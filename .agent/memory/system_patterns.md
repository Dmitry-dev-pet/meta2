# Системные Паттерны

## Архитектура
Проект использует **Слоистую Архитектуру** для разделения ответственности и улучшения поддерживаемости.

### Слои
1.  **API Layer** (`src/data_importer/api/`)
    -   Обрабатывает HTTP запросы/ответы.
    -   Валидация входных данных через Pydantic схемы.
    -   Делегирует бизнес-логику сервисам.
2.  **Service Layer** (`src/data_importer/services/`)
    -   Содержит основную бизнес-логику.
    -   `ImportService`: Оркестрирует процесс импорта.
    -   `DataProcessor`: Обрабатывает трансформацию и фильтрацию данных.
    -   `GoogleSheetsClient`: Управляет взаимодействием с внешним API.
3.  **Data Access Layer** (`src/data_importer/models/`)
    -   SQLAlchemy ORM модели (`User`, `Project`, `Review` и др.).
    -   Адаптер базы данных для управления сессиями.

## Паттерны Проектирования
-   **Внедрение Зависимостей (Dependency Injection)**: Сервисы инициализируются и внедряются там, где они нужны (например, `get_google_sheets_client`).
-   **Одиночка (Singleton)**: `GoogleSheetsClient` и `Settings` реализованы как синглтоны.
-   **Адаптер (Adapter)**: `DatabaseAdapter` абстрагирует используемый движок базы данных (SQLite/PostgreSQL).
-   **Репозиторий (Repository)** (Неявный): Операции с базой данных инкапсулированы внутри сервисного слоя (могут быть вынесены в явные репозитории в будущем).

## Стандарты Кодирования
-   **Async/Await**: Все операции ввода-вывода (БД, Сеть) асинхронны.
-   **Type Hinting**: Полное использование аннотаций типов Python.
-   **Конфигурация**: Pydantic `BaseSettings` для конфигурации через переменные окружения.
-   **Логирование**: Структурированное логирование с `structlog` (или стандартное logging, настроенное на JSON/Text вывод).

## Поток Данных
1.  **Получение (Fetch)**: `GoogleSheetsClient` скачивает сырые данные.
2.  **Обработка (Process)**: `DataProcessor` очищает, валидирует и фильтрует данные.
3.  **Импорт (Import)**: `ImportService` записывает обработанные данные в базу данных в рамках транзакции.
4.  **Отчет (Report)**: Генерируется и сохраняется статистика.

## Стандарты Верификации
-   **Обязательная проверка дроидами**: Перед завершением задач или после значительных изменений кода необходимо запускать:
    -   `ruff-fix` (Линтинг и авто-исправление)
    -   `black-format` (Форматирование)
    -   `typecheck` (Проверка типов)
