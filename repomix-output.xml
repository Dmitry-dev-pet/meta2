This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  scripts/
    generate-docs-map.py
    parse-changelog.js
  workflows/
    changelog-to-discord.yml
    generate-docs-map.yml
    issue-label-slack.yml
docs/
  changelog/
    1-10.mdx
    1-8.mdx
    1-9.mdx
    cli-updates.mdx
  cli/
    account/
      droid-shield.mdx
      security.mdx
    byok/
      baseten.mdx
      deepinfra.mdx
      fireworks.mdx
      google-gemini.mdx
      groq.mdx
      huggingface.mdx
      ollama.mdx
      openai-anthropic.mdx
      openrouter.mdx
      overview.mdx
    configuration/
      hooks/
        auto-formatting.mdx
        code-validation.mdx
        documentation-sync.mdx
        git-workflows.mdx
        logging-analytics.mdx
        notifications.mdx
        session-automation.mdx
        testing-automation.mdx
      skills/
        data-querying.mdx
        frontend-ui-integration.mdx
        internal-tools.mdx
        service-integration.mdx
      agents-md.mdx
      byok.mdx
      custom-droids.mdx
      custom-slash-commands.mdx
      hooks-guide.mdx
      ide-integrations.mdx
      mcp.mdx
      mixed-models.mdx
      settings.mdx
      skills.mdx
    droid-exec/
      cookbook/
        code-review-picture-1.png
        code-review-picture-2.png
        code-review.mdx
        github-actions.mdx
        refactor-error-messages.mdx
        refactor-fix-lint.mdx
        refactor-imports.mdx
      overview.mdx
    getting-started/
      common-use-cases.mdx
      how-to-talk-to-a-droid.mdx
      overview.mdx
      quickstart.mdx
      video-walkthrough.mdx
    user-guides/
      auto-run.mdx
      become-a-power-user.mdx
      choosing-your-model.mdx
      implementing-large-features.mdx
      specification-mode.mdx
  enterprise/
    compliance-audit-and-monitoring.mdx
    hierarchical-settings-and-org-control.mdx
    identity-and-access.mdx
    identity-sso-and-scim.mdx
    index.mdx
    llm-safety-and-agent-controls.mdx
    models-llm-gateways-and-integrations.mdx
    network-and-deployment.mdx
    privacy-and-data-flows.mdx
    usage-cost-and-analytics.mdx
  guides/
    building/
      droid-exec-tutorial.mdx
      droid-vps-setup.mdx
    product/
      coming-soon.mdx
  images/
    features/
      at_command.png
    logos/
      linear.svg
    overview/
      context.jpg
      fragments.jpg
      san_fran.jpg
      workflows.jpg
    quickstart/
      assembly-ask-options.png
      assembly-generate-ui.png
      assembly-landing-view.png
      assembly-new-session.png
      assembly-see-code.png
      assembly-select-blueprint.png
      assembly-ui-instructions.png
    tutorial/
      atcommand.png
      bridge-menu-mcp.png
      chathistory.png
      chatusecases.png
      chooserepo.png
      contextpanel.png
      fragmentviewer.png
      homepage.png
      homepagesession.png
      lfs.png
      new session.png
      newsession.png
      newsession1.png
      newsessionbutton.png
      remoterepo.png
      removecontext.png
      step-1.webp
      step-10.webp
      step-11.webp
      step-2.webp
      step-3.webp
      step-4.webp
      step-5.webp
      step-6.webp
      step-7.webp
      step-8.webp
      step-9.webp
      threads.png
      threadssession.png
      use cases.png
      usecases.png
    web/
      bridge-connection.gif
      context-panel.png
      droid-selection.gif
      factoryhomepage.png
      machine-connection-start.gif
      model-tool-selection.gif
    1.2ReleaseNotesv2.png
    add-new-panel.gif
    assembly-homepage.png
    at-command-options.mp4
    change-panel-type.gif
    CHAT_HISTORY.mp4
    codebase-explorer.mp4
    confluence-integration-example.png
    custom_models.png
    droid_ascii.gif
    droid_logo_cli.png
    droid_tui_intro.png
    droid_tui_logo.png
    FACTORY_SOCIAL.jpg
    factory-api-key.mp4
    factoryhomepage.png
    fragment-export-options.png
    fragments-demo.mp4
    getting-started-overview.mp4
    hero-dark.svg
    hero-light.svg
    image.png
    image(3).png
    image(4).png
    jira-integration-example.png
    local-file-sync.mp4
    mcp-registry-2.gif
    notion-at-command.png
    pr-integration-example.png
    product-image.png
    repository-search.mp4
    resize-panels.gif
    Screenshot2025-05-28at11.16.54PM.png
    Screenshot2025-05-28at11.19.47PM.png
    Screenshot2025-05-28at11.22.14PM.png
    Screenshot2025-05-28at11.27.50PM.png
    Screenshot2025-05-28at11.31.03PM.png
    Screenshot2025-05-28at11.33.23PM.png
    Screenshot2025-05-28at11.41.15PM.png
    Screenshot2025-05-28at4.38.28PM.png
    Screenshot2025-05-28at4.46.10PM.png
    Screenshot2025-05-28at9.20.17PM.png
    Screenshot2025-05-28at9.48.30PM.png
    SLACK_DEMO1.gif
    ToDoTool-demo.gif
    top-bar-navigation.mp4
    web-integration-example.png
  logo/
    dark.svg
    light.png
    light.svg
  onboarding/
    configuring-your-factory/
      droid-yaml-configuration.mdx
    configuring-your-review-droid/
      droid-yaml-configuration.mdx
      review-droid-guidelines.mdx
    creating-your-factory/
      basic-integrations.mdx
      signup.mdx
      sso-setup.mdx
      user-permissions.mdx
    integrating-with-your-engineering-system/
      github-cloud.mdx
      github-enterprise-server.mdx
      gitlab-cloud.mdx
      gitlab-self-hosted.mdx
      googledrive.mdx
      jira.mdx
      linear.mdx
      notion.mdx
      pagerduty.mdx
      sentry.mdx
      slack.mdx
    index.mdx
  reference/
    cli-reference.mdx
    hooks-reference.mdx
  web/
    getting-started/
      overview.mdx
      quickstart.mdx
    machine-connection/
      factory-bridge/
        best-practices.mdx
        cli-tools-reference.mdx
        installation-and-usage.mdx
        model-context-protocol.mdx
        troubleshooting.mdx
      remote-workspaces/
        best-practices.mdx
        index.mdx
        installation-and-usage.mdx
        setup-script.mdx
        troubleshooting.mdx
  welcome/
    index.mdx
  convert_md_to_mdx.sh
  docs.json
  factory-docs-map.mdx
  factoryhomepage.png
  favicon.svg
  pricing.mdx
  README.md
  style.css
examples/
  droid-code-review-workflow/
    .github/
      workflows/
        droid-code-review.yml
    README.md
  .gitkeep
.gitignore
community-builds.md
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".github/scripts/generate-docs-map.py">
#!/usr/bin/env python3
"""
Generate a comprehensive documentation map for Factory docs.
This script creates an unlisted page that outlines all documentation with heading structure.
Inspired by Claude Code's documentation map approach.
"""

import os
import re
from pathlib import Path
from datetime import datetime
from typing import List, Dict, Tuple
from collections import defaultdict

DOCS_ROOT = Path("docs")
OUTPUT_FILE = DOCS_ROOT / "factory_docs_map.mdx"
BASE_URL = "https://docs.factory.ai"

def extract_frontmatter(content: str) -> Dict[str, str]:
    """Extract frontmatter from MDX file."""
    frontmatter = {}
    if content.startswith("---"):
        end = content.find("---", 3)
        if end != -1:
            fm_content = content[3:end].strip()
            for line in fm_content.split("\n"):
                if ":" in line:
                    key, value = line.split(":", 1)
                    frontmatter[key.strip()] = value.strip().strip('"').strip("'")
    return frontmatter

def extract_headings(content: str) -> List[Tuple[int, str]]:
    """Extract markdown headings from content."""
    # Remove frontmatter
    if content.startswith("---"):
        end = content.find("---", 3)
        if end != -1:
            content = content[end + 3:]
    
    headings = []
    for line in content.split("\n"):
        match = re.match(r"^(#{1,6})\s+(.+)$", line.strip())
        if match:
            level = len(match.group(1))
            title = match.group(2).strip()
            # Remove markdown links but keep the text
            title = re.sub(r'\[([^\]]+)\]\([^\)]+\)', r'\1', title)
            # Remove HTML tags
            title = re.sub(r'<[^>]+>', '', title)
            headings.append((level, title))
    
    return headings

def get_doc_groups(docs_files: List[Path]) -> Dict[str, List[Path]]:
    """Organize documentation files by their top-level directory."""
    groups = defaultdict(list)
    
    for doc_file in docs_files:
        rel_path = doc_file.relative_to(DOCS_ROOT)
        parts = rel_path.parts
        
        if len(parts) == 1:
            # Root level docs
            groups["Root"].append(doc_file)
        else:
            # Group by top-level directory
            group_name = parts[0].replace("-", " ").replace("_", " ").title()
            groups[group_name].append(doc_file)
    
    return dict(sorted(groups.items()))

def get_page_url(doc_file: Path) -> str:
    """Generate the documentation URL for a file."""
    rel_path = doc_file.relative_to(DOCS_ROOT)
    # Remove .mdx extension and convert to URL path
    url_path = str(rel_path.with_suffix("")).replace("\\", "/")
    # Remove /index from the end if present
    if url_path.endswith("/index"):
        url_path = url_path[:-6]
    return f"{BASE_URL}/{url_path}"

def get_page_title(doc_file: Path, frontmatter: Dict[str, str]) -> str:
    """Get the page title from frontmatter or filename."""
    if "title" in frontmatter:
        return frontmatter["title"]
    elif "sidebarTitle" in frontmatter:
        return frontmatter["sidebarTitle"]
    else:
        # Use filename without extension
        return doc_file.stem.replace("-", " ").replace("_", " ").title()

def format_heading_as_bullet(level: int, title: str) -> str:
    """Format a heading as a nested bullet point."""
    indent = "  " * (level - 2)  # Start from h2 (level 2)
    return f"{indent}- {title}"

def should_exclude_file(file_path: Path) -> bool:
    """Determine if a file should be excluded from the docs map."""
    rel_path = str(file_path.relative_to(DOCS_ROOT))
    
    # Exclude patterns
    exclude_patterns = [
        "changelog/",
    ]
    
    # Check if file matches any exclude pattern
    for pattern in exclude_patterns:
        if rel_path.startswith(pattern):
            return True
    
    # Exclude specific files
    if file_path.name.lower() == "readme.md":
        return True
    if "factory_docs_map" in file_path.name:
        return True
    
    return False

def generate_docs_map() -> str:
    """Generate the complete documentation map."""
    # Find all MDX files
    mdx_files = sorted(DOCS_ROOT.glob("**/*.mdx"))
    md_files = sorted(DOCS_ROOT.glob("**/*.md"))
    
    # Filter out excluded files
    doc_files = [f for f in mdx_files + md_files if not should_exclude_file(f)]
    
    # Group documentation files
    doc_groups = get_doc_groups(doc_files)
    
    # Start building the markdown
    lines = [
        "---",
        'title: "Factory Documentation Map"',
        'description: "A comprehensive map of all Factory documentation pages with their headings for easy LLM navigation"',
        "---",
        "",
        "# Factory Documentation Map",
        "",
        "This is a comprehensive map of all Factory documentation pages with their headings, designed for easy navigation by LLMs and developers.",
        "",
        "> **Note:** This file is auto-generated by GitHub Actions. Do not edit manually.",
        f"> Last updated: {datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S')} UTC",
        "",
        "## Document Structure",
        "",
        "This map uses a hierarchical structure:",
        "",
        "- **##** marks documentation groups (e.g., 'CLI', 'Web', 'User Guides')",
        "- **###** marks individual documentation pages",
        "- **Nested bullets** show the heading structure within each page",
        "- Each page title links to the full documentation",
        "",
    ]
    
    # Generate documentation for each group
    for group_name, files in doc_groups.items():
        lines.append(f"## {group_name}")
        lines.append("")
        
        # Sort files by path for consistent ordering
        sorted_files = sorted(files, key=lambda f: f.relative_to(DOCS_ROOT))
        
        for doc_file in sorted_files:
            try:
                content = doc_file.read_text(encoding="utf-8")
                frontmatter = extract_frontmatter(content)
                page_title = get_page_title(doc_file, frontmatter)
                page_url = get_page_url(doc_file)
                
                # Add page title with link
                rel_path = doc_file.relative_to(DOCS_ROOT)
                lines.append(f"### [{page_title}]({page_url})")
                lines.append("")
                
                # Extract and add headings
                headings = extract_headings(content)
                if headings:
                    for level, title in headings:
                        if level >= 2:  # Skip h1 as it's usually the page title
                            lines.append(format_heading_as_bullet(level, title))
                    lines.append("")
                
            except Exception as e:
                print(f"Warning: Could not process {doc_file}: {e}")
                continue
    
    return "\n".join(lines)

def main():
    """Main execution function."""
    print("Generating Factory documentation map...")
    
    # Generate the documentation map
    docs_map = generate_docs_map()
    
    # Write to output file
    OUTPUT_FILE.write_text(docs_map, encoding="utf-8")
    
    print(f"Documentation map generated successfully: {OUTPUT_FILE}")
    print(f"Total lines: {len(docs_map.splitlines())}")

if __name__ == "__main__":
    main()
</file>

<file path=".github/scripts/parse-changelog.js">
#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

function parseChangelog(filePath) {
  const content = fs.readFileSync(filePath, 'utf-8');
  
  // Extract the first <Update> block
  const updateMatch = content.match(/<Update\s+label="([^"]+)"\s+rss=\{\{\s*title:\s*"([^"]+)",\s*description:\s*"([^"]+)"\s*\}\}>([\s\S]*?)<\/Update>/);
  
  if (!updateMatch) {
    console.error('No update block found');
    process.exit(1);
  }
  
  const [, date, title, description, body] = updateMatch;
  
  // Extract version number
  const versionMatch = body.match(/`([^`]+)`/);
  const version = versionMatch ? versionMatch[1] : '';
  
  // Extract sections
  const newFeaturesMatch = body.match(/## New features\s*([\s\S]*?)(?=##|\s*<\/Update>|$)/);
  const bugFixesMatch = body.match(/## Bug fixes\s*([\s\S]*?)(?=##|\s*<\/Update>|$)/);
  const enhancementsMatch = body.match(/## New features and enhancements\s*([\s\S]*?)(?=##|\s*<\/Update>|$)/);
  const stabilityMatch = body.match(/## Bug fixes and stability\s*([\s\S]*?)(?=##|\s*<\/Update>|$)/);
  
  // Extract bullet points
  function extractBullets(text) {
    if (!text) return [];
    const bullets = [];
    const lines = text.split('\n');
    for (const line of lines) {
      const trimmed = line.trim();
      if (trimmed.startsWith('* **')) {
        // Extract bold title and description
        const match = trimmed.match(/\*\s+\*\*([^*]+)\*\*:?\s*-?\s*(.*)/);
        if (match) {
          bullets.push(`‚Ä¢ ${match[1]}${match[2] ? ': ' + match[2] : ''}`);
        }
      } else if (trimmed.startsWith('* ')) {
        bullets.push(`‚Ä¢ ${trimmed.substring(2)}`);
      }
    }
    return bullets;
  }
  
  const newFeatures = extractBullets(newFeaturesMatch?.[1] || enhancementsMatch?.[1] || '');
  const bugFixes = extractBullets(bugFixesMatch?.[1] || stabilityMatch?.[1] || '');
  
  // Get changelog URL
  const fileName = path.basename(filePath, '.mdx');
  const changelogUrl = `https://docs.factory.ai/changelog/${fileName}`;
  
  // Build Discord message
  let message = `üìù **New Factory Changelog`;
  if (version) {
    message += `: ${version}**`;
  } else {
    message += `**`;
  }
  message += ` (${date})\n\n`;
  
  if (newFeatures.length > 0) {
    message += `**New features**\n`;
    message += newFeatures.slice(0, 5).join('\n') + '\n\n';
  }
  
  if (bugFixes.length > 0) {
    message += `**Bug fixes**\n`;
    message += bugFixes.slice(0, 5).join('\n') + '\n\n';
  }
  
  message += `View full changelog: ${changelogUrl}`;
  
  // Trim message to Discord's 2000 character limit
  if (message.length > 2000) {
    message = message.substring(0, 1950) + '...\n\n' + `View full changelog: ${changelogUrl}`;
  }
  
  return message;
}

// Main execution
if (require.main === module) {
  const filePath = process.argv[2];
  if (!filePath) {
    console.error('Usage: node parse-changelog.js <path-to-changelog.mdx>');
    process.exit(1);
  }
  
  try {
    const message = parseChangelog(filePath);
    console.log(message);
  } catch (error) {
    console.error('Error parsing changelog:', error.message);
    process.exit(1);
  }
}

module.exports = { parseChangelog };
</file>

<file path=".github/workflows/changelog-to-discord.yml">
name: Post Changelog to Discord

on:
  push:
    branches: [main]
    paths:
      - 'docs/changelog/*.mdx'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Get changed changelog files
        id: changes
        run: |
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | grep 'docs/changelog/' || echo "")
          echo "Changed files: $CHANGED_FILES"
          if [ -n "$CHANGED_FILES" ]; then
            # Get the first changed file
            FIRST_FILE=$(echo "$CHANGED_FILES" | head -n 1)
            echo "file=$FIRST_FILE" >> $GITHUB_OUTPUT
          fi

      - name: Setup Node.js
        if: steps.changes.outputs.file != ''
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Parse changelog and post to Discord
        if: steps.changes.outputs.file != ''
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          CHANGELOG_FILE: ${{ steps.changes.outputs.file }}
        run: |
          if [ -z "${DISCORD_WEBHOOK_URL}" ]; then
            echo "Discord webhook URL not provided. Skipping notification."
            exit 0
          fi

          # Parse the changelog
          MESSAGE=$(node .github/scripts/parse-changelog.js "$CHANGELOG_FILE")
          
          if [ -z "$MESSAGE" ]; then
            echo "Failed to parse changelog"
            exit 1
          fi
          
          echo "Posting to Discord:"
          echo "$MESSAGE"
          
          # Create JSON payload
          PAYLOAD=$(jq -n --arg content "$MESSAGE" '{
            content: $content
          }')
          
          # Post to Discord
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD" \
            "$DISCORD_WEBHOOK_URL"
          
          echo "Successfully posted to Discord!"
</file>

<file path=".github/workflows/generate-docs-map.yml">
name: Generate Documentation Map

on:
  push:
    branches:
      - main
    paths:
      - 'docs/**/*.md'
      - 'docs/**/*.mdx'
      - '.github/scripts/generate-docs-map.py'
      - '.github/workflows/generate-docs-map.yml'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  generate-docs-map:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Generate documentation map
        run: |
          python .github/scripts/generate-docs-map.py
      
      - name: Check for changes
        id: check_changes
        run: |
          if git diff --quiet docs/factory_docs_map.mdx; then
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi
      
      - name: Commit and push changes
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add docs/factory_docs_map.mdx
          git commit -m "docs: auto-update documentation map [skip ci]"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Summary
        run: |
          if [ "${{ steps.check_changes.outputs.changed }}" == "true" ]; then
            echo "‚úÖ Documentation map updated and committed"
          else
            echo "‚ÑπÔ∏è Documentation map is already up to date"
          fi
</file>

<file path=".github/workflows/issue-label-slack.yml">
name: Issue label Slack notifier

on:
  issues:
    types:
      - labeled

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare summary
        id: prepare
        uses: actions/github-script@v7
        with:
          script: |
            const issueBody = (context.payload.issue.body || '').trim();
            let summary = issueBody;
            if (summary) {
              summary = summary.replace(/\r\n/g, '\n');
              summary = summary.replace(/\n{3,}/g, '\n\n');
              if (summary.length > 400) {
                summary = summary.slice(0, 400).trimEnd() + '‚Ä¶';
              }
            }
            core.setOutput('summary', summary);

      - name: Add üëÄ reaction
        if: github.event.action == 'labeled'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.reactions.createForIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              content: 'eyes'
            });

      - name: Send Slack notification
        env:
          WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_SUMMARY: ${{ steps.prepare.outputs.summary }}
        run: |
          if [ -z "${WEBHOOK_URL}" ]; then
            echo "Slack webhook URL not provided." >&2
            exit 1
          fi

          if ! command -v jq >/dev/null 2>&1; then
            echo "jq is required but not available" >&2
            exit 1
          fi

          payload=$(jq -n --arg url "$ISSUE_URL" --arg title "$ISSUE_TITLE" --arg summary "$ISSUE_SUMMARY" '{
            text: $url,
            unfurl_links: true,
            unfurl_media: false,
            blocks: (
              if ($summary | length) > 0 then
                [
                  {
                    type: "section",
                    text: {
                      type: "mrkdwn",
                      text: "<\($url)|\($title)>"
                    }
                  },
                  {
                    type: "section",
                    text: {
                      type: "mrkdwn",
                      text: $summary
                    }
                  }
                ]
              else
                [
                  {
                    type: "section",
                    text: {
                      type: "mrkdwn",
                      text: "<\($url)|\($title)>"
                    }
                  }
                ]
              end
            )
          }')

          curl -X POST -H 'Content-type: application/json' --data "$payload" "$WEBHOOK_URL"
</file>

<file path="docs/changelog/1-10.mdx">
---
title: "Factory Release 1.10"
description: "MCP Manager, custom completion sounds, and Droid hooks"
draft: false
---

Factory 1.10 introduces a visual MCP Manager for extending Droid with external tools, customizable completion sounds to personalize your workflow, and Droid hooks‚Äîan experimental feature that gives you programmatic control over Droid's behavior.

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://youtube.com/embed/yBEbnA5j7iU"
  title="Factory 1.10 Release"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## MCP Manager

Connect Droid to external services with an intuitive visual interface. The MCP Manager lets you browse, authenticate, and manage Model Context Protocol servers without editing config files.

**How it works**

Type `/mcp` to open the interactive MCP Manager. Browse connected and available servers, view the tools each server provides, and authenticate with OAuth for services like Notion, Linear, and Stripe.

For servers in our registry, Droid automatically helps you add OAuth credentials, making setup a breeze. For servers not in the registry, you can still add them manually using the same interface you'd use in any other MCP-compatible app.

**What you can do**

- Browse all connected and disconnected MCP servers in one place
- Authenticate HTTP servers with OAuth credentials
- View the complete list of tools provided by each server
- Add new servers using the interactive form or command
- Enable, disable, or remove servers without touching config files

<Note>Learn more about [MCP configuration](/cli/configuration/mcp).</Note>

## Custom completion sounds

Get notified your way when Droid finishes a task. Choose from built-in sounds, use a terminal bell, or load your own custom audio file.

**How it works**

Navigate to Settings and find the "Completion sound" option. Select from:

- **Off** - No sound
- **Terminal Bell** - Standard system bell
- **FX-OK01** - A sound generated by Droid
- **FX-ACK01** - Produced by The Chainsmokers (because we won't let you down)
- **Custom Sound** - Upload your own audio file

You can also control when sounds play with the "Sound focus mode" setting:

- **Always** - Play sound regardless of window focus
- **When focused** - Only play when Droid window is active
- **When unfocused** - Only play when you're working elsewhere

Perfect for staying in flow while multitasking or working across multiple windows.

## Droid hooks (Experimental)

Run custom shell commands at key points in Droid's lifecycle. Hooks give you deterministic control over Droid's behavior, ensuring certain actions always happen rather than relying on the LLM to remember.

<Warning>
  Hooks are an experimental feature. They execute arbitrary shell commands on your system automatically. Always review hook implementations before registering them, as hooks run with your current environment's credentials.
</Warning>

**How it works**

1. Run the `/hooks` command to open the Hooks Manager
2. Navigate to a hook event like `PreToolUse`
3. Add a matcher to specify which tools trigger your hook (e.g., `Bash` for shell commands)
4. Add your hook command (e.g., a script that validates bash commands)
5. Save to User or Project settings
6. Your hook runs automatically whenever conditions match

**Use cases**

- **Automatic formatting** - Run `prettier` on TypeScript files or `gofmt` on Go files after every edit
- **Custom permissions** - Block modifications to production files or sensitive directories
- **Logging** - Track and count all executed commands for compliance or debugging
- **Feedback** - Provide automated feedback when Droid produces code that doesn't follow your conventions
- **Notifications** - Customize how you get notified when Droid needs input

**Example**: Add a `PreToolUse` hook with a `Bash` matcher that validates shell commands. When Droid tries to use `grep`, your hook blocks it and suggests using `rg` (ripgrep) instead. Droid receives the feedback and automatically adapts‚Äîno manual intervention required.

**Available hook events**

- **PreToolUse** - Runs before tool calls (can block them)
- **PostToolUse** - Runs after tool calls complete
- **UserPromptSubmit** - Runs when you submit a prompt
- **Notification** - Runs when Droid sends notifications
- **Stop** - Runs when Droid finishes responding
- **SubagentStop** - Runs when subagent tasks complete
- **PreCompact** - Runs before compact operations
- **SessionStart** - Runs at session start or resume
- **SessionEnd** - Runs when session ends

By encoding rules as hooks rather than prompt instructions, you turn suggestions into app-level code that executes every time it's expected to run. There are infinitely many applications‚Äîwe're excited to see what you build.

<Note>
  For comprehensive hook documentation, see the [hooks guide](/cli/configuration/hooks-guide) and [hooks reference](/reference/hooks-reference).
</Note>
</file>

<file path="docs/changelog/1-8.mdx">
---
title: "Factory Release 1.8"
description: "Headless CLI, Slack and Linear integrations"
draft: false
---

Factory 1.8 introduces Droid Exec, a headless execution mode for automation workflows, plus revamped Slack and Linear integrations that let you delegate complete tasks without leaving your collaboration tools.

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://www.youtube.com/embed/48cDQQU1HxQ"
  title="Factory 1.8 Release"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## Droid Exec: Headless CLI mode

Automate repetitive tasks at scale. Droid Exec is a one-shot command designed for CI/CD pipelines, shell scripts, and batch processing.

**How it works**

Run Droid Exec directly from the command line with configurable autonomy levels and output formats (including JSON). The command processes tasks concurrently with robust error handling‚Äîif one file fails, the batch continues.

**Use cases**

- Refactor code patterns across hundreds of files
- Generate or update tests in bulk
- Update dependencies project-wide
- Enforce coding standards across codebases
- Improve error messages and documentation

**Example**: Search for error instantiations across a codebase and improve messages using concurrent Droid Exec commands, processing up to 5 files at once.

<Note>Learn how to configure and run headless sessions in the [Droid Exec overview](/cli/droid-exec/overview).</Note>

## Slack integration

Delegate incidents and tasks directly from Slack threads. @mention Factory in any incident thread to spin up a headless session with full context.

**How it works**

1. @mention Factory in a Slack thread
2. Select your workspace if prompted
3. Factory starts a Droid session and drops a live session link in the thread
4. Your team can track progress in real-time

Perfect for incident response, debugging, and collaborative problem-solving without context switching.

## Linear integration

Assign Factory to Linear issues and let Droids work through tickets autonomously. Progress updates are posted directly back to Linear, keeping your team in sync.

**How it works**

1. Set Factory as the assignee on a Linear issue
2. Droid accesses full context of your code and conversation
3. As Droid makes progress, updates are posted back to Linear
4. Your team stays informed without manual check-ins

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://www.youtube.com/embed/bvEp0X9hSaI"
  title="Linear Demo"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## Sentry + Linear workflow

Take incident response workflows a step farther. Assign a ticket to Sentry to RCA an issue, then assign the fix to Factory. Full observability-to-resolution pipeline without leaving your tools.

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://www.youtube.com/embed/JmBHGKqtqJo"
  title="Senty and Linear"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## Droids everywhere

Droids work everywhere you go‚Äîfrom IDE to CI/CD to collaboration tools. Delegate incident response, migrations, and complete development tasks to Droids without changing your tools, models, or workflows.

Factory ranks as the world's leading coding agent on Terminal Bench, bringing agent-native development to your entire stack.
</file>

<file path="docs/changelog/1-9.mdx">
---
title: "Factory Release 1.9"
description: "Mixed models, custom subagents, and GitHub PR reviews"
draft: false
---

Factory 1.9 brings mixed models to let you choose the right model for each phase of work, custom subagents you can tailor to your workflow, and automated PR reviews through our new GitHub App.

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://www.youtube.com/embed/G1mN425ZKZQ"
  title="Factory 1.9 Release"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## Mixed models

Plan complex features with a more capable model, then execute efficiently with a faster one‚Äîall in the same session without restarting.

Access the `/model` command to configure your spec model separately from execution. Switch between Sonnet 4.5 for architectural planning and Haiku 4.5 for implementation, or test different combinations to optimize for cost and latency.

<Note>Learn more about [mixed models](/cli/configuration/mixed-models).</Note>

## Custom subagents

Build specialized Droids for your workflow. Configure tools, models, and behavior.

**How it works**

1. Enable Custom Droids in `/settings`
2. Launch `/droids` to open the Droids Manager
3. Create subagents manually or let Factory generate them
4. Configure which tools and models each subagent uses
5. Delegate tasks to your custom Droids mid-session

**Use cases**

- Security specialists for code review and compliance checks
- Codebase explorers for architectural analysis
- Test generators for comprehensive test coverage
- Documentation writers for API and feature docs

<Note>Explore [custom droids](/cli/configuration/custom-droids)</Note>

## Factory GitHub App for PR reviews

Automate code reviews directly in your pull requests. Factory's GitHub App provides inline feedback with full context‚Äîno manual CLI setup required.

[Install Factory Droid Review on GitHub Marketplace ‚Üí](https://github.com/marketplace/actions/factory-droid-review)

Add the app to your repository and configure your workflow with the `Factory-AI/droid-code-review@latest` action. Droids analyze PR changes and leave detailed comments on specific lines, catching issues early and maintaining code quality standards.

**Example**

```yaml
- name: Droid Review
  uses: Factory-AI/droid-code-review@latest
```
</file>

<file path="docs/changelog/cli-updates.mdx">
---
title: "CLI Updates"
description: "Recent features and improvements to Factory CLI"
rss: true
---

<Update label="November 18" rss={{ title: "CLI Updates", description: "Claude Code hooks migration, improved suggestions, and GLM support" }}>
  `v0.26.3`

  ## New features

  * **Skills Enabled by Default** - Skills command now enabled for all users
  * **Claude Code Hooks Auto-Migration** - Automatically detects and imports hooks from Claude Code CLI with interactive prompts. Smart translation converts `bash_tool` to `Execute` and `CLAUDE_CWD` to `DROID_CWD`, preventing duplicates and tracking migration state
  * **@ Suggestions Improvements** - Now includes folders in addition to files with better UI and performance

  ## Bug fixes

  * Fixed GLM4.6 configuration issues preventing it from working in spec mode
  * Fixed warmup API calls
  * Shift+Backspace now deletes single character like Backspace

</Update>

<Update label="November 14" rss={{ title: "CLI Updates", description: "Skills system, session favorites, and improved git integration" }}>
  `v0.26.0`

  ## New features

  * **Skills System** - Claude Code-compatible `.factory/skills` support for modular, prompt-based capabilities. Use the `/skills` command to manage skills and import from `.claude/skills` directories
  * **Session Favorites** - New `/favorite` command to pin/unpin sessions, keeping your active projects at the top of the session list
  * **Enhanced Bug Reporting** - The `/bug` command now zips session context, uploads it to Factory, and returns a shareable report ID automatically
  * **Cleaner Diff Viewer** - Improved UI with horizontal lines instead of borders

  ## Bug fixes

  * Always prompt to accept or reject generated specs and pass the correct labels to the UI flow
  * `droid spec` now writes files to the expected default path without manual overrides
  * Fixed autonomy handling so MCP tools respect the configured confirmation level in every session
  * Better error handling in pre-update logic
  * Added Axiom MCP server to the registry


</Update>

<Update label="November 13" rss={{ title: "CLI Updates", description: "Execute tool streaming, enhanced hooks system, and MCP autonomy controls" }}>
  `v0.25.0`

  ## New features

  * **Enhanced Hooks System** - Added 7 new hook types for complete lifecycle control:
    * UserPromptSubmit - Modify or validate prompts before they're sent to the agent
    * Stop - Execute custom logic when the agent completes (e.g., metrics collection)
    * SubagentStop - Track and log subagent task completion
    * PreCompact - Run custom logic before conversation compaction (can block compaction if needed)
    * SessionStart - Initialize sessions and inject environment variables
    * SessionEnd - Cleanup tasks when sessions end (triggered on logout, quit, Ctrl+C)
  * **MCP Tool Autonomy Levels** - Granular control over MCP tool confirmations: low autonomy requires confirmation for read-only MCP tools, high autonomy requires confirmation for all MCP tool calls
  * **Execute Tool Streaming** - Long-running commands now display the last two non-empty lines of output in real-time. No more wondering if Droid is stuck or slow.

  ## Bug fixes

  * Fixed paste handling in hooks UI - no more escape sequence artifacts when pasting commands
  * Fixed message ID alignment after conversation compaction
  * Fixed unfinished tool uses being cleared when switching providers to retry
  * Fixed markdown prompt usage for GPT models
  * Fixed /mcp rendering for narrow terminal windows
  * Fixed bracketed paste handling when suspending TUI
  * Authentication errors now appear directly in the CLI with clear error messages

</Update>

<Update label="November 12" rss={{ title: "CLI Updates", description: "Hooks system, interactive spec editing, and major performance improvements" }}>
  `v0.24.0`

  ## New features

  * **Hooks** - Introduced a powerful hooks system allowing you to run custom scripts before/after tool executions with configurable exit codes for different behaviors (success, warning, block, abort) - [Experimental - turn on in /settings]
  * **Interactive Spec Editing** - Added ability to interactively edit specs before execution
  * **Prompt Cache Warmup** - Added prompt-cache warmup while you're typing for faster responses

  ## Bug fixes

  * Fixed model switching to correctly handle conversation compaction when needed
  * Fixed spec mode tab cycling for reasoning levels
  * Fixed bracketed paste when suspending TUI
  * Corrected line numbers in ApplyPatch tool diff display
  * Eliminated race condition in ripgrep path resolution
  * Various agent loop stability improvements
  * Tool execution now correctly respects autonomy mode
  * Applied workaround for Figma MCP server compatibility

</Update>

<Update label="November 10" rss={{ title: "CLI Updates", description: "Markdown tables, pinned todos, and MCP improvements" }}>
  `v0.23.0`

  ## New features

  * **Markdown table rendering** - CLI now properly renders markdown tables for better display of structured data and documentation
  * **Pinned todo plans** - Pin important todo items to keep them visible and track tasks during long-running sessions
  * **MCP tool result formatting** - Improved formatting for MCP tool results with cleaner, more readable output

  ## Bug fixes

  * Fixed thinking block support for chat completion APIs to enable extended reasoning in compatible models
  * Fixed issue with baseline versions reverting back to non-baseline builds on update
  * Fixed autonomy mode handling in `droid exec` command for more reliable execution
  * Restored Ctrl+T keyboard shortcut functionality on Windows

</Update>

<Update label="November 7-8" rss={{ title: "CLI Updates", description: "Reasoning controls, bash output expansion, and MCP improvements" }}>
  `v0.22.14`

  ## New features

  * **Tab to cycle reasoning levels** - Navigate through different reasoning levels using the Tab key for better control
  * **Expanded bash mode outputs** - Transcript view now expands and displays bash command outputs for better visibility

  ## Bug fixes

  * Fixed MCP tool discovery for droid exec so tools appear correctly in --list-tools and pass validation
  * Fixed diff view to line wrap for better readability of long lines
  * Fixed OAuth refresh for MCP servers
  * Fixed markdown rendering bug in transcript view
  * Fixed message cancellation handling in TUI
  * Fixed prompt cache key handling in completions
  * Brought back Ctrl+T keyboard shortcut on Windows

</Update>

<Update label="November 6" rss={{ title: "CLI Updates", description: "Console improvements and enhanced reliability" }}>
  `v0.22.12`

  ## New features

  * **Quit/exit aliases** - type 'quit' or 'exit' commands for exiting sessions

  ## Bug fixes

  * Collect all AGENTS.md and CLAUDE.md files for system reminders
  * Fixed MCP server argument parsing when adding servers through the UI
  * Improved system diagnostics utilities for better troubleshooting
  * Cleaning and dynamic rendering of the pending tools to make it clear Droid is not stuck

</Update>

<Update label="November 5" rss={{ title: "CLI Updates", description: "Model support, tool permissions, and MCP improvements" }}>
  `v0.22.11`

  ## New features

  * **Context7 MCP server** - Added Context7 MCP server to the MCP registry

  ## Bug fixes

  * Improved droid exec run type tracking
  * Improved MCP client info handling

</Update>

<Update label="November 4" rss={{ title: "CLI Updates", description: "OAuth discovery, interrupt support, and stability improvements" }}>
  `v0.22.10`

  ## New features

  * **OAuth Discovery** - Automatically discover OAuth providers to streamline authentication setup for MCP
  * **OpenAI Reasoning Summaries** - Display OpenAI's extended reasoning summaries in expanded session view

  ## Bug fixes

  * Fixed copy-pasting behavior in terminal sessions
  * Improved timeout handling for more reliable operations
  * Enhanced Windows compatibility
  * Enable custom droids by default
  * Improved error logging and diagnostics

</Update>

<Update label="November 1" rss={{ title: "CLI Updates", description: "MCP Registry, tool permissions, session resume, and multiple bug fixes" }}>
  `v0.22.9`

  ## New features

  * **MCP Registry** - Added a curated selection of MCP servers for easy discovery and setup

    ![MCP Registry interface showing curated MCP servers](/images/mcp-registry-2.gif)

  * **Tool Permissions Support** - Implemented request tool permissions flow in stream-jsonrpc mode with support for multiple concurrent tool confirmations
  * **Session Resume** - Show resume command on exit (Ctrl+C or /quit) with new `-r, --resume` flag to continue sessions
  * **Thinking Traces Display** - Added UI component to show thinking blocks in expanded session view

  ## Bug fixes

  * Fixed CLI completion sounds by extracting embedded sound files to host filesystem, making them accessible to external shell commands
  * Fixed tool use in user message after tool cancellation
  * Added baseline builds for x64 CPUs (pre-2013) that don't support AVX2 SIMD instructions
  * Updated static split logic to use text messages as stable checkpoints, reducing flickering during rendering
  * Fixed storage and sending of Gemini thinking content from delta.extra_content.google
  * Removed MultiEdit tool due to low success rate (~80%)
  * Added recovery from malformed optional arguments using optimistic JSON parsing
</Update>

<Update label="October 31" rss={{ title: "CLI Updates", description: "Reasoning field support, Import from Claude, and bug fixes" }}>
  `v0.22.7`

  ## New features

  * **Reasoning field support in streaming responses** - Added support for displaying reasoning fields in chat completion streaming chunks for models that provide extended reasoning
  * **Import from Claude restored** - Re-enabled the "Import from Claude" option in the droids menu for easier conversation migration

  ## Bug fixes

  * Fixed MCP status indicator to only show when MCP servers are actually configured
  * Fixed message list flickering
  * Added support for custom headers when adding MCP servers
  * Fixed sound files not being included in SEA binary releases
  * Fixed Ctrl+C interruption messages to only display to users and not appear in logs for cleaner output
  * Resolved issue where tool use would incorrectly appear in user messages after tool cancellation
</Update>

<Update label="October 30" rss={{ title: "CLI Updates", description: "MCP Revamp and OpenAI organization field fix" }}>
  `v0.22.6`

  ## New features

  * **MCP Revamp**: Complete overhaul of Model Context Protocol implementation ([docs updated](https://docs.factory.ai/cli/configuration/mcp))

  ## Bug fixes

  * Fixed issue with OpenAI organization field
  * Restore Import (I) options in Droids (subagents) menu
</Update>

<Update label="October 29" rss={{ title: "CLI Updates", description: "Default model behavior improvements" }}>
  `v0.22.5`

  ## Bug fixes

  * **Default Model Behavior**: Improved default model behavior
</Update>

<Update label="October 28" rss={{ title: "CLI Updates", description: "Report previews and help text fixes" }}>
  `v0.22.4`

  ## Bug fixes

  * **Restored Report Previews**: Re-enabled HTML preview for reliability reports so you can view them directly in the web
  * **Fixed --help text**: Running droid exec --help was previously giving incorrect info for using droid exec in streaming mode. This has now been updated to include the correct flag name with correct instructions.
</Update>

<Update label="October 21-25" rss={{ title: "CLI Updates", description: "Detailed transcript view, customizable sounds, terminal setup support, and model upgrades" }}>
  `v0.22.3`

  ## New features and enhancements

  * **Detailed transcript view (Ctrl+O)**: Press Ctrl+O to view comprehensive tool execution details with complete breakdowns for all tool types including Execute, Edit, MultiEdit, Create, and more
  * **Customizable completion sounds**: Configure sound notifications when commands complete, with support for different sounds in focus mode and custom sound file paths
  * **Terminal setup support**: Added automated setup support for Warp, iTerm2, and macOS Terminal with automatic terminal indicators for improved integration
  * **PowerShell update**: Now uses `pwsh.exe` for better PowerShell compatibility and reliability on Windows systems
  * **Drag-and-drop image support**: Attach images to CLI sessions via drag-and-drop for easier multimodal interactions
  * **Custom models in subagents**: Added support for using custom models when executing subagents via Task tool
  * **Custom droid descriptions**: Moved custom droid descriptions to Task tool for better organization and usability
  * **`droid exec` custom model support**: Added support for custom models in droid exec sessions

  ## Bug fixes and stability

  * Resolved issues with prompt caching to improve performance and reduce costs
  * Added model ID logging on CLI tool execution for better observability
  * Limited messages rendered in Ctrl+O view to improve performance with large transcripts
  * Fixed sound files not being included in SEA binary releases
  * Fixed readonly value change issues that caused unexpected behavior
  * Fixed ExitSpecMode flickering issues for smoother user experience
  * Removed duplicate custom models header in settings
  * Improved session persistence to legacy sessions to maintain backward compatibility
  * Fixed infinite render issues on Windows systems
  * Fixed 400 error handling and validation
  * Added model validation error messages for better debugging
  * Fixed certificate loading timing to occur after logging initialization
</Update>

<Update label="October 14-20" rss={{ title: "CLI Updates", description: "MCP OAuth, system certificates, fuzzy search, and session management improvements" }}>
  `v0.21.3`

  ## New features and enhancements

  * **MCP OAuth support**: Added OAuth authentication support for Model Context Protocol in TUI for secure server connections
  * **System certificates support**: Added support for loading system certificates on Windows and macOS, with additional Windows system certificates support
  * **Fuzzy search implementation**: New fuzzy search for improved CLI command and option discovery
  * **Rewind fork workflow**: Added ability to rewind and fork from previous points in conversation sessions
  * **Bug report enhancements**: Added version, OS, and shell information to bug reports for better troubleshooting
  * **Live updates for subagent tool**: Added real-time progress updates when using the Task tool
  * **Enhanced custom droid prompts**: Improved prompts to encourage more proactive usage of custom droids
  * **Droid Shield optional setting**: Made Droid Shield an optional configurable setting with toggle support

  ## Bug fixes and stability

  * Added session_id to stream-json output format for better tracking and debugging
  * Enhanced authentication flow for smoother onboarding
  * Streamlined first-run experience by removing redundant onboarding steps
  * Fixed OAuth callback server port collision issues that prevented authentication
  * Fixed certificate loading timing issues causing TLS errors
  * Improved error metadata logging for better debugging
  * Fixed terminal setup issues across different shell environments
  * Better error messages when ripgrep (rg) isn't available in PATH
  * Improved handling of corrupted unicode normalization in file paths
  * Fixed impact level default value handling
</Update>

<Update label="September 30 - October 13" rss={{ title: "CLI Updates", description: "Droid exec enhancements, custom model support, streaming JSON, and stability improvements" }}>
  `v0.19.8`

  ## New features and enhancements

  * **`droid exec` Slack integration**: Added `slack_post_message` tool to droid exec for posting updates to Slack channels
  * **`droid exec` streaming JSON input mode**: Added streaming JSON input mode for multi-turn exec sessions for better automation workflows
  * **`droid exec` tool configuration**: Added ability to enable/disable specific tools in droid exec sessions
  * **`droid exec` pre-created session IDs**: Added support for pre-created session IDs in droid exec for better session management
  * **Initial prompt support**: Added support for launching TUI with an initial prompt via command line
  * **GLM-4.6 support**: Added LLM proxy support for GLM-4.6 with Fireworks, Baseten, and DeepInfra providers
  * **Azure OpenAI for GPT-5**: Added Azure OpenAI support for GPT-5 Codex in TUI
  * **Custom droid generation**: Added auto-generation of custom droids using LLM for faster setup
  * **MCP streamable HTTP servers**: Added support for streamable HTTP MCP servers
  * **Model selector refresh**: Updated model selector UI with improved organization and image support warnings
  * **Tab key auto-complete**: Tab key now auto-completes custom commands without submitting for better UX

  ## Bug fixes and stability

  * **`droid exec` session continuation fix**: Fixed droid exec to correctly continue an existing session instead of overwriting session data
  * Dynamic reasoning label for Codex models in UI
  * AGENTS.md source paths now shown in settings for better transparency
  * Better error messages when custom model JSON configuration is broken
  * Manual update instructions when auto-update isn't available
  * Fixed task subagents to properly terminate on abort
  * Fixed file rename retry logic on Windows systems
  * Fixed backslash rendering issues on Windows
  * Major improvements to custom subagents reliability
  * Fixed task tool subagents prompt for better execution
  * Don't stop agent on cancelled file edits in spec mode
  * Validated working directory exists before executing ripgrep
  * Fixed subagents to inherit model from TUI parent session
  * Truncated large MCP tool results to prevent context overflow
  * Fixed /cost command with Fireworks cached input
  * Added user-agent header to LLM requests for better tracking
  * Locked down file system permissions for better security
  * Fixed rendering for failed edit calls in spec mode
  * Fixed compaction logic and retry without tool results
  * Applied output transforms before compaction/caching
  * Persisted session's token usage for accurate cost tracking
  * Fixed /new command to reset timer and sessionId properly
  * Fixed compaction retry without tool results
  * Fixed screenshot reading with unicode normalization fallback
</Update>
</file>

<file path="docs/cli/account/droid-shield.mdx">
---
title: Droid Shield
description: Automatic secret detection to prevent accidental exposure of credentials in your git commits and pushes.
---

## What is Droid Shield?

Droid Shield is a built-in security feature that automatically scans un-committed changes for potential secrets before committing and pushing them to remote. It acts as a safety net to prevent accidental exposure of sensitive credentials like API keys, tokens, and passwords in your version control history.

---

## How Droid Shield Works

When you use Droid to perform `git commit` or `git push` operations, Droid Shield automatically:

1. **Scans the diff** - Analyzes only the lines being added (not removed or unchanged)
2. **Detects secrets** - Uses pattern matching to identify potential credentials
3. **Blocks execution** - Stops the git operation if secrets are detected
4. **Reports findings** - Shows exactly where potential secrets were found

<Note>
  Droid Shield only scans git operations performed through Droid. Manual git commands run outside of Droid are not affected.
</Note>

---

## What Droid Shield Detects

Droid Shield scans for a wide range of credential patterns, including:

<CardGroup cols={2}>
  <Card title="API Keys & Tokens" icon="key">
    Factory API keys, GitHub tokens, GitLab tokens, npm tokens, and API keys from (e.g. AWS, Google Cloud, Stripe, SendGrid) and more.
  </Card>
  <Card title="Authentication Credentials" icon="user-lock">
    (e.g. JWT, OAuth, session tokens), and URLs with embedded credentials.
  </Card>
  <Card title="Private Keys" icon="file-shield">
    (e.g. SSH private keys, PGP keys, age secret keys, OpenSSH keys), and other cryptographic key formats.
  </Card>
  <Card title="Service-Specific Secrets" icon="cloud">
    (e.g. Slack webhooks and tokens, Twilio credentials, Mailchimp keys, Square OAuth secrets, Azure storage keys).
  </Card>
</CardGroup>

### Detection Algorithm

Droid Shield uses smart pattern matching with randomness validation:

- **Pattern matching** - Identifies credentials by format
- **Randomness check** - Validates that captured values look like actual secrets
- **Context awareness** - Considers variable names and assignment patterns to reduce false positives

---

## When Droid Shield Activates

Droid Shield automatically activates during these git operations:

- **`git commit`** - Scans staged changes before creating the commit
- **`git push`** - Scans commits that would be pushed to the remote

<Warning>
  If secrets are detected, the git operation is blocked to prevent credential exposure. You'll need to remove the secrets before proceeding.
</Warning>

---

## Managing Droid Shield Settings

### In the CLI

You can toggle Droid Shield on or off through the settings menu:

1. Run `droid`
2. Enter `/settings`
3. Toggle **"Droid Shield"** setting
4. Changes take effect immediately

<Info>
  Droid Shield is **enabled by default** for your protection. We strongly recommend keeping it enabled.
</Info>

---

## What to Do if Secrets are Detected

When Droid Shield detects potential secrets, you'll see an error message like:

```
Droid-Shield has detected potential secrets in 2 location(s) across files:
src/config.ts, .env.example

If you would like to override, you can either:
1. Perform the commit/push yourself manually
2. Disable Droid Shield by running /settings and toggling the "Droid Shield" option
```

### Recommended Actions

<Steps>
  <Step title="Review the findings">
    Carefully examine the files and lines mentioned to identify what was detected.
  </Step>
  <Step title="Remove the secrets">
    - Use environment variables instead of hardcoded credentials
    - Move secrets to secure credential stores
    - Add sensitive files to `.gitignore`
    - Use git filter-branch or BFG Repo-Cleaner if secrets were already committed
  </Step>
  <Step title="Retry the operation">
    Once secrets are removed, run the git command again through Droid.
  </Step>
</Steps>

<Warning>
  **Never disable Droid Shield just to bypass the check.** Exposed credentials can lead to security breaches, unauthorized access, and compliance violations.
</Warning>

### If You Get a False Positive

Droid Shield uses conservative patterns to err on the side of caution. If you believe a detection is a false positive:

1. **Verify it's not a real secret** - Double-check that the value isn't sensitive
2. **Use a manual commit** - Perform the git operation yourself outside of Droid
3. **Report the pattern** - Contact support@factory.ai if you encounter recurring false positives

---

## Best Practices

<AccordionGroup>
  <Accordion title="Use environment variables">
    Store all secrets in environment variables or secure credential managers, never hardcode them in source files.
    
    ```bash
    # Good - Using environment variable
    const apiKey = process.env.FACTORY_API_KEY;
    
    # Bad - Hardcoded secret
    const apiKey = "fk-abc123xyz789...";
    ```
  </Accordion>
  
  <Accordion title="Keep Droid Shield enabled">
    Droid Shield provides an essential safety layer. Keep it enabled at all times, especially in team environments.
  </Accordion>
  
  <Accordion title="Review before committing">
    Even with Droid Shield, manually review your changes before committing to ensure no sensitive data is included.
  </Accordion>
  
  <Accordion title="Educate your team">
    Make sure all team members understand how Droid Shield works and why it's important to keep it enabled.
  </Accordion>
</AccordionGroup>

---

## Limitations

<Note>
  **Droid Shield is a detection tool, not a guarantee.** While it catches many common secret patterns, it cannot detect:
  - Custom secret formats not in the pattern database
  - Secrets that don't follow recognizable patterns
  - Obfuscated or encoded credentials
  - Business logic vulnerabilities or code security issues
  
  Always follow security best practices and never rely solely on automated tools for secret protection.
</Note>

---

## Related Resources

<CardGroup cols={2}>
  <Card title="Security Overview" icon="shield" href="/cli/account/security">
    Learn about Factory's comprehensive security features and best practices.
  </Card>
  <Card title="Settings" icon="gear" href="/cli/configuration/settings">
    Configure Droid settings including Droid Shield preferences.
  </Card>
</CardGroup>

---

## Need Help?

<CardGroup cols={2}>
  <Card title="Security Questions" icon="envelope">
    Email our security team: **security@factory.ai**
  </Card>
  <Card title="False Positives" icon="flag">
    Contact **support@factory.ai** to report persistent false positive patterns.
  </Card>
</CardGroup>
</file>

<file path="docs/cli/account/security.mdx">
---
title: Security
description: How Factory CLI keeps your code and data secure with built-in protections and best practices.
---

## Security-First Design

Factory CLI (Droid) is built with security at its core. Your code stays secure through encrypted authentication, strict permissions, and enterprise-grade protections.

---

## Key Security Features

<CardGroup cols={2}>
  <Card title="Secure Authentication" icon="shield-check">
    OAuth login with encrypted token storage. Tokens auto-rotate every 30 days and are stored with OS-level file permissions.
  </Card>
  <Card title="Permission Controls" icon="user-lock">
    All risky operations require explicit approval. Configure tool permissions from allow/ask/reject per your security needs.
  </Card>
  <Card title="Data Encryption" icon="lock">
    All data encrypted in transit (TLS 1.3) and at rest (AES-256 with AWS KMS). Factory never trains on your code.
  </Card>
  <Card title="Local Execution" icon="computer">
    Shell commands and file edits run locally. Only necessary context and diffs are sent to Factory's secure cloud.
  </Card>
</CardGroup>

---

## Security Best Practices

<Warning>
  Always review suggested code and commands before approval. You control what Droid can access and execute.
</Warning>

### Essential Security Guidelines

<AccordionGroup>
  <Accordion title="Review before approving">
    **Always verify proposed commands and file changes**, especially:
    - Commands that install packages or modify system files
    - Operations involving sensitive data or credentials  
    - Network requests to external services
    - File operations outside your project directory
  </Accordion>
  
  <Accordion title="Use isolated environments">
    **Run Droid in containers or VMs** when working with:
    - Untrusted code repositories
    - External APIs or web services
    - Experimental or potentially risky operations
    - Shared development environments
  </Accordion>
  
  <Accordion title="Manage permissions carefully">
    **Configure tool permissions** to match your security requirements:
    - Set high-risk commands to "reject" by default
    - Use "ask" for medium-risk operations requiring oversight
    - Only "allow" low-risk commands you trust completely
    - Review permissions regularly with the Settings menu
  </Accordion>
  
  <Accordion title="Protect sensitive data">
    **Never include secrets in prompts:**
    - Use environment variables for API keys and tokens
    - Store credentials in secure credential managers
    - Exclude sensitive files from Droid's working directory
    - Use the FACTORY_TOKEN environment variable for CI/CD
  </Accordion>
</AccordionGroup>

---

## Built-in Protections

Factory CLI includes multiple layers of security:

- **Write access restriction**: Can only modify files in the project directory and subdirectories
- **Command approval**: Risky operations require explicit user confirmation
- **Prompt injection detection**: Analyzes requests for potentially harmful instructions
- **Network request controls**: Web-fetching tools require approval by default
- **Input sanitization**: Prevents command injection attacks
- **Session isolation**: Each conversation maintains separate, secure context

---

## Enterprise Security

<CardGroup cols={2}>
  <Card title="SSO & Identity" icon="user-shield">
    SAML 2.0 / OIDC single sign-on with SCIM provisioning and role-based access controls.
  </Card>
  <Card title="Data Governance" icon="database">
    Zero data retention mode, customer-managed encryption keys (BYOK), and private cloud deployments.
  </Card>
  <Card title="Compliance" icon="certificate">
    SOC 2 Type II certified, GDPR compliant, with regular penetration testing and supply chain security.
  </Card>
  <Card title="Audit & Monitoring" icon="chart-line">
    Complete session logging, OpenTelemetry metrics, and enterprise-managed security policies.
  </Card>
</CardGroup>

---

## Need Help?

<CardGroup cols={2}>
  <Card title="Security Questions" icon="envelope">
    Email our security team: **security@factory.ai**
  </Card>
  <Card title="Trust Center" icon="globe">
    Visit **[trust.factory.ai](https://trust.factory.ai)** for compliance documents, certifications, and security resources.
  </Card>
</CardGroup>

<Note>
  Report security vulnerabilities through our responsible disclosure program. Contact security@factory.ai for details.
</Note>
</file>

<file path="docs/cli/byok/baseten.mdx">
---
title: Baseten
description: Deploy and serve custom models with enterprise-grade infrastructure
---

Deploy and serve custom models with Baseten's enterprise-grade infrastructure for ML model serving.

## Configuration

Add these configurations to `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "Qwen3-Coder-480B [Baseten]",
      "model": "Qwen/Qwen3-Coder-480B-A35B-Instruct",
      "base_url": "https://inference.baseten.co/v1",
      "api_key": "YOUR_BASETEN_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 8192
    }
  ]
}
```

## Getting Started

1. Sign up at [baseten.co](https://baseten.co)
2. Deploy a model from their model library or upload your own
3. Get your API key from the settings page
4. Find your model ID in the deployment dashboard
5. Add the configuration to your Factory config

## Notes

- Base URL format: `https://inference.baseten.co/v1`
- Replace `YOUR_MODEL_ID` with your deployed model's ID from Baseten dashboard
- Supports OpenAI-compatible API format
- Contact Baseten for enterprise features and custom deployments
</file>

<file path="docs/cli/byok/deepinfra.mdx">
---
title: DeepInfra
description: Cost-effective inference for a wide variety of open-source models
---

Access cost-effective inference for a wide variety of open-source models with DeepInfra's optimized infrastructure.

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "GLM-4.6 [DeepInfra]",
      "model": "zai-org/GLM-4.6",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    },
    {
      "model_display_name": "DeepSeek V3.1 Terminus [DeepInfra]",
      "model": "deepseek-ai/DeepSeek-V3.1-Terminus",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    },
    {
      "model_display_name": "Kimi K2 Instruct [DeepInfra]",
      "model": "moonshotai/Kimi-K2-Instruct-0905",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32768
    },
    {
      "model_display_name": "Qwen3 Coder 480B [DeepInfra]",
      "model": "Qwen/Qwen3-Coder-480B-A35B-Instruct-Turbo",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32768
    }
  ]
}
```

## Getting Started

1. Sign up at [deepinfra.com](https://deepinfra.com)
2. Get your API token from the dashboard
3. View available models at their [model list](https://deepinfra.com/models)
4. Add desired models to your configuration

## Notes

- Base URL format: `https://api.deepinfra.com/v1/openai`
- Model names match Hugging Face repository format
- Supports OpenAI-compatible API
- Automatic model updates when new versions are released
</file>

<file path="docs/cli/byok/fireworks.mdx">
---
title: Fireworks AI
description: High-performance inference for open-source models with optimized serving
---

Access high-performance inference for open-source models with Fireworks AI's optimized serving infrastructure.

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "GLM 4.5 [Fireworks]",
      "model": "accounts/fireworks/models/glm-4p5",
      "base_url": "https://api.fireworks.ai/inference/v1",
      "api_key": "YOUR_FIREWORKS_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    },
    {
      "model_display_name": "Deepseek V3.1 Terminus [Fireworks]",
      "model": "accounts/fireworks/models/deepseek-v3p1-terminus",
      "base_url": "https://api.fireworks.ai/inference/v1",
      "api_key": "YOUR_FIREWORKS_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 20480
    }
  ]
}
```

## Getting Started

1. Sign up at [fireworks.ai](https://fireworks.ai)
2. Get your API key from the dashboard
3. Browse available models in their [model catalog](https://fireworks.ai/models)
4. Add desired models to your configuration

## Notes

- Base URL format: `https://api.fireworks.ai/inference/v1`
- Model IDs typically start with `accounts/fireworks/models/`
- Supports streaming responses and function calling for compatible models
</file>

<file path="docs/cli/byok/google-gemini.mdx">
---
title: Google Gemini
description: Access Google's Gemini models using your Gemini AI API key
---

Connect to Google's Gemini models for advanced AI capabilities with multimodal support.

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "Gemini 2.5 Pro [Google]",
      "model": "gemini-2.5-pro",
      "base_url": "https://generativelanguage.googleapis.com/v1beta/",
      "api_key": "YOUR_GEMINI_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32000
    },
    {
      "model_display_name": "Gemini 1.5 Pro [Google]",
      "model": "gemini-1.5-pro",
      "base_url": "https://generativelanguage.googleapis.com/v1beta/",
      "api_key": "YOUR_GEMINI_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 1048576
    },
    {
      "model_display_name": "Gemini 1.5 Flash [Google]",
      "model": "gemini-1.5-flash",
      "base_url": "https://generativelanguage.googleapis.com/v1beta/",
      "api_key": "YOUR_GEMINI_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 1048576
    }
  ]
}
```

## Getting Started

1. Go to [makersuite.google.com/app/apikey](https://makersuite.google.com/app/apikey)
2. Click "Create API Key"
3. Copy your API key
4. Add it to your Factory configuration

## Notes

- Base URL uses the `v1beta` API version
- Gemini models use the `generic-chat-completion-api` provider type
</file>

<file path="docs/cli/byok/groq.mdx">
---
title: Groq
description: Ultra-fast inference with Groq's LPU‚Ñ¢ Inference Engine
---

Access ultra-fast inference powered by Groq's LPU‚Ñ¢ (Language Processing Unit) Inference Engine for various open-source models.

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "Kimi K2 [Groq]",
      "model": "moonshotai/kimi-k2-instruct-0905",
      "base_url": "https://api.groq.com/openai/v1",
      "api_key": "YOUR_GROQ_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    }
  ]
}
```

## Getting Started

1. Sign up at [groq.com](https://groq.com)
2. Get your API key from [console.groq.com](https://console.groq.com)
3. Browse available models in the [Groq documentation](https://console.groq.com/docs/overview.md)
4. Add desired models to your configuration

## Notes

- Base URL format: `https://api.groq.com/openai/v1`
- Groq uses the `generic-chat-completion-api` provider type
- Known for extremely fast inference speeds thanks to LPU architecture
- Supports streaming responses for compatible models
</file>

<file path="docs/cli/byok/huggingface.mdx">
---
title: Hugging Face
description: Connect to models hosted on Hugging Face's Inference Providers
---

Connect to thousands of models hosted on Hugging Face's Inference Providers. Learn more in the [Inference Providers documentation](https://huggingface.co/docs/inference-providers/en/index).

<Note>
  **Model Performance**: Models below 30 billion parameters have shown significantly lower performance on agentic coding tasks. While HuggingFace hosts many smaller models that can be useful for experimentation, they are generally not recommended for production coding work. Consider using models with 30B+ parameters for complex software engineering tasks.
</Note>

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "GPT OSS 120B [HF Router]",
      "model": "openai/gpt-oss-120b:fireworks-ai",
      "base_url": "https://router.huggingface.co/v1",
      "api_key": "YOUR_HF_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32768
    },
    {
      "model_display_name": "Llama 4 Scout 17B [HF Router]",
      "model": "meta-llama/Llama-4-Scout-17B-16E-Instruct:fireworks-ai",
      "base_url": "https://router.huggingface.co/v1",
      "api_key": "YOUR_HF_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    }
  ]
}
```

## Getting Started

1. Sign up at [huggingface.co](https://huggingface.co)
2. Get your token from [huggingface.co/settings/tokens](https://huggingface.co/settings/tokens)
3. Browse models at [huggingface.co/models](https://huggingface.co/models?pipeline_tag=text-generation&inference_provider=all&sort=trending)
4. Add desired models to your configuration

## Notes

- Model names must match the exact Hugging Face repository ID
- Some models require accepting license agreements on HF website first
- Large models may not be available on free tier
</file>

<file path="docs/cli/byok/ollama.mdx">
---
title: Ollama
description: Run models locally on your hardware or use Ollama Cloud
---

Run models locally on your hardware with Ollama, or use Ollama Cloud for hosted inference.

<Note>
  **Performance Notice**: Models below 30 billion parameters have shown significantly lower performance on agentic coding tasks. While smaller models (7B, 13B) can be useful for experimentation and learning, they are generally not recommended for production coding work or complex software engineering tasks.
</Note>


## Local Ollama

Run models entirely on your machine with no internet required.

### Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "Qwen 2.5 Coder 32B [Local]",
      "model": "qwen2.5-coder:32b",
      "base_url": "http://localhost:11434/v1",
      "api_key": "not-needed",  # add any non-empty value
      "provider": "generic-chat-completion-api",
      "max_tokens": 16000
    },
    {
      "model_display_name": "Qwen 2.5 Coder 7B [Local]",
      "model": "qwen2.5-coder:7b",
      "base_url": "http://localhost:11434/v1",
      "api_key": "not-needed",  # add any non-empty value
      "provider": "generic-chat-completion-api",
      "max_tokens": 4000
    }
  ]
}
```

### Setup

<Warning>
  **Context Window Configuration**: For optimal performance with Factory, ensure you set the context window to at least 32,000 tokens. You can either:
  - Use the context window slider in the Ollama app (set to 32k minimum)
  - Set environment variable before starting: `OLLAMA_CONTEXT_LENGTH=32000 ollama serve`
  
  Without adequate context, the experience will be significantly degraded.
</Warning>

1. Install Ollama from [ollama.com/download](https://ollama.com/download)
2. Pull desired models:
   ```bash
   # Recommended models
   ollama pull qwen2.5-coder:32b
   ollama pull qwen2.5-coder:7b
   ```
3. Start the Ollama server with extra context:
   ```bash
   OLLAMA_CONTEXT_LENGTH=32000 ollama serve
   ```
4. Add configurations to Factory config


### Approximate Hardware Requirements

| Model Size | RAM Required | VRAM (GPU) |
|-----------|--------------|------------|
| 3B params | 4GB | 3GB |
| 7B params | 8GB | 6GB |
| 13B params | 16GB | 10GB |
| 30B params | 32GB | 20GB |
| 70B params | 64GB | 40GB |

## Ollama Cloud

Use Ollama's cloud service for hosted model inference without local hardware requirements

### Recommended Cloud Model

The best performance for agentic coding has been observed with **qwen3-coder:480b**. 

For a full list of available cloud models, visit: [ollama.com/search?c=cloud](https://ollama.com/search?c=cloud)

### Configuration

```json
{
  "custom_models": [
    {
      "model_display_name": "qwen3-coder [Online]",
      "model": "qwen3-coder:480b-cloud",
      "base_url": "http://localhost:11434/v1/",
      "api_key": "not-needed",  # add any non-empty value
      "provider": "generic-chat-completion-api",
      "max_tokens": 128000
    }
  ]
}
```

### Getting Started with Cloud Models

1. Ensure Ollama is installed and running locally
2. Cloud models are accessed through your local Ollama instance - no API key needed
3. Add the configuration above to your Factory config
4. The model will automatically use cloud compute when requested

## Troubleshooting

### Local server not connecting
- Ensure Ollama is running: `ollama serve`
- Check if port 11434 is available
- Try `curl http://localhost:11434/api/tags` to test

### Model not found
- Pull the model first: `ollama pull model-name`
- Check exact model name with `ollama list`

## Notes

- Local API doesn't require authentication (use any placeholder for `api_key`)
- Models are stored in `~/.ollama/models/`
</file>

<file path="docs/cli/byok/openai-anthropic.mdx">
---
title: OpenAI & Anthropic
description: Use your own API keys for official OpenAI and Anthropic models
---

Use your own API keys for cost control and billing transparency with official OpenAI and Anthropic models.

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "Sonnet 4.5 [Custom]",
      "model": "claude-sonnet-4-5-20250929",
      "base_url": "https://api.anthropic.com",
      "api_key": "YOUR_ANTHROPIC_KEY",
      "provider": "anthropic",
      "max_tokens": 8192
    },
    {
      "model_display_name": "GPT5-Codex [Custom]",
      "model": "gpt-5-codex",
      "base_url": "https://api.openai.com/v1",
      "api_key": "YOUR_OPENAI_KEY",
      "provider": "openai",
      "max_tokens": 16384
    }
  ]
}
```

## Getting API Keys

### Anthropic
1. Sign up at [console.anthropic.com](https://console.anthropic.com)
2. Navigate to API Keys section
3. Create a new API key
4. Copy and use in your configuration

### OpenAI
1. Sign up at [platform.openai.com](https://platform.openai.com)
2. Go to API Keys section
3. Create a new secret key
4. Copy and use in your configuration

## Notes

- These configurations use the official APIs with full prompt caching support
- Factory automatically handles prompt caching when available
- Use `/cost` command in CLI to view cost breakdowns and cache hit rates
</file>

<file path="docs/cli/byok/openrouter.mdx">
---
title: OpenRouter
description: Access models from multiple providers through a unified interface
---

Connect to OpenRouter for access to models from multiple providers through a single API interface.

## Configuration

Configuration examples for `~/.factory/config.json`:

```json
{
  "custom_models": [
    {
      "model_display_name": "GPT-OSS-20B [OpenRouter]",
      "model": "openai/gpt-oss-20b",
      "base_url": "https://openrouter.ai/api/v1",
      "api_key": "YOUR_OPENROUTER_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32000
    }
  ]
}
```

## Getting Started

1. Sign up at [openrouter.ai](https://openrouter.ai)
2. Get your API key from the dashboard
3. Browse available models at [openrouter.ai/models](https://openrouter.ai/models)
4. Add desired models to your configuration

## Notes

- OpenRouter uses the `generic-chat-completion-api` provider type
- Some models may have usage restrictions or require additional permissions
</file>

<file path="docs/cli/byok/overview.mdx">
---
title: Overview
description: Connect your own API keys, use open source models, or run local models
---

Factory CLI supports custom model configurations through BYOK (Bring Your Own Key). Use your own OpenAI or Anthropic keys, connect to any open source model providers, or run models locally on your hardware. Once configured, switch between models using the `/model` command.

<Note>
  Your API keys remain local and are not uploaded to Factory servers. Custom models are only available in the CLI and won't appear in Factory's web or mobile platforms.
</Note>

<img src="/images/custom_models.png" alt="Model selector showing custom models" />

[Install the CLI with the 5-minute quickstart ‚Üí](/cli/getting-started/quickstart)

---

## Configuration Reference

Add custom models in `~/.factory/config.json` under the `custom_models` array.

### Supported Fields

| Field | Required | Description |
|-------|----------|-------------|
| `model_display_name` | ‚úì | Human-friendly name shown in model selector |
| `model` | ‚úì | Model identifier sent via API (e.g., `claude-sonnet-4-5-20250929`, `gpt-5-codex`, `qwen3:4b`) |
| `base_url` | ‚úì | API endpoint base URL |
| `api_key` | ‚úì | Your API key for the provider. Can't be empty. |
| `provider` | ‚úì | One of: `anthropic`, `openai`, or `generic-chat-completion-api` |
| `max_tokens` | ‚úì | Maximum output tokens for model responses |

---

## Understanding Providers

Factory supports three provider types that determine API compatibility:

| Provider | API Format | Use For | Documentation |
|----------|------------|---------|---------------|
| `anthropic` | Anthropic Messages API (v1/messages) | Anthropic models on their official API or compatible proxies | [Anthropic Messages API](https://docs.claude.com/en/api/messages) |
| `openai` | OpenAI Responses API | OpenAI models on their official API or compatible proxies. Required for the newest models like GPT-5 and GPT-5-Codex. | [OpenAI Responses API](https://platform.openai.com/docs/api-reference/responses) |
| `generic-chat-completion-api` | OpenAI Chat Completions API | OpenRouter, Fireworks, Together AI, Ollama, vLLM, and most open-source providers | [OpenAI Chat Completions API](https://platform.openai.com/docs/api-reference/chat) |

<Warning>
  Factory is actively verifying Droid's performance on popular models, but we cannot guarantee that all custom models will work out of the box. Only Anthropic and OpenAI models accessed via their official APIs are fully tested and benchmarked.
</Warning>

<Note>
  **Model Size Consideration**: Models below 30 billion parameters have shown significantly lower performance on agentic coding tasks. While these smaller models can be useful for experimentation and learning, they are generally not recommended for production coding work or complex software engineering tasks.
</Note>

---

## Prompt Caching

Factory CLI automatically uses prompt caching when available to reduce API costs:

- **Official providers (`anthropic`, `openai`)**: Factory attempts to use prompt caching via the official APIs. Caching behavior follows each provider's implementation and requirements.
- **Generic providers (`generic-chat-completion-api`)**: Prompt caching support varies by provider and cannot be guaranteed. Some providers may support caching, while others may not.

### Verifying Prompt Caching

To check if prompt caching is working correctly with your custom model:

1. Run a conversation with your custom model
2. Use the `/cost` command in Droid CLI to view cost breakdowns
3. Look for cache hit rates and savings in the output

If you're not seeing expected caching savings, consult your provider's documentation about their prompt caching support and requirements.

---

## Quick Start

Choose a provider from the left navigation to see specific configuration examples:

- **[Baseten](/cli/byok/baseten)** - Deploy and serve custom models
- **[DeepInfra](/cli/byok/deepinfra)** - Cost-effective inference for open-source models
- **[Fireworks AI](/cli/byok/fireworks)** - High-performance inference for open-source models
- **[Google Gemini](/cli/byok/google-gemini)** - Access Google's Gemini models
- **[Groq](/cli/byok/groq)** - Ultra-fast inference with Groq's LPU‚Ñ¢ Inference Engine
- **[Hugging Face](/cli/byok/huggingface)** - Connect to models on HF Inference API
- **[Ollama](/cli/byok/ollama)** - Run models locally or in the cloud
- **[OpenAI & Anthropic](/cli/byok/openai-anthropic)** - Use your own API keys for official models
- **[OpenRouter](/cli/byok/openrouter)** - Access multiple providers through a single interface

---

## Using Custom Models

Once configured, access your custom models in the CLI:

1. Use the `/model` command
2. Your custom models appear in a separate "Custom models" section below Factory-provided models
3. Select any model to start using it

Custom models display with the name you set in `model_display_name`, making it easy to identify different providers and configurations.

---

## Troubleshooting

### Model not appearing in selector
- Check JSON syntax in `~/.factory/config.json`
- Restart the CLI after making configuration changes
- Verify all required fields are present

### "Invalid provider" error
- Provider must be exactly `anthropic`, `openai`, or `generic-chat-completion-api`
- Check for typos and ensure proper capitalization

### Authentication errors
- Verify your API key is valid and has available credits
- Check that the API key has proper permissions
- Confirm the base URL matches your provider's documentation

### Local model won't connect
- Ensure your local server is running (e.g., `ollama serve`)
- Verify the base URL is correct and includes `/v1/` suffix if required
- Check that the model is pulled/available locally

### Rate limiting or quota errors
- Check your provider's rate limits and usage quotas
- Monitor your usage through your provider's dashboard

---

## Billing

- You pay your provider directly with no Factory markup or usage fees
- Track costs and usage in your provider's dashboard
</file>

<file path="docs/cli/configuration/hooks/auto-formatting.mdx">
---
title: "Auto-formatting Code"
description: "Automatically format code after every file edit using hooks"
---

This cookbook shows how to automatically format code after Droid edits files, ensuring consistent code style across your project without manual intervention.

## How it works

The hook:

1. **Triggers on file edits**: Runs after Write or Edit tool calls
2. **Detects file type**: Checks file extension to determine formatter
3. **Runs appropriate formatter**: Executes prettier, black, gofmt, rustfmt, etc.
4. **Provides feedback**: Reports formatting results to the user
5. **Handles errors gracefully**: Continues even if formatting fails

## Prerequisites

Install formatters for your language stack:

<CodeGroup>

```bash JavaScript/TypeScript
npm install -D prettier
```

```bash Python
pip install black isort
```

```bash Go
# gofmt is included with Go installation
go version
```

```bash Rust
rustup component add rustfmt
```

</CodeGroup>

## Basic setup

### Single language project

For a JavaScript/TypeScript project, add this to your `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | { read file_path; if echo \"$file_path\" | grep -qE '\\.(ts|tsx|js|jsx)$'; then npx prettier --write \"$file_path\" 2>&1 && echo \"‚úì Formatted $file_path\"; fi; }",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

### Multi-language project

For projects with multiple languages, use a script to handle different file types.

Create `.factory/hooks/format.sh`:

```bash
#!/bin/bash
set -e

# Read the hook input
input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path')

# Skip if file doesn't exist
if [ ! -f "$file_path" ]; then
  exit 0
fi

# Determine formatter based on file extension
case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx|*.json|*.css|*.scss|*.md|*.mdx)
    if command -v prettier &> /dev/null; then
      prettier --write "$file_path" 2>&1
      echo "‚úì Formatted with Prettier: $file_path"
    fi
    ;;
  *.py)
    if command -v black &> /dev/null; then
      black "$file_path" 2>&1
      echo "‚úì Formatted with Black: $file_path"
    fi
    if command -v isort &> /dev/null; then
      isort "$file_path" 2>&1
      echo "‚úì Sorted imports with isort: $file_path"
    fi
    ;;
  *.go)
    if command -v gofmt &> /dev/null; then
      gofmt -w "$file_path" 2>&1
      echo "‚úì Formatted with gofmt: $file_path"
    fi
    ;;
  *.rs)
    if command -v rustfmt &> /dev/null; then
      rustfmt "$file_path" 2>&1
      echo "‚úì Formatted with rustfmt: $file_path"
    fi
    ;;
  *.java)
    if command -v google-java-format &> /dev/null; then
      google-java-format -i "$file_path" 2>&1
      echo "‚úì Formatted with google-java-format: $file_path"
    fi
    ;;
  *)
    # No formatter for this file type
    exit 0
    ;;
esac

exit 0
```

Make the script executable:

```bash
chmod +x .factory/hooks/format.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/format.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

## Advanced configurations

### Format with custom config

Use project-specific prettier config:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | { read file_path; if echo \"$file_path\" | grep -qE '\\.(ts|tsx|js|jsx)$'; then npx prettier --config \"$DROID_PROJECT_DIR\"/.prettierrc --write \"$file_path\" 2>&1; fi; }",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

### Format with linting

Combine formatting with linting fixes.

Create `.factory/hooks/format-and-lint.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path')

if [ ! -f "$file_path" ]; then
  exit 0
fi

case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    # Format with prettier
    if command -v prettier &> /dev/null; then
      prettier --write "$file_path" 2>&1
      echo "‚úì Formatted: $file_path"
    fi
    
    # Fix lint issues
    if command -v eslint &> /dev/null; then
      eslint --fix "$file_path" 2>&1 || true
      echo "‚úì Linted: $file_path"
    fi
    ;;
  *.py)
    # Format with black
    if command -v black &> /dev/null; then
      black "$file_path" 2>&1
      echo "‚úì Formatted with Black: $file_path"
    fi
    
    # Sort imports
    if command -v isort &> /dev/null; then
      isort "$file_path" 2>&1
      echo "‚úì Sorted imports: $file_path"
    fi
    
    # Run flake8 for style issues
    if command -v flake8 &> /dev/null; then
      flake8 "$file_path" 2>&1 || true
      echo "‚úì Checked with flake8: $file_path"
    fi
    ;;
esac

exit 0
```

Make the script executable:

```bash
chmod +x .factory/hooks/format-and-lint.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/format-and-lint.sh",
            "timeout": 45
          }
        ]
      }
    ]
  }
}
```

### Conditional formatting

Only format files in specific directories.

Create `.factory/hooks/format-src-only.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path')

# Only format files in src/ or packages/ directories
if ! echo "$file_path" | grep -qE '^(src/|packages/)'; then
  exit 0
fi

case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    if command -v prettier &> /dev/null; then
      prettier --write "$file_path" 2>&1
      echo "‚úì Formatted: $file_path"
    fi
    ;;
esac

exit 0
```

Make the script executable:

```bash
chmod +x .factory/hooks/format-src-only.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/format-src-only.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

## Real-world examples

### Example 1: React component formatting

<Tabs>
  <Tab title="Before Hook">
    ```typescript
    // Droid creates this file
    import React from 'react';
    import {useState} from 'react';

    export const Button = ({onClick,label}:{onClick:()=>void;label:string})=>{
    const [loading,setLoading]=useState(false);
    return <button onClick={onClick} disabled={loading}>{label}</button>
    }
    ```
  </Tab>
  
  <Tab title="After Hook">
    ```typescript
    // Automatically formatted by prettier
    import React, { useState } from 'react';

    export const Button = ({
      onClick,
      label,
    }: {
      onClick: () => void;
      label: string;
    }) => {
      const [loading, setLoading] = useState(false);
      return (
        <button onClick={onClick} disabled={loading}>
          {label}
        </button>
      );
    };
    ```
    <Note>Imports consolidated, spacing fixed, formatting applied</Note>
  </Tab>
</Tabs>

### Example 2: Python import sorting

<Tabs>
  <Tab title="Before Hook">
    ```python
    # Droid creates this file
    from typing import Optional
    import sys
    from django.db import models
    import os
    from myapp.utils import helper

    def process_data(data: Optional[str]) -> None:
        if data:
            helper(data)
    ```
  </Tab>
  
  <Tab title="After Hook">
    ```python
    # Automatically formatted by black and isort
    import os
    import sys
    from typing import Optional

    from django.db import models

    from myapp.utils import helper


    def process_data(data: Optional[str]) -> None:
        if data:
            helper(data)
    ```
    <Note>Imports sorted into stdlib, third-party, and local groups</Note>
  </Tab>
</Tabs>

## Best practices

<Warning>
  Formatters can sometimes introduce subtle bugs (e.g., changing string formats, line continuations). Always review changes before committing.
</Warning>

<Steps>
  <Step title="Start with read-only mode">
    Test your formatter configuration manually first:
    ```bash
    # Dry run to see what would change
    prettier --check src/
    black --check src/
    ```
  </Step>
  
  <Step title="Use consistent config files">
    Ensure formatter configs are committed:
    ```bash
    # Add to version control
    git add .prettierrc .prettierignore
    git add pyproject.toml  # for black config
    ```
  </Step>
  
  <Step title="Set appropriate timeouts">
    Large files may need more time:
    ```json
    {
      "timeout": 60  // Increase for large files
    }
    ```
  </Step>
  
  <Step title="Handle formatter errors gracefully">
    Don't block Droid if formatting fails:
    ```bash
    # Use || true to continue on errors
    prettier --write "$file_path" 2>&1 || true
    ```
  </Step>
  
  <Step title="Consider Git hooks integration">
    Combine with pre-commit hooks for consistency:
    ```yaml
    # .pre-commit-config.yaml
    repos:
      - repo: https://github.com/pre-commit/mirrors-prettier
        rev: v3.0.0
        hooks:
          - id: prettier
    ```
  </Step>
</Steps>

## Troubleshooting

### Formatter not found

**Problem**: `command not found` error

**Solution**: Install the formatter globally or use npx/project binaries:
```bash
# Install globally
npm install -g prettier

# Or use project version
npx prettier --write "$file_path"
```

### Formatting breaks code

**Problem**: Formatter introduces syntax errors

**Solution**: Add file validation after formatting:
```bash
# For TypeScript
prettier --write "$file_path"
tsc --noEmit "$file_path" || echo "‚ö†Ô∏è Type errors after formatting"
```

### Hook runs too slowly

**Problem**: Formatting takes too long

**Solution**: Only format changed files, use faster formatters:
```bash
# Skip files that haven't changed
if git diff --quiet "$file_path"; then
  exit 0
fi
```

### Conflicts with editor formatting

**Problem**: Editor and hook format differently

**Solution**: Use the same config for both:
```json
// .vscode/settings.json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "prettier.configPath": ".prettierrc"
}
```

## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Code validation hooks](/cli/configuration/hooks/code-validation) - Enforce code standards
- [Git workflow hooks](/cli/configuration/hooks/git-workflows) - Integrate with Git
</file>

<file path="docs/cli/configuration/hooks/code-validation.mdx">
---
title: "Code Validation Hooks"
description: "Enforce code standards, security policies, and best practices automatically"
---

This cookbook shows how to use hooks to validate code changes, enforce security policies, and maintain code quality standards before Droid makes changes.

## How it works

Validation hooks can:

1. **Block unsafe operations**: Prevent edits to sensitive files or directories
2. **Enforce standards**: Check code against style guides and best practices
3. **Validate security**: Scan for secrets, vulnerabilities, and security issues
4. **Provide feedback**: Give Droid specific guidance on what to fix
5. **Run checks**: Execute linters, type checkers, and custom validators

## Prerequisites

Install validation tools for your stack:

<CodeGroup>

```bash JavaScript/TypeScript
npm install -D eslint typescript @typescript-eslint/parser
npm install -D semgrep  # For security scanning
```

```bash Python
pip install flake8 pylint bandit  # Linting and security
pip install semgrep  # Multi-language security scanner
```

```bash Go
go install golang.org/x/tools/cmd/goimports@latest
go install honnef.co/go/tools/cmd/staticcheck@latest
```

```bash Security Tools
# Gitleaks for secret detection
brew install gitleaks  # macOS
# or download from https://github.com/gitleaks/gitleaks
```

</CodeGroup>

## Basic validation

### Block sensitive file edits

Prevent Droid from modifying critical files.

Create `.factory/hooks/protect-files.sh`:

```bash
#!/bin/bash

input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Skip if no file path
if [ -z "$file_path" ]; then
  exit 0
fi

# List of protected patterns
protected_patterns=(
  "\.env"
  "\.env\."
  "package-lock\.json"
  "yarn\.lock"
  "\.git/"
  "node_modules/"
  "dist/"
  "build/"
  "secrets/"
  "\.pem$"
  "\.key$"
  "\.p12$"
  "credentials\.json"
)

# Check if file matches any protected pattern
for pattern in "${protected_patterns[@]}"; do
  if echo "$file_path" | grep -qE "$pattern"; then
    echo "‚ùå Cannot modify protected file: $file_path" >&2
    echo "This file is protected by project policy." >&2
    echo "If you need to modify it, please do so manually." >&2
    exit 2  # Exit code 2 blocks the operation
  fi
done

exit 0
```

```bash
chmod +x .factory/hooks/protect-files.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/protect-files.sh",
            "timeout": 3
          }
        ]
      }
    ]
  }
}
```

### Validate TypeScript syntax

Check TypeScript files for type errors before accepting edits.

Create `.factory/hooks/validate-typescript.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only validate TypeScript files
if ! echo "$file_path" | grep -qE '\.(ts|tsx)$'; then
  exit 0
fi

# For Write operations, validate the content directly
if [ "$tool_name" = "Write" ]; then
  content=$(echo "$input" | jq -r '.tool_input.content')
  
  # Write to temp file for validation
  temp_file=$(mktemp --suffix=.ts)
  echo "$content" > "$temp_file"
  
  # Run TypeScript compiler on temp file
  if ! npx tsc --noEmit "$temp_file" 2>&1; then
    rm "$temp_file"
    echo "‚ùå TypeScript validation failed" >&2
    echo "The code contains type errors. Please fix them before proceeding." >&2
    exit 2
  fi
  
  rm "$temp_file"
fi

# For Edit operations, validate the file will be valid after edit
# (This requires reading the file and applying the edit, which is complex)
# For now, we'll validate post-edit in PostToolUse

exit 0
```

```bash
chmod +x .factory/hooks/validate-typescript.sh
```

For PostToolUse validation:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | { read file_path; if echo \"$file_path\" | grep -qE '\\.(ts|tsx)$' && [ -f \"$file_path\" ]; then npx tsc --noEmit \"$file_path\" 2>&1 || { echo '‚ö†Ô∏è Type errors detected in '$file_path >&2; }; fi; }",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

## Security validation

### Secret detection

Prevent committing secrets and credentials.

Create `.factory/hooks/scan-secrets.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only scan file write/edit operations
if [ "$tool_name" != "Write" ] && [ "$tool_name" != "Edit" ]; then
  exit 0
fi

# Skip non-text files
if echo "$file_path" | grep -qE '\.(jpg|png|gif|pdf|zip|tar|gz)$'; then
  exit 0
fi

# Get content to scan
if [ "$tool_name" = "Write" ]; then
  content=$(echo "$input" | jq -r '.tool_input.content')
else
  # For Edit, we'd need to check the file after edit (PostToolUse is better)
  exit 0
fi

# Create temp file for scanning
temp_file=$(mktemp)
echo "$content" > "$temp_file"

# Pattern-based secret detection
secret_patterns=(
  "AKIA[0-9A-Z]{16}"  # AWS Access Key
  "AIza[0-9A-Za-z\\-_]{35}"  # Google API Key
  "sk-[a-zA-Z0-9]{32,}"  # OpenAI API Key
  "[a-f0-9]{32}"  # Generic 32-char hex (MD5)
  "ghp_[a-zA-Z0-9]{36}"  # GitHub Personal Access Token
  "glpat-[a-zA-Z0-9\\-]{20}"  # GitLab Personal Access Token
)

found_secrets=0

for pattern in "${secret_patterns[@]}"; do
  if grep -qE "$pattern" "$temp_file"; then
    echo "‚ùå Potential secret detected matching pattern: $pattern" >&2
    found_secrets=1
  fi
done

# Also check for common variable names with suspicious values
if grep -qE "(password|secret|key|token|api_key)\s*[:=]\s*['\"][^'\"]{8,}" "$temp_file"; then
  echo "‚ö†Ô∏è Suspicious credential-like assignment detected" >&2
  echo "Review: $(grep -E "(password|secret|key|token|api_key)\s*[:=]" "$temp_file" | head -1)" >&2
  found_secrets=1
fi

rm "$temp_file"

if [ $found_secrets -eq 1 ]; then
  echo "" >&2
  echo "Please use environment variables or secure secret management instead." >&2
  exit 2  # Block the operation
fi

exit 0
```

```bash
chmod +x .factory/hooks/scan-secrets.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/scan-secrets.sh",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
```

### Dependency security scanning

Check for vulnerable dependencies.

Create `.factory/hooks/check-deps.sh`:

```bash
#!/bin/bash

input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only check package files
if [[ ! "$file_path" =~ (package\.json|requirements\.txt|go\.mod|Cargo\.toml)$ ]]; then
  exit 0
fi

echo "üîç Checking for vulnerable dependencies..."

case "$file_path" in
  *package.json)
    if command -v npm &> /dev/null; then
      # Run npm audit
      if ! npm audit --audit-level=high 2>&1; then
        echo "‚ö†Ô∏è Vulnerable dependencies detected" >&2
        echo "Run 'npm audit fix' to resolve issues" >&2
        # Don't block, just warn
        exit 0
      fi
    fi
    ;;
    
  *requirements.txt)
    if command -v pip-audit &> /dev/null; then
      if ! pip-audit -r "$file_path" 2>&1; then
        echo "‚ö†Ô∏è Vulnerable Python packages detected" >&2
        exit 0
      fi
    fi
    ;;
    
  *Cargo.toml)
    if command -v cargo-audit &> /dev/null; then
      if ! cargo audit 2>&1; then
        echo "‚ö†Ô∏è Vulnerable Rust crates detected" >&2
        exit 0
      fi
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/check-deps.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/check-deps.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

## Code quality validation

### Enforce linting rules

Validate code against linting rules before accepting changes.

Create `.factory/hooks/lint-check.sh`:

```bash
#!/bin/bash

input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

if [ ! -f "$file_path" ]; then
  # File doesn't exist yet (Write operation), skip for now
  exit 0
fi

# Run appropriate linter based on file type
case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    if command -v eslint &> /dev/null; then
      if ! eslint "$file_path" 2>&1; then
        echo "" >&2
        echo "‚ùå ESLint found issues in $file_path" >&2
        echo "Please fix the linting errors above." >&2
        exit 2  # Block the operation
      fi
      echo "‚úì ESLint passed for $file_path"
    fi
    ;;
    
  *.py)
    if command -v flake8 &> /dev/null; then
      if ! flake8 "$file_path" 2>&1; then
        echo "" >&2
        echo "‚ùå Flake8 found issues in $file_path" >&2
        exit 2
      fi
      echo "‚úì Flake8 passed for $file_path"
    fi
    ;;
    
  *.go)
    if command -v golint &> /dev/null; then
      if ! golint "$file_path" 2>&1; then
        echo "" >&2
        echo "‚ùå Golint found issues in $file_path" >&2
        exit 2
      fi
    fi
    ;;
    
  *.rs)
    if command -v clippy &> /dev/null; then
      if ! cargo clippy -- -D warnings 2>&1; then
        echo "‚ùå Clippy found issues" >&2
        exit 2
      fi
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/lint-check.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/lint-check.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

### Complexity checks

Reject overly complex code.

Create `.factory/hooks/check-complexity.py`:

```python
#!/usr/bin/env python3
"""
Check code complexity and reject changes that are too complex.
Uses radon for Python, or custom heuristics for other languages.
"""
import json
import sys
import subprocess
import re

def check_python_complexity(file_path):
    """Check Python file complexity using radon."""
    try:
        result = subprocess.run(
            ['radon', 'cc', file_path, '-s', '-n', 'C'],
            capture_output=True,
            text=True,
            timeout=10
        )
        
        if result.returncode == 0 and result.stdout:
            print(f"‚ùå Code complexity too high in {file_path}", file=sys.stderr)
            print(result.stdout, file=sys.stderr)
            print("\nPlease simplify the code by:", file=sys.stderr)
            print("- Breaking down large functions", file=sys.stderr)
            print("- Reducing nesting levels", file=sys.stderr)
            print("- Extracting helper functions", file=sys.stderr)
            return False
            
    except (subprocess.SubprocessError, FileNotFoundError):
        pass
    
    return True

def check_js_complexity(file_path):
    """Basic complexity check for JavaScript/TypeScript."""
    with open(file_path, 'r') as f:
        content = f.read()
    
    # Count nesting level (very basic check)
    max_nesting = 0
    current_nesting = 0
    
    for char in content:
        if char == '{':
            current_nesting += 1
            max_nesting = max(max_nesting, current_nesting)
        elif char == '}':
            current_nesting -= 1
    
    if max_nesting > 5:
        print(f"‚ö†Ô∏è High nesting level ({max_nesting}) in {file_path}", file=sys.stderr)
        print("Consider refactoring to reduce nesting.", file=sys.stderr)
        # Warning only, don't block
    
    return True

try:
    input_data = json.load(sys.stdin)
    file_path = input_data.get('tool_input', {}).get('file_path', '')
    
    if not file_path:
        sys.exit(0)
    
    if file_path.endswith('.py'):
        if not check_python_complexity(file_path):
            sys.exit(2)
    elif file_path.endswith(('.js', '.jsx', '.ts', '.tsx')):
        if not check_js_complexity(file_path):
            sys.exit(2)
    
except Exception as e:
    print(f"Error checking complexity: {e}", file=sys.stderr)
    sys.exit(0)  # Don't block on errors
```

```bash
chmod +x .factory/hooks/check-complexity.py
pip install radon  # For Python complexity checking
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/check-complexity.py",
            "timeout": 15
          }
        ]
      }
    ]
  }
}
```

## Advanced validation

### Custom business logic validation

Enforce domain-specific rules.

Create `.factory/hooks/validate-business-logic.sh`:

```bash
#!/bin/bash

input=$(cat)
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')
content=$(echo "$input" | jq -r '.tool_input.content // ""')

# Example: Ensure API routes have authentication
if echo "$file_path" | grep -qE 'routes/.*\.ts$'; then
  if echo "$content" | grep -qE 'router\.(get|post|put|delete)' && \
     ! echo "$content" | grep -qE '(authenticate|requireAuth|isAuthenticated)'; then
    echo "‚ùå API routes must include authentication middleware" >&2
    echo "Add authenticate() or requireAuth() to your route handlers." >&2
    exit 2
  fi
fi

# Example: Ensure database queries use parameterized statements
if echo "$content" | grep -qE 'db\.query\([^?]*\$\{'; then
  echo "‚ùå SQL injection risk detected" >&2
  echo "Use parameterized queries instead of string interpolation." >&2
  echo "Bad:  db.query(\`SELECT * FROM users WHERE id = \${id}\`)" >&2
  echo "Good: db.query('SELECT * FROM users WHERE id = ?', [id])" >&2
  exit 2
fi

# Example: Ensure React components have prop type validation
if echo "$file_path" | grep -qE 'components/.*\.(tsx|jsx)$'; then
  if echo "$content" | grep -qE 'export (const|function)' && \
     ! echo "$content" | grep -qE '(PropTypes|interface.*Props|type.*Props)'; then
    echo "‚ö†Ô∏è React component should have prop type definitions" >&2
    echo "Consider adding TypeScript interfaces or PropTypes." >&2
    # Warning only, don't block
  fi
fi

exit 0
```

```bash
chmod +x .factory/hooks/validate-business-logic.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/validate-business-logic.sh",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
```

### Architecture compliance

Ensure code follows architecture patterns.

Create `.factory/hooks/check-architecture.py`:

```python
#!/usr/bin/env python3
"""
Enforce architectural boundaries and patterns.
"""
import json
import sys
import os
import re

ARCHITECTURE_RULES = {
    # Frontend components shouldn't import from backend
    r'src/frontend/.*\.tsx?$': {
        'forbidden_imports': [r'src/backend/', r'../backend/'],
        'message': 'Frontend code cannot import from backend'
    },
    
    # Domain layer shouldn't import from infrastructure
    r'src/domain/.*\.ts$': {
        'forbidden_imports': [r'src/infrastructure/', r'express', r'axios'],
        'message': 'Domain layer must be framework-agnostic'
    },
    
    # Tests shouldn't import from src
    r'tests/.*\.test\.ts$': {
        'forbidden_imports': [r'src/(?!test-utils)'],
        'message': 'Tests should use public APIs, not internal imports'
    },
}

def check_imports(file_path, content):
    """Check if imports violate architecture rules."""
    for pattern, rule in ARCHITECTURE_RULES.items():
        if re.search(pattern, file_path):
            # Extract all imports from the file
            import_pattern = r'from [\'"](.+?)[\'"]|import .+ from [\'"](.+?)[\'"]'
            imports = re.findall(import_pattern, content)
            
            for imp in imports:
                import_path = imp[0] or imp[1]
                
                # Check against forbidden patterns
                for forbidden in rule['forbidden_imports']:
                    if re.search(forbidden, import_path):
                        print(f"‚ùå Architecture violation in {file_path}", file=sys.stderr)
                        print(f"   {rule['message']}", file=sys.stderr)
                        print(f"   Forbidden import: {import_path}", file=sys.stderr)
                        return False
    
    return True

try:
    input_data = json.load(sys.stdin)
    file_path = input_data.get('tool_input', {}).get('file_path', '')
    content = input_data.get('tool_input', {}).get('content', '')
    
    if not file_path or not content:
        sys.exit(0)
    
    if not check_imports(file_path, content):
        sys.exit(2)
    
except Exception as e:
    print(f"Error: {e}", file=sys.stderr)
    sys.exit(0)
```

```bash
chmod +x .factory/hooks/check-architecture.py
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/check-architecture.py",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
```

## Best practices

<Steps>
  <Step title="Provide clear feedback">
    When blocking operations, explain what's wrong and how to fix it:
    ```bash
    echo "‚ùå Problem: TypeScript errors found" >&2
    echo "Solution: Fix the type errors shown above" >&2
    echo "Example: Add proper type annotations to parameters" >&2
    exit 2
    ```
  </Step>
  
  <Step title="Use warnings vs. errors appropriately">
    Not everything needs to block Droid:
    ```bash
    # Warning (exit 0) - inform but don't block
    echo "‚ö†Ô∏è Code complexity is high, consider refactoring" >&2
    exit 0
    
    # Error (exit 2) - block the operation
    echo "‚ùå Secret detected, cannot proceed" >&2
    exit 2
    ```
  </Step>
  
  <Step title="Performance matters">
    Keep validation fast:
    ```bash
    # Use grep for quick checks before expensive operations
    if grep -q "password" "$file"; then
      # Only run expensive scan if simple check passes
      run_detailed_security_scan "$file"
    fi
    ```
  </Step>
  
  <Step title="Make rules configurable">
    Allow teams to customize validation:
    ```bash
    # Read config from project settings
    MAX_COMPLEXITY="${DROID_MAX_COMPLEXITY:-10}"
    ENFORCE_TESTS="${DROID_ENFORCE_TESTS:-false}"
    ```
  </Step>
  
  <Step title="Test your validators">
    Create test files that should pass and fail:
    ```bash
    # Create test cases
    echo '{"tool_input":{"file_path":"test.ts","content":"..."}}' | \
      .factory/hooks/validate.sh
    ```
  </Step>
</Steps>

## Troubleshooting

### False positives

**Problem**: Validation blocks legitimate code

**Solution**: Add exclusion patterns:
```bash
# Skip test files
if echo "$file_path" | grep -qE '\.(test|spec)\.(ts|js)$'; then
  exit 0
fi

# Skip generated files
if echo "$file_path" | grep -qE '(generated|\.gen\.)'; then
  exit 0
fi
```

### Validation too slow

**Problem**: Hooks take too long to run

**Solution**: Optimize validation:
```bash
# Cache validation results
CACHE_FILE="/tmp/droid-validation-$(md5sum "$file_path" | cut -d' ' -f1)"

if [ -f "$CACHE_FILE" ]; then
  # File hasn't changed, use cached result
  exit 0
fi

# Run validation...
touch "$CACHE_FILE"
```

### Inconsistent with CI

**Problem**: Hook passes but CI fails

**Solution**: Use same tools and configs:
```bash
# Use exact same commands as CI
# .github/workflows/ci.yml:
#   npm run lint

# Hook should run:
npm run lint "$file_path"
```

## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Auto-formatting](/cli/configuration/hooks/auto-formatting) - Automatic code formatting
- [Git workflow hooks](/cli/configuration/hooks/git-workflows) - Git integration
</file>

<file path="docs/cli/configuration/hooks/documentation-sync.mdx">
---
title: "Documentation Sync"
description: "Keep documentation in sync with code changes automatically"
---

This cookbook shows how to automatically update documentation when code changes, ensure docs stay current, and generate API documentation from code.

## How it works

Documentation sync hooks can:

1. **Update API docs**: Generate documentation from code annotations
2. **Sync code examples**: Keep examples in docs matching actual code
3. **Validate doc references**: Ensure docs reference correct code paths
4. **Update changelogs**: Auto-generate changelog entries
5. **Check doc completeness**: Require documentation for new features

## Prerequisites

Install documentation tools:

<CodeGroup>

```bash TypeScript/JavaScript
npm install -D typedoc jsdoc documentation
npm install -D @readme/openapi-parser  # For OpenAPI
```

```bash Python
pip install sphinx pdoc3 mkdocs
pip install pydoc-markdown  # Markdown docs from docstrings
```

```bash Go
go install golang.org/x/tools/cmd/godoc@latest
go install github.com/swaggo/swag/cmd/swag@latest  # For Swagger
```

</CodeGroup>

## Basic documentation automation

### Auto-generate API docs

Generate API documentation when code changes.

Create `.factory/hooks/generate-api-docs.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only process code files
if ! echo "$file_path" | grep -qE '\.(ts|tsx|js|jsx|py|go)$'; then
  exit 0
fi

# Skip test files
if echo "$file_path" | grep -qE '\.(test|spec)\.(ts|tsx|js|jsx)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üìö Updating API documentation..."

case "$file_path" in
  *.ts|*.tsx)
    # TypeScript - use typedoc
    if command -v typedoc &> /dev/null && [ -f "typedoc.json" ]; then
      echo "Generating TypeScript docs..."
      typedoc --out docs/api src/ 2>&1 || {
        echo "‚ö†Ô∏è Failed to generate docs" >&2
      }
      echo "‚úì API docs updated at docs/api"
    fi
    ;;
    
  *.py)
    # Python - use pdoc
    if command -v pdoc &> /dev/null; then
      module_name=$(echo "$file_path" | sed 's|^src/||; s|/|.|g; s|\.py$||')
      echo "Generating Python docs for $module_name..."
      
      pdoc --html --output-dir docs/api "$module_name" --force 2>&1 || {
        echo "‚ö†Ô∏è Failed to generate docs" >&2
      }
      echo "‚úì API docs updated"
    fi
    ;;
    
  *.go)
    # Go - use godoc
    if command -v godoc &> /dev/null; then
      echo "Generating Go docs..."
      # Go docs are typically served, not generated
      # But we can create markdown from godoc
      echo "‚úì Go docs available via 'godoc -http=:6060'"
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/generate-api-docs.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/generate-api-docs.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

### Update README on project changes

Keep README in sync with project structure.

Create `.factory/hooks/update-readme.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only update on package.json or structure changes
if ! echo "$file_path" | grep -qE '(package\.json|README\.md)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Don't run if README is the file being edited
if [ "$file_path" = "README.md" ]; then
  exit 0
fi

echo "üìù Checking README..."

# Update package info in README
if [ -f "package.json" ] && [ -f "README.md" ]; then
  name=$(jq -r '.name' package.json)
  version=$(jq -r '.version' package.json)
  description=$(jq -r '.description' package.json)
  
  # Check if version in README matches package.json
  if ! grep -q "Version: $version" README.md; then
    echo "‚ö†Ô∏è README version out of sync with package.json"
    echo "Package version: $version"
    echo "Consider updating README.md or ask me to do it"
  fi
fi

# Check for missing documentation sections
required_sections=("Installation" "Usage" "API" "Contributing")
missing_sections=()

for section in "${required_sections[@]}"; do
  if ! grep -qi "## $section" README.md; then
    missing_sections+=("$section")
  fi
done

if [ ${#missing_sections[@]} -gt 0 ]; then
  echo "‚ö†Ô∏è README missing sections:"
  printf '  - %s\n' "${missing_sections[@]}"
fi

exit 0
```

```bash
chmod +x .factory/hooks/update-readme.sh
```


### Sync code examples in documentation

Ensure code examples in docs match actual code:



Create `.factory/hooks/sync-doc-examples.py`:

```python
#!/usr/bin/env python3
"""
Sync code examples in markdown docs with actual source code.
"""
import json
import sys
import re
import os

def extract_code_snippets(doc_file):
    """Extract code snippets from markdown file."""
    with open(doc_file, 'r') as f:
        content = f.read()
    
    # Find code blocks with source file annotations
    # Format: ```typescript
    # // From: src/components/Button.tsx
    pattern = r'```(\w+)\n// From: (.*?)\n(.*?)\n```'
    snippets = re.findall(pattern, content, re.DOTALL)
    
    return snippets

def verify_snippet_matches_source(language, source_file, snippet):
    """Check if snippet exists in source file."""
    if not os.path.exists(source_file):
        return False, f"Source file not found: {source_file}"
    
    with open(source_file, 'r') as f:
        source_content = f.read()
    
    # Normalize whitespace for comparison
    normalized_snippet = ' '.join(snippet.split())
    normalized_source = ' '.join(source_content.split())
    
    if normalized_snippet in normalized_source:
        return True, "Snippet matches source"
    else:
        return False, "Snippet does not match source code"

def main():
    input_data = json.load(sys.stdin)
    file_path = input_data.get('tool_input', {}).get('file_path', '')
    
    # Check both code files and doc files
    if file_path.endswith(('.md', '.mdx')):
        # Doc file changed - verify all examples
        print(f"üìñ Verifying code examples in {file_path}...")
        
        snippets = extract_code_snippets(file_path)
        issues = []
        
        for lang, source, snippet in snippets:
            matches, message = verify_snippet_matches_source(lang, source, snippet)
            if not matches:
                issues.append(f"{source}: {message}")
        
        if issues:
            print("‚ö†Ô∏è Some code examples may be outdated:", file=sys.stderr)
            for issue in issues:
                print(f"  - {issue}", file=sys.stderr)
            print("\nConsider updating the examples in the documentation.", file=sys.stderr)
        else:
            print("‚úì All code examples are in sync")
    
    elif file_path.endswith(('.ts', '.tsx', '.js', '.jsx', '.py')):
        # Code file changed - check if it's referenced in docs
        print(f"Checking if {file_path} is referenced in documentation...")
        
        # Find docs that reference this file
        doc_files = []
        for root, dirs, files in os.walk('docs'):
            for file in files:
                if file.endswith(('.md', '.mdx')):
                    doc_path = os.path.join(root, file)
                    with open(doc_path, 'r') as f:
                        if file_path in f.read():
                            doc_files.append(doc_path)
        
        if doc_files:
            print(f"‚ÑπÔ∏è File is referenced in {len(doc_files)} documentation file(s):")
            for doc in doc_files:
                print(f"  - {doc}")
            print("\nConsider updating these docs if the API changed.")
    
    sys.exit(0)

if __name__ == '__main__':
    try:
        main()
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(0)
```

```bash
chmod +x .factory/hooks/sync-doc-examples.py
```


## Advanced documentation automation

### OpenAPI/Swagger spec validation

Ensure API documentation matches implementation:



Create `.factory/hooks/validate-openapi.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Check if this is an API route file
if ! echo "$file_path" | grep -qE 'routes/.*\.(ts|js)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Check if OpenAPI spec exists
if [ ! -f "openapi.yaml" ] && [ ! -f "swagger.yaml" ]; then
  exit 0
fi

spec_file="openapi.yaml"
[ -f "swagger.yaml" ] && spec_file="swagger.yaml"

echo "üîç Validating OpenAPI spec..."

# Extract route definitions from code
# This is simplified - you'd need a more sophisticated parser
routes=$(grep -E "router\.(get|post|put|delete|patch)" "$file_path" | \
  sed -E "s/.*router\.([a-z]+)\(['\"](.*?)['\"].*/\1 \2/" || true)

if [ -n "$routes" ]; then
  echo "Routes in $file_path:"
  echo "$routes" | sed 's/^/  /'
  
  # Check if routes are documented in OpenAPI spec
  while IFS= read -r route; do
    method=$(echo "$route" | awk '{print $1}')
    path=$(echo "$route" | awk '{print $2}')
    
    if ! grep -q "$path" "$spec_file"; then
      echo "‚ö†Ô∏è Route not documented in $spec_file: $method $path"
      echo "Consider adding this endpoint to the API documentation."
    fi
  done <<< "$routes"
fi

# Validate spec syntax
if command -v swagger-cli &> /dev/null; then
  if swagger-cli validate "$spec_file" 2>&1; then
    echo "‚úì OpenAPI spec is valid"
  else
    echo "‚ùå OpenAPI spec has errors" >&2
  fi
fi

exit 0
```

```bash
chmod +x .factory/hooks/validate-openapi.sh
```


### JSDoc/TSDoc enforcement

Require documentation comments for public APIs:



Create `.factory/hooks/enforce-jsdoc.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')
content=$(echo "$input" | jq -r '.tool_input.content // ""')

# Only check TypeScript/JavaScript files
if ! echo "$file_path" | grep -qE '\.(ts|tsx|js|jsx)$'; then
  exit 0
fi

# Skip test files
if echo "$file_path" | grep -qE '\.(test|spec)\.(ts|tsx|js|jsx)$'; then
  exit 0
fi

# Check for exported functions/classes without JSDoc
missing_docs=()

# Find exported functions without JSDoc
while IFS= read -r line; do
  # Check if line is an export
  if echo "$line" | grep -qE '^export (function|class|const|interface|type)'; then
    # Get the name
    name=$(echo "$line" | sed -E 's/^export (function|class|const|interface|type) ([a-zA-Z0-9_]+).*/\2/')
    
    # Check if there's a JSDoc comment before it
    # This is simplified - you'd want a proper parser
    if ! echo "$content" | grep -B1 "^export.*$name" | grep -qE '^\s*\*'; then
      missing_docs+=("$name")
    fi
  fi
done <<< "$content"

if [ ${#missing_docs[@]} -gt 0 ]; then
  echo "‚ö†Ô∏è Exported items missing documentation:" >&2
  printf '  - %s\n' "${missing_docs[@]}" >&2
  echo "" >&2
  echo "Please add JSDoc comments for public APIs:" >&2
  echo "/**" >&2
  echo " * Description of what this does" >&2
  echo " * @param paramName - Parameter description" >&2
  echo " * @returns Return value description" >&2
  echo " */" >&2
  
  # Warning only, don't block
  # Change to exit 2 to enforce documentation
fi

exit 0
```

```bash
chmod +x .factory/hooks/enforce-jsdoc.sh
```


### Generate changelog from commits

Automatically build changelog from git history:



Create `.factory/hooks/generate-changelog.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')

# Only run on Stop (after work is complete)
if [ "$hook_event" != "Stop" ]; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Check if there are new commits since last changelog update
if [ ! -f "CHANGELOG.md" ]; then
  exit 0
fi

# Get last version in changelog
last_version=$(grep -m1 "## \[" CHANGELOG.md | sed -E 's/.*\[([0-9.]+)\].*/\1/')

if [ -z "$last_version" ]; then
  exit 0
fi

# Get commits since last version tag
if git rev-parse "v$last_version" &>/dev/null; then
  new_commits=$(git log "v$last_version..HEAD" --oneline)
  
  if [ -n "$new_commits" ]; then
    echo "üìù New commits since v$last_version"
    echo ""
    echo "Consider updating CHANGELOG.md with:"
    echo ""
    
    # Group commits by type
    echo "### Features"
    git log "v$last_version..HEAD" --oneline | grep "^[a-f0-9]* feat" | sed 's/^[a-f0-9]* feat[:(]/- /' || true
    echo ""
    
    echo "### Bug Fixes"
    git log "v$last_version..HEAD" --oneline | grep "^[a-f0-9]* fix" | sed 's/^[a-f0-9]* fix[:(]/- /' || true
    echo ""
  fi
fi

exit 0
```

```bash
chmod +x .factory/hooks/generate-changelog.sh
```


### Docs coverage report

Track which code has documentation:



Create `.factory/hooks/docs-coverage.py`:

```python
#!/usr/bin/env python3
"""
Calculate documentation coverage for the codebase.
"""
import os
import re
import sys
import json

def count_functions(file_path):
    """Count functions in a file."""
    with open(file_path, 'r') as f:
        content = f.read()
    
    # Count function definitions (simplified)
    if file_path.endswith('.py'):
        functions = re.findall(r'^def \w+\(', content, re.MULTILINE)
    elif file_path.endswith(('.ts', '.tsx', '.js', '.jsx')):
        functions = re.findall(r'(^export function \w+|^function \w+|const \w+ = \(.*\) =>)', 
                              content, re.MULTILINE)
    else:
        return 0
    
    return len(functions)

def count_documented_functions(file_path):
    """Count functions with documentation."""
    with open(file_path, 'r') as f:
        content = f.read()
    
    if file_path.endswith('.py'):
        # Look for docstrings
        pattern = r'def \w+\(.*?\):\s*"""'
    elif file_path.endswith(('.ts', '.tsx', '.js', '.jsx')):
        # Look for JSDoc comments
        pattern = r'/\*\*.*?\*/\s*(export )?function \w+'
    else:
        return 0
    
    documented = re.findall(pattern, content, re.DOTALL)
    return len(documented)

def main():
    # Calculate documentation coverage for src/
    src_dir = 'src'
    
    if not os.path.exists(src_dir):
        sys.exit(0)
    
    total_functions = 0
    documented_functions = 0
    
    for root, dirs, files in os.walk(src_dir):
        # Skip test files
        dirs[:] = [d for d in dirs if d not in ['__tests__', 'test', 'tests']]
        
        for file in files:
            if file.endswith(('.py', '.ts', '.tsx', '.js', '.jsx')):
                file_path = os.path.join(root, file)
                total_functions += count_functions(file_path)
                documented_functions += count_documented_functions(file_path)
    
    if total_functions > 0:
        coverage = (documented_functions / total_functions) * 100
        
        print(f"\nüìä Documentation Coverage Report")
        print(f"Documented functions: {documented_functions}/{total_functions}")
        print(f"Coverage: {coverage:.1f}%")
        
        if coverage < 60:
            print("\n‚ö†Ô∏è Documentation coverage is low")
            print("Consider adding documentation to public APIs")
        elif coverage < 80:
            print("\n‚úì Documentation coverage is good, but could be better")
        else:
            print("\n‚úì Excellent documentation coverage!")

if __name__ == '__main__':
    try:
        main()
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
    
    sys.exit(0)
```

```bash
chmod +x .factory/hooks/docs-coverage.py
```

Run on session end:

```json
{
  "hooks": {
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/docs-coverage.py",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
```


## Best practices

<Steps>
  <Step title="Automate but don't auto-commit">
    Generate docs but let users review before committing:
    ```bash
    # Generate docs
    typedoc --out docs/api src/
    
    # Alert but don't commit
    echo "‚úì API docs regenerated at docs/api"
    echo "Review changes: git diff docs/"
    ```
  </Step>
  
  <Step title="Keep doc examples testable">
    Extract examples from actual tests:
    ```bash
    # Extract example from test file
    sed -n '/Example:/,/End example/p' Button.test.tsx > docs/examples/button.md
    ```
  </Step>
  
  <Step title="Version documentation">
    Tag docs with version info:
    ```markdown
    # API Reference
    
    > Version: 2.1.0  
    > Last updated: 2024-01-15
    ```
  </Step>
  
  <Step title="Link docs to code">
    Include source file references:
    ```markdown
    ## Button Component
    
    Source: [`src/components/Button.tsx`](../src/components/Button.tsx)
    ```
  </Step>
  
  <Step title="Use doc generation tools">
    Don't manually maintain API docs:
    ```bash
    # TypeScript
    typedoc --out docs/api src/
    
    # Python
    pdoc --html --output-dir docs/api src/
    
    # Go
    godoc -http=:6060
    ```
  </Step>
</Steps>

## Troubleshooting


  
    **Problem**: Can't generate documentation
    
    **Solution**: Check tool configuration:
    ```bash
    # Verify tool installation
    which typedoc
    
    # Check config file
    cat typedoc.json
    
    # Test manually
    typedoc --version
    typedoc --help
    ```
  
  
  
    **Problem**: Doc examples don't match code
    
    **Solution**: Extract examples from tests:
    ```typescript
    // In test file
    /* DOC_EXAMPLE_START: basic-usage */
    const result = myFunction(input);
    expect(result).toBe(expected);
    /* DOC_EXAMPLE_END */
    ```
    
    Then extract programmatically:
    ```bash
    sed -n '/DOC_EXAMPLE_START/,/DOC_EXAMPLE_END/p' test.ts
    ```
  
  
  
    **Problem**: Doc generation takes too long
    
    **Solution**: Build incrementally:
    ```bash
    # Only rebuild changed files
    typedoc --incremental src/
    
    # Or skip in hooks, run manually
    if [ "$SKIP_DOC_BUILD" = "true" ]; then
      exit 0
    fi
    ```
  


## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Code validation](/cli/configuration/hooks/code-validation) - Enforce code standards
- [Git workflows](/cli/configuration/hooks/git-workflows) - Git integration
</file>

<file path="docs/cli/configuration/hooks/git-workflows.mdx">
---
title: "Git Workflow Hooks"
description: "Integrate hooks with Git for commit validation, branch protection, and automated workflows"
---

This cookbook shows how to use hooks to enforce Git workflows, validate commits, protect branches, and automate changelog generation.

## How it works

Git workflow hooks can:

1. **Validate commits**: Check commit messages follow conventions
2. **Protect branches**: Prevent accidental commits to main/production
3. **Generate changelogs**: Auto-create changelog entries from commits
4. **Run pre-push checks**: Validate code before pushing
5. **Enforce PR requirements**: Check branch names, linear issues, etc.

## Prerequisites

Basic Git tools:

<CodeGroup>

```bash Git
git --version
```

```bash GitHub CLI (optional)
brew install gh  # macOS
# or download from https://cli.github.com
```

```bash Conventional Commits (optional)
npm install -g commitlint @commitlint/cli @commitlint/config-conventional
```

</CodeGroup>

## Basic Git hooks

### Commit message validation

Enforce conventional commit format.

Create `.factory/hooks/validate-commit-msg.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')

# Only validate Bash commands that look like git commit
if [ "$tool_name" != "Bash" ]; then
  exit 0
fi

command=$(echo "$input" | jq -r '.tool_input.command')

# Check if this is a git commit command
if ! echo "$command" | grep -qE "^git commit"; then
  exit 0
fi

# Extract commit message from command
if echo "$command" | grep -qE "git commit -m"; then
  # Extract message from -m flag
  commit_msg=$(echo "$command" | sed -E 's/.*git commit.*-m[= ]*["\x27]([^"\x27]+)["\x27].*/\1/')
else
  # Allow commits without -m (will open editor)
  exit 0
fi

# Validate conventional commit format
# Format: type(scope): description
# Example: feat(auth): add login functionality

if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?:.+"; then
  echo "‚ùå Invalid commit message format" >&2
  echo "" >&2
  echo "Commit message must follow Conventional Commits format:" >&2
  echo "  type(scope): description" >&2
  echo "" >&2
  echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert" >&2
  echo "" >&2
  echo "Examples:" >&2
  echo "  feat(auth): add user login" >&2
  echo "  fix(api): handle null values" >&2
  echo "  docs: update README" >&2
  exit 2
fi

# Check for Linear issue reference
if ! echo "$commit_msg" | grep -qE "FAC-[0-9]+"; then
  echo "‚ö†Ô∏è No Linear issue reference found" >&2
  echo "Consider adding issue reference like: feat(auth): add login FAC-123" >&2
  # Warning only, don't block
fi

exit 0
```

```bash
chmod +x .factory/hooks/validate-commit-msg.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/validate-commit-msg.sh",
            "timeout": 3
          }
        ]
      }
    ]
  }
}
```

### Branch protection

Prevent commits directly to protected branches.

Create `.factory/hooks/protect-branches.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

# Only check git commit commands
if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git (commit|push)"; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Check if we're in a git repo
if [ ! -d ".git" ]; then
  exit 0
fi

current_branch=$(git branch --show-current)

# Protected branches that cannot be committed to directly
protected_branches=("main" "master" "production" "prod")

for branch in "${protected_branches[@]}"; do
  if [ "$current_branch" = "$branch" ]; then
    echo "‚ùå Cannot commit directly to protected branch: $branch" >&2
    echo "" >&2
    echo "Please create a feature branch instead:" >&2
    echo "  git checkout -b feature/your-feature-name" >&2
    echo "" >&2
    echo "Then create a pull request to merge your changes." >&2
    exit 2
  fi
done

exit 0
```

```bash
chmod +x .factory/hooks/protect-branches.sh
```


### Enforce branch naming

Require feature branches to follow naming conventions:



Create `.factory/hooks/validate-branch-name.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

# Only check git checkout -b commands
if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git checkout -b"; then
  exit 0
fi

# Extract branch name
branch_name=$(echo "$command" | sed -E 's/.*git checkout -b[= ]*([^ ]+).*/\1/')

# Valid patterns:
# - feature/FAC-123-description
# - fix/FAC-123-description
# - hotfix/FAC-123-description

if ! echo "$branch_name" | grep -qE "^(feature|fix|hotfix|docs|refactor)/[A-Z]+-[0-9]+-[a-z0-9-]+$"; then
  echo "‚ùå Invalid branch name format" >&2
  echo "" >&2
  echo "Branch names must follow the pattern:" >&2
  echo "  type/ISSUE-123-description" >&2
  echo "" >&2
  echo "Examples:" >&2
  echo "  feature/FAC-123-add-user-auth" >&2
  echo "  fix/FAC-456-fix-login-bug" >&2
  echo "  hotfix/FAC-789-critical-security-fix" >&2
  exit 2
fi

exit 0
```

```bash
chmod +x .factory/hooks/validate-branch-name.sh
```


## Advanced Git automation

### Auto-generate changelog entries

Automatically create changelog entries from commits:



Create `.factory/hooks/update-changelog.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

# Only run after git commit
if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git commit"; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Get the last commit message
last_commit=$(git log -1 --pretty=format:"%s")

# Parse conventional commit
if echo "$last_commit" | grep -qE "^(feat|fix)(\(.+\))?:"; then
  commit_type=$(echo "$last_commit" | sed -E 's/^([^:(]+).*/\1/')
  commit_msg=$(echo "$last_commit" | sed -E 's/^[^:]+: (.+)/\1/')
  
  # Determine changelog section
  if [ "$commit_type" = "feat" ]; then
    section="### Features"
  elif [ "$commit_type" = "fix" ]; then
    section="### Bug Fixes"
  else
    exit 0
  fi
  
  # Create/update CHANGELOG.md
  if [ ! -f "CHANGELOG.md" ]; then
    cat > CHANGELOG.md << EOF
# Changelog

All notable changes to this project will be documented in this file.

## [Unreleased]

$section

- $commit_msg

EOF
  else
    # Insert into Unreleased section
    if grep -q "## \[Unreleased\]" CHANGELOG.md; then
      # Check if section exists
      if grep -q "^$section" CHANGELOG.md; then
        # Add to existing section
        sed -i.bak "/^$section/a\\
- $commit_msg
" CHANGELOG.md
      else
        # Create new section
        sed -i.bak "/## \[Unreleased\]/a\\
\\
$section\\
\\
- $commit_msg
" CHANGELOG.md
      fi
      rm CHANGELOG.md.bak 2>/dev/null || true
    fi
  fi
  
  echo "‚úì Updated CHANGELOG.md"
fi

exit 0
```

```bash
chmod +x .factory/hooks/update-changelog.sh
```

Add to PostToolUse:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/update-changelog.sh",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
```


### Pre-push validation

Run tests and checks before allowing git push:



Create `.factory/hooks/pre-push-check.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

# Only check git push commands
if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git push"; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üîç Running pre-push checks..."

# Check for uncommitted changes
if [ -n "$(git status --porcelain)" ]; then
  echo "‚ö†Ô∏è You have uncommitted changes" >&2
  echo "Commit or stash them before pushing" >&2
  git status --short >&2
  exit 2
fi

# Run linter
if [ -f "package.json" ] && grep -q '"lint"' package.json; then
  echo "Running linter..."
  if ! npm run lint 2>&1; then
    echo "‚ùå Linting failed" >&2
    echo "Fix lint errors before pushing" >&2
    exit 2
  fi
  echo "‚úì Linting passed"
fi

# Run tests
if [ -f "package.json" ] && grep -q '"test"' package.json; then
  echo "Running tests..."
  if ! npm test 2>&1; then
    echo "‚ùå Tests failed" >&2
    echo "Fix failing tests before pushing" >&2
    exit 2
  fi
  echo "‚úì Tests passed"
fi

# Check for merge conflicts markers
if git grep -qE "^(<<<<<<<|=======|>>>>>>>)" 2>/dev/null; then
  echo "‚ùå Merge conflict markers found in files" >&2
  git grep -l "^(<<<<<<<|=======|>>>>>>>)" >&2
  exit 2
fi

echo "‚úì All pre-push checks passed"

exit 0
```

```bash
chmod +x .factory/hooks/pre-push-check.sh
```


### Auto-create PR when pushing new branch

Automatically open a PR when pushing a feature branch:



Create `.factory/hooks/auto-create-pr.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

# Only run after successful git push of a new branch
if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git push.*-u origin"; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Check if gh CLI is available
if ! command -v gh &> /dev/null; then
  exit 0
fi

current_branch=$(git branch --show-current)

# Don't create PR for main/master branches
if [[ "$current_branch" =~ ^(main|master|dev|develop)$ ]]; then
  exit 0
fi

# Check if PR already exists
if gh pr view &>/dev/null; then
  echo "‚ÑπÔ∏è PR already exists for this branch"
  exit 0
fi

# Extract issue number from branch name
issue_number=""
if [[ $current_branch =~ ([A-Z]+-[0-9]+) ]]; then
  issue_number="${BASH_REMATCH[1]}"
fi

# Generate PR title from branch name or commits
pr_title="$current_branch"
if [ -n "$issue_number" ]; then
  pr_title="$issue_number: $(echo "$current_branch" | sed -E 's/^[^/]+\/[A-Z]+-[0-9]+-//; s/-/ /g')"
fi

# Create PR
echo "üîÑ Creating pull request..."
if gh pr create --title "$pr_title" --body "Closes $issue_number" --web; then
  echo "‚úì Pull request created and opened in browser"
else
  echo "‚ö†Ô∏è Could not create PR automatically"
fi

exit 0
```

```bash
chmod +x .factory/hooks/auto-create-pr.sh
```


### Enforce co-authorship in commits

Add co-author trailers to commits:



Create `.factory/hooks/add-coauthor.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

# Only modify git commit commands
if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git commit.*-m"; then
  exit 0
fi

# Extract commit message
commit_msg=$(echo "$command" | sed -E 's/.*git commit.*-m[= ]*["\x27]([^"\x27]+)["\x27].*/\1/')

# Check if co-author is already present
if echo "$commit_msg" | grep -qE "Co-authored-by:"; then
  exit 0
fi

# Add factory droid co-author
coauthor="Co-authored-by: factory-droid[bot] <138933559+factory-droid[bot]@users.noreply.github.com>"

# Modify command to include co-author
modified_msg="$commit_msg

$coauthor"

# Return modified command via JSON output
cat << EOF
{
  "hookSpecificOutput": {
    "hookEventName": "PreToolUse",
    "permissionDecision": "allow",
    "permissionDecisionReason": "Adding co-author to commit",
    "updatedInput": {
      "command": "$(echo "$command" | sed -E "s/(git commit.*-m[= ]*)[\"']([^\"']+)[\"']/\1\"$modified_msg\"/")"
    }
  }
}
EOF

exit 0
```

```bash
chmod +x .factory/hooks/add-coauthor.sh
```


## Real-world examples

### Example 1: Monorepo commit validation

Ensure commits only touch one package:



Create `.factory/hooks/validate-monorepo-scope.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
command=$(echo "$input" | jq -r '.tool_input.command // ""')

if [ "$tool_name" != "Bash" ] || ! echo "$command" | grep -qE "^git commit"; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Get staged files
staged_files=$(git diff --cached --name-only)

if [ -z "$staged_files" ]; then
  exit 0
fi

# Check if changes span multiple packages
packages=$(echo "$staged_files" | grep -E "^(packages|apps)/" | cut -d/ -f1-2 | sort -u)
package_count=$(echo "$packages" | wc -l | tr -d ' ')

if [ "$package_count" -gt 1 ]; then
  echo "‚ùå Commit spans multiple packages" >&2
  echo "" >&2
  echo "Changed packages:" >&2
  echo "$packages" | sed 's/^/  - /' >&2
  echo "" >&2
  echo "Please commit changes to each package separately for clearer history." >&2
  exit 2
fi

exit 0
```


### Example 2: Release automation

Auto-tag releases when version changes:



Create `.factory/hooks/auto-tag-release.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')

# Only run after commits
if [ "$tool_name" != "Bash" ]; then
  exit 0
fi

command=$(echo "$input" | jq -r '.tool_input.command // ""')
if ! echo "$command" | grep -qE "^git commit"; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Check if package.json version changed in last commit
if ! git diff HEAD~1 HEAD --name-only | grep -q "package.json"; then
  exit 0
fi

# Check if version field changed
if git diff HEAD~1 HEAD -- package.json | grep -q "^+.*\"version\""; then
  # Get new version
  new_version=$(jq -r '.version' package.json)
  
  echo "üì¶ Version bump detected: v$new_version"
  echo "Creating git tag..."
  
  # Create and push tag
  if git tag "v$new_version" && git push origin "v$new_version"; then
    echo "‚úì Created and pushed tag v$new_version"
  fi
fi

exit 0
```


## Best practices

<Steps>
  <Step title="Use PreToolUse for prevention">
    Block bad commits before they happen:
    ```bash
    # In PreToolUse hook
    if invalid_commit; then
      echo "‚ùå Cannot proceed" >&2
      exit 2  # Blocks the git commit
    fi
    ```
  </Step>
  
  <Step title="Use PostToolUse for automation">
    Automate followup actions after successful commits:
    ```bash
    # In PostToolUse hook
    if git_commit_successful; then
      update_changelog
      create_pr
    fi
    ```
  </Step>
  
  <Step title="Provide clear error messages">
    Tell users exactly what's wrong and how to fix it:
    ```bash
    echo "‚ùå Commit message must include issue reference" >&2
    echo "Example: feat(auth): add login FAC-123" >&2
    ```
  </Step>
  
  <Step title="Make hooks configurable">
    Allow teams to customize behavior:
    ```bash
    PROTECTED_BRANCHES="${DROID_PROTECTED_BRANCHES:-main,master,production}"
    REQUIRE_ISSUE_REF="${DROID_REQUIRE_ISSUE:-true}"
    ```
  </Step>
  
  <Step title="Test hooks with dry-run">
    Test without making actual commits:
    ```bash
    # Simulate a commit
    echo '{"tool_name":"Bash","tool_input":{"command":"git commit -m \"test\""}}' | \
      .factory/hooks/validate-commit-msg.sh
    ```
  </Step>
</Steps>

## Troubleshooting


  
    **Problem**: Validation too strict
    
    **Solution**: Add escape hatches:
    ```bash
    # Allow bypass with special prefix
    if echo "$commit_msg" | grep -q "^WIP:"; then
      echo "‚ö†Ô∏è WIP commit allowed"
      exit 0
    fi
    ```
  
  
  
    **Problem**: Both Droid hooks and .git/hooks running
    
    **Solution**: Coordinate or choose one:
    ```bash
    # In .git/hooks/pre-commit
    if [ -n "$DROID_SESSION" ]; then
      exit 0  # Let Droid hooks handle it
    fi
    ```
  
  
  
    **Problem**: Tests take too long
    
    **Solution**: Run quick checks only:
    ```bash
    # Run fast subset of tests
    npm run test:unit  # Skip slow integration tests
    
    # Or run in parallel with push
    npm test &
    git push
    ```
  


## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Code validation](/cli/configuration/hooks/code-validation) - Validate code quality
- [Testing automation](/cli/configuration/hooks/testing-automation) - Automate tests
</file>

<file path="docs/cli/configuration/hooks/logging-analytics.mdx">
---
title: "Logging and Analytics"
description: "Track Droid usage, collect metrics, and analyze development patterns with hooks"
---

This cookbook shows how to use hooks to track Droid usage, collect development metrics, analyze patterns, and generate insights about your development workflow.

## How it works

Logging and analytics hooks can:

1. **Track tool usage**: Log which tools Droid uses most frequently
2. **Measure performance**: Track session duration, command execution time
3. **Analyze patterns**: Identify common workflows and bottlenecks
4. **Generate reports**: Create usage summaries and insights
5. **Monitor costs**: Track token usage and API costs

## Prerequisites

Tools for logging and data collection:

<CodeGroup>

```bash Basic tools
# jq for JSON processing
brew install jq  # macOS
sudo apt-get install jq  # Ubuntu/Debian

# SQLite for local database
brew install sqlite3  # macOS (usually pre-installed)
```

```bash Optional analytics
# ClickHouse for advanced analytics
brew install clickhouse  # macOS
docker run -d -p 8123:8123 clickhouse/clickhouse-server

# Or use cloud services
# - Google Analytics
# - Mixpanel
# - PostHog
```

</CodeGroup>

## Basic logging

### Log all commands

Track every command Droid executes.

Create `.factory/hooks/log-commands.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')

# Only log Bash commands
if [ "$tool_name" != "Bash" ]; then
  exit 0
fi

command=$(echo "$input" | jq -r '.tool_input.command')
timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
session_id=$(echo "$input" | jq -r '.session_id')

# Log to file
log_file="$HOME/.factory/command-log.jsonl"

# Create log entry
log_entry=$(jq -n \
  --arg ts "$timestamp" \
  --arg sid "$session_id" \
  --arg cmd "$command" \
  '{timestamp: $ts, session_id: $sid, command: $cmd}')

echo "$log_entry" >> "$log_file"

exit 0
```

```bash
chmod +x .factory/hooks/log-commands.sh
```

Add to `~/.factory/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/log-commands.sh",
            "timeout": 2
          }
        ]
      }
    ]
  }
}
```

Analyze logs:

```bash
# Most common commands
jq -r '.command' ~/.factory/command-log.jsonl | sort | uniq -c | sort -rn | head -10

# Commands by session
jq -r '"\(.session_id): \(.command)"' ~/.factory/command-log.jsonl
```

### Track file modifications

Log all file edits and writes.

Create `.factory/hooks/track-file-changes.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only track file operations
if [ "$tool_name" != "Write" ] && [ "$tool_name" != "Edit" ]; then
  exit 0
fi

timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
session_id=$(echo "$input" | jq -r '.session_id')
cwd=$(echo "$input" | jq -r '.cwd')

# Determine file type
file_ext="${file_path##*.}"

# Calculate file size (for Write operations)
if [ "$tool_name" = "Write" ]; then
  content=$(echo "$input" | jq -r '.tool_input.content // ""')
  size=$(echo "$content" | wc -c | tr -d ' ')
else
  size="unknown"
fi

# Log to SQLite database
db_file="$HOME/.factory/file-changes.db"

# Create table if not exists
sqlite3 "$db_file" "CREATE TABLE IF NOT EXISTS file_changes (
  timestamp TEXT,
  session_id TEXT,
  project TEXT,
  operation TEXT,
  file_path TEXT,
  file_type TEXT,
  size INTEGER
);" 2>/dev/null

# Insert record
sqlite3 "$db_file" "INSERT INTO file_changes VALUES (
  '$timestamp',
  '$session_id',
  '$(basename "$cwd")',
  '$tool_name',
  '$file_path',
  '$file_ext',
  '$size'
);" 2>/dev/null

exit 0
```

```bash
chmod +x .factory/hooks/track-file-changes.sh
```

Query the database:

```bash
# Most edited files
sqlite3 ~/.factory/file-changes.db \
  "SELECT file_path, COUNT(*) as edits FROM file_changes 
   GROUP BY file_path ORDER BY edits DESC LIMIT 10;"

# Files edited by type
sqlite3 ~/.factory/file-changes.db \
  "SELECT file_type, COUNT(*) as count FROM file_changes 
   GROUP BY file_type ORDER BY count DESC;"

# Activity by project
sqlite3 ~/.factory/file-changes.db \
  "SELECT project, COUNT(*) as changes FROM file_changes 
   GROUP BY project ORDER BY changes DESC;"
```


### Session duration tracking

Measure how long sessions last:



Create `.factory/hooks/track-session.sh`:

```bash
#!/bin/bash

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')
session_id=$(echo "$input" | jq -r '.session_id')

db_file="$HOME/.factory/sessions.db"

# Create table
sqlite3 "$db_file" "CREATE TABLE IF NOT EXISTS sessions (
  session_id TEXT PRIMARY KEY,
  start_time TEXT,
  end_time TEXT,
  reason TEXT,
  duration_seconds INTEGER
);" 2>/dev/null

case "$hook_event" in
  "SessionStart")
    # Record session start
    start_time=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
    sqlite3 "$db_file" "INSERT OR REPLACE INTO sessions (session_id, start_time) 
      VALUES ('$session_id', '$start_time');" 2>/dev/null
    ;;
    
  "SessionEnd")
    # Record session end and calculate duration
    end_time=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
    reason=$(echo "$input" | jq -r '.reason')
    
    # Get start time
    start_time=$(sqlite3 "$db_file" \
      "SELECT start_time FROM sessions WHERE session_id='$session_id';" 2>/dev/null)
    
    if [ -n "$start_time" ]; then
      # Calculate duration in seconds
      start_epoch=$(date -jf "%Y-%m-%dT%H:%M:%SZ" "$start_time" +%s 2>/dev/null || date -d "$start_time" +%s)
      end_epoch=$(date -jf "%Y-%m-%dT%H:%M:%SZ" "$end_time" +%s 2>/dev/null || date -d "$end_time" +%s)
      duration=$((end_epoch - start_epoch))
      
      # Update record
      sqlite3 "$db_file" "UPDATE sessions 
        SET end_time='$end_time', reason='$reason', duration_seconds=$duration 
        WHERE session_id='$session_id';" 2>/dev/null
      
      # Print summary
      echo "üìä Session duration: $((duration / 60)) minutes $((duration % 60)) seconds"
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/track-session.sh
```

Add to hooks:

```json
{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/track-session.sh",
            "timeout": 2
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/track-session.sh",
            "timeout": 2
          }
        ]
      }
    ]
  }
}
```

Query session stats:

```bash
# Average session duration
sqlite3 ~/.factory/sessions.db \
  "SELECT AVG(duration_seconds) / 60.0 as avg_minutes FROM sessions 
   WHERE duration_seconds IS NOT NULL;"

# Sessions by exit reason
sqlite3 ~/.factory/sessions.db \
  "SELECT reason, COUNT(*) as count FROM sessions 
   GROUP BY reason ORDER BY count DESC;"

# Longest sessions
sqlite3 ~/.factory/sessions.db \
  "SELECT session_id, duration_seconds / 60.0 as minutes FROM sessions 
   ORDER BY duration_seconds DESC LIMIT 10;"
```


## Advanced analytics

### Usage heatmap

Track when Droid is used most:



Create `.factory/hooks/usage-heatmap.py`:

```python
#!/usr/bin/env python3
"""
Generate usage heatmap showing when Droid is used most.
"""
import json
import sys
import sqlite3
from datetime import datetime
from collections import defaultdict

def generate_heatmap():
    """Create a heatmap of Droid usage by hour and day."""
    db_path = os.path.expanduser('~/.factory/sessions.db')
    
    if not os.path.exists(db_path):
        return
    
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    # Get all session starts
    cursor.execute("SELECT start_time FROM sessions WHERE start_time IS NOT NULL")
    
    # Count by day of week and hour
    heatmap = defaultdict(lambda: defaultdict(int))
    
    for (start_time,) in cursor.fetchall():
        try:
            dt = datetime.fromisoformat(start_time.replace('Z', '+00:00'))
            day = dt.strftime('%A')
            hour = dt.hour
            heatmap[day][hour] += 1
        except:
            continue
    
    conn.close()
    
    # Print heatmap
    days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
    hours = range(24)
    
    print("\nüìä Droid Usage Heatmap")
    print("=" * 80)
    print(f"{'Day':<12} {'Morning (6-12)':<15} {'Afternoon (12-18)':<15} {'Evening (18-24)':<15}")
    print("-" * 80)
    
    for day in days:
        morning = sum(heatmap[day][h] for h in range(6, 12))
        afternoon = sum(heatmap[day][h] for h in range(12, 18))
        evening = sum(heatmap[day][h] for h in range(18, 24))
        
        print(f"{day:<12} {morning:<15} {afternoon:<15} {evening:<15}")
    
    print("=" * 80)

if __name__ == '__main__':
    import os
    generate_heatmap()
```

```bash
chmod +x .factory/hooks/usage-heatmap.py
```

Run periodically:

```bash
# Add to weekly report
~/.factory/hooks/usage-heatmap.py
```


### Tool usage statistics

Track which tools are used most:



Create `.factory/hooks/tool-stats.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')

# Log tool usage
log_file="$HOME/.factory/tool-usage.log"
timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

echo "$timestamp $tool_name" >> "$log_file"

exit 0
```

```bash
chmod +x .factory/hooks/tool-stats.sh
```

Add to PreToolUse for all tools:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/tool-stats.sh",
            "timeout": 1
          }
        ]
      }
    ]
  }
}
```

Generate report:

```bash
# Most used tools
awk '{print $2}' ~/.factory/tool-usage.log | sort | uniq -c | sort -rn

# Tool usage over time
awk '{print $1}' ~/.factory/tool-usage.log | cut -d'T' -f1 | uniq -c

# Usage by hour
awk '{print $1}' ~/.factory/tool-usage.log | cut -d'T' -f2 | cut -d':' -f1 | sort | uniq -c
```


### Performance metrics

Track hook execution performance:



Create `.factory/hooks/perf-monitor.sh`:

```bash
#!/bin/bash

# This hook measures its own performance and logs it
start_time=$(date +%s.%N)

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')
tool_name=$(echo "$input" | jq -r '.tool_name // "none"')

# Simulate your actual hook work here
# ...

end_time=$(date +%s.%N)
duration=$(echo "$end_time - $start_time" | bc)

# Log performance
perf_log="$HOME/.factory/hook-performance.log"
timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

echo "$timestamp $hook_event $tool_name ${duration}s" >> "$perf_log"

# Warn if hook is slow
if (( $(echo "$duration > 1.0" | bc -l) )); then
  echo "‚ö†Ô∏è Hook took ${duration}s to execute (>1s threshold)" >&2
fi

exit 0
```

Analyze performance:

```bash
# Slowest hooks
sort -k4 -rn ~/.factory/hook-performance.log | head -10

# Average execution time by event
awk '{sum[$2]+=$4; count[$2]++} END {for (event in sum) print event, sum[event]/count[event] "s"}' \
  ~/.factory/hook-performance.log
```


### Cost tracking

Monitor token usage and API costs:



Create `.factory/hooks/track-costs.sh`:

```bash
#!/bin/bash

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')

# Only track on session end
if [ "$hook_event" != "SessionEnd" ]; then
  exit 0
fi

session_id=$(echo "$input" | jq -r '.session_id')
transcript_path=$(echo "$input" | jq -r '.transcript_path')

# Parse transcript for token usage
if [ ! -f "$transcript_path" ]; then
  exit 0
fi

# Extract token counts from transcript (simplified)
# In reality, you'd parse the actual transcript format
input_tokens=$(grep -o '"input_tokens":[0-9]*' "$transcript_path" | \
  cut -d':' -f2 | paste -sd+ - | bc)
output_tokens=$(grep -o '"output_tokens":[0-9]*' "$transcript_path" | \
  cut -d':' -f2 | paste -sd+ - | bc)

# Calculate approximate cost (rates vary by model)
# Claude Sonnet 4.5: $3 per 1M input, $15 per 1M output
input_cost=$(echo "scale=4; $input_tokens * 3 / 1000000" | bc)
output_cost=$(echo "scale=4; $output_tokens * 15 / 1000000" | bc)
total_cost=$(echo "scale=4; $input_cost + $output_cost" | bc)

# Log costs
cost_db="$HOME/.factory/costs.db"

sqlite3 "$cost_db" "CREATE TABLE IF NOT EXISTS costs (
  session_id TEXT PRIMARY KEY,
  timestamp TEXT,
  input_tokens INTEGER,
  output_tokens INTEGER,
  total_cost REAL
);" 2>/dev/null

timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

sqlite3 "$cost_db" "INSERT OR REPLACE INTO costs VALUES (
  '$session_id',
  '$timestamp',
  $input_tokens,
  $output_tokens,
  $total_cost
);" 2>/dev/null

# Print summary
echo "üí∞ Session cost: \$${total_cost} (${input_tokens} input + ${output_tokens} output tokens)"

exit 0
```

```bash
chmod +x .factory/hooks/track-costs.sh
```

Query costs:

```bash
# Total costs
sqlite3 ~/.factory/costs.db \
  "SELECT SUM(total_cost) as total FROM costs;"

# Cost by date
sqlite3 ~/.factory/costs.db \
  "SELECT DATE(timestamp) as date, SUM(total_cost) as cost 
   FROM costs GROUP BY DATE(timestamp) ORDER BY date DESC;"

# Most expensive sessions
sqlite3 ~/.factory/costs.db \
  "SELECT session_id, total_cost FROM costs 
   ORDER BY total_cost DESC LIMIT 10;"
```


### Generate weekly reports

Compile usage reports:



Create `.factory/hooks/weekly-report.py`:

```python
#!/usr/bin/env python3
"""
Generate weekly usage report.
"""
import os
import sqlite3
from datetime import datetime, timedelta

def generate_report():
    """Generate comprehensive weekly report."""
    home = os.path.expanduser('~')
    sessions_db = f"{home}/.factory/sessions.db"
    files_db = f"{home}/.factory/file-changes.db"
    costs_db = f"{home}/.factory/costs.db"
    
    # Get date range
    end_date = datetime.now()
    start_date = end_date - timedelta(days=7)
    
    print(f"\n{'='*60}")
    print(f"Droid Weekly Report")
    print(f"{start_date.strftime('%Y-%m-%d')} to {end_date.strftime('%Y-%m-%d')}")
    print(f"{'='*60}\n")
    
    # Session statistics
    if os.path.exists(sessions_db):
        conn = sqlite3.connect(sessions_db)
        cursor = conn.cursor()
        
        cursor.execute("""
            SELECT COUNT(*), AVG(duration_seconds), SUM(duration_seconds)
            FROM sessions 
            WHERE start_time >= ?
        """, (start_date.isoformat(),))
        
        count, avg_duration, total_duration = cursor.fetchone()
        
        if count:
            print("üìä Session Statistics")
            print(f"  Total sessions: {count}")
            print(f"  Average duration: {int(avg_duration / 60)} minutes")
            print(f"  Total time: {int(total_duration / 3600)} hours")
            print()
        
        conn.close()
    
    # File changes
    if os.path.exists(files_db):
        conn = sqlite3.connect(files_db)
        cursor = conn.cursor()
        
        cursor.execute("""
            SELECT file_type, COUNT(*) as changes
            FROM file_changes
            WHERE timestamp >= ?
            GROUP BY file_type
            ORDER BY changes DESC
            LIMIT 5
        """, (start_date.isoformat(),))
        
        print("üìù Most Edited File Types")
        for file_type, changes in cursor.fetchall():
            print(f"  .{file_type}: {changes} changes")
        print()
        
        conn.close()
    
    # Costs
    if os.path.exists(costs_db):
        conn = sqlite3.connect(costs_db)
        cursor = conn.cursor()
        
        cursor.execute("""
            SELECT SUM(total_cost), SUM(input_tokens), SUM(output_tokens)
            FROM costs
            WHERE timestamp >= ?
        """, (start_date.isoformat(),))
        
        total_cost, input_tokens, output_tokens = cursor.fetchone()
        
        if total_cost:
            print("üí∞ Cost Summary")
            print(f"  Total cost: ${total_cost:.2f}")
            print(f"  Input tokens: {input_tokens:,}")
            print(f"  Output tokens: {output_tokens:,}")
            print()
        
        conn.close()
    
    print(f"{'='*60}\n")

if __name__ == '__main__':
    generate_report()
```

```bash
chmod +x .factory/hooks/weekly-report.py
```

Schedule weekly:

```bash
# Add to crontab
# Run every Monday at 9am
# 0 9 * * 1 ~/.factory/hooks/weekly-report.py
```


## Best practices

<Steps>
  <Step title="Use structured logging">
    Log in JSON or to database for easy querying:
    ```bash
    # JSON logs
    jq -n --arg cmd "$command" '{timestamp: now, command: $cmd}' >> log.jsonl
    
    # SQLite for analytics
    sqlite3 db.db "INSERT INTO logs VALUES (...)"
    ```
  </Step>
  
  <Step title="Minimize performance impact">
    Keep logging hooks fast:
    ```bash
    # Async logging
    (echo "$log_entry" >> log.json) &
    
    # Batch writes
    echo "$entry" >> /tmp/buffer
    if [ $(wc -l < /tmp/buffer) -gt 100 ]; then
      cat /tmp/buffer >> permanent.log
      > /tmp/buffer
    fi
    ```
  </Step>
  
  <Step title="Protect sensitive data">
    Don't log secrets or credentials:
    ```bash
    # Redact sensitive info
    command=$(echo "$command" | sed 's/password=[^ ]*/password=***/g')
    ```
  </Step>
  
  <Step title="Rotate logs">
    Prevent log files from growing too large:
    ```bash
    # Log rotation
    if [ $(du -k log.json | cut -f1) -gt 10240 ]; then  # 10MB
      mv log.json log.json.$(date +%Y%m%d)
      gzip log.json.*
    fi
    ```
  </Step>
  
  <Step title="Make analytics opt-in">
    Respect user privacy:
    ```bash
    if [ "$DROID_ANALYTICS_ENABLED" != "true" ]; then
      exit 0
    fi
    ```
  </Step>
</Steps>

## Troubleshooting


  
    **Problem**: Log files consuming too much disk space
    
    **Solution**: Implement log rotation:
    ```bash
    # Compress old logs
    find ~/.factory -name "*.log" -mtime +7 -exec gzip {} \;
    
    # Delete very old logs
    find ~/.factory -name "*.log.gz" -mtime +30 -delete
    ```
  
  
  
    **Problem**: SQLite database locked during concurrent access
    
    **Solution**: Use WAL mode and retry logic:
    ```bash
    # Enable WAL mode
    sqlite3 db.db "PRAGMA journal_mode=WAL;"
    
    # Retry on busy
    sqlite3 db.db -cmd ".timeout 5000" "INSERT ..."
    ```
  
  
  
    **Problem**: Hooks take too long
    
    **Solution**: Use async logging:
    ```bash
    # Background logging
    (
      # Expensive logging operation
      process_and_log_data
    ) &  # Run in background
    
    exit 0  # Return immediately
    ```
  


## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Session automation](/cli/configuration/hooks/session-automation) - Automate session setup
- [Custom notifications](/cli/configuration/hooks/notifications) - Get notified about events
</file>

<file path="docs/cli/configuration/hooks/notifications.mdx">
---
title: "Custom Notifications"
description: "Get notified when Droid needs attention using desktop alerts, sounds, Slack, and more"
---

This cookbook shows how to set up custom notifications so you know when Droid needs your input or when important events occur during a session.

## How it works

Notification hooks can:

1. **Trigger on multiple events**: Notification, Stop, SubagentStop, SessionEnd
2. **Support multiple channels**: Desktop notifications, system sounds, Slack, email, webhooks
3. **Provide context**: Include session details, task completion status, error messages
4. **Filter intelligently**: Only notify on important events
5. **Work cross-platform**: macOS, Linux, Windows

## Prerequisites

Install notification tools for your platform:

<CodeGroup>

```bash macOS
# Built-in commands (no installation needed)
which osascript  # For display notifications
which afplay     # For sounds
```

```bash Linux
# Install notify-send
sudo apt-get install libnotify-bin  # Ubuntu/Debian
sudo dnf install libnotify           # Fedora
sudo pacman -S libnotify             # Arch
```

```bash Windows (PowerShell)
# BurntToast for Windows notifications
Install-Module -Name BurntToast -Scope CurrentUser
```

</CodeGroup>

For Slack notifications, create a webhook at [api.slack.com/messaging/webhooks](https://api.slack.com/messaging/webhooks).

## Basic notifications

### Desktop notification when Droid waits

Get notified when Droid is waiting for your input.

Create `.factory/hooks/notify-wait.sh`:

```bash
#!/bin/bash

input=$(cat)
message=$(echo "$input" | jq -r '.message // "Droid needs your attention"')
hook_event=$(echo "$input" | jq -r '.hook_event_name')

# Only notify on actual wait events
if [ "$hook_event" != "Notification" ]; then
  exit 0
fi

# Platform-specific notification
if [[ "$OSTYPE" == "darwin"* ]]; then
  # macOS
  osascript -e "display notification \"$message\" with title \"Droid\" sound name \"Ping\""
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
  # Linux
  notify-send "Droid" "$message" -i dialog-information -u normal
elif [[ "$OSTYPE" == "msys" || "$OSTYPE" == "cygwin" ]]; then
  # Windows
  powershell -Command "New-BurntToastNotification -Text 'Droid', '$message'"
fi

exit 0
```

```bash
chmod +x .factory/hooks/notify-wait.sh
```

Add to `~/.factory/settings.json` (user-wide):

```json
{
  "hooks": {
    "Notification": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/notify-wait.sh",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
```

### Sound alert when task completes

Play a sound when Droid finishes.

Create `.factory/hooks/completion-sound.sh`:

```bash
#!/bin/bash

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')

# Only alert on completion events
if [ "$hook_event" != "Stop" ]; then
  exit 0
fi

# Platform-specific sound
if [[ "$OSTYPE" == "darwin"* ]]; then
  # macOS - use system sounds
  afplay /System/Library/Sounds/Glass.aiff
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
  # Linux - use system bell or speaker-test
  paplay /usr/share/sounds/freedesktop/stereo/complete.oga 2>/dev/null || \
    echo -e '\a'  # Fallback to terminal bell
fi

exit 0
```

```bash
chmod +x .factory/hooks/completion-sound.sh
```

Add to `~/.factory/settings.json`:

```json
{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/completion-sound.sh",
            "timeout": 3
          }
        ]
      }
    ]
  }
}
```

## Advanced notifications

### Slack integration

Send Slack messages when Droid completes tasks.

Create `.factory/hooks/slack-notify.sh`:

```bash
#!/bin/bash
set -e

# Configure your Slack webhook URL
SLACK_WEBHOOK_URL="${SLACK_WEBHOOK_URL:-}"

if [ -z "$SLACK_WEBHOOK_URL" ]; then
  echo "SLACK_WEBHOOK_URL not set, skipping Slack notification"
  exit 0
fi

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')
session_id=$(echo "$input" | jq -r '.session_id')
cwd=$(echo "$input" | jq -r '.cwd')

# Build message based on event type
case "$hook_event" in
  "Stop")
    title="‚úÖ Droid Task Completed"
    color="good"
    ;;
  "SessionEnd")
    title="üèÅ Droid Session Ended"
    color="#808080"
    reason=$(echo "$input" | jq -r '.reason')
    ;;
  "SubagentStop")
    title="ü§ñ Subagent Task Completed"
    color="good"
    ;;
  *)
    exit 0
    ;;
esac

# Send to Slack
curl -X POST "$SLACK_WEBHOOK_URL" \
  -H 'Content-Type: application/json' \
  -d @- << EOF
{
  "attachments": [
    {
      "color": "$color",
      "title": "$title",
      "fields": [
        {
          "title": "Project",
          "value": "$(basename "$cwd")",
          "short": true
        },
        {
          "title": "Session",
          "value": "${session_id:0:8}...",
          "short": true
        }
      ],
      "footer": "Droids",
      "ts": $(date +%s)
    }
  ]
}
EOF

exit 0
```

```bash
chmod +x .factory/hooks/slack-notify.sh
```

Set your webhook URL:

```bash
# Add to ~/.bashrc or ~/.zshrc
export SLACK_WEBHOOK_URL="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
```

Add to `~/.factory/settings.json`:

```json
{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/slack-notify.sh",
            "timeout": 10
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "~/.factory/hooks/slack-notify.sh",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
```

### Email notifications

Send email alerts for important events.

Create `.factory/hooks/email-notify.sh`:

```bash
#!/bin/bash
set -e

# Configure email settings
EMAIL_TO="${DROID_NOTIFY_EMAIL:-your-email@example.com}"
EMAIL_FROM="${DROID_FROM_EMAIL:-droid@factory.ai}"

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')

# Only notify on session end with errors
if [ "$hook_event" != "SessionEnd" ]; then
  exit 0
fi

reason=$(echo "$input" | jq -r '.reason')
session_id=$(echo "$input" | jq -r '.session_id')
cwd=$(echo "$input" | jq -r '.cwd')

# Check if session ended due to error
if [ "$reason" != "error" ] && [ "$reason" != "other" ]; then
  exit 0
fi

# Send email using sendmail or mail command
subject="Droid Session Ended: $(basename "$cwd")"
body="Session $session_id ended with reason: $reason

Project: $cwd
Time: $(date)

Check the logs for more details."

# Try sendmail first, fallback to mail command
if command -v sendmail &> /dev/null; then
  echo -e "Subject: $subject\nFrom: $EMAIL_FROM\nTo: $EMAIL_TO\n\n$body" | sendmail -t
elif command -v mail &> /dev/null; then
  echo "$body" | mail -s "$subject" "$EMAIL_TO"
else
  echo "No email command available (sendmail or mail)"
  exit 1
fi

exit 0
```

```bash
chmod +x .factory/hooks/email-notify.sh
```

Configure environment:

```bash
# Add to ~/.bashrc or ~/.zshrc
export DROID_NOTIFY_EMAIL="your-email@example.com"
```


### Rich desktop notifications with actions

macOS notifications with action buttons.

Create `.factory/hooks/rich-notify-macos.sh`:

```bash
#!/bin/bash

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')
message=$(echo "$input" | jq -r '.message // "Droid needs your attention"')
session_id=$(echo "$input" | jq -r '.session_id')

# Only for macOS
if [[ "$OSTYPE" != "darwin"* ]]; then
  exit 0
fi

case "$hook_event" in
  "Notification")
    # Notification with action buttons
    osascript << EOF
tell application "System Events"
  display notification "$message" with title "Droid Waiting" subtitle "Session: ${session_id:0:8}" sound name "Ping"
end tell
EOF
    ;;
    
  "Stop")
    # Success notification
    osascript << EOF
tell application "System Events"
  display notification "Task completed successfully" with title "Droid Complete" subtitle "$(basename "$PWD")" sound name "Glass"
end tell
EOF
    ;;
    
  "SessionEnd")
    reason=$(echo "$input" | jq -r '.reason')
    # Different sound based on reason
    sound="Purr"
    if [ "$reason" == "error" ]; then
      sound="Basso"
    fi
    
    osascript << EOF
tell application "System Events"
  display notification "Session ended: $reason" with title "Droid Session" subtitle "$(basename "$PWD")" sound name "$sound"
end tell
EOF
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/rich-notify-macos.sh
```


### Webhook integration

Send notifications to custom webhooks:



Create `.factory/hooks/webhook-notify.sh`:

```bash
#!/bin/bash
set -e

WEBHOOK_URL="${DROID_WEBHOOK_URL:-}"

if [ -z "$WEBHOOK_URL" ]; then
  exit 0
fi

input=$(cat)

# Forward the entire hook input to webhook
curl -X POST "$WEBHOOK_URL" \
  -H 'Content-Type: application/json' \
  -d "$input" \
  --max-time 5 \
  --silent \
  --show-error

exit 0
```

```bash
chmod +x .factory/hooks/webhook-notify.sh
export DROID_WEBHOOK_URL="https://your-webhook-url.com/droid-events"
```


## Real-world examples

### Example 1: Focus mode notifications

Only notify when you're away from your desk:



Create `.factory/hooks/smart-notify.sh`:

```bash
#!/bin/bash

input=$(cat)

# Check if user is idle (macOS)
if [[ "$OSTYPE" == "darwin"* ]]; then
  idle_time=$(ioreg -c IOHIDSystem | awk '/HIDIdleTime/ {print int($NF/1000000000)}')
  
  # Only notify if idle for more than 60 seconds
  if [ "$idle_time" -lt 60 ]; then
    exit 0
  fi
fi

# Send notification
message=$(echo "$input" | jq -r '.message // "Droid needs your attention"')
osascript -e "display notification \"$message\" with title \"Droid\" sound name \"Ping\""

exit 0
```


### Example 2: Team notification dashboard

Log all events to a shared dashboard:



Create `.factory/hooks/team-logger.sh`:

```bash
#!/bin/bash
set -e

# Central logging endpoint
LOG_ENDPOINT="${TEAM_LOG_ENDPOINT:-}"

if [ -z "$LOG_ENDPOINT" ]; then
  exit 0
fi

input=$(cat)
hook_event=$(echo "$input" | jq -r '.hook_event_name')
session_id=$(echo "$input" | jq -r '.session_id')
cwd=$(echo "$input" | jq -r '.cwd')

# Add metadata
payload=$(echo "$input" | jq -c ". + {
  user: \"$USER\",
  hostname: \"$HOSTNAME\",
  timestamp: \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\",
  project: \"$(basename "$cwd")\"
}")

# Send to logging service
curl -X POST "$LOG_ENDPOINT" \
  -H 'Content-Type: application/json' \
  -d "$payload" \
  --max-time 3 \
  --silent

exit 0
```


## Best practices

<Steps>
  <Step title="Keep notification scripts fast">
    Use short timeouts to avoid blocking Droid:
    ```json
    {
      "timeout": 5  // 5 seconds max for notifications
    }
    ```
  </Step>
  
  <Step title="Handle failures gracefully">
    Don't block execution if notifications fail:
    ```bash
    # Continue even if curl fails
    curl -X POST "$URL" ... || true
    exit 0
    ```
  </Step>
  
  <Step title="Respect user preferences">
    Check environment variables for opt-out:
    ```bash
    if [ "$DROID_DISABLE_NOTIFICATIONS" = "true" ]; then
      exit 0
    fi
    ```
  </Step>
  
  <Step title="Test notifications">
    Manually trigger hooks for testing:
    ```bash
    # Test notification script
    echo '{"hook_event_name":"Notification","message":"Test"}' | .factory/hooks/notify-wait.sh
    ```
  </Step>
  
  <Step title="Use appropriate notification levels">
    Different events warrant different urgency:
    - Notification: High urgency (Droid waiting)
    - Stop: Medium urgency (task complete)
    - SessionEnd: Low urgency (FYI only)
  </Step>
</Steps>

## Troubleshooting


  
    **Problem**: No notifications show up
    
    **Solution**: Check notification permissions:
    ```bash
    # macOS - check System Settings > Notifications
    # Linux - verify notify-send works
    notify-send "Test" "This is a test"
    
    # Check if hooks are executing
    droid --debug
    ```
  
  
  
    **Problem**: Slack messages not sending
    
    **Solution**: Test webhook directly:
    ```bash
    curl -X POST "$SLACK_WEBHOOK_URL" \
      -H 'Content-Type: application/json' \
      -d '{"text":"Test from curl"}'
    ```
  
  
  
    **Problem**: Getting spammed with alerts
    
    **Solution**: Add rate limiting:
    ```bash
    # Only notify once every 5 minutes
    LAST_NOTIFY_FILE="/tmp/droid-last-notify"
    
    if [ -f "$LAST_NOTIFY_FILE" ]; then
      last_time=$(cat "$LAST_NOTIFY_FILE")
      current_time=$(date +%s)
      if [ $((current_time - last_time)) -lt 300 ]; then
        exit 0
      fi
    fi
    
    date +%s > "$LAST_NOTIFY_FILE"
    # ... send notification
    ```
  
  
  
    **Problem**: No audio alert
    
    **Solution**: Check audio system:
    ```bash
    # macOS - list available sounds
    ls /System/Library/Sounds/
    
    # Test sound
    afplay /System/Library/Sounds/Glass.aiff
    
    # Linux - check audio
    paplay /usr/share/sounds/freedesktop/stereo/complete.oga
    ```
  


## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation  
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Session automation](/cli/configuration/hooks/session-automation) - Automate session setup
- [Logging and analytics](/cli/configuration/hooks/logging-analytics) - Track Droid usage
</file>

<file path="docs/cli/configuration/hooks/session-automation.mdx">
---
title: "Session Automation"
description: "Automate session setup with context loading, environment configuration, and dependency management"
---

This cookbook shows how to use SessionStart hooks to automatically prepare your development environment when Droid starts, saving time and ensuring consistency.

## How it works

SessionStart hooks:

1. **Run at session start**: Triggered when starting new sessions or resuming
2. **Load context**: Add relevant project information to the conversation
3. **Setup environment**: Configure paths, environment variables, tools
4. **Check dependencies**: Verify required tools and packages are available
5. **Persist state**: Set environment variables for the entire session

## Prerequisites

Basic tools for automation:

<CodeGroup>

```bash macOS/Linux
# jq for JSON processing
brew install jq  # macOS
sudo apt-get install jq  # Ubuntu/Debian
```

```bash Git/GitHub CLI
# For loading Git context
git --version
gh --version  # Optional: GitHub CLI
```

</CodeGroup>

## Basic session automation

### Load project context

Automatically provide Droid with project information.

Create `.factory/hooks/load-context.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
source_type=$(echo "$input" | jq -r '.source')

# Only load context on startup and resume
if [ "$source_type" != "startup" ] && [ "$source_type" != "resume" ]; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üìã Loading project context..."
echo ""

# Project overview
if [ -f "README.md" ]; then
  echo "## Project Overview"
  echo ""
  head -n 20 README.md
  echo ""
fi

# Recent git activity
if [ -d ".git" ]; then
  echo "## Recent Changes"
  echo ""
  echo "Latest commits:"
  git log --oneline -5
  echo ""
  
  echo "Current branch: $(git branch --show-current)"
  echo "Uncommitted changes: $(git status --short | wc -l | tr -d ' ') files"
  echo ""
fi

# Project structure
if [ -f "package.json" ]; then
  echo "## Package Info"
  echo ""
  echo "Name: $(jq -r '.name' package.json)"
  echo "Version: $(jq -r '.version' package.json)"
  echo ""
  
  echo "Scripts available:"
  jq -r '.scripts | keys[]' package.json | head -n 10 | sed 's/^/  - /'
  echo ""
fi

# TODO/FIXME comments
echo "## Open TODOs"
echo ""
echo "Found $(grep -r "TODO\|FIXME" src/ 2>/dev/null | wc -l | tr -d ' ') TODO/FIXME comments in src/"
echo ""

exit 0
```

```bash
chmod +x .factory/hooks/load-context.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/load-context.sh",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
```

### Setup development environment

Configure tools and paths automatically.

Create `.factory/hooks/setup-env.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üîß Setting up development environment..."

# Detect and setup Node.js version
if [ -f ".nvmrc" ] && command -v nvm &> /dev/null; then
  NODE_VERSION=$(cat .nvmrc)
  echo "üì¶ Switching to Node.js $NODE_VERSION"
  
  # Persist environment changes using DROID_ENV_FILE
  if [ -n "$DROID_ENV_FILE" ]; then
    # Capture environment before nvm
    ENV_BEFORE=$(export -p | sort)
    
    # Source nvm and switch version
    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    nvm use
    
    # Capture changes and persist them
    ENV_AFTER=$(export -p | sort)
    comm -13 <(echo "$ENV_BEFORE") <(echo "$ENV_AFTER") >> "$DROID_ENV_FILE"
    
    echo "‚úì Node.js environment configured"
  fi
fi

# Setup Python virtual environment
if [ -f "requirements.txt" ] || [ -f "pyproject.toml" ]; then
  if [ ! -d "venv" ]; then
    echo "‚ö†Ô∏è Virtual environment not found. Consider creating one:"
    echo "   python -m venv venv"
  else
    echo "üêç Python virtual environment detected"
    
    if [ -n "$DROID_ENV_FILE" ]; then
      # Activate venv for session
      echo "source \"$cwd/venv/bin/activate\"" >> "$DROID_ENV_FILE"
      echo "‚úì Virtual environment will be activated for Bash commands"
    fi
  fi
fi

# Add project binaries to PATH
if [ -d "node_modules/.bin" ] && [ -n "$DROID_ENV_FILE" ]; then
  echo "export PATH=\"\$PATH:$cwd/node_modules/.bin\"" >> "$DROID_ENV_FILE"
  echo "‚úì Added node_modules/.bin to PATH"
fi

# Setup Go workspace
if [ -f "go.mod" ]; then
  echo "üî∑ Go module detected"
  if [ -n "$DROID_ENV_FILE" ]; then
    echo "export GO111MODULE=on" >> "$DROID_ENV_FILE"
    echo "export GOPATH=$HOME/go" >> "$DROID_ENV_FILE"
  fi
fi

echo ""
echo "‚úì Environment setup complete"

exit 0
```

```bash
chmod +x .factory/hooks/setup-env.sh
```


## Advanced automation

### Load recent Linear/GitHub issues

Provide Droid with context about current work.

Create `.factory/hooks/load-issues.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
source_type=$(echo "$input" | jq -r '.source')

if [ "$source_type" != "startup" ]; then
  exit 0
fi

echo "üìã Loading recent issues..."
echo ""

# Load GitHub issues if gh CLI is available
if command -v gh &> /dev/null; then
  echo "## Recent GitHub Issues"
  echo ""
  
  # Get assigned issues
  gh issue list --assignee @me --limit 5 --json number,title,state | \
    jq -r '.[] | "  - #\(.number): \(.title) [\(.state)]"'
  echo ""
fi

# Load Linear issues if linear CLI is available
if command -v linear &> /dev/null; then
  echo "## Recent Linear Issues"
  echo ""
  
  # Get assigned issues
  linear issue list --assignee @me --limit 5 2>/dev/null | head -n 10
  echo ""
fi

# Check for CHANGELOG or ROADMAP
if [ -f "CHANGELOG.md" ]; then
  echo "## Recent Changelog"
  echo ""
  head -n 15 CHANGELOG.md
  echo ""
fi

exit 0
```

```bash
chmod +x .factory/hooks/load-issues.sh
```

### Check and install dependencies

Automatically ensure dependencies are up-to-date.

Create `.factory/hooks/check-dependencies.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üì¶ Checking dependencies..."
echo ""

# Node.js projects
if [ -f "package.json" ]; then
  if [ ! -d "node_modules" ]; then
    echo "‚ö†Ô∏è node_modules not found"
    echo "Suggestion: Run 'npm install' or 'yarn install'"
    echo ""
  else
    # Check if package.json is newer than node_modules
    if [ "package.json" -nt "node_modules" ]; then
      echo "‚ö†Ô∏è package.json modified since last install"
      echo "Suggestion: Run 'npm install' to update dependencies"
      echo ""
    else
      echo "‚úì Node dependencies up to date"
      echo ""
    fi
  fi
fi

# Python projects
if [ -f "requirements.txt" ]; then
  if [ ! -d "venv" ]; then
    echo "‚ö†Ô∏è Python virtual environment not found"
    echo "Suggestion: Run 'python -m venv venv && source venv/bin/activate && pip install -r requirements.txt'"
    echo ""
  else
    echo "‚úì Python virtual environment exists"
    echo ""
  fi
fi

# Go projects
if [ -f "go.mod" ]; then
  if [ ! -d "vendor" ] && ! command -v go &> /dev/null; then
    echo "‚ö†Ô∏è Go not found in PATH"
    echo "Suggestion: Install Go from https://go.dev"
    echo ""
  else
    echo "‚úì Go environment ready"
    echo ""
  fi
fi

# Ruby projects
if [ -f "Gemfile" ]; then
  if ! command -v bundle &> /dev/null; then
    echo "‚ö†Ô∏è Bundler not found"
    echo "Suggestion: gem install bundler"
    echo ""
  else
    if ! bundle check &>/dev/null; then
      echo "‚ö†Ô∏è Ruby gems out of date"
      echo "Suggestion: bundle install"
      echo ""
    else
      echo "‚úì Ruby gems up to date"
      echo ""
    fi
  fi
fi

exit 0
```

```bash
chmod +x .factory/hooks/check-dependencies.sh
```

### Load custom project guidelines

Provide project-specific instructions automatically.

Create `.factory/AGENTS.md` with project guidelines:

```markdown
# Project Guidelines for Droid

## Code Style
- Use TypeScript for all new files
- Follow ESLint configuration strictly
- Prefer functional components in React
- Use async/await over promises

## Testing
- Write tests for all new features
- Run `npm test` before committing
- Maintain >80% code coverage

## Architecture
- Keep components under 200 lines
- Use Redux for global state
- Local state for component-specific data
- No direct API calls from components (use services)

## Git Workflow
- Create feature branches from `dev`
- Name branches: `feature/FAC-123-description`
- Write descriptive commit messages
- Squash commits before merging
```

Create `.factory/hooks/load-guidelines.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
source_type=$(echo "$input" | jq -r '.source')

if [ "$source_type" != "startup" ]; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')

# Load project-specific guidelines
if [ -f "$cwd/.factory/AGENTS.md" ]; then
  echo "## Project Guidelines"
  echo ""
  cat "$cwd/.factory/AGENTS.md"
  echo ""
fi

# Load PR templates
if [ -f "$cwd/.github/PULL_REQUEST_TEMPLATE.md" ]; then
  echo "## PR Template Reference"
  echo ""
  head -n 20 "$cwd/.github/PULL_REQUEST_TEMPLATE.md"
  echo ""
fi

exit 0
```

```bash
chmod +x .factory/hooks/load-guidelines.sh
```


### Smart context based on Git branch

Load different context based on the current branch:



Create `.factory/hooks/branch-context.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

if [ ! -d ".git" ]; then
  exit 0
fi

branch=$(git branch --show-current)

echo "## Current Context: $branch"
echo ""

case "$branch" in
  main|master)
    echo "‚ö†Ô∏è Working on production branch!"
    echo "Extra care needed - changes go to production"
    echo ""
    
    # Show recent production issues
    if command -v gh &> /dev/null; then
      echo "Recent production issues:"
      gh issue list --label production --limit 3 --json number,title | \
        jq -r '.[] | "  - #\(.number): \(.title)"'
      echo ""
    fi
    ;;
    
  dev|develop)
    echo "üì¶ Working on development branch"
    echo "Standard development workflow applies"
    echo ""
    ;;
    
  feature/*)
    feature_name="${branch#feature/}"
    echo "üî® Feature branch: $feature_name"
    echo ""
    
    # Try to find related issue
    if [[ $feature_name =~ FAC-[0-9]+ ]]; then
      issue_id="${BASH_REMATCH[0]}"
      echo "Related Linear issue: $issue_id"
      
      # Fetch issue details if linear CLI available
      if command -v linear &> /dev/null; then
        linear issue view "$issue_id" 2>/dev/null || true
        echo ""
      fi
    fi
    
    # Show uncommitted changes
    if [ -n "$(git status --short)" ]; then
      echo "Uncommitted changes:"
      git status --short | head -n 10
      echo ""
    fi
    ;;
    
  hotfix/*)
    echo "üö® HOTFIX BRANCH"
    echo "Critical bug fix - expedite review and deployment"
    echo ""
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/branch-context.sh
```


## Real-world examples

### Example 1: Monorepo workspace setup

Automatically switch to the right package:



Create `.factory/hooks/monorepo-setup.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
cwd=$(echo "$input" | jq -r '.cwd')

# Check if this is a monorepo
if [ ! -f "$cwd/package.json" ] || ! grep -q '"workspaces"' "$cwd/package.json"; then
  exit 0
fi

echo "## Monorepo Structure"
echo ""

# List workspaces
if command -v npm &> /dev/null; then
  echo "Available workspaces:"
  npm ls --workspaces --depth=0 2>/dev/null | grep -E "^[‚îú‚îî]" | sed 's/^[‚îú‚îî]‚îÄ‚îÄ /  - /'
  echo ""
fi

# Show recent changes by workspace
if [ -d ".git" ]; then
  echo "Recently modified workspaces:"
  git diff --name-only HEAD~5..HEAD | \
    grep -E "^(packages|apps)/" | \
    cut -d/ -f1-2 | \
    sort -u | \
    head -n 5 | \
    sed 's/^/  - /'
  echo ""
fi

exit 0
```


### Example 2: Docker environment check

Ensure Docker services are running:



Create `.factory/hooks/check-docker.sh`:

```bash
#!/bin/bash

if ! command -v docker &> /dev/null; then
  exit 0
fi

# Check if Docker daemon is running
if ! docker info &>/dev/null; then
  echo "‚ö†Ô∏è Docker daemon not running"
  echo "Suggestion: Start Docker Desktop or run 'sudo systemctl start docker'"
  echo ""
  exit 0
fi

echo "## Docker Environment"
echo ""

# Check for docker-compose.yml
if [ -f "docker-compose.yml" ] || [ -f "docker-compose.yaml" ]; then
  echo "Docker Compose configuration found"
  
  # Check if services are running
  if docker-compose ps &>/dev/null; then
    echo ""
    echo "Running services:"
    docker-compose ps --format "table {{.Name}}\t{{.Status}}" | tail -n +2 | sed 's/^/  /'
  else
    echo "Suggestion: Start services with 'docker-compose up -d'"
  fi
  echo ""
fi

exit 0
```


## Best practices

<Steps>
  <Step title="Keep context concise">
    Only load essential information:
    ```bash
    # Show summary, not full content
    echo "Found $(wc -l < README.md) lines in README"
    # Instead of: cat README.md
    ```
  </Step>
  
  <Step title="Cache expensive operations">
    Avoid repeated expensive checks:
    ```bash
    CACHE_FILE="/tmp/droid-context-$(date +%Y%m%d)"
    if [ -f "$CACHE_FILE" ]; then
      cat "$CACHE_FILE"
      exit 0
    fi
    
    # Generate context...
    echo "$context" | tee "$CACHE_FILE"
    ```
  </Step>
  
  <Step title="Use DROID_ENV_FILE for environment">
    Persist environment variables correctly:
    ```bash
    if [ -n "$DROID_ENV_FILE" ]; then
      echo 'export NODE_ENV=development' >> "$DROID_ENV_FILE"
      echo 'export API_URL=http://localhost:3000' >> "$DROID_ENV_FILE"
    fi
    ```
  </Step>
  
  <Step title="Handle missing tools gracefully">
    Check before using external commands:
    ```bash
    if command -v gh &> /dev/null; then
      gh issue list
    else
      echo "GitHub CLI not installed (skip with: brew install gh)"
    fi
    ```
  </Step>
  
  <Step title="Provide actionable suggestions">
    Tell users what to do next:
    ```bash
    echo "‚ö†Ô∏è Dependencies out of date"
    echo "Action: Run 'npm install' to update"
    echo "Or: Let me handle this - just ask 'install dependencies'"
    ```
  </Step>
</Steps>

## Troubleshooting


  
    **Problem**: Too much information loaded
    
    **Solution**: Summarize and link to details:
    ```bash
    echo "README.md exists ($(wc -l < README.md) lines)"
    echo "Run 'cat README.md' to view full content"
    ```
  
  
  
    **Problem**: Variables not available in Bash commands
    
    **Solution**: Verify DROID_ENV_FILE usage:
    ```bash
    if [ -z "$DROID_ENV_FILE" ]; then
      echo "DROID_ENV_FILE not available" >&2
      exit 1
    fi
    
    # Append, don't overwrite
    echo 'export VAR=value' >> "$DROID_ENV_FILE"
    ```
  
  
  
    **Problem**: Session start takes too long
    
    **Solution**: Run expensive operations asynchronously:
    ```bash
    # Start background job for slow operations
    (
      sleep 1  # Let Droid start first
      expensive_operation > /tmp/droid-context.txt
    ) &
    
    # Return immediately with basic context
    echo "Loading detailed context in background..."
    ```
  


## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Custom notifications](/cli/configuration/hooks/notifications) - Get notified about events
- [Logging and analytics](/cli/configuration/hooks/logging-analytics) - Track session metrics
</file>

<file path="docs/cli/configuration/hooks/testing-automation.mdx">
---
title: "Testing Automation"
description: "Automate test execution, coverage tracking, and test result validation with hooks"
---

This cookbook shows how to automatically run tests when Droid modifies code, maintain test coverage, and enforce testing requirements.

## How it works

Testing hooks can:

1. **Auto-run tests**: Execute tests after code changes
2. **Track coverage**: Monitor and enforce coverage thresholds
3. **Validate test files**: Ensure tests exist for new code
4. **Run specific tests**: Execute only relevant test suites
5. **Generate reports**: Create test and coverage reports

## Prerequisites

Install testing frameworks for your stack:

<CodeGroup>

```bash JavaScript/TypeScript
npm install -D jest @testing-library/react vitest
npm install -D @vitest/coverage-v8  # For coverage
```

```bash Python
pip install pytest pytest-cov
pip install coverage  # For coverage tracking
```

```bash Go
# go test is built-in
go install github.com/gotestyourself/gotestsum@latest  # Better test output
```

</CodeGroup>

## Basic testing automation

### Run tests after code changes

Automatically run tests when Droid edits files.

Create `.factory/hooks/run-tests.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only run tests after file write/edit
if [ "$tool_name" != "Write" ] && [ "$tool_name" != "Edit" ]; then
  exit 0
fi

# Skip non-code files
if ! echo "$file_path" | grep -qE '\.(ts|tsx|js|jsx|py|go)$'; then
  exit 0
fi

# Skip test files themselves
if echo "$file_path" | grep -qE '\.(test|spec)\.(ts|tsx|js|jsx)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üß™ Running tests for changed file..."

# Determine test command based on file type
case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    # Find corresponding test file
    test_file=$(echo "$file_path" | sed -E 's/\.(ts|tsx|js|jsx)$/.test.\1/')
    
    if [ ! -f "$test_file" ]; then
      # Try alternate naming
      test_file=$(echo "$file_path" | sed -E 's/\.(ts|tsx|js|jsx)$/.spec.\1/')
    fi
    
    if [ -f "$test_file" ]; then
      # Run specific test file
      if command -v npm &> /dev/null && grep -q '"test"' package.json; then
        npm test -- "$test_file" 2>&1 || {
          echo "‚ùå Tests failed for $test_file" >&2
          echo "Please fix the failing tests." >&2
          exit 2
        }
        echo "‚úì Tests passed for $test_file"
      fi
    else
      echo "‚ö†Ô∏è No test file found for $file_path"
      echo "Consider creating: $test_file"
    fi
    ;;
    
  *.py)
    # Run pytest for Python files
    if command -v pytest &> /dev/null; then
      # Find test file
      test_file=$(echo "$file_path" | sed 's/\.py$//' | sed 's|^src/|tests/test_|')_test.py
      
      if [ -f "$test_file" ]; then
        pytest "$test_file" -v 2>&1 || {
          echo "‚ùå Tests failed" >&2
          exit 2
        }
        echo "‚úì Tests passed"
      else
        echo "‚ö†Ô∏è No test file found at $test_file"
      fi
    fi
    ;;
    
  *.go)
    # Run go test
    if command -v go &> /dev/null; then
      package=$(dirname "$file_path")
      go test "./$package" -v 2>&1 || {
        echo "‚ùå Tests failed" >&2
        exit 2
      }
      echo "‚úì Tests passed"
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/run-tests.sh
```

Add to `.factory/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$DROID_PROJECT_DIR\"/.factory/hooks/run-tests.sh",
            "timeout": 60
          }
        ]
      }
    ]
  }
}
```

### Enforce test coverage

Block changes that decrease test coverage.

Create `.factory/hooks/check-coverage.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only check code files
if ! echo "$file_path" | grep -qE '\.(ts|tsx|js|jsx|py)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Minimum coverage threshold
MIN_COVERAGE="${DROID_MIN_COVERAGE:-80}"

echo "üìä Checking test coverage..."

case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    # Jest coverage
    if command -v npm &> /dev/null && grep -q '"test"' package.json; then
      # Run coverage for specific file
      coverage_output=$(npm test -- --coverage --collectCoverageFrom="$file_path" --silent 2>&1 || true)
      
      # Extract coverage percentage
      if echo "$coverage_output" | grep -qE "All files.*[0-9]+(\.[0-9]+)?%"; then
        coverage=$(echo "$coverage_output" | grep "All files" | grep -oE "[0-9]+(\.[0-9]+)?%" | head -1 | tr -d '%')
        
        if (( $(echo "$coverage < $MIN_COVERAGE" | bc -l) )); then
          echo "‚ùå Coverage too low: ${coverage}% (minimum: ${MIN_COVERAGE}%)" >&2
          echo "Please add tests to improve coverage." >&2
          exit 2
        fi
        
        echo "‚úì Coverage: ${coverage}%"
      fi
    fi
    ;;
    
  *.py)
    # Python coverage
    if command -v pytest &> /dev/null; then
      coverage_output=$(pytest --cov="$file_path" --cov-report=term 2>&1 || true)
      
      if echo "$coverage_output" | grep -qE "TOTAL.*[0-9]+%"; then
        coverage=$(echo "$coverage_output" | grep "TOTAL" | grep -oE "[0-9]+%" | tr -d '%')
        
        if [ "$coverage" -lt "$MIN_COVERAGE" ]; then
          echo "‚ùå Coverage too low: ${coverage}% (minimum: ${MIN_COVERAGE}%)" >&2
          exit 2
        fi
        
        echo "‚úì Coverage: ${coverage}%"
      fi
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/check-coverage.sh
```

Configure coverage threshold:

```bash
# Add to ~/.bashrc or ~/.zshrc
export DROID_MIN_COVERAGE=75
```

### Require tests for new files

Ensure new code files have corresponding tests.

Create `.factory/hooks/require-tests.sh`:

```bash
#!/bin/bash

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only check Write operations (new files)
if [ "$tool_name" != "Write" ]; then
  exit 0
fi

# Only check code files in src/
if ! echo "$file_path" | grep -qE '^src/.*\.(ts|tsx|js|jsx|py)$'; then
  exit 0
fi

# Skip if it's already a test file
if echo "$file_path" | grep -qE '\.(test|spec)\.(ts|tsx|js|jsx)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')

# Determine expected test file location
case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    test_file1=$(echo "$file_path" | sed -E 's/\.(ts|tsx|js|jsx)$/.test.\1/')
    test_file2=$(echo "$file_path" | sed -E 's/\.(ts|tsx|js|jsx)$/.spec.\1/')
    test_file3=$(echo "$file_path" | sed 's|^src/|tests/|; s/\.(ts|tsx|js|jsx)$/.test.\1/')
    ;;
    
  *.py)
    test_file1=$(echo "$file_path" | sed 's|^src/|tests/|; s/\.py$/_test.py/')
    test_file2=$(echo "$file_path" | sed 's|^src/|tests/test_|')
    test_file3=""
    ;;
esac

# Check if any test file exists
found_test=false
for test_file in "$test_file1" "$test_file2" "$test_file3"; do
  if [ -n "$test_file" ] && [ -f "$cwd/$test_file" ]; then
    found_test=true
    break
  fi
done

if [ "$found_test" = false ]; then
  echo "‚ö†Ô∏è No test file found for $file_path" >&2
  echo "" >&2
  echo "Please create a test file at one of:" >&2
  echo "  - $test_file1" >&2
  [ -n "$test_file2" ] && echo "  - $test_file2" >&2
  [ -n "$test_file3" ] && echo "  - $test_file3" >&2
  echo "" >&2
  echo "Or ask me: 'Create tests for $file_path'" >&2
  
  # Warning only, don't block
  # Change to exit 2 to enforce test creation
fi

exit 0
```

```bash
chmod +x .factory/hooks/require-tests.sh
```


## Advanced testing automation

### Smart test selection

Only run tests affected by changes.

Create `.factory/hooks/run-affected-tests.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

if [ "$tool_name" != "Write" ] && [ "$tool_name" != "Edit" ]; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

# Find tests that import this file
echo "üîç Finding affected tests..."

case "$file_path" in
  *.ts|*.tsx|*.js|*.jsx)
    # Find test files that import this file
    filename=$(basename "$file_path" | sed -E 's/\.(ts|tsx|js|jsx)$//')
    module_name=$(echo "$file_path" | sed 's|^src/||; s/\.(ts|tsx|js|jsx)$//')
    
    # Search for imports
    affected_tests=$(grep -rl "from.*['\"].*$module_name['\"]" . \
      --include="*.test.ts" \
      --include="*.test.tsx" \
      --include="*.test.js" \
      --include="*.test.jsx" \
      --include="*.spec.ts" \
      --include="*.spec.tsx" \
      2>/dev/null || true)
    
    if [ -n "$affected_tests" ]; then
      echo "Running affected tests:"
      echo "$affected_tests" | sed 's/^/  - /'
      echo ""
      
      # Run tests
      echo "$affected_tests" | while read -r test_file; do
        npm test -- "$test_file" 2>&1 || {
          echo "‚ùå Test failed: $test_file" >&2
          exit 2
        }
      done
      
      echo "‚úì All affected tests passed"
    else
      echo "No affected tests found"
    fi
    ;;
esac

exit 0
```

```bash
chmod +x .factory/hooks/run-affected-tests.sh
```


### Snapshot testing validation

Detect and validate snapshot updates.

Create `.factory/hooks/validate-snapshots.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Check if snapshot files changed
if ! echo "$file_path" | grep -qE '__snapshots__/.*\.snap$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üì∏ Snapshot file modified: $file_path"
echo ""

# Run tests in update mode to verify
test_file=$(echo "$file_path" | sed 's|/__snapshots__/.*\.snap$|.test.ts|')

if [ ! -f "$test_file" ]; then
  test_file=$(echo "$file_path" | sed 's|/__snapshots__/.*\.snap$|.spec.ts|')
fi

if [ -f "$test_file" ]; then
  echo "Verifying snapshot update..."
  
  if npm test -- "$test_file" -u 2>&1; then
    echo "‚úì Snapshot update verified"
    echo ""
    echo "‚ö†Ô∏è Remember to review snapshot changes before committing:"
    echo "  git diff $file_path"
  else
    echo "‚ùå Snapshot verification failed" >&2
    exit 2
  fi
else
  echo "‚ö†Ô∏è Could not find test file for snapshot"
fi

exit 0
```

```bash
chmod +x .factory/hooks/validate-snapshots.sh
```


### Test performance monitoring

Track test execution time and warn on slow tests.

Create `.factory/hooks/monitor-test-perf.py`:

```python
#!/usr/bin/env python3
"""
Monitor test execution time and report slow tests.
"""
import json
import sys
import subprocess
import time
import re

# Slow test threshold in seconds
SLOW_TEST_THRESHOLD = 5.0

def run_tests_with_timing(test_file):
    """Run tests and capture timing information."""
    start_time = time.time()
    
    try:
        result = subprocess.run(
            ['npm', 'test', '--', test_file, '--verbose'],
            capture_output=True,
            text=True,
            timeout=60
        )
        
        elapsed = time.time() - start_time
        
        # Parse test output for individual test times
        slow_tests = []
        for line in result.stdout.split('\n'):
            # Look for test timing info
            match = re.search(r'(.*?)\s+\((\d+)ms\)', line)
            if match:
                test_name = match.group(1).strip()
                test_time_ms = int(match.group(2))
                test_time_s = test_time_ms / 1000.0
                
                if test_time_s > SLOW_TEST_THRESHOLD:
                    slow_tests.append((test_name, test_time_s))
        
        return elapsed, slow_tests, result.returncode
        
    except subprocess.TimeoutExpired:
        return None, [], 1

try:
    input_data = json.load(sys.stdin)
    file_path = input_data.get('tool_input', {}).get('file_path', '')
    
    if not file_path or not file_path.endswith(('.test.ts', '.test.tsx', '.spec.ts', '.spec.tsx')):
        sys.exit(0)
    
    print(f"‚è±Ô∏è  Monitoring test performance for {file_path}...")
    
    elapsed, slow_tests, returncode = run_tests_with_timing(file_path)
    
    if elapsed is not None:
        print(f"\nTotal test time: {elapsed:.2f}s")
        
        if slow_tests:
            print(f"\n‚ö†Ô∏è  Found {len(slow_tests)} slow test(s):")
            for test_name, test_time in slow_tests:
                print(f"  - {test_name}: {test_time:.2f}s")
            print("\nConsider optimizing these tests or mocking expensive operations.")
        else:
            print("‚úì All tests running within acceptable time")
        
        # Don't block on slow tests, just warn
        sys.exit(returncode)
    else:
        print("‚ùå Tests timed out", file=sys.stderr)
        sys.exit(2)
        
except Exception as e:
    print(f"Error monitoring tests: {e}", file=sys.stderr)
    sys.exit(0)
```

```bash
chmod +x .factory/hooks/monitor-test-perf.py
```


### Test flakiness detector

Detect and report flaky tests:



Create `.factory/hooks/detect-flaky-tests.sh`:

```bash
#!/bin/bash
set -e

input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // ""')

# Only check test files
if ! echo "$file_path" | grep -qE '\.(test|spec)\.(ts|tsx|js|jsx)$'; then
  exit 0
fi

cwd=$(echo "$input" | jq -r '.cwd')
cd "$cwd"

echo "üé≤ Checking for test flakiness..."

# Run tests multiple times
RUNS=3
failures=0

for i in $(seq 1 $RUNS); do
  echo "Run $i/$RUNS..."
  
  if ! npm test -- "$file_path" --silent 2>&1; then
    ((failures++))
  fi
done

if [ $failures -gt 0 ] && [ $failures -lt $RUNS ]; then
  echo "" >&2
  echo "‚ö†Ô∏è FLAKY TEST DETECTED" >&2
  echo "Test passed $((RUNS - failures))/$RUNS times" >&2
  echo "" >&2
  echo "This test is unreliable and should be fixed." >&2
  echo "Common causes:" >&2
  echo "  - Race conditions" >&2
  echo "  - Timing dependencies" >&2
  echo "  - Non-deterministic data" >&2
  echo "  - External dependencies" >&2
  
  # Warning only, don't block
  exit 0
elif [ $failures -eq $RUNS ]; then
  echo "‚ùå Test consistently fails" >&2
  exit 2
else
  echo "‚úì Test is stable ($RUNS/$RUNS passed)"
fi

exit 0
```

```bash
chmod +x .factory/hooks/detect-flaky-tests.sh
```


## Best practices

<Steps>
  <Step title="Run tests asynchronously when possible">
    Don't block Droid unnecessarily:
    ```bash
    # Run tests in background, report later
    (npm test "$file" > /tmp/test-results.txt 2>&1 &)
    echo "Tests running in background..."
    ```
  </Step>
  
  <Step title="Set appropriate timeouts">
    Allow enough time for test suites:
    ```json
    {
      "timeout": 120  // 2 minutes for test suites
    }
    ```
  </Step>
  
  <Step title="Use test file conventions">
    Follow standard naming patterns:
    ```
    src/components/Button.tsx
    src/components/Button.test.tsx  // Co-located
    
    Or:
    
    src/components/Button.tsx
    tests/components/Button.test.tsx  // Separate directory
    ```
  </Step>
  
  <Step title="Make coverage configurable">
    Different files may need different thresholds:
    ```bash
    # .factory/.coverage-config
    src/critical/*.ts:90
    src/utils/*.ts:75
    src/experimental/*.ts:50
    ```
  </Step>
  
  <Step title="Cache test results">
    Skip tests if code hasn't changed:
    ```bash
    hash=$(md5sum "$file_path")
    cache_file="/tmp/test-cache-$hash"
    
    if [ -f "$cache_file" ]; then
      echo "‚úì Tests passed (cached)"
      exit 0
    fi
    ```
  </Step>
</Steps>

## Troubleshooting


  
    **Problem**: Test execution blocks workflow
    
    **Solution**: Run only unit tests, skip integration:
    ```bash
    # Fast unit tests only
    npm test -- --testPathPattern="unit" "$file"
    
    # Or configure in package.json
    {
      "scripts": {
        "test:fast": "jest --testPathIgnorePatterns=integration"
      }
    }
    ```
  
  
  
    **Problem**: Tests fail in hooks but pass manually
    
    **Solution**: Check environment differences:
    ```bash
    # Ensure same environment
    export NODE_ENV=test
    export CI=true
    
    # Use project test script
    npm test  # Not direct jest call
    ```
  
  
  
    **Problem**: Coverage includes generated files
    
    **Solution**: Configure coverage exclusions:
    ```json
    // jest.config.js
    {
      "coveragePathIgnorePatterns": [
        "/node_modules/",
        "/.gen/",
        "/dist/",
        "\\.d\\.ts$"
      ]
    }
    ```
  


## See also

- [Hooks reference](/reference/hooks-reference) - Complete hooks API documentation
- [Get started with hooks](/cli/configuration/hooks-guide) - Basic hooks introduction
- [Code validation](/cli/configuration/hooks/code-validation) - Validate code quality
- [Git workflows](/cli/configuration/hooks/git-workflows) - Git integration
</file>

<file path="docs/cli/configuration/skills/data-querying.mdx">
---
title: Internal data querying skill
description: A reusable skill for safely querying internal analytics and data services and producing shareable, reproducible artifacts.
---

Use this skill when Droids need to answer questions using **internal data sources** ‚Äì analytics warehouses, reporting databases, or internal data APIs ‚Äì in a way that is safe, auditable, and reproducible.

The skill directory can also host **data utilities** that the agent can leverage, such as:

- `metrics.md` ‚Äì definitions and references for key metrics/dimensions (with links to the canonical dbt models or warehouse docs)
- `examples.sql` ‚Äì small, illustrative queries against trusted models or marts
- `data-governance.md` ‚Äì data-classification guidance and safe-sharing checklists

```md
# Skill: Internal data querying

## Purpose

Query internal data services to answer well-scoped questions, producing results and artifacts that are safe to share and easy to re-run.

## When to use this skill

- A stakeholder asks for **metrics, trends, or slices** that rely on internal data.
- The answers can be derived from existing **warehouses, marts, or reporting APIs**.
- The request needs a **reproducible query** and not an ad-hoc manual export.

## Inputs

- **Business question**: one or two sentences describing what we want to know.
- **Time range and filters**: date boundaries, customer segments, environments, etc.
- **Source systems**: names of warehouses, schemas, or APIs to use.
- **Data sensitivity notes**: whether PII, financial data, or regulated data is involved.

## Out of scope

- Direct queries against production OLTP databases unless explicitly allowed.
- Creating new pipelines or ingestion jobs.
- Sharing raw PII or secrets outside approved destinations.

## Conventions

- Use the **preferred query layer** (e.g., dbt models, semantic layer, analytics API) instead of raw tables when available.
- Follow established **naming and folder conventions** for saved queries or analysis notebooks.
- Respect internal **data classification and access control** policies.

## Required behavior

1. Translate the business question into a precise query spec (metrics, dimensions, filters).
2. Choose appropriate sources and explain tradeoffs if multiple options exist.
3. Write queries that are performant and cost-conscious for the target system.
4. Produce both **results** and a **re-runnable query artifact** (SQL, API call, notebook, or dashboard link).

## Required artifacts

- Query text (SQL, DSL, or API request) checked into the appropriate repo or folder.
- A short **analysis summary** capturing methodology, assumptions, and caveats.
- Links to any **dashboards, notebooks, or reports** created.

## Implementation checklist

1. Clarify the business question, time range, and filters.
2. Identify the best data source(s) based on freshness, completeness, and governance.
3. Draft the query, validate it on a limited time window or sample.
4. Check for joins, filters, and aggregations that could distort the answer; fix as needed.
5. Save the query in the approved location with a descriptive name.
6. Capture results and summarize key findings and limitations.

## Verification

Use whatever validation mechanisms exist for your data stack, for example:

- `dbt test` in the relevant project
- Unit or regression tests for custom metrics or transformations
- Manual spot checks against known benchmarks or historical reports

The skill is complete when:

- The query runs successfully within acceptable time and cost bounds.
- Results match expectations or known reference points (within reasonable tolerance).
- The query and results are documented enough for another engineer or analyst to reuse.

## Safety and escalation

- If the query touches **sensitive or regulated data**, confirm that the destination (PR, doc, ticket) is an approved location before including any sample rows.
- If you identify data quality issues, file or update a data-quality ticket and call them out prominently in the analysis summary.
```
</file>

<file path="docs/cli/configuration/skills/frontend-ui-integration.mdx">
---
title: Frontend UI integration skill
description: A reusable skill for implementing typed, tested frontend workflows against existing backend APIs in enterprise codebases.
---

This skill is designed for large enterprise frontends (React/TypeScript, Next.js, or similar) where Droids implement or extend user-facing flows against existing backend APIs.

The folder that contains this skill definition can also include **supporting utilities** the Droid may call, for example:

- `SKILL.md` / `frontend-ui-integration.mdx` ‚Äì this skill spec
- `references.md` ‚Äì pointers to existing TypeScript types, API modules, and routes in your codebase
- `design-system.md` ‚Äì design-system usage guidelines or component maps
- `accessibility-checklist.md` ‚Äì reusable accessibility and performance checklists
- `design-system.md` ‚Äì design-system usage guidelines or component maps
- `accessibility-checklist.md` ‚Äì reusable accessibility and performance checklists

```md
# Skill: Frontend UI integration

## Purpose

Implement or extend a user-facing workflow in our primary web application, integrating with **existing backend APIs** and following our **design system, routing, and testing conventions**.

## When to use this skill

- The feature is primarily a **UI/UX change** backed by one or more existing APIs.
- The backend contracts, auth model, and core business rules **already exist**.
- The change affects **only** the web frontend (no schema or service ownership changes).

## Inputs

- **Feature description**: short narrative of the user flow and outcomes.
- **Relevant APIs**: endpoints, request/response types, and links to source definitions.
- **Target routes/components**: paths, component names, or feature modules.
- **Design references**: Figma links or existing screens to mirror.
- **Guardrails**: performance limits, accessibility requirements, and any security constraints.

## Out of scope

- Creating new backend services or changing persistent data models.
- Modifying authentication/authorization flows.
- Introducing new frontend frameworks or design systems.

## Conventions

- **Framework**: React with TypeScript.
- **Routing**: use the existing router and route layout patterns.
- **Styling**: use the in-house design system components (Buttons, Inputs, Modals, Toasts, etc.).
- **State management**: prefer the existing state libraries (e.g., React Query, Redux, Zustand) and follow established patterns.

## Required behavior

1. Implement the UI changes with **strong typing** for all props and API responses.
2. Handle loading, empty, error, and success states using existing primitives.
3. Ensure the UI is **keyboard accessible** and screen-reader friendly.
4. Respect feature flags and rollout mechanisms where applicable.

## Required artifacts

- Updated components and hooks in the appropriate feature module.
- **Unit tests** for core presentation logic.
- **Integration or component tests** for the new flow (e.g., React Testing Library, Cypress, Playwright) where the repo already uses them.
- Minimal **CHANGELOG or PR description text** summarizing the behavior change (to be placed in the PR, not this file).

## Implementation checklist

1. Locate the relevant feature module and existing components.
2. Confirm the backend APIs and types, updating shared TypeScript types if needed.
3. Implement the UI, wiring in API calls via the existing data layer.
4. Add or update tests to cover the new behavior and edge cases.
5. Run the required validation commands (see below).

## Verification

Run the following (adjust commands to match the project):

- `pnpm lint`
- `pnpm test -- --runInBand --watch=false`
- `pnpm typecheck` (if configured separately)

The skill is complete when:

- All tests, linters, and type checks pass.
- The new UI behaves as specified across normal, error, and boundary cases.
- No unrelated files or modules are modified.

## Safety and escalation

- If the requested change requires backend contract changes, **stop** and request a backend-focused task instead.
- If design references conflict with existing accessibility standards, favor accessibility and highlight the discrepancy in the PR description.
```
</file>

<file path="docs/cli/configuration/skills/internal-tools.mdx">
---
title: Internal tools skill
description: A reusable skill for building and extending internal tools that support engineers, operators, and support teams.
---

Use this skill when Droids are building or extending **internal-facing applications** ‚Äì admin panels, support consoles, operational dashboards, or engineering utilities ‚Äì where reliability and safety matter more than surface polish.

The internal-tools skill folder can also include **helper artifacts** the agent should use, for example:

- `rbac.md` ‚Äì summaries of standard RBAC roles and permission matrices, plus links to the authoritative policy definitions
- `audit-patterns.md` ‚Äì patterns for confirmations, approvals, and audit logging
- `operations-checklist.md` ‚Äì checklists for operational readiness and incident handling

```md
# Skill: Internal tools development

## Purpose

Design, implement, or extend internal tools that help employees operate the system safely and efficiently, while respecting access controls and audit requirements.

## When to use this skill

- The audience is **internal staff** (engineers, SREs, support, operations, finance, etc.).
- The tool interacts with **production-adjacent systems** (feature flags, incidents, customer data, billing, etc.).
- The change is scoped to internal workflows and does not directly alter customer-facing UX.

## Inputs

- **User personas** and teams who will use the tool.
- **Workflows** to support (create/update actions, approvals, review flows).
- **Systems touched**: services, queues, flags, and data stores.
- **Risk classification**: what can go wrong if the tool misbehaves or is misused.

## Out of scope

- Tools that require new identity providers or SSO integrations.
- Changes that bypass existing approval or change-management processes.
- Direct manual-write tooling for core financial or compliance systems without explicit approval.

## Conventions

- Use the **standard stack** for internal tools (framework, component library, backend pattern) already used in the repo.
- Apply **role-based access control** and logging patterns consistently.
- Prefer **read-only views and guarded actions** (confirmation dialogs, requiring justification text, etc.) for high-risk operations.

## Required behavior

1. Implement flows that make the happy path fast while making destructive actions clearly intentional.
2. Ensure all state changes are logged with **who**, **what**, and **when**, and link to existing audit/logging infrastructure.
3. Provide clear feedback on success, errors, and partial failures.
4. Design for operational debugging: include ids, timestamps, and links to related systems.

## Required artifacts

- Frontend and backend changes in the appropriate internal-tools modules.
- **Automated tests** for critical operations (at least unit tests; integration tests where harnesses exist).
- Baseline **operational runbook entry** or link explaining how to use the tool and what to do when it fails, if required by your team.

## Implementation checklist

1. Clarify workflow boundaries and risk level with stakeholders.
2. Identify existing components, endpoints, and patterns to reuse.
3. Implement the UI, backend handlers, and data access using established abstractions.
4. Add safeguards: confirmations, rate limiting, or approvals depending on risk.
5. Wire up logging and metrics so usage and failures are visible.
6. Add or update tests and any required runbook entries.

## Verification

Run the standard validation commands for the relevant apps/services (tests, lint, type checks). In addition:

- Exercise both **happy paths and failure modes** in a safe environment.
- Confirm that audit logs and metrics reflect actions accurately.

The skill is complete when:

- Validation commands pass.
- Flows behave correctly in staging or an equivalent environment.
- Stakeholders can perform their target workflows without manual DB access or unsafe workarounds.

## Safety and escalation

- If an operation could cause **irreversible data loss or external customer impact**, require higher-level approvals and consider additional controls (dual control, time-boxed access, or break-glass procedures).
- If you discover that existing internal tools bypass critical controls, document this clearly and escalate through the appropriate risk or security channel.
```
</file>

<file path="docs/cli/configuration/skills/service-integration.mdx">
---
title: Service integration skill
description: A reusable skill for extending existing services and wiring integrations in complex enterprise codebases.
---

Use this skill when a feature requires changes to one or more backend services in a **shared, multi-team codebase** ‚Äì for example, adding a new endpoint, publishing an event, or calling out to a dependency owned by another team.

The surrounding skill folder is a good place to keep **integration utilities** the agent can reuse, such as:

- `SKILL.md` ‚Äì this service-integration skill specification
- `schemas/` ‚Äì representative event and API schemas (e.g., JSON, Protobuf, or OpenAPI) or trimmed examples, not the canonical service definitions
- `patterns.md` ‚Äì examples of approved integration patterns and links to the real implementations
- `observability-checklist.md` ‚Äì standard logging/metrics/tracing checklists

```md
# Skill: Service integration in a complex codebase

## Purpose

Extend or integrate with existing services in our main backend codebase while preserving ownership boundaries, reliability standards, and observability requirements.

## When to use this skill

- The change requires adding or modifying a backend API, job, or event.
- The service lives in a **shared monorepo** with clear ownership and domain boundaries.
- The work may require coordination with other teams, but the main implementation happens in our services.

## Inputs

- **Business requirement**: short description of the user or system behavior change.
- **Primary service(s)**: names/paths of the services and domains involved.
- **Existing contracts**: relevant API schemas, events, or message formats.
- **Non-functional requirements**: latency, error budget, data retention, and throughput expectations.
- **Change management**: rollout strategy, feature flags, or migration plan.

## Out of scope

- Greenfield systems that require new infrastructure or data stores.
- Cross-region or cross-cloud replication design.
- Changes that conflict with established ownership boundaries without prior approval.

## Conventions

- Follow the **domain boundaries** and module layout described in `AGENTS.md` and internal architecture docs.
- Use existing **configuration, logging, metrics, and tracing** patterns.
- Reuse established **error handling** and **retry/backoff** utilities.

## Required behavior

1. Introduce new APIs, jobs, or events using existing framework patterns.
2. Maintain backwards compatibility wherever possible; if breaking changes are required, document migration steps.
3. Ensure all new behavior is observable via logs, metrics, and/or traces.
4. Respect existing security and privacy requirements (authN/Z, PII handling, data residency).

## Required artifacts

- Code changes in the relevant service(s) and domain modules.
- **Unit tests** for core logic and boundary conditions.
- **Integration or contract tests** for new or modified interfaces, where harnesses exist.
- Updated **runbooks or design docs** only if required by your team's process (link from the PR description instead of duplicating here).

## Implementation checklist

1. Identify ownership and confirm which service(s) should change.
2. Map the data and control flow across services and dependencies.
3. Design the integration surface (API, event, or job) and validate it against existing conventions.
4. Implement the change, keeping related files and modules co-located.
5. Add or update tests at the appropriate layers (unit, integration, contract).
6. Ensure logs/metrics/traces make the new behavior debuggable in production.
7. Wire in feature flags or configuration for safe rollout if necessary.

## Verification

Run the service-level validation commands, for example:

- `pnpm test --filter <service>` or `pytest` in the service directory
- `pnpm lint` or equivalent linter for the language in use
- Any existing **contract or integration test suites** referenced from `AGENTS.md` or service docs

The skill is complete when:

- All relevant tests and linters pass.
- The new integration behaves correctly in local or staging environments.
- Observability signals (logs, metrics, traces) show the expected behavior without noisy regressions.

## Safety and escalation

- If the change touches **shared schemas, core auth logic, billing, or compliance-critical data**, stop and request explicit human approval and design review.
- If dependencies owned by other teams need changes, create or update their tickets and clearly document assumptions and contract expectations in the PR.
```
</file>

<file path="docs/cli/configuration/agents-md.mdx">
---
title: AGENTS.md
description: Teach agents everything they need to know about your project with a single Markdown file.
---

## 1 ¬∑ What is **AGENTS.md**?

**AGENTS.md** is a Markdown file that lives in your repository (or home directory) and acts as a _briefing packet_ for AI coding agents.

### Why AGENTS.md?

**README.md** files are for humans: quick starts, project descriptions, and contribution guidelines.

**AGENTS.md** complements this by containing the extra, sometimes detailed context coding agents need: build steps, tests, and conventions that might clutter a README or aren't relevant to human contributors.

We intentionally kept it separate to:

- Give agents a clear, predictable place for instructions
- Keep READMEs concise and focused on human contributors
- Provide precise, agent-focused guidance that complements existing README and docs

### What it contains:

- Describes how to **build, test, and run** your project
- Explains architectural patterns and conventions
- Lists external services, environment variables, or design docs
- Provides domain-specific vocabulary and code style rules

Agents read AGENTS.md _before_ planning any change, giving them the same tribal knowledge senior engineers already carry in their heads.

---

## 2 ¬∑ One AGENTS.md works across many agents

Your AGENTS.md file is compatible with a growing ecosystem of AI coding agents and tools, including:

- **Droids** - Factory's AI coding agents
- **Cursor** - AI-powered code editor
- **Aider** - AI pair programming in your terminal
- **Gemini CLI** - Google's command-line AI assistant
- **Jules** - Google's coding assistant
- **Codex** - OpenAI's code generation model
- **Zed** - AI-enhanced editor
- **Phoenix** - AI development platform
- And many more emerging tools

Rather than introducing another proprietary file format, AGENTS.md uses a standard that works across the entire AI development ecosystem.

---

## 3 ¬∑ File locations & discovery hierarchy

Agents look for AGENTS.md in this order (first match wins):

1. `./AGENTS.md` in the **current working directory**
2. The nearest parent directory up to the repo root
3. Any `AGENTS.md` in sub-folders the agent is working inside
4. Personal override: `~/.factory/AGENTS.md`

<Note>
  Multiple files can coexist. The closer one to the file being edited takes
  precedence.
</Note>

---

## 4 ¬∑ File structure & syntax

AGENTS.md is plain Markdown; headings provide semantic hints.

```md
# Build & Test ‚Üê exact commands for compiling and testing

# Architecture Overview ‚Üê short description of major modules

# Security ‚Üê auth flows, API keys, sensitive data

# Git Workflows ‚Üê branching, commit conventions, PR requirements

# Conventions & Patterns ‚Üê naming, folder layout, code style
```

Agents recognize:

- **Top-level headings** (`#`) as sections
- **Bullet lists** for commands or rules
- **Inline code** (`` ` ``) for exact commands, filenames, env vars
- **Links** to external docs (GitHub, Figma, Confluence‚Ä¶)

---

## 5 ¬∑ Common sections

| Section                    | Purpose                                                       |
| -------------------------- | ------------------------------------------------------------- |
| **Build & Test**           | Exact commands for compiling and running the test suite.      |
| **Architecture Overview**  | One-paragraph summary of major modules and data flow.         |
| **Security**               | API keys, endpoints, auth flows, rate limits, sensitive data. |
| **Git Workflows**          | Branching strategy, commit conventions, PR requirements.      |
| **Conventions & Patterns** | Folder structure, naming patterns, code style, lint rules.    |

Include only what _future you_ will care about‚Äîbrevity beats encyclopaedia-length files.

---

## 6 ¬∑ Templates & examples

### Factory-style comprehensive example

```md
# MyProject

This is an overview of My Project. It's an example app used to highlight AGENTS.md files utility.

## Core Commands

‚Ä¢ Type-check and lint: `pnpm check`
‚Ä¢ Auto-fix style: `pnpm check:fix`
‚Ä¢ Run full test suite: `pnpm test --run --no-color`
‚Ä¢ Run a single test file: `pnpm test --run <path>.test.ts`
‚Ä¢ Start dev servers (frontend + backend): `pnpm dev`
‚Ä¢ Build for production: `pnpm build` then `pnpm preview`

All other scripts wrap these six tasks.

## Project Layout

‚îú‚îÄ client/ ‚Üí React + Vite frontend
‚îú‚îÄ server/ ‚Üí Express backend

‚Ä¢ Frontend code lives **only** in `client/`
‚Ä¢ Backend code lives **only** in `server/`
‚Ä¢ Shared, environment-agnostic helpers belong in `src/`

## Development Patterns & Constraints

Coding style
‚Ä¢ TypeScript strict mode, single quotes, trailing commas, no semicolons.
‚Ä¢ 100-char line limit, tabs for indent (2-space YAML/JSON/MD).
‚Ä¢ Use interfaces for public APIs; avoid `@ts-ignore`.
‚Ä¢ Tests first when fixing logic bugs.
‚Ä¢ Visual diff loop for UI tweaks.
‚Ä¢ Never introduce new runtime deps without explanation in PR description.

## Git Workflow Essentials

1. Branch from `main` with a descriptive name: `feature/<slug>` or `bugfix/<slug>`.
2. Run `pnpm check` locally **before** committing.
3. Force pushes **allowed only** on your feature branch using
   `git push --force-with-lease`. Never force-push `main`.
4. Keep commits atomic; prefer checkpoints (`feat: ‚Ä¶`, `test: ‚Ä¶`).

## Evidence Required for Every PR

A pull request is reviewable when it includes:

- All tests green (`pnpm test`)
- Lint & type check pass (`pnpm check`)
- Diff confined to agreed paths (see section 2)
- **Proof artifact**
  ‚Ä¢ Bug fix ‚Üí failing test added first, now passes
  ‚Ä¢ Feature ‚Üí new tests or visual snapshot demonstrating behavior
- One-paragraph commit / PR description covering intent & root cause
- No drop in coverage, no unexplained runtime deps
```

### Node + React monorepo

```md
# Build & Test

- Build: `npm run build`
- Test: `npm run test -- --runInBand`

# Run Locally

- API: `npm run dev --workspace=api`
- Web: `npm run dev --workspace=web`
- Storybook: `npm run storybook`

# Conventions

- All backend code in `packages/api/src`
- React components in `packages/web/src/components`
- Use `zod` for request validation

# Architecture Overview

The API is GraphQL (Apollo). Web uses Next.js with SSR.

# External Services

- Stripe for payments (`STRIPE_KEY`)
- S3 for uploads (`AWS_BUCKET`)

# Gotchas

- Test snapshot paths are absolute‚Äîrun `npm run test -- --updateSnapshot` after refactors.
```

### Python microservice

```md
# Build & Test

- Build: `pip install -e .`
- Test: `pytest`

# Run Locally

- `uvicorn app.main:app --reload`

# Conventions

- Config via Pydantic settings (`settings.py`)
- CELERY tasks live in `tasks/`
```

---

## 7 ¬∑ Best practices

<AccordionGroup>
  <Accordion title="Keep it short">
    Aim for **‚â§ 150 lines**. Long files slow the agent and bury signal.
  </Accordion>

{" "}

<Accordion title="Use concrete commands">
  Wrap commands in back-ticks so agents can copy-paste without guessing.
</Accordion>

{" "}

<Accordion title="Update alongside code">
  Treat AGENTS.md like code‚ÄîPR reviewers should nudge updates when build steps
  change.
</Accordion>

{" "}

<Accordion title="One source of truth">
  Avoid duplicate docs; link to READMEs or design docs instead of pasting them.
</Accordion>

{" "}

<Accordion title="Make requests precise">
  The more precise your guidance for the task at hand, the more likely the agent
  is to accomplish that task to your liking.
</Accordion>

  <Accordion title="Verify before merging">
    Require objective proof: tests, lint, type check, and a diff confined to agreed paths.
  </Accordion>
</AccordionGroup>

---

## 8 ¬∑ How agents use AGENTS.md

<Steps>
  <Step title="Ingestion">
    On task start, agents load the nearest AGENTS.md into their context window.
  </Step>
  <Step title="Planning">
    Build/test commands are used to form the execution plan (e.g. run tests
    after edits).
  </Step>
  <Step title="Tool selection">
    Folder and naming conventions steer tools like `edit_file` and
    `create_file`.
  </Step>
  <Step title="Validation">
    Gotchas and domain vocabulary improve reasoning and reduce hallucinations.
  </Step>
</Steps>

---

## 9 ¬∑ When things go wrong

Like any development work, agent tasks sometimes need course correction when scope creeps or assumptions prove wrong. The same iteration patterns that work with human collaborators apply here.

### Warning signs of agent drift:

- Plans that rewrite themselves mid-execution
- Edits outside the declared paths
- Fixes claimed without failing tests to prove they work
- Diffs bloated with unrelated changes

### Recovery playbook:

1. **Tighten the spec**: Narrow the directory or tests the agent may touch
2. **Salvage the good**: Keep valid artifacts such as a failing test; revert noisy edits
3. **Restart clean**: Launch a fresh session with improved instructions
4. **Take over**: When you can tell the agent is failing, pair program the final changes

---

## 10 ¬∑ Getting started

<CardGroup cols={2}>
  <Card
    title="Specification Mode"
    icon="list-check"
    href="/cli/user-guides/specification-mode"
  >
    Specs + AGENTS.md = instant context for new features.
  </Card>
  <Card
    title="Auto-Run"
    icon="forward"
    href="/cli/user-guides/auto-run"
  >
    Reliable automation depends on accurate build & test commands.
  </Card>
</CardGroup>

### Summary

1. Add **AGENTS.md** at your repo root (and optionally submodules).
2. Document build/test commands, conventions, and gotchas‚Äî_concise & actionable_.
3. Agents read it automatically; no extra flags required.

Pick one modest bug or small feature from your backlog. Write three clear sentences that state where to begin, how to reproduce the issue, and what proof signals completion. Run the agent through Explore ‚Üí Plan ‚Üí Code ‚Üí Verify, review the evidence, and merge.

Ship faster with fewer surprises‚Äîgive your agent the playbook it needs!
</file>

<file path="docs/cli/configuration/byok.mdx">
---
title: Bring Your Own Key
description: Connect your own API keys, use open source models, or run local models
---

Factory CLI supports custom model configurations through BYOK (Bring Your Own Key). Use your own OpenAI or Anthropic keys, connect to any open source model providers (like OpenRouter), or run models locally on your hardware. Once configured, switch between models using the `/model` command.

<Note>
  Your API keys remain local and are not uploaded to Factory servers. Custom models are only available in the CLI and won't appear in Factory's web or mobile platforms.
</Note>

<img src="/images/custom_models.png" alt="Model selector showing custom models" />

[Install the CLI with the 5-minute quickstart ‚Üí](/cli/getting-started/quickstart)

---

## Configuration Reference

Add custom models in `~/.factory/config.json` under the `custom_models` array.

### Supported Fields

| Field | Required | Description |
|-------|----------|-------------|
| `model_display_name` | ‚úì | Human-friendly name shown in model selector |
| `model` | ‚úì | Model identifier sent via API (e.g., `claude-sonnet-4-5-20250929`, `gpt-5-codex`, `qwen3:4b`) |
| `base_url` | ‚úì | API endpoint base URL |
| `api_key` | ‚úì | Your API key for the provider. Can't be empty. |
| `provider` | ‚úì | One of: `anthropic`, `openai`, or `generic-chat-completion-api` |
| `max_tokens` | ‚úì | Maximum output tokens for model responses |

---

## Understanding Providers

Factory supports three provider types that determine API compatibility:

| Provider | API Format | Use For | Documentation |
|----------|------------|---------|---------------|
| `anthropic` | Anthropic Messages API (v1/messages) | Anthropic models on their official API or compatible proxies | [Anthropic Messages API](https://docs.claude.com/en/api/messages) |
| `openai` | OpenAI Responses API | OpenAI models on their official API or compatible proxies. Required for the newest models like GPT-5 and GPT-5-Codex. | [OpenAI Responses API](https://platform.openai.com/docs/api-reference/responses) |
| `generic-chat-completion-api` | OpenAI Chat Completions API | OpenRouter, Fireworks, Together AI, Ollama, vLLM, and most open-source providers | [OpenAI Chat Completions API](https://platform.openai.com/docs/api-reference/chat) |

<Warning>
  Factory is actively verifying Droid's performance on popular models, but we cannot guarantee that all custom models will work out of the box. Only Anthropic and OpenAI models accessed via their official APIs are fully tested and benchmarked.
</Warning>

---

## Prompt Caching

Factory CLI automatically uses prompt caching when available to reduce API costs:

- **Official providers (`anthropic`, `openai`)**: Factory attempts to use prompt caching via the official APIs. Caching behavior follows each provider's implementation and requirements.
- **Generic providers (`generic-chat-completion-api`)**: Prompt caching support varies by provider and cannot be guaranteed. Some providers may support caching, while others may not.

### Verifying Prompt Caching

To check if prompt caching is working correctly with your custom model:

1. Run a conversation with your custom model
2. Use the `/cost` command in Droid CLI to view cost breakdowns
3. Look for cache hit rates and savings in the output

If you're not seeing expected caching savings, consult your provider's documentation about their prompt caching support and requirements.

---

## Quick Start Examples

### Bring Your Own OpenAI/Anthropic Keys

Use your own API keys for cost control and billing transparency:

```json
{
  "custom_models": [
    {
      "model_display_name": "Sonnet 4.5 [Custom]",
      "model": "claude-sonnet-4-5-20250929",
      "base_url": "https://api.anthropic.com",
      "api_key": "YOUR_ANTHROPIC_KEY",
      "provider": "anthropic"
    },
    {
      "model_display_name": "GPT5-Codex [Custom]",
      "model": "gpt-5-codex",
      "base_url": "https://api.openai.com/v1",
      "api_key": "YOUR_OPENAI_KEY",
      "provider": "openai"
    }
  ]
}
```

### Access via OpenRouter

Connect to OpenRouter for access to models from multiple providers:

```json
{
  "custom_models": [
    {
      "model_display_name": "GPT-OSS-20B",
      "model": "openai/gpt-oss-20b",
      "base_url": "https://openrouter.ai/api/v1",
      "api_key": "YOUR_OPENROUTER_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32000
    }
  ]
}
```

Browse available models at [openrouter.ai/models](https://openrouter.ai/models).

### Fireworks AI

Access high-performance inference for open-source models with optimized serving:

```json
{
  "custom_models": [
    {
      "model_display_name": "GLM 4.5 [Fireworks]",
      "model": "accounts/fireworks/models/glm-4p5",
      "base_url": "https://api.fireworks.ai/inference/v1",
      "api_key": "YOUR_FIREWORKS_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    },
    {
      "model_display_name": "Llama 3.1 405B [Fireworks]",
      "model": "accounts/fireworks/models/llama-v3p1-405b-instruct",
      "base_url": "https://api.fireworks.ai/inference/v1",
      "api_key": "YOUR_FIREWORKS_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 131072
    }
  ]
}
```

Get your API key at [fireworks.ai](https://fireworks.ai). Browse available models in their [model catalog](https://fireworks.ai/models).

### Baseten

Deploy and serve custom models with enterprise-grade infrastructure:

```json
{
  "custom_models": [
    {
      "model_display_name": "Custom Model [Baseten]",
      "model": "YOUR_MODEL_ID",
      "base_url": "https://inference.baseten.co/v1",
      "api_key": "YOUR_BASETEN_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 8192
    },
    {
      "model_display_name": "Llama 3.1 70B [Baseten]",
      "model": "llama-3.1-70b-instruct",
      "base_url": "https://inference.baseten.co/v1",
      "api_key": "YOUR_BASETEN_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 131072
    }
  ]
}
```

<Note>
  Baseten supports custom model deployments. Replace `YOUR_MODEL_ID` with your deployed model's ID from the Baseten dashboard.
</Note>

### DeepInfra

Access cost-effective inference for a wide variety of open-source models:

```json
{
  "custom_models": [
    {
      "model_display_name": "GLM 4.6 [DeepInfra]",
      "model": "zai-org/GLM-4.6",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    },
    {
      "model_display_name": "Qwen 2.5 Coder 32B [DeepInfra]",
      "model": "Qwen/Qwen2.5-Coder-32B-Instruct",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32768
    },
    {
      "model_display_name": "DeepSeek V3 [DeepInfra]",
      "model": "deepseek-ai/DeepSeek-V3",
      "base_url": "https://api.deepinfra.com/v1/openai",
      "api_key": "YOUR_DEEPINFRA_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 65536
    }
  ]
}
```

Get your API token at [deepinfra.com](https://deepinfra.com). View available models at their [model list](https://deepinfra.com/models).

### Hugging Face Inference API

Connect to models hosted on Hugging Face's Inference API:

```json
{
  "custom_models": [
    {
      "model_display_name": "Mistral 7B [HF]",
      "model": "mistralai/Mistral-7B-Instruct-v0.3",
      "base_url": "https://api-inference.huggingface.co/models",
      "api_key": "YOUR_HF_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32768
    },
    {
      "model_display_name": "CodeLlama 13B [HF]",
      "model": "codellama/CodeLlama-13b-Instruct-hf",
      "base_url": "https://api-inference.huggingface.co/models",
      "api_key": "YOUR_HF_TOKEN",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    }
  ]
}
```

<Note>
  Get your Hugging Face token from [huggingface.co/settings/tokens](https://huggingface.co/settings/tokens). Some models may require Pro subscription for faster inference.
</Note>

### Ollama (Local and Cloud)

#### Local Ollama

Run models locally on your hardware with Ollama:

```json
{
  "custom_models": [
    {
      "model_display_name": "Qwen 2.5 Coder [Local]",
      "model": "qwen2.5-coder:7b",
      "base_url": "http://localhost:11434/v1",
      "api_key": "not-needed",
      "provider": "generic-chat-completion-api",
      "max_tokens": 8192
    },
    {
      "model_display_name": "DeepSeek Coder V2 [Local]",
      "model": "deepseek-coder-v2:16b",
      "base_url": "http://localhost:11434/v1",
      "api_key": "not-needed",
      "provider": "generic-chat-completion-api",
      "max_tokens": 16384
    }
  ]
}
```

<Tip>
  First, install Ollama and pull your desired model:
  ```bash
  ollama pull qwen2.5-coder:7b
  ollama serve  # Start the local server
  ```
</Tip>

#### Ollama Cloud

Use Ollama's cloud service for hosted model inference:

```json
{
  "custom_models": [
    {
      "model_display_name": "Llama 3.1 8B [Ollama Cloud]",
      "model": "llama3.1:8b",
      "base_url": "https://ollama.com",
      "api_key": "YOUR_OLLAMA_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 131072,
      "headers": {
        "Authorization": "Bearer YOUR_OLLAMA_API_KEY"
      }
    }
  ]
}
```

<Note>
  For Ollama Cloud, you'll need to include the Authorization header with your API key. Get your API key from [ollama.com](https://ollama.com).
</Note>

### Connect to Google Gemini

Access Google's Gemini models using your Gemini AI API key:

```json
{
  "custom_models": [
    {
      "model_display_name": "Gemini 2.5 Pro",
      "model": "gemini-2.5-pro",
      "base_url": "https://generativelanguage.googleapis.com/v1beta/",
      "api_key": "YOUR_GEMINI_API_KEY",
      "provider": "generic-chat-completion-api",
      "max_tokens": 32000
    }
  ]
}
```



---

## Using Custom Models

Once configured, access your custom models in the CLI:

1. Use the `/model` command
2. Your custom models appear in a separate "Custom models" section below Factory-provided models
3. Select any model to start using it

Custom models display with the name you set in `model_display_name`, making it easy to identify different providers and configurations.

---

## Troubleshooting

### Model not appearing in selector
- Check JSON syntax in `~/.factory/config.json`
- Restart the CLI after making configuration changes
- Verify all required fields are present

### "Invalid provider" error
- Provider must be exactly `anthropic`, `openai`, or `generic-chat-completion-api`
- Check for typos and ensure proper capitalization

### Authentication errors
- Verify your API key is valid and has available credits
- Check that the API key has proper permissions
- Confirm the base URL matches your provider's documentation

### Local model won't connect
- Ensure your local server is running (e.g., `ollama serve`)
- Verify the base URL is correct and includes `/v1/` suffix if required
- Check that the model is pulled/available locally

### Rate limiting or quota errors
- Check your provider's rate limits and usage quotas
- Monitor your usage through your provider's dashboard

---

## Billing

- You pay your provider directly with no Factory markup or usage fees
- Track costs and usage in your provider's dashboard
</file>

<file path="docs/cli/configuration/custom-droids.mdx">
---
title: Custom Droids (Subagents)
description: Create specialized subagents with their own prompts, tool access, and models that droid can delegate work to.
---

Custom droids are reusable subagents defined in Markdown. Each droid carries its own system prompt, model preference, and tooling policy so you can hand off focused tasks‚Äîlike code review, security checks, or research‚Äîwithout re-typing instructions.

<Warning>
  Custom Droids are experimental. You must enable them in settings before they
  will be picked up.
</Warning>

---

## 1 ¬∑ What are custom droids?

Custom droids live as `.md` files under either your project's `.factory/droids/` or your personal `~/.factory/droids/` directory. When enabled, the CLI scans these folders (top-level files only), validates each definition, and exposes them as `subagent_type` targets for the **Task** tool. This lets the primary assistant spin up purpose-built helpers mid-session.

- **Project droids** sit in `<repo>/.factory/droids/` and are shared with teammates.
- **Personal droids** live in `~/.factory/droids/` and follow you across workspaces.
- Project definitions override personal ones when the names match.

---

## 2 ¬∑ Why use them?

- **Faster delegation** ‚Äì encode complex checklists once and reuse them with a single tool call.
- **Stricter safety** ‚Äì limit an agent to read-only, edit-only, or curated tool sets.
- **Context isolation** ‚Äì each subagent runs with a fresh context window, avoiding prompt bloat.
- **Repeatable reviews** ‚Äì capture team-specific review, testing, or release gates as code you can version.

---

## 3 ¬∑ Quick start

1. Open **Settings** (`/settings`) and toggle **Custom Droids** under the _Experimental_ section. This persists `"enableCustomDroids"` in `~/.factory/settings.json` and registers the Task tool.
2. Restart `droid`.
3. Run `/droids` to launch the Droids menu.
4. Choose **Create a new Droid**, pick a storage location (project or personal), then follow the wizard to set:
   - Description of what the droid should do
   - System prompt (auto-generated or manually edited)
   - Identifier (name for the droid)
   - Model (or inherit from parent session)
   - Tools (explicit list of tool IDs)
5. Save. The CLI writes `<name>.md` into the chosen `droids/` directory and normalizes the filename (lowercase, hyphenated).
6. Ask droid to use it, e.g. "Run the Task tool with subagent `code-reviewer` to review this diff," or trigger it from automation.

The loader caches scans for ~5 seconds. The current UI instantiates a fresh loader on every open, so changes usually show up on the next visit; a long-running watch is not yet enabled by default.

---

## 4 ¬∑ Configuration

Each droid file is Markdown with YAML frontmatter.

```md
---
name: code-reviewer
description: Focused reviewer that checks diffs for correctness risks
model: inherit
tools: ["Read", "LS", "Grep", "Glob"]
---

You are the team's senior reviewer. Examine the diff the parent agent shares and:

- flag correctness, security, and migration risks
- list targeted follow-up tasks if changes are required
- confirm tests or manual validation needed before merge

Respond with:
Summary: <one-line finding>
Findings:

- <bullet>
- <bullet>
```

Key metadata fields:

| Field         | Notes                                                                                                                          |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `name`        | Required. Lowercase letters, digits, `-`, `_`. Drives the `subagent_type` value and filename.                                  |
| `description` | Optional. Shown in the UI list. Keep ‚â§500 chars.                                                                               |
| `model`       | `inherit` (use parent session's model), or specify a model identifier. For built-in models, use values like `claude-sonnet-4-5-20250929`. For custom models (BYOK), use `custom:` + the `model` field from your config (e.g., `custom:gpt-4o-mini`), **not** the `model_display_name`. Run `/models` in the CLI to see available options. |
| `tools`       | Tool selection: `undefined` (all tools) or array of tool IDs like `["Read", "Edit", "Execute"]`. Case-sensitive.               |

Prompts must start with YAML frontmatter containing at least `name` and include a non-empty body. `DroidValidator` surfaces errors (invalid names, unknown models, unknown tools) and warnings (missing description, duplicated tools). Validation issues appear in the CLI logs when a file fails to load.

### Tool categories ‚Üí concrete tools

| Category    | Tool IDs                                    | Purpose                            |
| ----------- | ------------------------------------------- | ---------------------------------- |
| `read-only` | `Read`, `LS`, `Grep`, `Glob`                | Safe analysis and file exploration |
| `edit`      | `Create`, `Edit`, `MultiEdit`, `ApplyPatch` | Code generation and modifications  |
| `execute`   | `Execute`                                   | Shell command execution            |
| `web`       | `WebSearch`, `FetchUrl`                     | Internet research and content      |
| `mcp`       | Dynamically populated (if any)              | Model Context Protocol tools       |

Explicit arrays must use the tool names above (case-sensitive). Unknown names cause validation errors.

---

## 5 ¬∑ Managing droids in the UI

`/droids` opens a modal displaying:

- **List of droids** ‚Äì shows each droid with:
  - Name and model in parentheses
  - Description preview
  - Location badge (Project / Personal)
  - Tools summary (e.g., "All tools" or count of selected tools)
- **Create a new Droid** ‚Äì launches a guided wizard:
  1. Choose location (Project or Personal)
  2. Describe what the droid should do
  3. Generate or manually edit the system prompt
  4. Confirm identifier, model, and tools
- **Import from Claude Code** ‚Äì import existing agents from `~/.claude/agents/` as custom droids
- **Actions** ‚Äì View, Edit, Delete droids, or Reload to refresh the list

---

## 5.5 ¬∑ Importing Claude Code subagents

You can import agents created in Claude Code as custom droids. This lets you reuse your existing Claude Code agents with the Droids system.

### How to import

1. Run `/droids` to open the Droids menu
2. Press **I** to start the import flow
3. The CLI scans Claude Code agent directories:
   - **Project scope**: `<repo>/.claude/agents/` (workspace-specific agents)
   - **Personal scope**: `~/.claude/agents/` (personal agents)
4. Review the list of available agents:
   * Agents marked `(already exists)` are pre-deselected by default
   * Pre-selected agents are those not yet imported to Droids
5. Press **Space** to toggle individual selections, **A** to toggle all
6. Press **Enter** to import the selected agents

### What happens during import

The import process converts Claude Code agents into Droids:

1. **Metadata extraction**:
   - Agent name ‚Üí droid `name`
   - Agent description (including examples and usage guidance) ‚Üí droid `description`
   - Agent instructions ‚Üí droid system prompt (body)

2. **Configuration mapping**:
   - Model: Maps Claude Code model families to Factory models:
     - `inherit` ‚Üí `inherit`
     - `sonnet` ‚Üí first available Sonnet model
     - `haiku` ‚Üí first available Haiku model
     - `opus` ‚Üí first available Opus model
   - Tools: Maps Claude Code tool names to Factory tools (may show validation warnings if tools don't map)
   - Location: Imports to Personal `~/.factory/droids/` by default

3. **Tool validation**:
   - Some Claude Code tools may not have equivalents in Factory
   - Invalid tools are listed with a warning: "Invalid tools: [list]"
   - You can edit the droid to fix tool mappings or adjust tool access

4. **File creation**:
   - Creates a `.md` file in `~/.factory/droids/` (personal location)
   - Filename is normalized (lowercase, hyphenated)
   - File format: YAML frontmatter + system prompt body

5. **Import report**:
   - Shows success/failure for each agent
   - Imported agents are immediately available in the droid list
   - You can edit any imported droid to adjust model, tools, or prompt

### Example import flow

**Selection screen** (before import):

```
Import Droids (.claude/agents)

Project (<repo>/.claude/agents/):
> [x] polite-greeter
  Use this agent when the user requests a greeting, says hello, or asks for a polite
  welcome message. Examples: <example>...

  [ ] code-summarizer
  Use this agent when you need to understand what a code file does without diving into
  implementation details. Examples: <example>...

Personal (~/.claude/agents/):
  [x] security-checker
  Security analysis agent...

‚Üë/‚Üì navigate ‚Ä¢ Space select ‚Ä¢ A toggle all ‚Ä¢ Enter import ‚Ä¢ B back
```

**After import** (back in droid list):

```
Custom Droids

> code-reviewer (gpt-5-codex)
  This droid verifies the correct base branch and committed...
  Location: Project  ‚Ä¢  Tools: All tools

  polite-greeter (claude-opus-4-1-20250805)
  Use this agent when the user requests a greeting, says he...
  Location: Personal  ‚Ä¢  Tools: 1 selected

  code-summarizer (claude-sonnet-4-5-20250929)
  Use this agent when you need to understand what a code fi...
  Location: Personal  ‚Ä¢  Tools: All tools
```

### Handling tool validation errors

After importing, if you see **"Invalid tools: [list]"**, it means some Claude Code tools don't have Factory equivalents:

1. **View the droid** (press Enter) to see the full tool list
2. **Edit the droid** (press E) to adjust:
   - Remove invalid tools from the list
   - Keep only valid Factory tools
3. **Check available tools** - the list shows which Factory tools are available

Common unmapped tools:

* Claude Code tools like `Write`, `NotebookEdit`, `BrowseURL` don't exist in Factory
* Replace with equivalent Factory tools:
  * `Write` ‚Üí `Edit`, `Create`
  * `BrowseURL` ‚Üí `WebSearch`, `FetchUrl`
* Or remove the `tools` section entirely to enable all Factory tools

---

## 6 ¬∑ Using custom droids effectively

- **Invoke via the Task tool** ‚Äì when custom droids are enabled, the droid may call it autonomously, or you can request it directly ("Use the subagent `security-auditor` on this change").
- **Choose models strategically** ‚Äì use `inherit` to match the parent session, or specify a different model for specialized tasks:
  - Smaller/faster models for simple analysis and summary tasks (lower cost).
  - Larger/more capable models for complex reasoning, code review, and multi-step analysis.
  - Run `/models` in the CLI to see available options for your workspace.
- **Limit tool access** ‚Äì use explicit tool lists to restrict what a subagent can do, preventing unexpected shell commands or other dangerous operations.
- **Leverage live updates** ‚Äì the Task tool now streams live progress, showing tool calls, results, and TodoWrite updates in real time as the subagent executes.
- **Structure output** ‚Äì organize the prompt to emit sections like `Summary:` and `Findings:` so the Task tool UI can summarize results clearly.
- **Share and collaborate** ‚Äì check `.factory/droids/*.md` into your repo so teammates can use shared droids, and version-control prompt updates like code.
- **Leverage Claude Code agents** ‚Äì import your existing Claude Code agents (see section 5.5) to reuse them as custom droids in Factory.

---

## 7 ¬∑ Examples

### Code reviewer (project scope)

```md
---
name: code-reviewer
description: Reviews diffs for correctness, tests, and migration fallout
model: inherit
tools: ["Read", "LS", "Grep", "Glob"]
---

You are the team's principal reviewer. Given the diff and context:

- Summarize the intent of the change.
- Flag correctness risks, missing tests, or rollback hazards.
- Call out any migrations or data changes that need coordination.

Reply with:
Summary: <one-line>
Findings:

- <issue or ‚úÖ No blockers>
  Follow-up:
- <action or leave blank>
```

Use: "Run the subagent `code-reviewer` on the staged diff."

### Security sweeper (personal scope)

```md
---
name: security-sweeper
description: Looks for insecure patterns in recently edited files
model: inherit
tools: ["Read", "Grep", "WebSearch"]
---

Investigate the files referenced in the prompt for security issues:

- Identify injection, insecure transport, privilege escalation, or secrets exposure.
- Suggest concrete mitigations.
- Link to relevant CWE or internal standards when helpful.

Respond with:
Summary: <headline>
Findings:

- <file>: <issue>
  Mitigations:
- <recommendation>
```

### Task coordinator (with live progress)

```md
---
name: task-coordinator
description: Coordinates multi-step tasks with live progress updates
model: inherit
tools: Read, Edit, Execute, TodoWrite
---

You are a task coordinator. Break down the goal into actionable steps:

1. Use TodoWrite to create and update a task list
2. For each task, read relevant files and execute commands as needed
3. Report progress in real-time using TodoWrite updates

Keep the task list updated with completion status (pending, in_progress, completed).
```

---

With custom droids, you capture tribal knowledge as code. Compose specialized prompts once, assign the right tools and models, and let the primary assistant delegate heavy lifts to the subagents you design.
</file>

<file path="docs/cli/configuration/custom-slash-commands.mdx">
---
title: Custom Slash Commands
description: Extend the CLI with reusable Markdown prompts or executable scripts that run from the chat input.
---

Custom slash commands turn repeatable prompts or setup steps into `/shortcuts`. Droid scans a pair of `.factory/commands` folders, turns each file into a command, and pipes the result straight into the conversation or your terminal session.

---

## 1 ¬∑ Discovery & naming

| Scope         | Location                   | Purpose                                                                                             |
| ------------- | -------------------------- | --------------------------------------------------------------------------------------------------- |
| **Workspace** | `<repo>/.factory/commands` | Project-specific commands shared with teammates. Overrides any personal command with the same slug. |
| **Personal**  | `~/.factory/commands`      | Always scanned. Stores private or cross-project shortcuts.                                          |

- Only Markdown (`*.md`) files and files with a leading shebang (`#!`) are registered.
- Filenames are slugged (lowercase, spaces ‚Üí `-`, non URL-safe characters dropped). `Code Review.mdx` becomes `/code-review`.
- Invoke commands from chat with `/command-name optional arguments`. Slash suggestions use the description pulled from the file.
- Run `/commands` to open the **Custom Commands** manager UI for browsing, reloading (`R`), or importing commands.
- Commands must live at the top level of the `commands` directory. Nested folders are ignored today.

---

## 2 ¬∑ Markdown commands

Markdown files render into a system notification that seeds droid‚Äôs next turn. Optional YAML frontmatter controls autocomplete metadata.

```md
---
description: Send a code review checklist
argument-hint: <branch-name>
---

Please review `$ARGUMENTS` and summarize any merge blockers, test gaps, and risky areas.

- Highlight security or performance concerns
- Suggest follow-up tasks with owners
- List files that need attention
```

| Frontmatter key | Purpose                                                          |
| --------------- | ---------------------------------------------------------------- |
| `description`   | Overrides the generated summary shown in slash suggestions.      |
| `argument-hint` | Appends inline usage hints (e.g., `/code-review <branch-name>`). |
| `allowed-tools` | Reserved for future use. Safe to omit.                           |

`$ARGUMENTS` expands to everything typed after the command name. If you do not reference `$ARGUMENTS`, the body is sent unchanged.

<Tip>
  Markdown output is wrapped in a system notification so the next agent turn
  immediately sees the prompt.
</Tip>

<Note>
  Positional placeholders like `$1` or `$2` are not supported yet‚Äîuse
  `$ARGUMENTS` and parse inside the prompt if you need structured input.
</Note>

---

## 3 ¬∑ Executable commands

Executable files must start with a valid shebang so the CLI can call the interpreter.

```bash
#!/usr/bin/env bash
set -euo pipefail

echo "Preparing $1"
npm install
npm run lint
echo "Ready to deploy $1"
```

- The executable receives the command arguments (`/deploy feature/login` ‚Üí `$1=feature/login`).
- Scripts run from the current working directory and inherit your environment, so they have the same permissions you do.
- Stdout and stderr (up to 64 KB) plus the script contents are posted back to the chat transcript for transparency. Failures still surface their logs.

---

## 4 ¬∑ Managing commands

- **Edit or add** files directly in `.factory/commands`. The CLI rescans on launch; press `R` inside `/commands` to reload without restarting.
- **Import** existing `.agents` or `.claude` commands: open `/commands`, press `I`, select entries, and they copy into your Factory directory.
- **Remove** a command by deleting its file. Since workspace commands win precedence, deleting the repo version reveals the personal fallback if one exists.

---

## 5 ¬∑ Usage patterns

- Keep project workflows under version control inside the repo‚Äôs `.factory/commands` so teammates share the same shortcuts.
- Build idempotent scripts that are safe to rerun; document any cleanup steps in the file itself.
- Use Markdown templates for checklists, code review rubrics, onboarding instructions, or context packets you frequently provide to droid.
- Review executable commands like any other source code‚Äîtreat secrets carefully and prefer referencing environment variables already loaded in your shell.

---

## 6 ¬∑ Examples

### Code review rubric (Markdown)

```md
---
description: Ask droid for a structured code review
argument-hint: <branch-or-PR>
---

Review `$ARGUMENTS` and respond with:

1. **Summary** ‚Äì What changed and why it matters.
2. **Correctness** ‚Äì Tests, edge cases, and regressions to check.
3. **Risks** ‚Äì Security, performance, or migration concerns.
4. **Follow-up** ‚Äì Concrete TODOs for the author.

Include file paths alongside any specific feedback.
```

Invoke with `/review feature/login-flow` to seed droid with a consistent checklist before it inspects the diff.

### Daily standup helper (Markdown)

```md
---
description: Summarize progress for standup
---

Draft a standup update using:

- **Yesterday:** Key wins, merged PRs, or blockers cleared.
- **Today:** Planned work items and their goals.
- **Risks:** Anything at risk of slipping, support needed, or cross-team dependencies.

Keep it to three short bullet sections.
```

Use `/standup` after droid reviews your git history or TODO list to generate a polished update.

### Regression smoke test (Executable)

```bash
#!/usr/bin/env bash
set -euo pipefail

target=${1:-"src"}

echo "Running lint + unit tests for $target"
npm run lint -- "$target"
npm test -- --runTestsByPath "$target"

echo "Collecting git status"
git status --short

echo "Done"
```

Saved as `smoke.sh`, this shows up as `/smoke`. Pass a path (`/smoke src/widgets/__tests__/widget.test.tsx`) to constrain the checks and share the aggregated output with everyone on the thread.

Once set up, custom slash commands compress multi-step prompts or environment setup into a single keystroke, keeping your focus on guiding droid instead of repeating boilerplate.
</file>

<file path="docs/cli/configuration/hooks-guide.mdx">
---
title: "Get started with hooks"
description: "Learn how to customize and extend Droid's behavior by registering shell commands"
---

Droid hooks are user-defined shell commands that execute at various points
in Droid's lifecycle. Hooks provide deterministic control over Droid's behavior, ensuring certain actions always happen rather than relying on
Droid to choose to run them.

<Warning>
  **Experimental Feature**: Hooks are currently experimental. To use hooks:
  1. Run `/settings` command
  2. Navigate to the "Hooks" setting
  3. Toggle it from "Disabled" to "Enabled"
  4. The `/hooks` command will become available after enabling
</Warning>

<Tip>
  For reference documentation on hooks, see [Hooks reference](/reference/hooks-reference).
</Tip>

Example use cases for hooks include:

* **Notifications**: Customize how you get notified when Droid is awaiting
  your input or permission to run something.
* **Automatic formatting**: Run `prettier` on .ts files, `gofmt` on .go files,
  etc. after every file edit.
* **Logging**: Track and count all executed commands for compliance or
  debugging.
* **Feedback**: Provide automated feedback when Droid produces code that
  does not follow your codebase conventions.
* **Custom permissions**: Block modifications to production files or sensitive
  directories.

By encoding these rules as hooks rather than prompting instructions, you turn
suggestions into app-level code that executes every time it is expected to run.

<Warning>
  You must consider the security implication of hooks as you add them, because hooks run automatically during Droid's execution with your current environment's credentials.
  For example, malicious hooks code can exfiltrate your data. Always review your hooks implementation before registering them.

  For full security best practices, see [Security Considerations](/reference/hooks-reference#security-considerations) in the hooks reference documentation.
</Warning>

<Note>
  **Important**: Always use **absolute paths** when referencing scripts in your hook commands, not relative paths. 
  Hooks execute from Droid's current working directory, which may not be your project root. 
  Use `$FACTORY_PROJECT_DIR` for project-relative scripts (e.g., `"$FACTORY_PROJECT_DIR"/.factory/hooks/script.sh`) 
  or full paths for global scripts (e.g., `/usr/local/bin/my-hook.sh` or `~/.factory/hooks/script.sh`).
</Note>

## Hook Events Overview

Droid provides several hook events that run at different points in the
workflow:

* **PreToolUse**: Runs before tool calls (can block them)
* **PostToolUse**: Runs after tool calls complete
* **UserPromptSubmit**: Runs when the user submits a prompt, before Droid processes it
* **Notification**: Runs when Droid sends notifications
* **Stop**: Runs when Droid finishes responding
* **SubagentStop**: Runs when sub-droid tasks complete
* **PreCompact**: Runs before Droid is about to run a compact operation
* **SessionStart**: Runs when Droid starts a new session or resumes an existing session
* **SessionEnd**: Runs when Droid session ends

Each event receives different data and can control Droid's behavior in
different ways.

## Quickstart

In this quickstart, you'll add a hook that logs the shell commands that Droid runs.

### Prerequisites

Install `jq` for JSON processing in the command line.

### Step 1: Open hooks configuration

Run the `/hooks` [slash command](/cli/configuration/custom-slash-commands) and select
the `PreToolUse` hook event.

`PreToolUse` hooks run before tool calls and can block them while providing
Droid feedback on what to do differently.

### Step 2: Add a matcher

Select `+ Add new matcher‚Ä¶` to run your hook only on Bash tool calls.

Type `Bash` for the matcher.

<Note>You can use `*` to match all tools.</Note>

### Step 3: Add the hook

Select `+ Add new hook‚Ä¶` and enter this command:

```bash
jq -r '.tool_input.command' >> ~/.factory/bash-command-log.txt
```

### Step 4: Save your configuration

For storage location, select `User settings` since you're logging to your home
directory. This hook will then apply to all projects, not just your current
project.

Then press Esc until you return to the REPL. Your hook is now registered!

### Step 5: Verify your hook

Run `/hooks` again or check `~/.factory/settings.json` to see your configuration:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.command' >> ~/.factory/bash-command-log.txt"
          }
        ]
      }
    ]
  }
}
```

### Step 6: Test your hook

Ask Droid to run a simple command like `ls` and check your log file:

```bash
cat ~/.factory/bash-command-log.txt
```

You should see entries like:

```
ls
```

## More Examples

<Note>
  For a complete example implementation, see the [bash command validator example](https://github.com/Factory-AI/factory/tree/main/examples/hooks) in our public codebase.
</Note>

### Code Formatting Hook

Automatically format TypeScript files after editing:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | { read file_path; if echo \"$file_path\" | grep -q '\\.ts'; then npx prettier --write \"$file_path\"; fi; }"
          }
        ]
      }
    ]
  }
}
```

### Markdown Formatting Hook

Automatically fix missing language tags and formatting issues in markdown files:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "\"$FACTORY_PROJECT_DIR\"/.factory/hooks/markdown_formatter.py"
          }
        ]
      }
    ]
  }
}
```

Create `.factory/hooks/markdown_formatter.py` with this content:

```python
#!/usr/bin/env python3
"""
Markdown formatter for Droid output.
Fixes missing language tags and spacing issues while preserving code content.
"""
import json
import sys
import re
import os

def detect_language(code):
    """Best-effort language detection from code content."""
    s = code.strip()
    
    # JSON detection
    if re.search(r'^\s*[{\[]', s):
        try:
            json.loads(s)
            return 'json'
        except:
            pass
    
    # Python detection
    if re.search(r'^\s*def\s+\w+\s*\(', s, re.M) or \
       re.search(r'^\s*(import|from)\s+\w+', s, re.M):
        return 'python'
    
    # JavaScript detection  
    if re.search(r'\b(function\s+\w+\s*\(|const\s+\w+\s*=)', s) or \
       re.search(r'=>|console\.(log|error)', s):
        return 'javascript'
    
    # Bash detection
    if re.search(r'^#!.*\b(bash|sh)\b', s, re.M) or \
       re.search(r'\b(if|then|fi|for|in|do|done)\b', s):
        return 'bash'
    
    # SQL detection
    if re.search(r'\b(SELECT|INSERT|UPDATE|DELETE|CREATE)\s+', s, re.I):
        return 'sql'
        
    return 'text'

def format_markdown(content):
    """Format markdown content with language detection."""
    # Fix unlabeled code fences
    def add_lang_to_fence(match):
        indent, info, body, closing = match.groups()
        if not info.strip():
            lang = detect_language(body)
            return f"{indent}```{lang}\n{body}{closing}\n"
        return match.group(0)
    
    fence_pattern = r'(?ms)^([ \t]{0,3})```([^\n]*)\n(.*?)(\n\1```)\s*$'
    content = re.sub(fence_pattern, add_lang_to_fence, content)
    
    # Fix excessive blank lines (only outside code fences)
    content = re.sub(r'\n{3,}', '\n\n', content)
    
    return content.rstrip() + '\n'

# Main execution
try:
    input_data = json.load(sys.stdin)
    file_path = input_data.get('tool_input', {}).get('file_path', '')
    
    if not file_path.endswith(('.md', '.mdx')):
        sys.exit(0)  # Not a markdown file
    
    if os.path.exists(file_path):
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        formatted = format_markdown(content)
        
        if formatted != content:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(formatted)
            print(f"‚úì Fixed markdown formatting in {file_path}")
    
except Exception as e:
    print(f"Error formatting markdown: {e}", file=sys.stderr)
    sys.exit(1)
```

Make the script executable:

```bash
chmod +x .factory/hooks/markdown_formatter.py
```

This hook automatically:

* Detects programming languages in unlabeled code blocks
* Adds appropriate language tags for syntax highlighting
* Fixes excessive blank lines while preserving code content
* Only processes markdown files (`.md`, `.mdx`)

### Custom Notification Hook

Get desktop notifications when Droid needs input:

```json
{
  "hooks": {
    "Notification": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "notify-send 'Droid' 'Awaiting your input'"
          }
        ]
      }
    ]
  }
}
```

### File Protection Hook

Block edits to sensitive files:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "python3 -c \"import json, sys; data=json.load(sys.stdin); path=data.get('tool_input',{}).get('file_path',''); sys.exit(2 if any(p in path for p in ['.env', 'package-lock.json', '.git/']) else 0)\""
          }
        ]
      }
    ]
  }
}
```

## Learn more

* For reference documentation on hooks, see [Hooks reference](/reference/hooks-reference).
* For comprehensive security best practices and safety guidelines, see [Security Considerations](/reference/hooks-reference#security-considerations) in the hooks reference documentation.
* For troubleshooting steps and debugging techniques, see [Debugging](/reference/hooks-reference#debugging) in the hooks reference documentation.
</file>

<file path="docs/cli/configuration/ide-integrations.mdx">
---
title: IDE Integrations
description: Run droid directly inside your editor for richer context and a smoother workflow.
---

Droid works great with any Integrated Development Environment (IDE) that has a terminal. Just run `droid`, and you're ready to go.

In addition, Droid provides a dedicated integration for Visual Studio Code (including popular forks like Cursor, Windsurf, and VSCodium). For JetBrains IDEs such as IntelliJ, PyCharm, Android Studio, WebStorm, PhpStorm, and GoLand, simply run `droid` inside the integrated terminal‚Äîno plugin is required.

## Features

- **Quick launch**: Use keyboard shortcuts to open Droid directly from your editor, or click the Droid button in the UI
- **Diff viewing**: Code changes can be displayed directly in the IDE diff viewer instead of the terminal
- **Selection context**: The current selection/tab in the IDE is automatically shared with Droid
- **File reference shortcuts**: Use keyboard shortcuts to insert file references
- **Diagnostic sharing**: Diagnostic errors (lint, syntax, etc.) from the IDE are automatically shared with Droid as you work

## Installation

### VS Code

To install Droid on VS Code and popular forks like Cursor, Windsurf, and VSCodium:

1. Open VS Code
2. Open the integrated terminal
3. Run `droid` - the extension will auto-install

<Note>
  You can install the [VS Code Extension
  here](https://marketplace.visualstudio.com/items?itemName=Factory.factory-vscode-extension).
</Note>

### JetBrains

Open the integrated terminal in your JetBrains IDE (IntelliJ, PyCharm, Android Studio, WebStorm, PhpStorm, or GoLand) and run `droid`. No additional plugin installation is necessary.

## Usage

### From your IDE

Run `droid` from your IDE's integrated terminal, and all features will be active.

## Troubleshooting

### VS Code extension not installing

- Ensure you're running Droid from VS Code's integrated terminal
- Ensure that the CLI corresponding to your IDE is installed:
  - For VS Code: `code` command should be available
  - For Cursor: `cursor` command should be available
  - For Windsurf: `windsurf` command should be available
  - For VSCodium: `codium` command should be available
  - If not installed, use `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux) and search for "Shell Command: Install 'code' command in PATH" (or the equivalent for your IDE)
- Check that VS Code has permission to install extensions

### JetBrains terminal issues

- Ensure you're running Droid from the project root directory
- Use the integrated terminal inside the IDE rather than an external shell
- Completely restart the IDE if terminal state issues persist

### ESC key configuration

If the ESC key doesn't interrupt Droid operations in JetBrains terminals:

1. Go to Settings ‚Üí Tools ‚Üí Terminal
2. Either:
   - Uncheck "Move focus to the editor with Escape", or
   - Click "Configure terminal keybindings" and delete the "Switch focus to Editor" shortcut
3. Apply the changes

This allows the ESC key to properly interrupt Droid operations.

### Common issues

| Symptom                                   | Fix                                                                                        |
| ----------------------------------------- | ------------------------------------------------------------------------------------------ |
| **"Editor integration disabled" message** | Verify the VS Code extension is installed or update `editorIntegration` to match your editor |
| CLI cannot find Node/Bun                  | Ensure the `droid` binary is on the PATH VS Code/JetBrains uses (restart after install)    |
| Missing file context                      | Save files; unsaved buffers older than 500 KB are skipped for performance                  |
| Stale diagnostics                         | Run **‚Üª Refresh Diagnostics** command (VS Code Command Palette)                            |
| VS Code terminal closes immediately       | Check your shell's startup scripts: they must not auto-exit                                |
| Network blocked in corporate proxy        | Configure proxy variables in settings or set `HTTP_PROXY`/`HTTPS_PROXY` env vars           |

For additional help, email support@factory.ai with logs from `~/.factory/logs/`

## Next steps

<CardGroup cols={2}>
  <Card title="Settings" icon="sliders" href="/cli/configuration/settings">
    Fine-tune thinking budget, tool permissions, and more.
  </Card>
  <Card
    title="Specification Mode"
    icon="list-check"
    href="/cli/user-guides/specification-mode"
  >
    See how editor context improves feature delivery.
  </Card>
</CardGroup>
</file>

<file path="docs/cli/configuration/mcp.mdx">
---
title: 'Model Context Protocol (MCP)'
description: 'Connect your own tools with Model Context Protocol'
---

Model Context Protocol (MCP) servers extend droid's capabilities by providing additional tools and context. Droid offers two ways to manage them: CLI commands for quick setup and scripting, or an interactive UI for browsing and management.

<Note>
  Use CLI commands like `droid mcp add` for quick server setup and automation,
  or use `/mcp` within droid for an interactive visual interface.
</Note>

## Adding Servers

The `droid mcp add` command adds MCP servers to your configuration. Droid supports two types of servers: **http** (remote endpoints) and **stdio** (local processes).

### Adding HTTP Servers

HTTP servers are remote MCP endpoints - the recommended way to connect to cloud services and APIs.

**Syntax:**

```bash
droid mcp add <name> <url> --type http [--header "KEY: VALUE"...]
```

**Arguments:**

- `name` - Unique server identifier
- `url` - HTTP/HTTPS URL of the MCP server
- `--type http` - Required flag to specify HTTP transport
- `--header "KEY: VALUE"` - HTTP headers for authentication (can be used multiple times)

### Popular HTTP MCP Servers

#### Development & Testing

**Sentry** - Monitor errors, debug production issues

```bash
droid mcp add sentry https://mcp.sentry.dev/mcp --type http
```

**Hugging Face** - Access Hugging Face Hub and Gradio AI applications

```bash
droid mcp add hugging-face https://huggingface.co/mcp --type http
```

**Socket** - Security analysis for dependencies

```bash
droid mcp add socket https://mcp.socket.dev/ --type http
```

#### Project Management & Documentation

**Notion** - Read docs, update pages, manage tasks

```bash
droid mcp add notion https://mcp.notion.com/mcp --type http
```

**Linear** - Issue tracking and project management

```bash
droid mcp add linear https://mcp.linear.app/mcp --type http
```

**Intercom** - Access customer conversations and tickets

```bash
droid mcp add intercom https://mcp.intercom.com/mcp --type http
```

**Monday** - Manage monday.com boards and items

```bash
droid mcp add monday https://mcp.monday.com/mcp --type http
```

#### Payments & Commerce

**Stripe** - Payment processing and subscriptions

```bash
droid mcp add stripe https://mcp.stripe.com --type http
```

**PayPal** - PayPal commerce and payment processing

```bash
droid mcp add paypal https://mcp.paypal.com/mcp --type http
```

#### Design & Media

**Figma** - Generate code with Figma context

```bash
droid mcp add figma https://mcp.figma.com/mcp --type http
```

**Canva** - Browse, summarize, and generate Canva designs

```bash
droid mcp add canva https://mcp.canva.com/mcp --type http
```

**TwelveLabs** - Video analysis, search, and AI-powered insights

```bash
droid mcp add twelvelabs-mcp https://mcp.twelvelabs.io --type http \
  --header "x-api-key: YOUR_TWELVELABS_API_KEY"
```

#### Infrastructure & DevOps

**Netlify** - Create, deploy, and manage websites

```bash
droid mcp add netlify https://netlify-mcp.netlify.app/mcp --type http
```

**Vercel** - Manage projects, deployments, and logs

```bash
droid mcp add vercel https://mcp.vercel.com/ --type http
```

**Stytch** - Configure authentication services

```bash
droid mcp add stytch http://mcp.stytch.dev/mcp --type http
```

<Tip>
  Many HTTP servers require OAuth authentication. After adding, use the
  interactive `/mcp` UI to complete the authentication flow.
</Tip>

### Adding Stdio Servers

Stdio servers run as local processes on your machine - ideal for tools that need direct system access.

**Syntax:**

```bash
droid mcp add <name> "<command>" [--env KEY=VALUE...]
```

**Arguments:**

- `name` - Unique server identifier
- `command` - Command to start the server (quote if it contains spaces)
- `--env KEY=VALUE` - Environment variables (can be used multiple times)

### Popular Stdio MCP Servers

**Airtable** - Read/write records, manage bases and tables

```bash
droid mcp add airtable "npx -y airtable-mcp-server" \
  --env AIRTABLE_API_KEY=your_key
```

**ClickUp** - Task management and project tracking

```bash
droid mcp add clickup "npx -y @hauptsache.net/clickup-mcp" \
  --env CLICKUP_API_KEY=your_key \
  --env CLICKUP_TEAM_ID=your_team_id
```

**HubSpot** - Access and manage CRM data

```bash
droid mcp add hubspot "npx -y @hubspot/mcp-server" \
  --env HUBSPOT_ACCESS_TOKEN=your_token
```

## Removing Servers

Remove a server from your configuration:

```bash
droid mcp remove <name>
```

**Example:**

```bash
droid mcp remove notion
```

## Managing Servers

Type `/mcp` within droid to open an interactive UI for managing MCP servers.
- See all configured servers with status
- View all tools provided by each server
- Authenticate remote servers that require OAuth authentication
- Add/remove and enable/disable servers

## Configuration

MCP server configurations are stored in `~/.factory/mcp.json`. The configuration includes:

- **Name**: Unique identifier for the server
- **Type**: Server type (`stdio` or `http`)
- **Stdio settings**: `command`, `args`, `env` (environment variables)
- **HTTP settings**: `url`, `headers` (for authentication)
- **Disabled**: Boolean flag to temporarily disable a server

Droid automatically reloads when the configuration file changes, so servers are immediately available after adding them.
</file>

<file path="docs/cli/configuration/mixed-models.mdx">
---
title: Mixed Models
description: Use a different AI model for Specification Mode planning than your default model for maximum flexibility and optimization.
---

## What are mixed models?

Mixed models allow you to use a different AI model specifically for Specification Mode planning while keeping a separate default model for regular coding sessions. This gives you the flexibility to optimize both planning and implementation phases independently.

For example, you might want to use a more powerful model for comprehensive specification planning, while using a faster model for day-to-day implementation work.

---

## Why use mixed models?

Different models excel at different tasks. Separating your spec mode model from your default model lets you:

<CardGroup cols={2}>
  <Card title="Optimize for Planning" icon="brain">
    Use a more thorough, analytical model for specification planning that considers edge cases and architectural decisions.
  </Card>
  <Card title="Balance Speed & Cost" icon="gauge">
    Keep a faster, more economical model for regular coding while reserving powerful models for critical planning phases.
  </Card>
  <Card title="Match Task Complexity" icon="layer-group">
    Complex features benefit from advanced reasoning during planning, while simpler tasks can use standard models.
  </Card>
  <Card title="Flexible Workflows" icon="shuffle">
    Switch between different model combinations to find what works best for your specific use cases.
  </Card>
</CardGroup>

---

## How to configure mixed models

### Accessing the Configuration

1. Run `droid` to start the CLI
2. Enter `/model` to open the model selector
3. Navigate to **"Configure Spec Mode Model"** (first option in the list)
4. Press **Enter** to begin configuration

### Configuration Options

When you open the configurator, you'll see three options:

- **Yes, configure spec mode model** - Select a different model for Specification Mode
- **No, keep using [current configuration/main model]** - Exit without making changes
- **Clear spec mode model (use main model)** - Remove the spec mode model and use your default model for everything *(only shown if you already have a spec mode model configured)*

### Selecting a Model

1. Choose **"Yes, configure spec mode model"**
2. Browse the list of available models
3. Select your preferred model for Specification Mode
4. If the model supports reasoning, choose your reasoning effort level
5. The configuration is saved automatically

<Note>
  Only compatible models will be available in the selector based on your current default model. See [Model Compatibility](#model-compatibility) below.
</Note>

---

## Model Compatibility

Not all model combinations work together due to how different AI providers handle reasoning traces and context. Here are the compatibility rules:

### Compatibility Rules

<AccordionGroup>
  <Accordion title="OpenAI Models">
    **OpenAI models can only pair with other OpenAI models**
    
    - Main model: GPT-5 ‚Üí Spec model: GPT-5-Codex ‚úÖ
    - Main model: GPT-5 ‚Üí Spec model: Sonnet 4.5 ‚ùå
    
    OpenAI's internal reasoning format is encrypted and is incompatible with other model providers.
  </Accordion>
  
  <Accordion title="Anthropic Models with Reasoning">
    **Anthropic models with reasoning enabled can only pair with other Anthropic models**
    
    - Main model: Sonnet 4.5 (reasoning on) ‚Üí Spec model: Sonnet 4.5 ‚úÖ
    - Main model: Sonnet 4.5 (reasoning on) ‚Üí Spec model: GPT-5 ‚ùå
    
    When extended thinking is active, reasoning traces must stay within the same provider.
  </Accordion>
  
  <Accordion title="Anthropic Models without Reasoning">
    **Anthropic models with reasoning off can pair with non-OpenAI models**
    
    - Main model: Sonnet 4.5 (reasoning off) ‚Üí Spec model: Any non-OpenAI model ‚úÖ
    - Main model: Sonnet 4.5 (reasoning off) ‚Üí Spec model: DeepSeek ‚úÖ
    
    Without reasoning enabled, cross-provider compatibility is possible.
  </Accordion>
</AccordionGroup>

<Info>
  **Why these restrictions?** Model providers encrypt their reasoning traces differently. When reasoning is active, the spec model must be able to read and continue the reasoning chain from the main model, which requires matching providers.
</Info>

---

## Reasoning Effort Configuration

If you select an Anthropic model that supports reasoning (like Sonnet 4.5), you'll be prompted to choose a reasoning effort level:

- **Off** - No extended thinking, faster responses
- **Low** - Brief consideration, balanced speed and depth
- **Medium** - Moderate thinking time for complex decisions
- **High** - Deep analysis for critical architectural choices

The reasoning effort for your spec mode model is independent of your default model's reasoning setting, giving you complete control over each phase.

<Tip>
  For specification planning, **Medium** or **High** reasoning effort often produces better results since thorough analysis during planning prevents issues during implementation.
</Tip>

---

## Common Configurations

Here are some effective model combinations for different scenarios:

### Anthropic Models

**Best for:** Most development workflows, flexible reasoning control

- **Default model:** Haiku 4.5 or Sonnet 4.5 (select reasoning of your choice if supported)
- **Spec mode model:** Sonnet 4.5 (reasoning: high)
- **Benefits:** Fast implementation with deep planning analysis

### OpenAI Models

**Best for:** Teams using OpenAI models exclusively, cost-conscious projects

- **Default model:** GPT-5-Codex
- **Spec mode model:** GPT-5 (high reasoning)
- **Benefits:** Consistent reasoning format, specialized coding model for specs

---

## How It Works

Once configured, Droid automatically uses your spec mode model whenever you enter Specification Mode:

1. **Activate Specification Mode** with **Shift+Tab**
2. **Provide your feature description**
3. **Droid uses your spec mode model** to analyze, plan, and generate the specification
4. **Review and approve** the generated spec
5. **Implementation uses your default model** to write the actual code

<Note>
  Your default model is always used for regular coding sessions and implementation work. The spec mode model is only active during the planning phase of Specification Mode.
</Note>

---

## Checking Your Configuration

To see which models you're currently using:

1. Enter `/model` in the CLI
2. Your current default model is highlighted
3. If you have a spec mode model configured, it's displayed at the top of the selector

---

## Clearing your mixed models configuration

If you want to go back to using a single model for everything:

1. Enter `/model` in the CLI
2. Navigate to **"Configure Spec Mode Model"**
3. Press **Enter**
4. Select **"Clear spec mode model (use main model)"**
5. Confirm by pressing **Enter**

Your default model will now be used for both regular coding and Specification Mode.

---

## Best Practices

<AccordionGroup>
  <Accordion title="Start with the same model">
    If you're new to Specification Mode, start by using your default model for both modes. Once you're comfortable, experiment with different spec mode models to see if it improves your planning quality.
  </Accordion>
  
  <Accordion title="Consider your project complexity">
    Simple projects may not need separate models. For complex systems with intricate dependencies, using a more powerful spec mode model can prevent costly mistakes during implementation.
  </Accordion>
  
  <Accordion title="Match reasoning to task importance">
    Use higher reasoning effort for architectural decisions and lower effort for routine feature additions. Adjust both your default and spec mode reasoning independently.
  </Accordion>
  
  <Accordion title="Respect compatibility rules">
    Don't try to force incompatible model combinations. The restrictions exist for good technical reasons and violations will be prevented by the CLI.
  </Accordion>
  
  <Accordion title="Monitor your usage">
    More powerful models and higher reasoning efforts increase cost. Balance quality needs with budget constraints by using premium configurations selectively.
  </Accordion>
</AccordionGroup>

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="Can't select the model I want">
    **Cause:** The model is incompatible with your current default model.
    
    **Solution:** Check the [Model Compatibility](#model-compatibility) rules above. You may need to change your default model first, or adjust reasoning settings to enable compatibility.
  </Accordion>
  
  <Accordion title="Spec mode model was automatically cleared">
    **Cause:** You changed your default model to one that's incompatible with your configured spec mode model.
    
    **Solution:** This is expected behavior. Configure a new spec mode model that's compatible with your new default model, or continue using the default model for both modes.
  </Accordion>
  
  <Accordion title="Reasoning effort selector doesn't appear">
    **Cause:** The selected model doesn't support reasoning, or you're using a non-Anthropic model combination.
    
    **Solution:** This is normal. Not all models support reasoning configuration. The model will use its default behavior.
  </Accordion>
</AccordionGroup>

---

## Related Resources

<CardGroup cols={2}>
  <Card title="Specification Mode" icon="file-contract" href="/cli/user-guides/specification-mode">
    Learn how to use Specification Mode for planning and implementing features.
  </Card>
  <Card title="Settings" icon="gear" href="/cli/configuration/settings">
    Configure other aspects of how Droid behaves and integrates with your workflow.
  </Card>
  <Card title="Choosing Your Model" icon="brain" href="/cli/user-guides/choosing-your-model">
    Understand the differences between available models and how to choose the right one.
  </Card>
  <Card title="BYOK" icon="key" href="/cli/byok/overview">
    Bring your own API keys to use custom models with Factory.
  </Card>
</CardGroup>

---
</file>

<file path="docs/cli/configuration/settings.mdx">
---
title: Settings
description: Configure how droid behaves and integrates with your workflow.
---

## Accessing settings

To configure droid settings:

1. Run `droid`
2. Enter `/settings`
3. Adjust your preferences interactively

Changes take effect immediately and are saved to your settings file.

## Where settings live

| OS        | Location                               |
| --------- | -------------------------------------- |
| macOS / Linux | `~/.factory/settings.json` |
| Windows   | `%USERPROFILE%\.factory\settings.json` |

If the file doesn't exist, it's created with defaults the first time you run **droid**.

## Available settings

| Setting | Options | Default | Description |
| ------- | ------- | ------- | ----------- |
| `model` | `sonnet`, `opus`, `GPT-5`, `gpt-5-codex`, `haiku`, `droid-core`, `custom-model` | `sonnet` | The default AI model used by droid |
| `reasoningEffort` | `off`, `none`, `low`, `medium`, `high` (availability depends on the model) | Model-dependent default | Controls how much structured thinking the model performs. |
| `autonomyLevel` | `normal`, `spec`, `auto-low`, `auto-medium`, `auto-high` | `normal` | Sets the default autonomy mode when starting droid. |
| `cloudSessionSync` | `true`, `false` | `true` | Mirror CLI sessions to Factory web. |
| `diffMode` | `github`, `unified` | `github` | Choose between split GitHub-style diffs and a single-column view. |
| `completionSound` | `off`, `bell` | `off` | Audio cue when a response finishes. |
| `commandAllowlist` | Array of commands | Safe defaults provided | Commands that run without extra confirmation. |
| `commandDenylist` | Array of commands | Restrictive defaults provided | Commands that always require confirmation. |
| `includeCoAuthoredByDroid` | `true`, `false` | `true` | Automatically append the Droid co-author trailer to commits. |
| `enableDroidShield` | `true`, `false` | `true` | Enable secret scanning and git guardrails. |
| `specSaveEnabled` | `true`, `false` | `false` | Persist spec outputs to disk. |
| `specSaveDir` | File path | `.factory/docs` | Directory used when `specSaveEnabled` is `true`. |
| `enableCustomDroids` | `true`, `false` | `false` | Toggle the experimental Custom Droids feature. |

### Model

Choose the default AI model that powers your droid:

- **`sonnet`** - Claude Sonnet 4.5 (recommended, current default)
- **`opus`** - Claude Opus 4.1 for complex tasks
- **`GPT-5`** - Latest OpenAI model
- **`gpt-5-codex`** - Advanced coding-focused model
- **`haiku`** - Claude Haiku 4.5, fast and cost-effective
- **`droid-core`** - GLM-4.6 open-source model
- **`custom-model`** - Your own configured model via BYOK

[You can also add custom models and BYOK.](/cli/configuration/byok)

### Reasoning effort

`reasoningEffort` adjusts how much structured thinking the model performs before replying. Available values depend on the model, but typically include:

- **`off` / `none`** ‚Äì disable structured reasoning (fastest).
- **`low`**, **`medium`**, **`high`** ‚Äì progressively increase deliberation time for more complex reasoning.

Anthropic models default to `off`, while GPT-5 starts on `medium`.

### Autonomy level

`autonomyLevel` controls how proactively droid executes commands when sessions begin. Start at `normal`, or select an `auto-*` preset to pre-authorize additional actions.

### Diff mode

Control how droid displays code changes:

- **`github`** ‚Äì Side-by-side, higher fidelity render (recommended).
- **`unified`** ‚Äì Traditional single-column diff format.

### Cloud session sync

When this switch is on, every CLI session is mirrored to Factory web so you can revisit conversations in the browser:

- **`true`** ‚Äì Sync sessions to the web app.
- **`false`** ‚Äì Keep sessions local only.

### Sound notifications

Configure audio feedback when droid completes a response:

- **`bell`** ‚Äì Use the system terminal bell
- **`off`** ‚Äì No sound notifications

<Note>
  Access sound settings via `/settings` or `Shift+Tab` ‚Üí **Settings** in the TUI.
</Note>

## Command allowlist & denylist

Use these settings to control which commands droid can execute automatically and which it must never run:

- **`commandAllowlist`** ‚Äì Commands in this array are treated as safe and run without additional confirmation, regardless of autonomy prompts. Include only low-risk utilities you rely on frequently (for example `ls`, `pwd`, `dir`).
- **`commandDenylist`** ‚Äì Commands in this array always require confirmation and are typically blocked because they are destructive or unsafe (for example recursive `rm`, `mkfs`, or privileged system operations).

Commands that appear in both lists default to the denylist behavior. Any command that is in neither list falls back to the autonomy level you selected for the session.

### Example allow/deny configuration

```json
{
  "commandAllowlist": [
    "ls",
    "pwd",
    "dir"
  ],
  "commandDenylist": [
    "rm -rf /",
    "mkfs",
    "shutdown"
  ]
}
```

Review and update these arrays periodically to match your workflow and security posture, especially when sharing configurations across teams.

## Example configuration

```json
{
  "model": "sonnet",
  "reasoningEffort": "low",
  "diffMode": "github",
  "cloudSessionSync": true,
  "completionSound": "bell"
}
```

---

### Need more?

- [CLI Overview](/cli/getting-started/overview) ‚Äì see the main TUI workflow
- [CLI Reference](/reference/cli-reference) ‚Äì command flags & options
- [IDE Integrations](/cli/configuration/ide-integrations) ‚Äì editor-specific setup
- [Custom models & BYOK](/cli/configuration/byok) - add custom models and API keys
</file>

<file path="docs/cli/configuration/skills.mdx">
---
title: Skills
description: Capture the way your engineering org wants work done and package it as reusable capabilities Droids can invoke on demand.
---

Skills are how you turn a general-purpose Droid into **a specialist teammate that follows your engineering playbook every time**.

Instead of re-explaining the same workflows in every prompt, you capture them once as a skill: a reusable bundle of **capability + context + guardrails** that Droids can invoke as part of a larger plan.

Use skills when you want the agent to:

- **Behave like your team** ‚Äì follow your architecture, testing, security, and rollout norms by default.
- **Be consistent across sessions** ‚Äì run the same playbook every time you ask for "frontend change" or "new service integration".
- **Scale safely** ‚Äì let more people use automation without needing to be experts in the codebase or infrastructure.

## What is a skill?

At the file-system level, a skill is a **directory** (e.g. `.factory/skills/frontend-ui-integration/`) that contains:

- A primary spec like `SKILL.md` or `skill.mdx` with frontmatter + markdown instructions
- Optional supporting files (types, schemas, checklists) that the Droid can read when the skill is active

Conceptually, each skill defines:

- **What problem it solves** ‚Äì e.g., "add a typed React surface for an existing API" or "wire a service into our event bus".
- **What inputs it expects** ‚Äì feature description, services, APIs, time ranges, risk level, etc.
- **What success looks like** ‚Äì required artifacts, tests, verification commands, and safety checks.

Skills are **model-invoked**: the Droid decides when to use them based on the skill description and the current task, rather than you typing a specific command.

## Skill file format

Skills are defined in Markdown with YAML frontmatter. A small, focused skill can be just a short `SKILL.md`:

```md
---
name: summarize-diff
description: Summarize the staged git diff in 3‚Äì5 bullets. Use when the user asks for a summary of pending changes.
---

# Summarize Diff

## Instructions

1. Run `git diff --staged`.
2. Summarize the changes in 3‚Äì5 bullets, focusing on user-visible behavior.
3. Call out any migrations, risky areas, or tests that should be run.
```

You can also include additional frontmatter fields such as `allowed-tools` in future iterations; for now, `name` and `description` are the key fields that help Droids discover and use your skill.

## Where skills live

Skills are discovered from a small set of well-known locations:

| Scope         | Location                            | Purpose                                                                 |
| ------------- | ----------------------------------- | ----------------------------------------------------------------------- |
| **Workspace** | `<repo>/.factory/skills/`           | Project skills shared with teammates; checked into git.                 |
| **Personal**  | `~/.factory/skills/`                | Private skills that follow you across projects on your machine.         |

Each **skill** lives in its own directory under one of these roots:

- Workspace: `<repo>/.factory/skills/<skill-name>/SKILL.md`
- Personal: `~/.factory/skills/<skill-name>/SKILL.md`

In large monorepos, you can either:

- Keep a **single, shared** skills folder at the root:

  ```text
  .factory/skills/
    frontend/
      SKILL.md
    payments-service/
      SKILL.md
    data-warehouse-querying/
      SKILL.md
  ```

- Or add **per-project** `.factory` folders so skills live alongside each subproject:

  ```text
  services/payments/.factory/skills/
    payments-service/
      SKILL.md
  apps/frontend/.factory/skills/
    dashboard-ui/
      SKILL.md
  ```

Project skills are the primary way to share and standardize capabilities inside an engineering org; personal skills are ideal for individual workflows or experiments.

## Quickstart

<Steps>
  <Step title="Create a skill folder">
    Under your repo, create a directory in `.factory/skills/`, for example
    `.factory/skills/frontend-ui-integration/`.
  </Step>
  <Step title="Add SKILL.md or skill.mdx">
    Inside the folder, create `SKILL.md` or `skill.mdx` with YAML frontmatter
    (`name`, `description`) and markdown instructions that define the
    capability, inputs, and success criteria.
  </Step>
  <Step title="Add supporting files (optional)">
    Co-locate any types, schemas, or checklists the Droid should use when the
    skill is active (for example `types.ts`, `schemas/`, or
    `rollout-checklist.md`).
  </Step>
  <Step title="Restart and use">
    Restart `droid` or your integration so it rescans skills, then describe
    your task normally. The Droid will automatically invoke matching skills
    when they apply.
  </Step>
</Steps>

## How skills differ from other configuration

Skills sit alongside other ways of shaping Droid behavior:

- **Custom droids** ‚Äì define *which* model and tools to use and at what autonomy level; they are full agent configurations.
- **Custom slash commands** ‚Äì are **user-invoked** macros you call explicitly (e.g., `/review-pr`); they don‚Äôt automatically trigger based on the task.
- **MCP servers** ‚Äì expose external systems (APIs, databases, SaaS tools) as tools; they are about *connecting* resources, not encoding your workflow.

Skills are different because they:

- Package **how work should be done** (your engineering playbook) as reusable capabilities.
- Are **discoverable and composable** ‚Äì the Droid can chain multiple skills inside a plan.
- Can sit on top of tools, custom droids, and MCP servers to orchestrate them safely.

In practice you might:

- Use MCP to expose your internal deployment API.
- Use a custom droid to define which tools/models are allowed in CI.
- Use a skill to encode "how to safely roll out a canary deployment" using that API and droid configuration.

## Why skills matter in enterprise codebases

Skills are especially valuable in enterprise environments where you need to:

- Standardize how Droids do **frontend implementation, service integrations, data querying, and internal tools**.
- Encode **team conventions, safety rules, and SLAs** once, then reuse them across projects.
- Make automation **discoverable, auditable, and shareable** via git, not just "whatever happened in one chat".

You can create skills from scratch for Factory, or reuse existing skills you already invested in for other agents by importing them and wiring them into your droid configuration.


# Best practices

<AccordionGroup>
  <Accordion title="Keep each skill narrow and outcome-focused">
    Design skills around a **single responsibility** (e.g., "implement a typed
    React UI for an existing endpoint"), not "build the whole feature".
    Define a **crisp success criterion**: what artifacts should exist when the
    skill finishes (files changed, tests added, docs updated, approvals
    gathered). Prefer several small skills composed by a Droid over one giant
    "do everything" skill.
  </Accordion>

  <Accordion title="Make inputs explicit and structured">
    Document required inputs: repo path, services involved, APIs, schemas,
    feature flag names, etc. Use **structured fields** (JSON snippets, bullet
    lists, tables) instead of long prose when describing APIs or data models.
    For security-sensitive workflows, include explicit **"never do"**
    constraints and escalation conditions.
  </Accordion>

  <Accordion title="Encode team conventions and guardrails">
    Bake in your **testing, observability, and rollout requirements** so the
    skill always follows them. Reference your existing **AGENTS.md**, runbooks,
    and design docs instead of inlining everything. Require **proof
    artifacts**: tests, screenshots, log queries, or links to dashboards
    depending on the domain.
  </Accordion>

  <Accordion title="Design for enterprise constraints">
    Assume **large monorepos, multiple services, and layered approvals**. Be
    explicit about **which directories** Droids may touch, which
    languages/frameworks are in-bounds, and which are not. Include guidance for
    **cross-team dependencies** ‚Äì when to stub, when to coordinate with
    another team, and when to stop and ask.
  </Accordion>

  <Accordion title="Make skills composable">
    Prefer **idempotent** skills: safe to rerun on the same branch/PR. Design
    skills to produce **machine-parseable output** where possible (for example,
    a short summary block that other skills can consume). Keep skills
    **stateless** beyond the current branch: no hidden assumptions about prior
    runs.
  </Accordion>

  <Accordion title="Operate with verification and safety">
    Always include a **"Verification"** section that lists commands Droids
    must run before completing the skill. Call out **fallbacks** when
    verification fails (rollback steps, feature flags, or canary paths). For
    production-adjacent skills, require that Droids **open PRs but never
    merge** without human review.
  </Accordion>
</AccordionGroup>


## Cookbook

The cookbook provides opinionated skill templates aimed at common enterprise software workflows.

We focus on four families of skills:

1. **Frontend implementation skills** ‚Äì building UI surfaces that integrate with existing APIs
2. **Integration skills for complex codebases** ‚Äì extending or wiring together services in large monorepos
3. **Internal data querying skills** ‚Äì safe, auditable access to internal analytics or data services
4. **Internal tools skills** ‚Äì building small but robust internal apps that improve developer and operator workflows

See the following examples:

- `cli/configuration/skills/frontend-ui-integration` ‚Äì Frontend skill for implementing a typed UI workflow against an existing backend API
- `cli/configuration/skills/service-integration` ‚Äì Skill for extending an existing service and wiring it into a complex monorepo
- `cli/configuration/skills/data-querying` ‚Äì Skill for safely querying internal data services and producing shareable artifacts
- `cli/configuration/skills/internal-tools` ‚Äì Skill for building or extending internal tools (admin panels, support consoles, engineering utilities)

<CardGroup cols={2}>
  <Card
    title="Frontend UI integration"
    href="/cli/configuration/skills/frontend-ui-integration"
    icon="layout"
  >
    Implement typed, tested frontend flows against existing backend APIs using
    your design system, routing, and testing conventions.
  </Card>
  <Card
    title="Service integration in complex codebases"
    href="/cli/configuration/skills/service-integration"
    icon="layers"
  >
    Extend or wire backend services in a shared monorepo while respecting
    ownership boundaries, observability, and rollout requirements.
  </Card>
  <Card
    title="Internal data querying"
    href="/cli/configuration/skills/data-querying"
    icon="database"
  >
    Safely query internal analytics and data services, producing reproducible
    queries and shareable analysis artifacts.
  </Card>
  <Card
    title="Internal tools"
    href="/cli/configuration/skills/internal-tools"
    icon="settings"
  >
    Build or extend internal-facing tools (admin panels, consoles, utilities)
    with strong RBAC, audit logging, and operational safeguards.
  </Card>
</CardGroup>

In practice, each skill folder can also contain **supporting utilities** the agent may use alongside the core prompt template ‚Äì for example:

- `SKILL.md` or `skill.mdx` ‚Äì the main skill specification
- `references.md` ‚Äì links and pointers to types, APIs, and modules that already exist in your codebase
- `schemas/` ‚Äì JSON/YAML schemas or OpenAPI snippets referenced by the skill (not the source-of-truth service code)
- `checklists.md` ‚Äì reusable validation or rollout checklists

These co-located files give the agent a predictable, structured bundle of context to work from when the skill is invoked, without duplicating or relocating production code.

Use these as starting points and adapt the inputs, constraints, and verification steps to match your stack and governance requirements.
</file>

<file path="docs/cli/droid-exec/cookbook/code-review.mdx">
---
title: Automated Code Review
description: Automate pull request reviews using Droid Exec in GitHub Actions
---

This tutorial shows you how to set up automated code review using Droid Exec in GitHub Actions. The workflow will analyze pull requests, identify issues, and post feedback as inline comments.

<Info>
Unlike interactive CLI sessions, Droid Exec runs in headless mode, making it perfect for CI/CD automation. The agent analyzes code changes, identifies issues, and submits review feedback directly via GitHub CLI.
</Info>

## How it works

The workflow:

1.  Triggers on pull request events
2.  Checks out the PR and installs the Droid CLI
3.  Configures git identity
4.  Runs Droid Exec to fetch PR data and submit review comments via GitHub CLI
5.  Uploads debug artifacts on failure

<div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
  <div style={{ flex: '1', minWidth: '300px' }}>
    <img src="./code-review-picture-1.png" alt="Droid Exec posting inline comments on PR with detected issues" />
  </div>
  <div style={{ flex: '1', minWidth: '300px' }}>
    <img src="./code-review-picture-2.png" alt="Droid Exec approval comment on clean PR" />
  </div>
</div>

<Accordion title="Full Workflow File">
````yaml
name: Droid Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

concurrency:
  group: droid-review-${{ github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  pull-requests: write
  contents: read
  issues: write

jobs:
  code-review:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    # Skip automated code review for draft PRs
    if: github.event.pull_request.draft == false

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Install Droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          "$HOME/.local/bin/droid" --version

      - name: Configure git identity
        run: |
          git config user.name "Droid Agent"
          git config user.email "droidagent@factory.ai"

      - name: Perform automated code review
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          cat > prompt.txt << 'EOF'
          You are an automated code review system. Review the PR diff and identify clear issues that need to be fixed.

          First, use the Web Fetch tool to get the full PR context from: https://github.com/${{ github.repository }}/pull/${{ github.event.pull_request.number }}

          This will provide you with:
          - PR title, description, and metadata
          - Complete diff with line numbers for positioning comments
          - Changed files with their status
          - Existing comments and review threads (to avoid duplicates)

          Task: After fetching the PR data, review the code changes and directly submit your findings using the GitHub CLI.

          Focus on these types of issues:
          - Dead/unreachable code (if (false), while (false), code after return/throw/break)
          - Broken control flow (missing break in switch, fallthrough bugs)
          - Async/await mistakes (missing await, .then without return, unhandled promise rejections)
          - Array/object mutations in React components or reducers
          - UseEffect dependency array problems (missing deps, incorrect deps)
          - Incorrect operator usage (== vs ===, && vs ||, = in conditions)
          - Off-by-one errors in loops or array indexing
          - Integer overflow/underflow in calculations
          - Regex catastrophic backtracking vulnerabilities
          - Missing base cases in recursive functions
          - Incorrect type coercion that changes behavior
          - Environment variable access without defaults or validation
          - Null/undefined dereferences
          - Resource leaks (unclosed files or connections)
          - SQL/XSS injection vulnerabilities
          - Concurrency/race conditions
          - Missing error handling for critical operations

          Comment format:
          - Clearly describe the issue: "This code block is unreachable due to the if (false) condition"
          - Provide a concrete fix: "Remove this entire if block as it will never execute"
          - When possible, suggest the exact code change:
            ```
            // Remove the unreachable code
            ```
          - Be specific about why it's a problem: "This will cause a TypeError if input is null"
          - No emojis, just clear technical language

          Skip commenting on:
          - Code style, formatting, or naming conventions
          - Minor performance optimizations
          - Architectural decisions or design patterns
          - Features or functionality (unless broken)
          - Test coverage (unless tests are clearly broken)

          You may open and read other repository files beyond those listed above when it helps you understand the change, but keep all review comments anchored to the modified lines in this PR.

          Use the fetched PR data to:
          - Avoid repeating resolved issues unless the problem still exists.
          - Reference ongoing discussions when adding a follow-up or clarification.
          - Prefer replying to existing open threads instead of creating duplicates when addressing the same code.
          - Ignore your own previous comments that have been resolved unless the underlying issue is still present.

          Position calculation:
          - Use the line position from the diff data fetched from the PR
          - This is the line number in the diff, not the absolute file line
          - Comments must align with exact changed lines only

          How to submit your review:
          Use the GitHub CLI (gh) to submit your review. Run "gh --help" and explore the available commands to understand how to:
          - Submit PR reviews with inline comments
          - Reply to existing review comments
          - Post general PR comments when no issues are found

          The PR number is ${{ github.event.pull_request.number }} and repository is ${{ github.repository }}.

          Guidelines:
          - Submit at most 10 comments total, prioritizing the most critical issues
          - Each comment should be actionable and clear about what needs to be fixed
          - Check for existing "no issues" comments from bots before posting duplicate messages
          - Include a summary in the review body when submitting multiple inline comments
          EOF

          # Run droid exec with the prompt - it will handle PR review submission directly
          echo "Running code review analysis and submitting results..."
          droid exec --auto high --model claude-sonnet-4-5-20250929 -f prompt.txt

      - name: Upload debug artifacts on failure
        if: ${{ failure() }}
        uses: actions/upload-artifact@v4
        with:
          name: droid-review-debug-${{ github.run_id }}
          path: |
            prompt.txt
            ${{ runner.home }}/.factory/logs/droid-log-single.log
            ${{ runner.home }}/.factory/logs/console.log
          if-no-files-found: ignore
          retention-days: 7
````
</Accordion>

## Prerequisites

<Steps>
  <Step title="GitHub Repository">
    Ensure you have a GitHub repository with Actions enabled
  </Step>
  
  <Step title="Get Factory API Key">
    Generate your API key from the [Factory Settings Page](https://app.factory.ai/settings/api-keys)
  </Step>
  
  <Step title="GitHub Actions Knowledge">
    Basic understanding of GitHub Actions workflows
  </Step>
</Steps>

## Configure authentication

Add your Factory API key as a repository secret:

1.  Go to your repository's Settings ‚Üí Secrets and variables ‚Üí Actions
2.  Click "New repository secret"
3.  Name: `FACTORY_API_KEY`
4.  Value: Your Factory API key (starts with `fk-`)

## Build the GitHub Actions workflow

Let's build the workflow step by step to understand each component.

### Set up the workflow trigger

Create `.github/workflows/droid-code-review.yml` and configure when it should run:

```yaml
name: Droid Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

concurrency:
  group: droid-review-${{ github.event.pull_request.number }}
  cancel-in-progress: true
```

The `concurrency` group ensures only one review runs per PR at a time, canceling outdated runs when new commits are pushed.

### Configure workflow permissions

Define the top-level permissions and job details used by the workflow:

```yaml
permissions:
  pull-requests: write
  contents: read
  issues: write

jobs:
  code-review:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    # Skip draft PRs to avoid noise during development
    if: github.event.pull_request.draft == false

```

### Checkout the repository

Add the checkout step to access the PR code:

```yaml
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for accurate diffs
          ref: ${{ github.event.pull_request.head.sha }}
```

### Install Droid CLI

Install the Droid CLI in the runner:

```yaml
      - name: Install Droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          "$HOME/.local/bin/droid" --version
```

### Configure git identity

Set the git username and email so review comments originate from the expected bot account:

```yaml
      - name: Configure git identity
        run: |
          git config user.name "Droid Agent"
          git config user.email "droidagent@factory.ai"
```

### Run the automated review

Craft a detailed prompt and execute Droid Exec to fetch PR data and submit review comments directly. The command relies on both `FACTORY_API_KEY` and `GITHUB_TOKEN` secrets:

````yaml
      - name: Perform automated code review
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          cat > prompt.txt << 'EOF'
          You are an automated code review system. Review the PR diff and identify clear issues that need to be fixed.

          First, use the Web Fetch tool to get the full PR context from: https://github.com/${{ github.repository }}/pull/${{ github.event.pull_request.number }}

          This will provide you with:
          - PR title, description, and metadata
          - Complete diff with line numbers for positioning comments
          - Changed files with their status
          - Existing comments and review threads (to avoid duplicates)

          Task: After fetching the PR data, review the code changes and directly submit your findings using the GitHub CLI.

          Focus on these types of issues:
          - Dead/unreachable code (if (false), while (false), code after return/throw/break)
          - Broken control flow (missing break in switch, fallthrough bugs)
          - Async/await mistakes (missing await, .then without return, unhandled promise rejections)
          - Array/object mutations in React components or reducers
          - UseEffect dependency array problems (missing deps, incorrect deps)
          - Incorrect operator usage (== vs ===, && vs ||, = in conditions)
          - Off-by-one errors in loops or array indexing
          - Integer overflow/underflow in calculations
          - Regex catastrophic backtracking vulnerabilities
          - Missing base cases in recursive functions
          - Incorrect type coercion that changes behavior
          - Environment variable access without defaults or validation
          - Null/undefined dereferences
          - Resource leaks (unclosed files or connections)
          - SQL/XSS injection vulnerabilities
          - Concurrency/race conditions
          - Missing error handling for critical operations

          Comment format:
          - Clearly describe the issue: "This code block is unreachable due to the if (false) condition"
          - Provide a concrete fix: "Remove this entire if block as it will never execute"
          - When possible, suggest the exact code change:
            ```
            // Remove the unreachable code
            ```
          - Be specific about why it's a problem: "This will cause a TypeError if input is null"
          - No emojis, just clear technical language

          Skip commenting on:
          - Code style, formatting, or naming conventions
          - Minor performance optimizations
          - Architectural decisions or design patterns
          - Features or functionality (unless broken)
          - Test coverage (unless tests are clearly broken)

          You may open and read other repository files beyond those listed above when it helps you understand the change, but keep all review comments anchored to the modified lines in this PR.

          Use the fetched PR data to:
          - Avoid repeating resolved issues unless the problem still exists.
          - Reference ongoing discussions when adding a follow-up or clarification.
          - Prefer replying to existing open threads instead of creating duplicates when addressing the same code.
          - Ignore your own previous comments that have been resolved unless the underlying issue is still present.

          Position calculation:
          - Use the line position from the diff data fetched from the PR
          - This is the line number in the diff, not the absolute file line
          - Comments must align with exact changed lines only

          How to submit your review:
          Use the GitHub CLI (gh) to submit your review. Run "gh --help" and explore the available commands to understand how to:
          - Submit PR reviews with inline comments
          - Reply to existing review comments
          - Post general PR comments when no issues are found

          The PR number is ${{ github.event.pull_request.number }} and repository is ${{ github.repository }}.

          Guidelines:
          - Submit at most 10 comments total, prioritizing the most critical issues
          - Each comment should be actionable and clear about what needs to be fixed
          - Check for existing "no issues" comments from bots before posting duplicate messages
          - Include a summary in the review body when submitting multiple inline comments
          EOF

          # Run droid exec with the prompt - it will handle PR review submission directly
          echo "Running code review analysis and submitting results..."
          droid exec --auto high --model claude-sonnet-4-5-20250929 -f prompt.txt
````

### Save artifacts on failure

Store review artifacts for troubleshooting if the workflow fails:

```yaml
      - name: Upload debug artifacts on failure
        if: ${{ failure() }}
        uses: actions/upload-artifact@v4
        with:
          name: droid-review-debug-${{ github.run_id }}
          path: |
            prompt.txt
            ${{ runner.home }}/.factory/logs/droid-log-single.log
            ${{ runner.home }}/.factory/logs/console.log
          if-no-files-found: ignore
          retention-days: 7
```


## Test your reviewer

Create a test PR with some intentional issues to verify the workflow:

```javascript
// Example code with issues
function processData(data) {
  if (false) {  // Dead code
    console.log("This never runs");
  }
  
  data.forEach(async item => {  // Missing await
    processItem(item);
  });
  
  if (data = null) {  // Changed assignment to comparison
    return;
  }
}
```

The reviewer should identify these issues and post inline comments.
</file>

<file path="docs/cli/droid-exec/cookbook/github-actions.mdx">
---
title: GitHub Actions
description: Ready-to-use GitHub Actions workflows with droid exec.
---

# GitHub Actions

**Prerequisites:** Add `FACTORY_API_KEY` to repository secrets (Settings ‚Üí Secrets ‚Üí Actions)

## Example 1: Automated PR Review and Fix

Automatically reviews PRs, fixes issues, and posts detailed feedback.

```yaml
name: PR Assistant
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review-and-fix:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
      
      - name: Analyze and fix code
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
        run: |
          # Get the diff
          git diff origin/${{ github.base_ref }}...HEAD > pr_changes.diff
          
          # Review and fix issues (pipe diff to stdin)
          cat pr_changes.diff | droid exec --auto low "
          Review this PR diff and:
          1. Fix any obvious bugs, typos, or linting errors
          2. Add missing error handling
          3. Improve code comments where unclear
          4. DO NOT commit or push changes
          "
          
          # Generate review report (needs --auto to write files)
          droid exec --auto low "Analyze the changes again and write a detailed review to review.md with:
          - Summary of automated fixes made
          - Remaining issues that need human attention
          - Security or performance concerns
          - Test coverage recommendations"
      
      - name: Commit fixes if any
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add -A
            git commit -m "fix: automated improvements for PR #${{ github.event.pull_request.number }}
            
            Co-authored-by: factory-droid[bot] <138933559+factory-droid[bot]@users.noreply.github.com>"
            git push
          fi
      
      - name: Post review comment
        if: always()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            let review = '## ü§ñ Automated Review\n\n';
            
            if (fs.existsSync('review.md')) {
              review += fs.readFileSync('review.md', 'utf8');
            } else {
              review += 'Review completed successfully.';
            }
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: review
            });
```

## Example 2: Daily Documentation and Test Updates

Keeps documentation and tests in sync with code changes automatically.

```yaml
name: Daily Maintenance
on:
  schedule:
    - cron: '0 3 * * *'  # 3 AM UTC daily
  workflow_dispatch:  # Allow manual trigger

jobs:
  update-docs-and-tests:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
      
      - name: Update documentation
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
        run: |
          droid exec --auto low "
          Review all code files modified in the last 7 days and:
          1. Update any outdated JSDoc/docstring comments
          2. Update README.md if new features were added
          3. Add missing documentation for public APIs
          4. Update examples to match current implementation
          Write a summary of changes to docs-updates.md
          "
      
      - name: Generate missing tests
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
        run: |
          droid exec --auto low "
          Find functions and components without test coverage and:
          1. Generate unit tests for utility functions
          2. Create basic test cases for React components
          3. Add edge case tests for error handling
          4. Follow existing test patterns in the codebase
          Write a summary to test-updates.md
          "
      
      - name: Create PR if changes exist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Note: gh CLI is pre-installed on GitHub-hosted runners
          if [ -n "$(git status --porcelain)" ]; then
            BRANCH="auto-updates-$(date +%Y%m%d)"
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            
            git checkout -b $BRANCH
            git add -A
            git commit -m "chore: automated documentation and test updates
            
            Co-authored-by: factory-droid[bot] <138933559+factory-droid[bot]@users.noreply.github.com>"
            git push origin $BRANCH
            
            # Combine summaries for PR body
            PR_BODY="## Automated Updates\n\n"
            [ -f docs-updates.md ] && PR_BODY="${PR_BODY}### Documentation\n$(cat docs-updates.md)\n\n"
            [ -f test-updates.md ] && PR_BODY="${PR_BODY}### Tests\n$(cat test-updates.md)\n\n"
            
            gh pr create \
              --title "ü§ñ Daily automated updates" \
              --body "$PR_BODY" \
              --label "automated,documentation,tests"
          fi
```

## Example 3: Security and Dependency Scanner

Scans for vulnerabilities and outdated dependencies on a schedule.

```yaml
name: Security Scanner
on:
  schedule:
    - cron: '0 9 * * 1'  # Mondays at 9 AM UTC
  workflow_dispatch:

jobs:
  security-scan:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
      
      - name: Security audit
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
        run: |
          droid exec --auto medium "
          Perform a comprehensive security audit:
          1. Check package.json for known vulnerabilities
          2. Update vulnerable dependencies to safe versions
          3. Scan code for hardcoded secrets or API keys
          4. Review authentication and authorization patterns
          5. Check for SQL injection or XSS vulnerabilities
          6. Generate security-report.md with all findings and fixes
          "
      
      - name: Create issue if vulnerabilities found
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Note: gh CLI is pre-installed on GitHub-hosted runners
          if [ -f security-report.md ] && grep -q "vulnerability\|security\|risk" security-report.md; then
            gh issue create \
              --title "üîí Security audit findings - $(date +%Y-%m-%d)" \
              --body-file security-report.md \
              --label "security,high-priority" \
              --assignee "${{ github.repository_owner }}"
          fi
      
      - name: Create PR for fixes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Note: gh CLI is pre-installed on GitHub-hosted runners
          if [ -n "$(git status --porcelain)" ]; then
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            
            git checkout -b security-fixes-$(date +%Y%m%d)
            git add -A
            git commit -m "fix: security updates and dependency patches
            
            Co-authored-by: factory-droid[bot] <138933559+factory-droid[bot]@users.noreply.github.com>"
            git push origin HEAD
            
            gh pr create \
              --title "üîí Security fixes" \
              --body-file security-report.md \
              --label "security,dependencies" \
              --assignee "${{ github.repository_owner }}"
          fi
```
</file>

<file path="docs/cli/droid-exec/cookbook/refactor-error-messages.mdx">
---
title: 'Improve Error Messages'
description: 'Automatically improve Error messages across your entire codebase using Droid Exec'
---

This tutorial demonstrates how to use Droid Exec to refactor error messages across hundreds of files simultaneously. The script intelligently finds all ResponseError instantiations and improves their messages to be more descriptive, actionable, and user-friendly. 

<Info>
`ResponseError` is Factory's internal error handling class used to throw HTTP-style errors with specific status codes. These error classes are used throughout the codebase to handle API errors.
</Info>

## How it works

The script:

1. **Finds files**: Searches for all `.ts` and `.tsx` files containing ResponseError classes
2. **Filters smartly**: Excludes `node_modules`, `.git`, `dist`, `build`, and `.next` directories
3. **Identifies errors**: Locates all ResponseError instantiations (400, 401, 403, 404, etc.)
4. **Improves messages**: Makes them more descriptive and actionable
5. **Adds context**: Includes what went wrong and potential fixes
6. **User-friendly language**: Removes technical jargon
7. **Preserves metadata**: Keeps error codes and metadata intact

## Get the script

<Accordion title="View full script source">
```bash
#!/bin/bash

# Droid Error Message Improvement Script

# Automatically improves ResponseError messages across the codebase

#

# Usage: ./droid-improve-errors.sh [directory]

# Example: ./droid-improve-errors.sh apps

set -e

# Configuration

CONCURRENCY=${CONCURRENCY:-5}
DRY_RUN=${DRY_RUN:-false}
TARGET_DIR="${1:-.}"

# Colors for output

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m'

# Temp files for tracking

TEMP_DIR=$(mktemp -d)
FILES_LIST="$TEMP_DIR/files.txt"
ERRORS_FOUND="$TEMP_DIR/errors_found.txt"
MODIFIED_COUNT=0
PROCESSED_COUNT=0
ERRORS_IMPROVED=0

# Cleanup on exit

trap "rm -rf $TEMP_DIR" EXIT

# Function to process a single file

process_file() {
local filepath="$1"
    local filename=$(basename "$filepath")

    # Check if file contains ResponseError instantiations
    if ! grep -qE "new ResponseError[0-9]+|throw new ResponseError" "$filepath" 2>/dev/null; then
        return 0
    fi

    # Count error instances for reporting
    local error_count=$(grep -cE "new ResponseError[0-9]+" "$filepath" 2>/dev/null || echo 0)

    echo -e "${BLUE}Processing: $filepath${NC}"
    echo -e "  Found $error_count error instantiation(s)"

    # The AI prompt for improving error messages
    local prompt="Improve the error messages in $filepath:

Find all ResponseError instantiations (ResponseError400BadRequest, ResponseError401Unauthorized, etc.)
and improve their error messages following these guidelines:

1. Make messages more descriptive and actionable
2. Include context about what went wrong
3. Suggest potential fixes when appropriate
4. Use user-friendly language (avoid technical jargon)
5. Include relevant details without exposing sensitive data

Examples of improvements:

- 'Invalid api key format' ‚Üí 'API key must be a 32-character alphanumeric string starting with \"fac\_\"'
- 'Organization not found' ‚Üí 'Organization with ID {orgId} not found. Please verify the organization exists and you have access.'
- 'Invalid CSRF token' ‚Üí 'Security validation failed. Please refresh the page and try again.'
- 'Invalid request parameters' ‚Üí 'Missing required field \"email\". Please provide a valid email address.'
- 'User is already a member' ‚Üí 'This user is already a member of the organization and cannot be invited again.'

Only modify the error message strings, preserve all other code including metadata parameters.
Return the complete file with improved error messages."

    if [ "$DRY_RUN" = "true" ]; then
        echo -e "${YELLOW}  [DRY RUN] Would improve $error_count error message(s)${NC}"
        echo "$error_count" >> "$ERRORS_FOUND"
        return 0
    fi

    # Get original file hash for comparison
    local original_hash=$(md5sum "$filepath" 2>/dev/null | cut -d' ' -f1 || md5 -q "$filepath")

    # Run droid to improve error messages
    if droid exec --auto low "$prompt" 2>/dev/null; then
        # Check if file was modified
        local new_hash=$(md5sum "$filepath" 2>/dev/null | cut -d' ' -f1 || md5 -q "$filepath")
        if [ "$original_hash" != "$new_hash" ]; then
            echo -e "${GREEN}  ‚úì Improved error messages${NC}"
            ((MODIFIED_COUNT++))
            ((ERRORS_IMPROVED+=error_count))
        else
            echo -e "  No changes needed"
        fi
        ((PROCESSED_COUNT++))
    else
        echo -e "${RED}  ‚úó Failed to process${NC}"
    fi

}

# Export function and variables for parallel execution

export -f process_file
export DRY_RUN GREEN YELLOW BLUE RED NC ERRORS_FOUND

# Main execution

echo -e "${BLUE}=== Droid Error Message Improvement ===${NC}"
echo -e "${BLUE}Directory: $TARGET_DIR${NC}"
echo -e "${BLUE}Concurrency: $CONCURRENCY${NC}"
[ "$DRY_RUN" = "true" ] && echo -e "${YELLOW}DRY RUN MODE${NC}"
echo ""

# Find TypeScript files containing ResponseError

find "$TARGET_DIR" -type f \( -name "*.ts" -o -name "*.tsx" \) \
    ! -path "*/node_modules/*" \
    ! -path "*/.git/*" \
    ! -path "*/dist/*" \
    ! -path "*/build/*" \
    ! -path "*/.next/*" \
    ! -path "*/coverage/*" \
    -exec grep -l "ResponseError[0-9]" {} \; 2>/dev/null > "$FILES_LIST" || true

FILE_COUNT=$(wc -l < "$FILES_LIST" | tr -d ' ')

if [ "$FILE_COUNT" -eq 0 ]; then
echo -e "${YELLOW}No files with ResponseError found${NC}"
exit 0
fi

echo -e "${BLUE}Found $FILE_COUNT files with ResponseError classes${NC}\n"

# Process files in parallel

cat "$FILES_LIST" | xargs -n 1 -P "$CONCURRENCY" -I {} bash -c 'process_file "$@"' _ {}

# Calculate total errors found in dry run

if [ "$DRY_RUN" = "true" ] && [ -f "$ERRORS_FOUND" ]; then
TOTAL_ERRORS=$(awk '{sum+=$1} END {print sum}' "$ERRORS_FOUND" 2>/dev/null || echo 0)
fi

# Show summary

echo -e "\n${BLUE}=== Summary ===${NC}"
echo -e "${GREEN}Files scanned: $FILE_COUNT${NC}"
echo -e "${GREEN}Files processed: $PROCESSED_COUNT${NC}"

if [ "$DRY_RUN" = "true" ]; then
[ -n "$TOTAL_ERRORS" ] && echo -e "${YELLOW}Error messages to improve: $TOTAL_ERRORS${NC}"
else
echo -e "${GREEN}Files modified: $MODIFIED_COUNT${NC}"
[ "$ERRORS_IMPROVED" -gt 0 ] && echo -e "${GREEN}Error messages improved: ~$ERRORS_IMPROVED${NC}"
fi

if [ "$DRY_RUN" = "false" ] && [ "$MODIFIED_COUNT" -gt 0 ]; then
echo -e "\n${BLUE}Next steps:${NC}"
echo " git diff # Review changes"
echo " npm run typecheck # Verify types"
echo " npm run test # Run tests"
echo " git add -A # Stage changes"
echo " git commit -m 'refactor: improve error messages for better UX'"
fi

````
</Accordion>

## Prerequisites

Before you begin, complete the [Droid Exec installation](/cli/droid-exec/overview#installation).

## Basic usage

### Preview changes (dry run)

<Warning>
  Always start with a dry run to see how many error messages need improvement before modifying files.
</Warning>

The dry run feature shows you exactly which files contain ResponseError instantiations and how many:

```bash
# Preview what would happen (no changes made)
DRY_RUN=true ./droid-improve-errors.sh apps/factory-admin/src/app/api/_utils/middleware.ts

# Example output:
# === Droid Error Message Improvement ===
# Directory: apps/factory-admin/src/app/api/_utils/middleware.ts
# Concurrency: 5
# DRY RUN MODE
#
# Found 1 files with ResponseError classes
#
# Processing: apps/factory-admin/src/app/api/_utils/middleware.ts
#   Found 6 error instantiation(s)
#   [DRY RUN] Would improve 6 error message(s)
#
# === Summary ===
# Files scanned: 1
# Files processed: 0
# Error messages to improve: 6
````

**How dry run works:**

- When `DRY_RUN=true`: Counts all ResponseError instantiations without making changes
- When `DRY_RUN=false` (default): Actually improves the error messages using AI

This helps you:

- Estimate the scope of changes needed
- Test on a small directory first
- Plan your refactoring strategy

### Apply refactoring

Once you're ready, run the actual error message improvement:

```bash
# Actually improve the error messages (default behavior)
./droid-improve-errors.sh apps/factory-admin

# Or explicitly set DRY_RUN=false
DRY_RUN=false ./droid-improve-errors.sh apps/factory-admin

# Adjust concurrency for faster processing
CONCURRENCY=10 ./droid-improve-errors.sh packages
```

Actual execution example:

```bash
% ./scripts/droid-improve-errors.sh apps/factory-admin/src/app/api/_utils/middleware.ts
=== Droid Error Message Improvement ===
Directory: apps/factory-admin/src/app/api/_utils/middleware.ts
Concurrency: 5

Found 1 files with ResponseError classes

Processing: apps/factory-admin/src/app/api/_utils/middleware.ts
  Found 6 error instantiation(s)
## Summary

I've successfully improved all error messages in the `apps/factory-admin/src/app/api/_utils/middleware.ts` file. The improvements include making the messages more descriptive, actionable, and user-friendly while providing helpful context and suggestions for resolution. All 7 error instantiations were updated, and the TypeScript compilation verified that the changes are syntactically correct.
```

## Real-world transformations

### Example 1: Session Authentication

<Tabs>
  <Tab title="Before">
    ```typescript
    // middleware.ts
    if (!sessionCookie?.value) {
      throw new ResponseError401Unauthorized('No session');
    }

    if (!userRecord) {
      throw new ResponseError401Unauthorized('Invalid session');
    }
    ```
  </Tab>
  
  <Tab title="After">
    ```typescript
    // middleware.ts
    if (!sessionCookie?.value) {
      throw new ResponseError401Unauthorized(
        'Session cookie not found. Please sign in again to access the admin dashboard.'
      );
    }

    if (!userRecord) {
      throw new ResponseError401Unauthorized(
        'Session is invalid or has expired. Please sign in again to continue.'
      );
    }
    ```
    <Note>Clear instructions on what went wrong and how to fix it</Note>
  </Tab>
</Tabs>

### Example 2: Bearer Token Authorization

<Tabs>
  <Tab title="Before">
    ```typescript
    // middleware.ts
    if (!authHeader) {
      throw new ResponseError401Unauthorized('Missing auth header');
    }

    if (authHeader !== `Bearer ${secret}`) {
      throw new ResponseError401Unauthorized('Invalid token');
    }
    ```
  </Tab>
  
  <Tab title="After">
    ```typescript
    // middleware.ts
    if (!authHeader) {
      throw new ResponseError401Unauthorized(
        'Authorization header is missing. Please include a valid Bearer token in the Authorization header.'
      );
    }

    if (authHeader !== `Bearer ${secret}`) {
      throw new ResponseError401Unauthorized(
        'Invalid or expired authorization token. Please verify your API credentials and ensure the token is properly formatted as "Bearer <token>".'
      );
    }
    ```
    <Note>Specific format requirements and troubleshooting hints added</Note>
  </Tab>
</Tabs>

## Best practices

<Note>
  Follow these best practices for safe and effective error message improvement.
</Note>

<Steps>
  <Step title="Start with a dry run">
    Always preview the scope of changes first: 
    ```bash
    # See how many errors need improvement 
    DRY_RUN=true ./droid-improve-errors.sh packages
    ```
  </Step>

  <Step title="Process incrementally">
    For large codebases, tackle one module at a time: 
    ```bash 
    # Process each app separately for easier review 
    ./droid-improve-errors.sh apps/factory-admin
    git add -A && git commit -m "refactor(factory-admin): improve error messages" 
    
    ./droid-improve-errors.sh apps/factory-app 
    git add -A && git commit -m "refactor(factory-app): improve error messages"
    ```
  </Step>
</Steps>
</file>

<file path="docs/cli/droid-exec/cookbook/refactor-fix-lint.mdx">
---
title: 'Automated Lint Fixes'
description: 'Automatically fix ESLint violations across your codebase using Droid Exec'
---

This tutorial demonstrates how to use Droid Exec to automatically fix ESLint violations across your codebase. The script identifies files with lint errors and intelligently fixes them while preserving functionality.

<Info>
This approach works with any ESLint rule - from simple formatting issues to complex architectural patterns.
</Info>

## How it works

The script:

1. **Finds violations**: Runs ESLint to identify all route.ts files missing middleware
2. **Analyzes context**: Determines the appropriate middleware type based on the route path
3. **Adds middleware**: Inserts the correct handle*Middleware call as the first statement
4. **Preserves logic**: Wraps existing code in the middleware callback
5. **Maintains types**: Ensures TypeScript types are correctly preserved
6. **Formats code**: Maintains consistent code style

## Get the script

<Accordion title="View full script source">
```bash
#!/bin/bash

# Droid Route Middleware Fix Script
# Automatically adds required middleware to NextJS API routes that are missing them
#
# Usage: ./droid-fix-route-middleware.sh [directory]
# Example: ./droid-fix-route-middleware.sh apps/factory-app

set -e

# Configuration
CONCURRENCY=${CONCURRENCY:-5}
DRY_RUN=${DRY_RUN:-false}
TARGET_DIR="${1:-.}"
ESLINT_RULE="factory/require-route-middleware"

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m'

# Temp files for tracking
TEMP_DIR=$(mktemp -d)
VIOLATIONS_FILE="$TEMP_DIR/violations.txt"
PROCESSED_COUNT=0
FIXED_COUNT=0
FAILED_COUNT=0

# Cleanup on exit
trap "rm -rf $TEMP_DIR" EXIT

# Function to detect violations using ESLint
find_violations() {
    echo -e "${BLUE}Scanning for route middleware violations...${NC}"
    
    # Run ESLint with the specific rule and capture violations
    # Using --format json for easier parsing
    npx eslint "$TARGET_DIR" \
        --ext .ts,.tsx \
        --rule "${ESLINT_RULE}: error" \
        --format json 2>/dev/null | \
        jq -r '.[] | select(.errorCount > 0) | .filePath' > "$VIOLATIONS_FILE" || true
    
    # Alternative approach if the above doesn't work - find all route.ts files
    # and check them individually
    if [ ! -s "$VIOLATIONS_FILE" ]; then
        find "$TARGET_DIR" -type f -name "route.ts" \
            ! -path "*/node_modules/*" \
            ! -path "*/.next/*" \
            ! -path "*/dist/*" \
            ! -path "*/build/*" | while read -r file; do
            # Check if file has middleware violations
            if npx eslint "$file" \
                --rule "${ESLINT_RULE}: error" \
                --format compact 2>&1 | grep -q "require-route-middleware"; then
                echo "$file" >> "$VIOLATIONS_FILE"
            fi
        done
    fi
}

# Function to determine the appropriate middleware type based on route path
get_middleware_type() {
    local filepath="$1"
    
    # Check for specific route patterns
    if [[ "$filepath" == *"/api/cron/"* ]]; then
        echo "cron"
    elif [[ "$filepath" == *"/api/webhooks/"* ]]; then
        echo "public"
    elif [[ "$filepath" == *"/api/admin/"* ]]; then
        echo "admin"
    elif [[ "$filepath" == *"/api/auth/"* ]] && [[ "$filepath" != *"/logout"* ]]; then
        echo "public"
    elif [[ "$filepath" == *"/api/health"* ]] || [[ "$filepath" == *"/api/echo"* ]]; then
        echo "public"
    elif [[ "$filepath" == *"factory-admin"* ]]; then
        echo "admin"
    else
        echo "authenticated"
    fi
}

# Function to process a single file
process_file() {
    local filepath="$1"
    local filename=$(basename "$filepath")
    local middleware_type=$(get_middleware_type "$filepath")
    
    echo -e "${BLUE}Processing: $filepath${NC}"
    echo -e "  Detected type: $middleware_type middleware needed"
    
    # The AI prompt for adding middleware
    local prompt="Fix the middleware violations in $filepath by adding the appropriate middleware handler.

IMPORTANT CONTEXT:
This is a NextJS API route file that needs middleware added to each exported HTTP handler (GET, POST, PUT, DELETE, etc.).
The middleware must be the FIRST statement in each handler function.

Based on the route type ($middleware_type), use the appropriate middleware:

1. For 'authenticated' routes (require user login):
\`\`\`typescript
import { handleAuthenticatedMiddleware } from '@/app/api/_utils/middleware';

export async function GET(req: NextRequest) {
  return handleAuthenticatedMiddleware(req, async ({ req, user }) => {
    // Existing route logic here
    // 'user' is the authenticated UserRecord
    return NextResponse.json({ data });
  });
}
\`\`\`

2. For 'public' routes (no auth required):
\`\`\`typescript
import { handlePublicMiddleware } from '@/app/api/_utils/middleware';

export async function POST(req: NextRequest) {
  return handlePublicMiddleware(req, async (req) => {
    // Existing route logic here
    return NextResponse.json({ data });
  });
}
\`\`\`

3. For 'cron' routes (require cron secret):
\`\`\`typescript
import { handleCronMiddleware } from '@/app/api/_utils/middleware';

export async function POST(req: NextRequest) {
  return handleCronMiddleware(req, async (req) => {
    // Existing route logic here
    return NextResponse.json({ success: true });
  });
}
\`\`\`

4. For 'admin' routes (require admin role):
\`\`\`typescript
import { handleAuthenticatedMiddleware, AdminRole } from '@/app/api/_utils/middleware';

export async function GET(req: NextRequest) {
  return handleAuthenticatedMiddleware(
    req,
    async ({ req, user }) => {
      // Existing route logic here
      return NextResponse.json({ data });
    },
    { requiredRole: AdminRole.ADMIN_1 }
  );
}
\`\`\`

Additional options can be passed:
- \`context\`: String for error logging context
- \`requireCsrf\`: Boolean to enable CSRF validation
- \`requiredRole\`: AdminRole enum value for role-based access

INSTRUCTIONS:
1. Add the appropriate import for the middleware function if not present
2. Wrap the ENTIRE body of each exported HTTP handler with the middleware call
3. The middleware should return the result of the middleware function
4. Move ALL existing logic inside the middleware callback
5. Preserve all existing imports, types, and logic exactly as-is
6. If the handler already uses try-catch for error handling, you can remove it as the middleware handles errors
7. Ensure the callback parameters match the middleware type (some provide 'user', others just 'req')

Only modify the route handlers to add middleware. Return the complete fixed file."
    
    if [ "$DRY_RUN" = "true" ]; then
        echo -e "${YELLOW}  [DRY RUN] Would add $middleware_type middleware${NC}"
        return 0
    fi
    
    # Run droid to fix the middleware
    if droid exec --auto low "$prompt" 2>/dev/null; then
        # Verify the fix worked by running ESLint again
        if npx eslint "$filepath" \
            --rule "${ESLINT_RULE}: error" \
            --no-eslintrc \
            --plugin factory \
            --format compact 2>&1 | grep -q "require-route-middleware"; then
            echo -e "${RED}  ‚úó Failed to fix all violations${NC}"
            ((FAILED_COUNT++))
        else
            echo -e "${GREEN}  ‚úì Fixed middleware violations${NC}"
            ((FIXED_COUNT++))
        fi
        ((PROCESSED_COUNT++))
    else
        echo -e "${RED}  ‚úó Failed to process${NC}"
        ((FAILED_COUNT++))
    fi
}

# Export function and variables for parallel execution
export -f process_file get_middleware_type
export DRY_RUN GREEN YELLOW BLUE RED NC ESLINT_RULE

# Main execution
echo -e "${BLUE}=== Droid Route Middleware Fix ===${NC}"
echo -e "${BLUE}Directory: $TARGET_DIR${NC}"
echo -e "${BLUE}Concurrency: $CONCURRENCY${NC}"
[ "$DRY_RUN" = "true" ] && echo -e "${YELLOW}DRY RUN MODE${NC}"
echo ""

# Find violations
find_violations

VIOLATION_COUNT=$(wc -l < "$VIOLATIONS_FILE" 2>/dev/null | tr -d ' ' || echo 0)

if [ "$VIOLATION_COUNT" -eq 0 ]; then
    echo -e "${GREEN}No middleware violations found!${NC}"
    exit 0
fi

echo -e "${YELLOW}Found $VIOLATION_COUNT files with middleware violations${NC}\n"

# Process files in parallel
cat "$VIOLATIONS_FILE" | xargs -n 1 -P "$CONCURRENCY" -I {} bash -c 'process_file "$@"' _ {}

# Show summary
echo -e "\n${BLUE}=== Summary ===${NC}"
echo -e "${GREEN}Files processed: $PROCESSED_COUNT${NC}"
if [ "$DRY_RUN" = "false" ]; then
    echo -e "${GREEN}Files fixed: $FIXED_COUNT${NC}"
    [ "$FAILED_COUNT" -gt 0 ] && echo -e "${RED}Files failed: $FAILED_COUNT${NC}"
fi

if [ "$DRY_RUN" = "false" ] && [ "$FIXED_COUNT" -gt 0 ]; then
    echo -e "\n${BLUE}Next steps:${NC}"
    echo "  npm run lint           # Verify all violations are fixed"
    echo "  npm run typecheck      # Check TypeScript compilation"
    echo "  npm run test           # Run tests"
    echo "  git diff              # Review changes"
    echo "  git add -A            # Stage changes"
    echo "  git commit -m 'fix: add required middleware to API routes'"
fi

# Exit with error if some files failed
[ "$FAILED_COUNT" -gt 0 ] && exit 1
exit 0
```
</Accordion>

<Warning>
  **Critical for Success**: When customizing this script for your own lint rules, always include concrete before/after examples in the prompt you give to Droid Exec. This dramatically improves accuracy.
  
  Good prompt structure:
  1. Describe the violation to fix
  2. Show a "before" code example with the violation
  3. Show an "after" code example with the fix applied
  4. List any edge cases or patterns to preserve
  
  The more specific your examples, the better Droid will understand and implement the fix pattern.
</Warning>

## Prerequisites

Before you begin, ensure you have completed the [Droid Exec installation](/cli/droid-exec/overview#installation)

## Basic usage

### Preview violations (dry run)

<Warning>
  Always start with a dry run to see which files need fixing before making changes.
</Warning>

The dry run shows you which files violate the middleware rule and what type of middleware would be added:

```bash
# Preview what would happen (no changes made)
DRY_RUN=true ./droid-fix-route-middleware.sh apps/factory-admin/src/app/api

# Example output:
# === Droid Route Middleware Fix ===
# Directory: apps/factory-admin/src/app/api
# Concurrency: 5
# DRY RUN MODE
#
# Scanning for route middleware violations...
# Found 3 files with middleware violations
#
# Processing: apps/factory-admin/src/app/api/health/route.ts
#   Detected type: public middleware needed
#   [DRY RUN] Would add public middleware
# Processing: apps/factory-admin/src/app/api/orgs/route.ts
#   Detected type: admin middleware needed
#   [DRY RUN] Would add admin middleware
# Processing: apps/factory-admin/src/app/api/cron/batch-friction/poll-and-report/route.ts
#   Detected type: cron middleware needed
#   [DRY RUN] Would add cron middleware
#
# === Summary ===
# Files processed: 0
```

**How dry run works:**
- When `DRY_RUN=true`: Identifies violations and shows what middleware type would be added
- When `DRY_RUN=false` (default): Actually fixes the violations by adding middleware

This helps you:
- Understand which routes are missing middleware
- Verify the correct middleware type will be used
- Estimate the scope of changes

### Apply fixes

Once ready, run the actual fix:

```bash
# Fix all violations in a directory
./droid-fix-route-middleware.sh apps/factory-admin/src/app/api

# Example output:
# === Droid Route Middleware Fix ===
# Directory: apps/factory-admin/src/app/api
# Concurrency: 5
#
# Scanning for route middleware violations...
# Found 3 files with middleware violations
#
# Processing: apps/factory-admin/src/app/api/health/route.ts
#   Detected type: public middleware needed
# Processing: apps/factory-admin/src/app/api/cron/batch-friction/poll-and-report/route.ts
#   Detected type: cron middleware needed
# Processing: apps/factory-admin/src/app/api/orgs/route.ts
#   Detected type: admin middleware needed
# ‚úì Fixed middleware violations
# ‚úì Fixed middleware violations  
# ‚úì Fixed middleware violations
```

## Real-world transformations

### Example 1: Simple GET Handler

<Tabs>
  <Tab title="Before">
    <Note>Missing middleware - no authentication check!</Note>
    ```typescript
    // apps/factory-app/src/app/api/sessions/route.ts
    import { NextRequest, NextResponse } from 'next/server';
    import { getFirestoreInstance } from '@factory/services/firebase/admin';
    
    export async function GET(req: NextRequest) {
      const searchParams = req.nextUrl.searchParams;
      const userId = searchParams.get('userId');
      
      ...
      
      return NextResponse.json({
        sessions: sessions.docs.map(doc => doc.data())
      });
    }
    ```
  </Tab>
  
  <Tab title="After">
    <Note>Now properly authenticated with access to user object</Note>
    ```typescript
    // apps/factory-app/src/app/api/sessions/route.ts
    import { NextRequest, NextResponse } from 'next/server';
    import { getFirestoreInstance } from '@factory/services/firebase/admin';
    import { handleAuthenticatedMiddleware } from '@/app/api/_utils/middleware';
    
    export async function GET(req: NextRequest) {
      return handleAuthenticatedMiddleware(req, async ({ req, user }) => {
        const searchParams = req.nextUrl.searchParams;
        const userId = searchParams.get('userId');
        
        ...
        
        return NextResponse.json({
          sessions: sessions.docs.map(doc => doc.data())
        });
      });
    }
    ```
  </Tab>
</Tabs>

### Example 2: Cron Job Handler  

<Tabs>
  <Tab title="Before">
    <Note>Cron job without authorization - anyone could trigger it!</Note>
    ```typescript
    // apps/factory-admin/src/app/api/cron/batch-friction/poll-and-report/route.ts
    export async function GET(request: NextRequest) {
      
      logInfo('[poll-report] Starting poll and report workflow');

      const results = {
        polledBatches: 0,
        processedBatches: 0,
        failedBatches: [],
        reportGenerated: false,
        reportError: null,
      };

      // ... rest of the cron job logic ...

      return NextResponse.json({
        success,
        message,
        summary: {
          processedBatches: results.processedBatches,
          failedBatches: results.failedBatches.length,
          reportGenerated: results.reportGenerated,
        },
      });
    }
    ```
  </Tab>
  
  <Tab title="After">
    <Note>Now protected by cron secret, entire handler wrapped in middleware</Note>
    ```typescript
    // apps/factory-admin/src/app/api/cron/batch-friction/poll-and-report/route.ts
    export async function GET(request: NextRequest) {
      return handleCronMiddleware(request, async (req) => {
        logInfo('[poll-report] Starting poll and report workflow');

        const results = {
          polledBatches: 0,
          processedBatches: 0,
          failedBatches: [],
          reportGenerated: false,
          reportError: null,
        };

        // ... rest of the cron job logic ...

        return NextResponse.json({
          success,
          message,
          summary: {
            processedBatches: results.processedBatches,
            failedBatches: results.failedBatches.length,
            reportGenerated: results.reportGenerated,
          },
        });
      });
    }
    ```
  </Tab>
</Tabs>


## Best practices

<Note>
  Follow these best practices for safe and effective middleware addition.
</Note>

<Steps>
  <Step title="Start with dry run">
    Preview changes before applying:
    ```bash
    # See what would be fixed without making changes
    DRY_RUN=true ./droid-fix-route-middleware.sh apps
    ```
  </Step>
  
  <Step title="Process by app">
    Fix one application at a time for easier review:
    ```bash
    # Fix factory-app routes
    ./droid-fix-route-middleware.sh apps/factory-app
    npm run typecheck -- --filter=factory-app
    git add -A && git commit -m "fix(factory-app): add required middleware to API routes"
    
    # Fix factory-admin routes
    ./droid-fix-route-middleware.sh apps/factory-admin
    npm run typecheck -- --filter=factory-admin
    git add -A && git commit -m "fix(factory-admin): add required middleware to API routes"
    ```
  </Step>
</Steps>
</file>

<file path="docs/cli/droid-exec/cookbook/refactor-imports.mdx">
---
title: "Organize Imports"
description: "Automatically organize imports across your entire codebase using Droid Exec"
---

This tutorial demonstrates how to use Droid Exec to refactor import statements across hundreds of files simultaneously. The script intelligently groups, sorts, and optimizes imports while removing unused dependencies and converting module formats.

## How it works

The script:

1. **Finds files**: Searches for all `.js`, `.jsx`, `.ts`, and `.tsx` files
2. **Filters smartly**: Excludes `node_modules`, `.git`, `dist`, and `build` directories
3. **Checks for imports**: Only processes files that contain import statements
4. **Groups imports**: Organizes into external, internal, and relative imports
5. **Sorts alphabetically**: Within each group for consistency
6. **Removes unused**: Eliminates imports that aren't referenced
7. **Modernizes syntax**: Converts `require()` to ES6 `import`
8. **Consolidates duplicates**: Merges multiple imports from the same module

## Get the script

<Accordion title="View full script source">
```bash
#!/bin/bash

# Simplified Droid Import Refactoring Script
# A cookbook example of using AI to refactor imports across a codebase
#
# Usage: ./droid-refactor-imports.sh [directory]
# Example: ./droid-refactor-imports.sh src

set -e

# Configuration
CONCURRENCY=${CONCURRENCY:-5}
DRY_RUN=${DRY_RUN:-false}
TARGET_DIR="${1:-.}"

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# Temp files for tracking
TEMP_DIR=$(mktemp -d)
FILES_LIST="$TEMP_DIR/files.txt"
MODIFIED_COUNT=0
PROCESSED_COUNT=0

# Cleanup on exit
trap "rm -rf $TEMP_DIR" EXIT

# Function to process a single file
process_file() {
    local filepath="$1"
    local filename=$(basename "$filepath")
    
    # Check if file has imports
    if ! grep -qE "^import |^const .* = require\(|^export .* from" "$filepath" 2>/dev/null; then
        return 0
    fi
    
    echo -e "${BLUE}Processing: $filepath${NC}"
    
    # The AI prompt for refactoring imports
    local prompt="Refactor the imports in $filepath:

1. Group imports in this order with blank lines between:
   - External packages (node_modules)
   - Internal/absolute imports (@/ or src/)
   - Relative imports (./ or ../)

2. Sort alphabetically within each group
3. Remove unused imports
4. Convert require() to ES6 imports
5. Consolidate duplicate imports from same module

Only modify imports, preserve all other code exactly.
Return the complete refactored file."
    
    if [ "$DRY_RUN" = "true" ]; then
        echo -e "${YELLOW}  [DRY RUN] Would refactor imports${NC}"
        return 0
    fi
    
    # Get original file hash for comparison
    local original_hash=$(md5sum "$filepath" 2>/dev/null | cut -d' ' -f1 || md5 -q "$filepath")
    
    # Run droid to refactor the file
    if droid exec --auto low "$prompt" 2>/dev/null; then
        # Check if file was modified
        local new_hash=$(md5sum "$filepath" 2>/dev/null | cut -d' ' -f1 || md5 -q "$filepath")
        if [ "$original_hash" != "$new_hash" ]; then
            echo -e "${GREEN}  ‚úì Refactored${NC}"
            ((MODIFIED_COUNT++))
        fi
        ((PROCESSED_COUNT++))
    else
        echo "  ‚úó Failed to process"
    fi
}

# Export function and variables for parallel execution
export -f process_file
export DRY_RUN GREEN YELLOW BLUE NC

# Main execution
echo -e "${BLUE}=== Droid Import Refactoring ===${NC}"
echo -e "${BLUE}Directory: $TARGET_DIR${NC}"
echo -e "${BLUE}Concurrency: $CONCURRENCY${NC}"
[ "$DRY_RUN" = "true" ] && echo -e "${YELLOW}DRY RUN MODE${NC}"
echo ""

# Find JavaScript and TypeScript files
find "$TARGET_DIR" -type f \
    \( -name "*.js" -o -name "*.jsx" -o -name "*.ts" -o -name "*.tsx" \) \
    ! -path "*/node_modules/*" \
    ! -path "*/.git/*" \
    ! -path "*/dist/*" \
    ! -path "*/build/*" \
    > "$FILES_LIST"

FILE_COUNT=$(wc -l < "$FILES_LIST" | tr -d ' ')

if [ "$FILE_COUNT" -eq 0 ]; then
    echo -e "${YELLOW}No JavaScript/TypeScript files found${NC}"
    exit 0
fi

echo -e "${BLUE}Found $FILE_COUNT files to check${NC}\n"

# Process files in parallel
cat "$FILES_LIST" | xargs -n 1 -P "$CONCURRENCY" -I {} bash -c 'process_file "$@"' _ {}

# Show summary
echo -e "\n${BLUE}=== Summary ===${NC}"
echo -e "${GREEN}Files processed: $PROCESSED_COUNT${NC}"
[ "$DRY_RUN" = "false" ] && echo -e "${GREEN}Files modified: $MODIFIED_COUNT${NC}"

if [ "$DRY_RUN" = "false" ] && [ "$MODIFIED_COUNT" -gt 0 ]; then
    echo -e "\n${BLUE}Next steps:${NC}"
    echo "  git diff           # Review changes"
    echo "  git add -A         # Stage changes"
    echo "  git commit -m 'refactor: organize imports'"
fi
```
</Accordion>

## Prerequisites

Before you begin, complete the [Droid Exec installation](/cli/droid-exec/overview#installation).

## Basic usage

### Preview changes (dry run)

<Warning>
  Always start with a dry run to preview changes before modifying files. This helps you understand what transformations will be applied.
</Warning>

The dry run feature is controlled by the `DRY_RUN` environment variable:

```bash
# Preview what would happen (no changes made)
DRY_RUN=true ./droid-refactor-imports.sh src

# Example output:
# === Droid Import Refactoring ===
# Directory: src
# Concurrency: 5
# DRY RUN MODE
# 
# Found 25 files to check
# 
# Processing: src/components/Button.tsx
#   [DRY RUN] Would refactor imports
# Processing: src/utils/api.ts
#   [DRY RUN] Would refactor imports
```

**How dry run works:**
- When `DRY_RUN=true`: The script finds all files that need processing and shows which files have imports to refactor, but doesn't modify any files
- When `DRY_RUN=false` (default): Actually runs the AI refactoring and modifies the files

This is particularly useful for:
- Testing on a small directory first to understand the changes
- Estimating time/cost before processing a large codebase
- Verifying the script finds the right files before committing to changes

### Apply refactoring

Once you're satisfied with the preview, run the actual refactoring:

```bash
# Actually refactor the imports (default behavior)
./droid-refactor-imports.sh packages/models

# Or explicitly set DRY_RUN=false
DRY_RUN=false ./droid-refactor-imports.sh packages/models

# Adjust concurrency for faster processing
CONCURRENCY=10 ./droid-refactor-imports.sh packages/models
```

Actual execution example:
```
=== Droid Import Refactoring ===
Directory: packages/models
Concurrency: 5

Found 78 files to check

Processing: packages/models/src/organization/test-utils/fixtures.ts
Processing: packages/models/src/organization/agentReadiness/types.ts
Processing: packages/models/src/organization/utils.ts
Processing: packages/models/src/organization/agentReadiness/handlers.ts
Processing: packages/models/jest.config.ts
Processing: packages/models/src/organization/user/defaultRepositories/handlers.ts
Perfect! I've successfully refactored the imports in the file...
## Summary

I've successfully refactored the imports in `packages/models/src/organization/test-utils/fixtures.ts`. 
The imports are now properly organized with comments separating external packages from relative imports...
...
```

## Real-world transformations

### Example 1: CommonJS to ES6 Conversion

<Tabs>
  <Tab title="Before">
    ```typescript
    // customers.ts
    const getStripeInstance = require("./instance").getStripeInstance;
    import dayjs from 'dayjs';  // unused import
    import url from 'url';  // unused import
    ```
  </Tab>
  
  <Tab title="After">
    ```typescript
    // customers.ts
    // Relative imports
    import { getStripeInstance } from './instance';
    ```
    <Note>CommonJS converted to ES6, unused imports removed</Note>
  </Tab>
</Tabs>

### Example 2: Consolidating Duplicate Imports

<Tabs>
  <Tab title="Before">
    ```typescript
    // admin.ts
    const { auth } = require('firebase-admin');
    import { App } from "firebase-admin/app"
    import { Firestore } from 'firebase-admin/firestore';
    import dotenv from 'dotenv';  // unused import
    const { FirebaseProjectName } = require("./enums");
    import {
      getFirestoreInstanceForProject,
      getFirebaseAuthInstanceForProject,
    } from './multi-admin';
    const { initializeFirebaseAdminApp } = require('./multi-admin');
    import {
      getFirestoreInstance as getDefaultFirestoreInstance,
      getFirestoreInstanceForTest as getDefaultFirestoreInstanceForTest,
      getFirebaseAuthInstance as getDefaultFirebaseAuthInstance,
    } from "./multi-admin"
    import express from 'express';  // unused import
    ```
  </Tab>
  
  <Tab title="After">
    ```typescript
    // admin.ts
    // External packages
    import { auth } from 'firebase-admin';
    import { App } from 'firebase-admin/app';
    import { Firestore } from 'firebase-admin/firestore';

    // Relative imports
    import { FirebaseProjectName } from './enums';
    import {
      getFirestoreInstanceForProject,
      getFirebaseAuthInstanceForProject,
      initializeFirebaseAdminApp,
      getFirestoreInstance as getDefaultFirestoreInstance,
      getFirestoreInstanceForTest as getDefaultFirestoreInstanceForTest,
      getFirebaseAuthInstance as getDefaultFirebaseAuthInstance,
    } from './multi-admin';
    ```
    <Note>Multiple imports from same module consolidated, unused removed, CommonJS converted</Note>
  </Tab>
</Tabs>

## Best practices

<Note>
  Follow these best practices for safe and effective import refactoring.
</Note>

<Steps>
  <Step title="Start with a dry run">
    Always preview changes before modifying files:
    ```bash
    # Preview what would happen without making changes
    DRY_RUN=true ./droid-refactor-imports.sh packages/models
    ```
  </Step>
  
  <Step title="Test on a small scope first">
    Start with a specific subdirectory before processing entire codebase:
    ```bash
    # Test on a single module first
    ./droid-refactor-imports.sh packages/models/src/utils
    
    # Then expand to larger directories
    ./droid-refactor-imports.sh packages/models
    ```
  </Step>
  
  <Step title="Process incrementally">
    For large codebases, process directories separately for easier review:
    ```bash
    # Process each package separately
    ./droid-refactor-imports.sh packages/models
    git add -A && git commit -m "refactor: organize imports in models"
    
    ./droid-refactor-imports.sh packages/services  
    git add -A && git commit -m "refactor: organize imports in services"
    ```
  </Step>
</Steps>
</file>

<file path="docs/cli/droid-exec/overview.mdx">
---
title: Overview
description: Non-interactive execution mode for CI/CD pipelines and automation scripts.
---

# Droid Exec (Headless CLI)

Droid Exec is Factory's headless execution mode designed for automation workflows. Unlike the interactive CLI, `droid exec` runs as a one-shot command that completes a task and exits, making it ideal for CI/CD pipelines, shell scripts, and batch processing.

## Summary and goals

Droid Exec is a one-shot task runner designed to:

- Produce readable logs, and structured artifacts when requested
- Enforce opt-in for mutations/command execution (secure-by-default)
- Fail fast on permission violations with clear errors
- Support simple composition for batch and parallel work

<CardGroup cols={2}>
  <Card title="Non-Interactive" icon="terminal">
    Single run execution that writes to stdout/stderr for CI/CD integration
  </Card>
  <Card title="Secure by Default" icon="lock">
    Read-only by default with explicit opt-in for mutations via autonomy levels
  </Card>
  <Card title="Composable" icon="puzzle">
    Designed for shell scripting, parallel execution, and pipeline integration
  </Card>
  <Card title="Clean Output" icon="file-export">
    Structured output formats and artifacts for automated processing
  </Card>
</CardGroup>

## Execution model

- Non-interactive single run that writes to stdout/stderr.
- Default is spec-mode: the agent is only allowed to execute read-only operations.
- Add `--auto` to enable edits and commands; risk tiers gate what can run.

CLI help (excerpt):

```
Usage: droid exec [options] [prompt]

Execute a single command (non-interactive mode)

Arguments:
  prompt                          The prompt to execute

Options:
  -o, --output-format <format>    Output format (default: "text")
  -f, --file <path>               Read prompt from file
  --auto <level>                  Autonomy level: low|medium|high
  --skip-permissions-unsafe       Skip ALL permission checks (unsafe)
  -s, --session-id <id>           Existing session to continue (requires a prompt)
  -m, --model <id>                Model ID to use
  -r, --reasoning-effort <level>  Reasoning effort: off|low|medium|high
  --cwd <path>                    Working directory path
  -h, --help                      display help for command
```

Supported models (examples):

- gpt-5-codex (default)
- gpt-5-2025-08-07
- claude-sonnet-4-20250514
- claude-opus-4-1-20250805

## Installation

<Steps>
  <Step title="Install Droid CLI">
    <CodeGroup>
    ```bash macOS/Linux
    curl -fsSL https://app.factory.ai/cli | sh
    ```

    ```powershell Windows
    irm https://app.factory.ai/cli/windows | iex
    ```
    </CodeGroup>
  </Step>

  <Step title="Get Factory API Key">
    Generate your API key from the [Factory Settings Page](https://app.factory.ai/settings/api-keys)
  </Step>

  <Step title="Set Environment Variable">
    Export your API key as an environment variable:
    ```bash
    export FACTORY_API_KEY=fk-...
    ```
  </Step>
</Steps>

## Quickstart

- Direct prompt:
  - `droid exec "analyze code quality"`
  - `droid exec "fix the bug in src/main.js" --auto low`
- From file:
  - `droid exec -f prompt.md`
- Pipe:
  - `echo "summarize repo structure" | droid exec`
- Session continuation:
  - `droid exec --session-id <session-id> "continue with next steps"`

## Autonomy Levels

Droid exec uses a tiered autonomy system to control what operations the agent can perform. By default, it runs in read-only mode, requiring explicit flags to enable modifications.

### DEFAULT (no flags) - Read-only Mode
The safest mode for reviewing planned changes without execution:
- ‚úÖ Reading files or logs: cat, less, head, tail, systemctl status
- ‚úÖ Display commands: echo, pwd
- ‚úÖ Information gathering: whoami, date, uname, ps, top
- ‚úÖ Git read operations: git status, git log, git diff
- ‚úÖ Directory listing: ls, find (without -delete or -exec)
- ‚ùå No modifications to files or system
- **Use case:** Safe for reviewing what changes would be made

```bash
# Analyze and plan refactoring without making changes
droid exec "Analyze the authentication system and create a detailed plan for migrating from session-based auth to OAuth2. List all files that would need changes and describe the modifications required."

# Review code quality and generate report
droid exec "Review the codebase for security vulnerabilities, performance issues, and code smells. Generate a prioritized list of improvements needed."

# Understand project structure
droid exec "Analyze the project architecture and create a dependency graph showing how modules interact with each other."
```

### `--auto low` - Low-risk Operations
Enables basic file operations while blocking system changes:
- ‚úÖ File creation/editing in project directories
- ‚ùå No system modifications or package installations
- **Use case:** Documentation updates, code formatting, adding comments

```bash
# Safe file operations
droid exec --auto low "add JSDoc comments to all functions"
droid exec --auto low "fix typos in README.md"
```

### `--auto medium` - Development Operations
Operations that may have significant side effects, but these side effects are typically harmless and straightforward to recover from.
Adds common development tasks to low-risk operations:
- Installing packages from trusted sources: npm install, pip install (without sudo)
- Network requests to trusted endpoints: curl, wget to known APIs
- Git operations that modify local repositories: git commit, git checkout, git pull (but not git push)
- Building code with tools like make, npm run build, mvn compile
- ‚ùå No git push, sudo commands, or production changes
- **Use case:** Local development, testing, dependency management

```bash
# Development tasks
droid exec --auto medium "install deps, run tests, fix issues"
droid exec --auto medium "update packages and resolve conflicts"
```

### `--auto high` - Production Operations
Commands that may have security implications such as data transfers between untrusted sources or execution of unknown code, or major side effects such as irreversible data loss or modifications of production systems/deployments.
- Running arbitrary/untrusted code: curl | bash, eval, executing downloaded scripts
- Exposing ports or modifying firewall rules that could allow external access
- Git push operations that modify remote repositories: git push, git push --force
- Irreversible actions to production deployments, database migrations, or other sensitive operations
- Commands that access or modify sensitive information like passwords or keys
- ‚ùå Still blocks: sudo rm -rf /, system-wide changes
- **Use case:** CI/CD pipelines, automated deployments

```bash
# Full workflow automation
droid exec --auto high "fix bug, test, commit, and push to main"
droid exec --auto high "deploy to staging after running tests"
```

### `--skip-permissions-unsafe` - Bypass All Checks
<Warning>
  DANGEROUS: This mode allows ALL operations without confirmation. Only use in completely isolated environments like Docker containers or throwaway VMs.
</Warning>

- ‚ö†Ô∏è Allows ALL operations without confirmation
- ‚ö†Ô∏è Can execute irreversible operations
- Cannot be combined with --auto flags
- **Use case:** Isolated environments

```bash
# In a disposable Docker container for CI testing
docker run --rm -v $(pwd):/workspace alpine:latest sh -c "
  apk add curl bash &&
  curl -fsSL https://app.factory.ai/cli | sh &&
  droid exec --skip-permissions-unsafe 'Install all system dependencies, modify system configs, run integration tests that require root access, and clean up test databases'
"

# In ephemeral GitHub Actions runner for rapid iteration
# where the runner is destroyed after each job
droid exec --skip-permissions-unsafe "Modify /etc/hosts for test domains, install custom kernel modules, run privileged container tests, and reset network interfaces"

# In a temporary VM for security testing
droid exec --skip-permissions-unsafe "Run penetration testing tools, modify firewall rules, test privilege escalation scenarios, and generate security audit reports"
```

### Fail-fast Behavior

If a requested action exceeds the current autonomy level, droid exec will:
1. Stop immediately with a clear error message
2. Return a non-zero exit code
3. Not perform any partial changes

This ensures predictable behavior in automation scripts and CI/CD pipelines.

## Output formats and artifacts

Droid exec supports three output formats for different use cases:

### text (default)
Human-readable output for direct consumption or logs:

```bash
$ droid exec --auto low "create a python file that prints 'hello world'"
Perfect! I've created a Python file named `hello_world.py` in your home directory that prints 'hello world' when executed.
```

### json
Structured JSON output for parsing in scripts and automation:

```bash
$ droid exec "summarize this repository" --output-format json
{
  "type": "result",
  "subtype": "success",
  "is_error": false,
  "duration_ms": 5657,
  "num_turns": 1,
  "result": "This is a Factory documentation repository containing guides for CLI tools, web platform features, and onboarding procedures...",
  "session_id": "8af22e0a-d222-42c6-8c7e-7a059e391b0b"
}
```

Use JSON format when you need to:
- Parse the result in a script
- Check success/failure programmatically
- Extract session IDs for continuation
- Process results in a pipeline

### debug
Streaming messages showing the agent's execution in real-time:

```bash
$ droid exec "run ls command" --output-format debug
{"type":"message","role":"user","text":"run ls command"}
{"type":"message","role":"assistant","text":"I'll run the ls command to list the contents..."}
{"type":"tool_call","toolName":"Execute","parameters":{"command":"ls -la"}}
{"type":"tool_result","value":"total 16\ndrwxr-xr-x@ 8 user staff..."}
{"type":"message","role":"assistant","text":"The ls command has been executed successfully..."}
```

Debug format is useful for:
- Monitoring agent behavior
- Troubleshooting execution issues
- Understanding tool usage patterns
- Real-time progress tracking

For automated pipelines, you can also direct the agent to write specific artifacts:

```bash
droid exec --auto low "Analyze dependencies and write to deps.json"
droid exec --auto low "Generate metrics report in CSV format to metrics.csv"
```

## Working directory

- Use `--cwd` to scope execution:

```
droid exec --cwd /home/runner/work/repo "Map internal packages and dump graphviz DOT to deps.dot"
```

## Models and reasoning effort

- Choose a model with `-m` and adjust reasoning with `-r`:

```
droid exec -m claude-sonnet-4-20250514 -r medium -f plan.md
```

## Batch and parallel patterns

Shell loops (bounded concurrency):

```bash
# Process files in parallel (GNU xargs -P)
find src -name "*.ts" -print0 | xargs -0 -P 4 -I {} \
  droid exec --auto low "Refactor file: {} to use modern TS patterns"
```

Background job parallelization:

```bash
# Process multiple directories in parallel with job control
for path in packages/ui packages/models apps/factory-app; do
  (
    cd "$path" &&
    droid exec --auto low "Run targeted analysis and write report.md"
  ) &
done
wait  # Wait for all background jobs to complete
```

Chunked inputs:

```bash
# Split large file lists into manageable chunks
git diff --name-only origin/main...HEAD | split -l 50 - /tmp/files_
for f in /tmp/files_*; do
  list=$(tr '\n' ' ' < "$f")
  droid exec --auto low "Review changed files: $list and write to review.json"
done
rm /tmp/files_*  # Clean up temporary files
```

Workflow Automation (CI/CD):

```yaml
# Dead code detection and cleanup suggestions
name: Code Cleanup Analysis
on:
  schedule:
    - cron: '0 1 * * 0' # Weekly on Sundays
  workflow_dispatch:
jobs:
  cleanup-analysis:
    strategy:
      matrix:
        module: ['src/components', 'src/services', 'src/utils', 'src/hooks']
    steps:
      - uses: actions/checkout@v4
      - run: droid exec --cwd "${{ matrix.module }}" --auto low "Identify unused exports, dead code, and deprecated patterns. Generate cleanup recommendations in cleanup-report.md"
```

## Unique usage examples

License header enforcer:

```bash
git ls-files "*.ts" | xargs -I {} \
  droid exec --auto low "Ensure {} begins with the Apache-2.0 header; add it if missing"
```

API contract drift check (read-only):

```bash
droid exec "Compare openapi.yaml operations to our TypeScript client methods and write drift.md with any mismatches"
```

Security sweep:

```bash
droid exec --auto low "Run a quick audit for sync child_process usage and propose fixes; write findings to sec-audit.csv"
```

## Exit behavior

- 0: success
- Non-zero: failure (permission violation, tool error, unmet objective). Treat non-zero as failed in CI.

## Best practices

- Favor `--auto low`; keep mutations minimal and commit/push in scripted steps.
- Avoid `--skip-permissions-unsafe` unless fully sandboxed.
- Ask the agent to emit artifacts your pipeline can verify.
- Use `--cwd` to constrain scope in monorepos.
</file>

<file path="docs/cli/getting-started/common-use-cases.mdx">
---
title: Common Use Cases
description: Practical, day‚Äëone workflows you can run in the interactive terminal UI.
---

Droid excels at real-world development tasks. This guide shows practical workflows you can use immediately, with specific prompts that get great results.

## Understanding a new codebase

**Start with the big picture:**

```
Analyze this codebase and explain the overall architecture.
What technologies and frameworks does this project use?
Where are the main entry points and how is testing set up?
```

**Drill down into specifics:**

```
Explain how user authentication flows through this system.
What are the main components in the frontend and how do they interact?
Show me where the API routes are defined and list the key handlers.
```

**Navigate by domain:**

```
Where does payment processing happen? Walk me through a typical payment flow.
Find all the database models and explain their relationships.
Show me the error handling patterns used throughout this codebase.
```

Droid leverages organizational knowledge and can read through your entire project structure to provide comprehensive explanations with relevant file references and architectural insights.

## Fixing bugs and debugging

**From error message to solution:**

```
I'm seeing this error in production:
TypeError: Cannot read properties of undefined (reading 'title')
at src/components/PostCard.tsx:37:14

Help me reproduce locally and fix it. Explain the root cause first.
```

**Using logs for debugging:**

```
Here are the server logs from the last hour showing 500 errors.
Find the failing code path and propose a fix with proper error handling.
```

**Systematic debugging:**

```
Users report that file uploads fail randomly with "Network timeout" errors.
The upload logic is in src/upload/handler.ts.
Add logging to diagnose the issue and implement retry logic.
```

Droid will analyze error patterns, create failing tests to reproduce issues, propose minimal fixes, and verify the solution works.

## Building features

**Enterprise workflow integration:**

```
Implement the feature described in this Jira ticket: https://company.atlassian.net/browse/PROJ-123
Follow our security standards and include comprehensive error handling.
```

**API development:**

```
Add a PATCH /users/:id endpoint with email uniqueness validation.
Return 200 on success, 400 on invalid payload, 404 if user missing.
Update the OpenAPI spec and add integration tests.
Similar patterns exist in src/routes/users/get.ts.
```

**Using Specification Mode:**
For complex features, use [Specification Mode](/cli/user-guides/specification-mode) to automatically get planning before implementation. This ensures proper architecture and reduces iterations.

## Working with tests

**Test-driven development:**

```
Write comprehensive tests for the user registration flow first.
Don't implement the actual registration logic yet.
Include tests for validation, duplicate emails, and password requirements.
```

**Fixing failing tests:**

```
Run tests and fix the first failing test.
Explain the root cause before making changes.
Show me the diff before applying any fixes.
```

**Improving test coverage:**

```
Identify untested critical paths in the payment processing module.
Propose specific test cases and implement them with proper mocks.
```

## Safe refactoring

**Structure improvements:**

```
Refactor the authentication module into smaller files with no behavior change.
Keep the public API identical and run all tests after each change.
```

**Dependency updates:**

```
Replace the deprecated bcrypt library with bcryptjs project-wide.
Update all imports and ensure compatibility across the codebase.
Show a summary of all files changed.
```

**Code quality:**

```
Extract the shared date utility functions into a separate module.
Update imports across the repository and run tests to confirm identical behavior.
```

## Documentation and communication

**API documentation:**

```
Generate comprehensive OpenAPI specification for the payments service.
Include request/response examples and error codes.
Create a TypeScript SDK based on the spec.
```

**Code explanations:**

```
Explain the relationship between the AutoScroller and ViewUpdater classes using a diagram.
Document the data flow and key methods for new team members.
```

**Release management:**

```
Summarize all changes in this branch and draft a pull request description.
Include breaking changes and migration notes for API consumers.
```

## Enterprise integration

**Team tool integration:**
If you've integrated platforms through Factory's dashboard, droid can automatically read context when you paste links to specific tickets or documents:

```
Read this Jira ticket and implement the feature: https://company.atlassian.net/browse/PROJ-123
Include all the acceptance criteria and follow our security standards.
```

```
Use the requirements from this Notion spec to implement the user preferences API: https://notion.so/team/user-prefs-spec
Follow the data structure and validation rules outlined in the document.
```

**Security-focused development:**

```
Add file upload functionality with proper validation to prevent directory traversal attacks.
Follow the security patterns used in our existing document upload feature.
Include rate limiting and file type validation.
```

**Compliance considerations:**

```
Review this authentication implementation for GDPR compliance.
Ensure proper data encryption and user consent handling.
Add audit logging for all user data access.
```

## Getting the most value

**Be specific and direct:** Instead of "fix the login bug," try "fix the authentication timeout where users get logged out after 5 minutes instead of the configured 30 minutes."

**Provide verification steps:** Tell droid how to confirm success‚Äîrun specific tests, check that services start cleanly, or verify UI behavior.

**Use organizational knowledge:** Reference team conventions, existing patterns, and established practices. Droid learns from your codebase and can help maintain consistency.

**Leverage the review workflow:** Always review proposed changes before approval. The transparent diff view helps you understand modifications and provide feedback for better future results.

## Next steps

Ready to try these workflows? Head to the [Quickstart](/cli/getting-started/quickstart) to get droid running, or dive into [Specification Mode](/cli/user-guides/specification-mode) for complex feature development.
For more communication tips, see [How to Talk to a Droid](/cli/getting-started/how-to-talk-to-a-droid) to learn proven prompting patterns that get better results.
For more communication tips, see [How to Talk to a Droid](/cli/getting-started/how-to-talk-to-a-droid) to learn proven prompting patterns that get better results.
</file>

<file path="docs/cli/getting-started/how-to-talk-to-a-droid.mdx">
---
title: How to Talk to a Droid
description: Proven techniques for writing prompts that get high-quality results from Factory's AI agents.
---

Droid works best with clear, specific instructions. Like pairing with a skilled engineer, the quality of your communication directly affects the results. This guide shows practical patterns that get better outcomes with fewer iterations.

## Core principles

**Be explicit about what you want.** Instead of "can you improve the auth system?" try "add rate limiting to login attempts with exponential backoff following the pattern in middleware/rateLimit.ts." Droid performs best when you clearly state your goal.

**Provide context upfront.** Include error messages, file paths, screenshots, or relevant documentation. If you're implementing something from a Jira ticket or design doc, paste the link‚Äîdroid can automatically read context from platforms you've integrated in Factory's dashboard.

**Choose your approach.** For complex features, consider using Specification Mode for automatic planning. For routine tasks, droid can proceed directly while still showing you all changes for review. See the [Planning versus doing](#planning-versus-doing) section for detailed guidance.

**Define success.** Tell droid how to verify the work is complete‚Äîrun specific tests, check that a service starts cleanly, or confirm a UI matches a mockup.

## Writing effective prompts

The best prompts are direct and include relevant details:

```
Add comprehensive error handling to the payment processor in src/payments/processor.ts.
Catch gateway timeouts and retry up to 3 times with exponential backoff.
Similar retry logic exists in src/notifications/sender.ts.
Run the payment integration tests to verify it works.
```

```
Run the build and fix all TypeScript errors. Focus on the auth module first.
```

```
Review my uncommitted changes with git diff and suggest improvements before I commit.
```

```
The login form allows empty submissions. Add client-side validation and return proper error messages.
Check that localhost:3000/login shows validation errors when fields are empty.
```

```
Refactor the database connection logic into a separate module but don't change any query interfaces.
```

Notice these examples:

- State the goal clearly in the first sentence
- Include specific files or commands when known
- Mention related code that might help
- Explain how to test the result
- Keep it conversational but direct

## Planning versus doing

For complex features, use [Specification Mode](/cli/user-guides/specification-mode) which automatically provides planning and review before implementation:

```
Add user preferences API with key-value storage following REST conventions.
Include validation and comprehensive tests.
```

For straightforward tasks, droid can proceed directly while still showing you changes for approval:

```
Fix the failing test in tests/auth.test.ts line 42
```

```
Add logging to the startup sequence with appropriate log levels.
```

## Managing context

**Use AGENTS.md files** to document build commands, testing procedures, and coding standards. Droid reads these automatically, so you don't have to repeat project conventions. See the [AGENTS.md guide](/cli/configuration/agents-md) for detailed setup instructions.

**Mention specific files** when you know where the code lives. Use `@filename` to reference files directly, or include file paths in your prompts. This focuses droid's attention and saves time.

**Set boundaries** for changes. "Only modify files in the auth directory" or "don't change the public API" helps contain the scope.

**Reference external resources** by including URLs to tickets, docs, designs, or specs. Droid can fetch and use this information.

## Common workflows

**Understanding code:**

```
Explain how user authentication flows through this system.
```

```
What are the main components in the frontend and how do they interact?
```

**Implementing features:**

```
Add a PATCH /users/:id endpoint with email uniqueness validation.
Update the OpenAPI spec and add integration tests.
Similar patterns exist in src/routes/users/get.ts.
```

**Fixing bugs:**

```
Users report file uploads fail randomly. Error in browser console: "Network timeout".
Upload logic is in src/upload/handler.ts. Check for timeout handling.
```

**Code review:**

```
Look at git diff and review these changes for security issues and maintainability.
```

**Refactoring:**

```
Extract the email sending logic into a separate service class.
Keep the same interfaces but make it testable in isolation.
```

## Enterprise integration

Reference your team's tools by pasting links to tickets or documents:

```
Implement the feature described in this Jira ticket: https://company.atlassian.net/browse/PROJ-123
Follow our security standards from the compliance docs.
```

If you've integrated these platforms in Factory's dashboard, droid can automatically read context from Jira, Notion, Slack, and other sources. For additional tool connections, droid also supports MCP integrations.

For security-sensitive work:

```
Add file upload functionality with proper validation to prevent directory traversal attacks.
Follow the security patterns used in our document upload feature.
```

## Session management

Start new conversations when context gets cluttered or when switching to unrelated tasks. Fresh context often works better than accumulated noise from failed attempts.

For large projects, break work into phases:

```
First implement the database schema changes. Don't add the API endpoints yet.
```

Then in a follow-up:

```
Now add the REST endpoints using the new schema. Include validation and error handling.
```

## Advanced techniques

**Test-driven development:**

```
Write comprehensive tests for the user registration flow first.
Don't implement the actual registration logic yet.
```

**Plan-driven development:**

```
Create a markdown file outlining the plan for updating both backend API and React components.
Include the shared data structure and implementation order.
Then implement each part following the documented plan.
```

## Examples of good prompts

Here are real examples that work well:

```
Run git blame on the file I have open and figure out who added the rate limiting logic.
```

```
Look at git diff staged and remove any debug statements before I commit.
```

```
Convert these 5 React components to use TypeScript. Use proper interfaces for props.
```

```
Find the commit that introduced the caching mechanism and explain how it works.
```

```
Add input validation to all the forms in the admin panel. Return 400 with clear error messages.
```

```
Check the production logs for any errors in the last hour and suggest fixes for the most common ones.
```

## What doesn't work well

Avoid vague requests:

- "Make the app better" ‚Üí too broad
- "Fix the database" ‚Üí not specific enough
- "Can you help with the frontend?" ‚Üí unclear goal

Don't make droid guess:

- If you know the file path, include it
- If you know the command to run, mention it
- If there's related code, point to it

## Getting better results

Treat droid like a capable teammate. Provide the same context and guidance you'd give a colleague working on the task. Be specific about quality standards and business requirements.

Remember that droid learns your organization's patterns over time. The more consistently you use it within your codebase, the better it becomes at following your conventions.

Most importantly, review the changes droid proposes. You maintain full control through the approval workflow, so take time to understand modifications and provide feedback for better future results.

Ready to try these patterns? Head back to the [Quickstart](/cli/getting-started/quickstart) and practice with your own code.
</file>

<file path="docs/cli/getting-started/overview.mdx">
---
title: Overview
sidebarTitle: Overview
description: Meet `droid` ‚Äî the power of Factory in your terminal
---
## Get started in 30 seconds

<CodeGroup>

```bash macOS/Linux
curl -fsSL https://app.factory.ai/cli | sh
```

```powershell Windows
irm https://app.factory.ai/cli/windows | iex
```

</CodeGroup>

Then navigate to your project and start the droid CLI.

<CodeGroup>
```bash
# Navigate to your project
cd /path/to/your/project

# Start interactive session
droid
```

</CodeGroup>

You're now connected to Factory's development agent from your terminal. [Try the 5-minute quickstart ‚Üí](/cli/getting-started/quickstart)

<Note>
  **Quick tip:** Press `!` to toggle bash mode and run shell commands directly without AI interpretation. Press `Esc` to return to normal mode. See the [CLI Reference](/reference/cli-reference#bash-mode) for details.
</Note>

## What `droid` brings to your workflow

- **End-to-end feature development**: From planning to implementation to testing - droid handles the complete development lifecycle while keeping you in control through transparent review workflows.
- **Deep codebase understanding**: Leverages your organization's shared knowledge across repositories, documentation, and issue tracking to provide contextually aware assistance that improves over time.
- **Engineering system integration**: Connects directly to your existing tools ‚Äî with native integrations to Jira, Notion, Slack, and many more tools ‚Äî so development work stays synchronized with your team's processes.
- **Production-ready automation**: Deploy the same workflows locally during development or in CI/CD pipelines, with enterprise security and compliance built-in from day one.

## Why teams choose Factory

- **Built for enterprise**: On-premise deployment options, SOC-2 compliance, and air-gapped environments. We prioritize security and quality over racing to the lowest price point.
- **Your tools, enhanced**: Works within your existing terminal, IDE, and development environment. No need to switch editors or learn new interfaces ‚Äî droid integrates where you're already productive.
- **Transparent and controllable**: Every decision droid makes is visible and reviewable. You maintain full oversight of code changes with our native diff viewer and approval workflows.
- **Model flexibility**: Not locked into a single AI provider. Factory allows you to route tasks to the best model for each job while maintaining consistent behavior and memory across your organization.

## Next steps

<CardGroup cols={2}>
  <Card
    title="Quickstart"
    icon="rocket"
    href="/cli/getting-started/quickstart"
  >
    See droid in action with practical examples
  </Card>
  <Card
    title="Common Use Cases"
    icon="lightbulb"
    href="/cli/getting-started/common-use-cases"
  >
    Step-by-step guides for common workflows
  </Card>
  <Card
    title="IDE Integration"
    icon="code"
    href="/cli/configuration/ide-integrations"
  >
    Add droid to your IDE
  </Card>
  <Card
    title="Configuration"
    icon="gear"
    href="/cli/configuration/settings"
  >
    Customize droid for your workflow
  </Card>
</CardGroup>

## Additional resources

<CardGroup cols={2}>
  <Card
    title="AGENTS.md Guide"
    icon="file-lines"
    href="/cli/configuration/agents-md"
  >
    Configure project-specific guidance and conventions
  </Card>
  <Card
    title="CLI Reference"
    icon="terminal"
    href="/reference/cli-reference"
  >
    Complete reference for droid commands
  </Card>
  {false && (
    <>
      <Card
        title="CI/CD Integration"
        icon="diagram-project"
        href="/cli/configuration/ci-cd"
      >
        Use droid in your continuous integration pipelines
      </Card>
      <Card
        title="Pricing & Usage"
        icon="credit-card"
        href="/cli/account/tokens-and-pricing"
      >
        Understand usage tracking and billing
      </Card>
    </>
  )}
</CardGroup>
```
</file>

<file path="docs/cli/getting-started/quickstart.mdx">
---
title: "Quickstart"
description: "Get productive with droid in 5 minutes using the interactive terminal UI."
---

This quickstart guide will have you collaborating with Factory's development agent in just a few minutes. You'll experience how droid understands your codebase, makes thoughtful changes, and integrates with your existing workflow.

## Before you begin

Make sure you have:

- A terminal open in a code project
- Git repository (recommended for full workflow demonstration)

## Step 1: Install and start droid

<CodeGroup>

```bash macOS/Linux
curl -fsSL https://app.factory.ai/cli | sh
```

```powershell Windows
irm https://app.factory.ai/cli/windows | iex
```

</CodeGroup>

<Note>
  **Linux users:** Ensure `xdg-utils` is installed for proper functionality. Install with: `sudo apt-get install xdg-utils`
</Note>

Then navigate to your project and start the droid CLI.

<CodeGroup>
```bash
# Navigate to your project
cd /path/to/your/project

# Start interactive session
droid
```

</CodeGroup>

<img
  src="/images/droid_tui_intro.png"
  alt="Droid CLI"
  height="450"
  className="rounded-lg"
/>

You'll see droid's welcome screen in a full-screen terminal interface. If prompted, sign in via your browser to connect to Factory's development agent.

## Step 2: Explore your codebase

Let's start by having droid understand your project. Try one of these questions:

```

> analyze this codebase and explain the overall architecture

```

```

> what technologies and frameworks does this project use?

```

```

> where are the main entry points and how is testing set up?

```

Droid reads your files contextually and leverages organizational knowledge to provide comprehensive insights about your project structure and conventions.

## Step 3: Make your first code change

Now let's see droid in action with a simple modification:

```

> add comprehensive logging to the main application startup

```

Droid will:

1. Analyze your current logging setup
2. Propose specific changes with a clear plan
3. Show you exactly what will be modified
4. Wait for your approval before making changes

This transparent review process ensures you maintain full control over all code modifications.

## Step 4: Experience enterprise workflows

Try a more complex task that showcases droid's enterprise capabilities:

```

> audit this codebase for security vulnerabilities and create a remediation plan

```

Or provide context from your team's tools by pasting a link:

```

> implement the feature described in this Jira ticket: https://company.atlassian.net/browse/PROJ-123

```

If you've integrated these platforms through Factory's dashboard, droid can automatically read context from Jira, Notion, Slack, and other sources. Droid can also connect to additional tools via MCP integrations for even more capabilities.

## Step 5: Handle version control

Droid makes Git operations conversational and intelligent:

```

> review my uncommitted changes and suggest improvements before I commit

```

```

> create a well-structured commit with a descriptive message following our team conventions

```

```

> analyze the last few commits and identify any potential issues or patterns

```

## Essential controls

Here are the key interactions you'll use daily:

| Action           | What it does                   | How to use                     |
| ---------------- | ------------------------------ | ------------------------------ |
| Send message     | Submit a task or question      | Type and press **Enter**       |
| Multi-line input | Write longer prompts           | **Shift\+Enter** for new lines |
| Approve changes  | Accept proposed modifications  | Accept change in the TUI       |
| Reject changes   | Decline proposed modifications | Reject change in the TUI       |
| Switch modes     | Toggle between modes           | **Shift\+Tab**                 |
| View shortcuts   | See all available commands     | Press **?**                    |
| Exit session     | Leave droid                    | **Ctrl\+C** or type `exit`     |

### Useful slash commands

Quick shortcuts to common actions:

- `/settings` - Configure droid behavior, models, and preferences
- `/model` - Switch between AI models mid-session
- `/mcp` - Manage Model Context Protocol servers
- `/account` - Open your Factory account settings in browser
- `/billing` - View and manage your billing settings
- `/help` - See all available commands

[Learn how to create custom slash commands ‚Üí](/cli/configuration/custom-slash-commands)

## Collaboration best practices

**Be specific with context:**
Instead of: "fix the bug"
Try: "fix the authentication timeout issue where users get logged out after 5 minutes instead of the configured 30 minutes"

**Use spec mode for complex features:**
For larger features, use [Specification Mode](/cli/user-guides/specification-mode) which automatically provides planning before implementation without needing to explicitly request it.

**Leverage organizational knowledge:**

```

> following our team's coding standards, implement the user preferences feature described in ticket PROJ-123

```

**Use the review workflow:**
Always review droid's proposed changes before approval. The transparent diff view helps you understand exactly what will be modified.

## Pro tips for enterprise teams

**Security-first approach:**
Droid automatically considers security implications and will flag potential vulnerabilities during code generation.

**Compliance integration:**
Connect your compliance tools through MCP to ensure all changes meet your organization's standards.

**Team knowledge sharing:**
Droid learns from your organization's patterns and can help maintain consistency across team members and projects.

## What's next?

<CardGroup cols={2}>
  <Card
    title="Common Use Cases"
    icon="lightbulb"
    href="/cli/getting-started/common-use-cases"
  >
    Explore real-world scenarios and workflows
  </Card>
  <Card
    title="Configuration"
    icon="gear"
    href="/cli/configuration/settings"
  >
    Customize droid for your team's workflow
  </Card>
  <Card
    title="AGENTS.md Guide"
    icon="file-text"
    href="/cli/configuration/agents-md"
  >
    Document your project conventions and commands
  </Card>
  <Card
    title="IDE Integration"
    icon="code"
    href="/cli/configuration/ide-integrations"
  >
    Use droid within your favorite editor
  </Card>
</CardGroup>
```
</file>

<file path="docs/cli/getting-started/video-walkthrough.mdx">
---
title: "Video Walkthrough"
description: "A video tutorial covering installation, configuration, and all key features of the Droid CLI"
---

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://youtube.com/embed/aw0thMXwAMY"
  title="Factory Video Walkthrough"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## Installation & Setup

Get started by installing the Droid CLI in your terminal of choice.

<CodeGroup>

```bash macOS/Linux
curl -fsSL https://app.factory.ai/cli | sh
```

```powershell Windows
irm https://app.factory.ai/cli/windows | iex
```

</CodeGroup>

Verify the installation:

```bash
which droid
```

Start the Droid CLI:

```bash
cd /path/to/your/project
droid
```

### First-Time Authentication

On your first run, you'll see an onboarding screen:

1. Choose to create an account or log in
2. Confirm the authentication code in your browser
3. Return to the terminal to start using droid

## Interface & Shortcuts

### Help Menu

Press `Shift + ?` to open the help menu, which shows:

- How to send messages and create new lines
- Available keyboard shortcuts
- Basic navigation commands
- Autonomy mode options

<Note>
  **Terminal-specific key bindings**: The default for new lines is `\` + `Enter`, but you can configure this to `Shift + Enter` or other combinations based on your terminal's key bindings. Check `/terminal-setup` in the CLI for configuration options.
</Note>

### Essential Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| `Enter` | Send message |
| `\` + `Enter` (or `Shift + Enter`) | New line in message |
| `Esc` (double tap) | Clear current input |
| `Shift + ?` | Open help menu |
| `Shift + Tab` | Cycle through autonomy modes |
| `/` | Open command menu |
| `Cmd + Shift + H` | Show root directory |
| `Cmd + Shift + .` | Show hidden files/folders |
| `Ctrl + C` or `exit` | Exit droid |
| `Ctrl + V` | Paste image |

<Note>
  The paste image shortcut works across all terminals, though the specific key binding may vary based on your terminal configuration.
</Note>

## Autonomy Modes

Cycle through different autonomy levels by pressing `Shift + Tab`:

[Learn more about Specification Mode ‚Üí](/cli/user-guides/specification-mode)

<AccordionGroup>
  <Accordion title="Spec Mode (Research & Plan Only)">
    Droid will research and create a plan without making any changes. Perfect for understanding what will happen before execution.
    
    - No file edits
    - No command execution
    - Creates detailed specifications
    - Allows iteration on plans before proceeding
  </Accordion>

  <Accordion title="Low Mode (Read-Only + Safe Commands)">
    Allows reading files and executing low-risk, read-only commands.
    
    - File reading
    - Directory listing
    - Safe diagnostic commands
    - No modifications
  </Accordion>

  <Accordion title="Medium Mode (File Edits Allowed)">
    Enables file modifications and medium-risk commands that are easily reversible.
    
    - Create/edit/delete files
    - Run build commands
    - Execute tests
    - Reversible operations
  </Accordion>

  <Accordion title="High Mode (All Commands with Safeguards)">
    Allows all commands but still maintains safety through allow/deny lists.
    
    - Full command execution
    - File removal operations (with confirmation)
    - Git operations
    - Configurable via allow/deny lists
  </Accordion>
</AccordionGroup>

<Warning>
  Even in High mode, certain dangerous operations (like removing files) will always require your approval unless you explicitly configure them in the allow list.
</Warning>

[Configure autonomy settings ‚Üí](/cli/configuration/settings)

## Slash Commands

Press `/` to access the command menu with options for:

- **Account & Billing** - Manage your Factory account
- **Model** - Switch between AI models and set reasoning levels
- **Sessions** - View and navigate previous sessions
- **Settings** - Configure CLI preferences
- **Terminal Setup** - Configure key bindings
- **Custom Commands** - Access your [custom slash commands](/cli/configuration/custom-slash-commands)
- **Droids** - Manage [custom sub-agents](/cli/configuration/custom-droids)
- **MCP** - Configure [Model Context Protocol integrations](/cli/configuration/mcp)

### Switching Models

Access the model menu with `/model`:

1. View available models
2. Switch between models for different tasks
3. Set reasoning level where applicable

<Tip>
  Different models excel at different tasks. Use reasoning models for complex planning and faster models for routine edits.
</Tip>

[Learn about choosing your model ‚Üí](/cli/user-guides/choosing-your-model)

### Sessions Management

Access with `/sessions`:

- View all previous sessions
- Navigate to any past session
- Open sessions in the web interface
- Continue work from where you left off

Cloud sync must be enabled in settings for sessions to appear in the web interface.

## Settings & Configuration

Access settings via `/settings` to customize your experience:

[Full settings documentation ‚Üí](/cli/configuration/settings)

### Core Settings

<CardGroup cols={2}>
  <Card title="Model & Reasoning">
    Choose your default model and reasoning level for new sessions
  </Card>
  
  <Card title="Diff Mode">
    Configure how code changes are displayed
  </Card>
  
  <Card title="GitHub Completion">
    Enable/disable GitHub Copilot-style completions
  </Card>
  
  <Card title="Cloud Sync">
    Sync sessions to Factory web platform
  </Card>
</CardGroup>

### Advanced Settings

<AccordionGroup>
  <Accordion title="Droid Co-Author on PRs">
    When enabled, droid will be added as a co-author on pull requests it helps create. You can disable this if you prefer to be the sole author.
  </Accordion>

  <Accordion title="Droid Shield">
    Protects environment variables and secrets in your code. Prevents accidental commits of sensitive information like API keys, passwords, and tokens.
    
    <Warning>
      Keep this enabled to protect against security vulnerabilities.
    </Warning>
    
    [Learn more about Droid Shield ‚Üí](/cli/account/droid-shield)
  </Accordion>

  <Accordion title="Save Spec as Markdown">
    Automatically saves specifications generated in Spec Mode as markdown files on your machine for reference and documentation.
    
    [Learn more about Specification Mode ‚Üí](/cli/user-guides/specification-mode)
  </Accordion>

  <Accordion title="Allow List & Deny List">
    Configure which commands require approval even in High autonomy mode. Even on High, file removal operations require confirmation by default.
    
    [Learn more about auto-run settings ‚Üí](/cli/user-guides/auto-run)
  </Accordion>
</AccordionGroup>

### IDE Integration

Install the droid extension for VS Code, Cursor, and other IDEs directly from the settings menu.

[Learn more about IDE integration ‚Üí](/cli/configuration/ide-integrations)

## Configuration Files

Access your configuration directory by pressing `Cmd + Shift + H` to show your root directory, then `Cmd + Shift + .` to reveal hidden files. Navigate to the `~/.factory/` folder.

### Directory Structure

```
~/.factory/
‚îú‚îÄ‚îÄ config.json          # Model configuration and BYOK
‚îú‚îÄ‚îÄ settings.json        # CLI settings and allow/deny lists
‚îú‚îÄ‚îÄ mcp.json            # MCP integrations
‚îú‚îÄ‚îÄ droids/             # Custom sub-agents
‚îú‚îÄ‚îÄ commands/           # Custom slash commands
‚îú‚îÄ‚îÄ logs/               # Session logs
‚îî‚îÄ‚îÄ bug-reports/        # Crash reports
```

<Tip>
  Learn more: [Settings](/cli/configuration/settings) | [Custom Slash Commands](/cli/configuration/custom-slash-commands) | [Custom Droids](/cli/configuration/custom-droids) | [MCP Configuration](/cli/configuration/mcp)
</Tip>

### config.json - Bring Your Own Key

Configure custom models using your own API keys:

```json
{
  "models": [
    {
      "provider": "openrouter",
      "name": "anthropic/claude-3.5-sonnet",
      "apiKey": "your-api-key-here",
      "displayName": "Claude 3.5 Sonnet (OpenRouter)"
    }
  ]
}
```

<Steps>
  <Step title="Find Provider Documentation">
    Visit [Bring Your Own Key documentation](/cli/byok/overview) and select your provider (OpenRouter, Fireworks, etc.)
  </Step>
  
  <Step title="Copy Configuration Template">
    Copy the JSON configuration for your chosen provider
  </Step>
  
  <Step title="Add to config.json">
    Paste the configuration into `~/.factory/config.json` and add your API key
  </Step>
  
  <Step title="Select Model">
    Use `/model` in the CLI to select your newly added model
  </Step>
</Steps>

[See all BYOK providers ‚Üí](/cli/byok/overview)

### settings.json - Allow & Deny Lists

Configure which commands require approval in High autonomy mode:

```json
{
  "autoModeAllow": [],
  "autoModeDeny": [
    "git push",
    "rm -rf",
    "npm publish"
  ]
}
```

Even in High mode, commands in the `autoModeDeny` list will always require your explicit approval before execution.

### mcp.json - MCP Integrations

Enable or disable MCP tools individually:

```json
{
  "mcpServers": {
    "brave-search": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-brave-search"],
      "env": {
        "BRAVE_API_KEY": "your-api-key"
      }
    },
    "playwright": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-playwright"],
      "disabled": true
    }
  }
}
```

Set `"disabled": true` to temporarily disable an MCP without removing its configuration.

[Learn more about MCP configuration ‚Üí](/cli/configuration/mcp)

## Custom Droids (Sub-Agents)

Custom droids are specialized AI agents that handle specific tasks. Access the droids menu with `/droids`:

### Managing Droids

- **Import** (`i`) - Import pre-built droids from other agents
- **Create** (`c`) - Create a new custom droid
- **Edit** - Modify existing droid configurations
- **Enable/Disable** - Toggle droids on or off

### Creating a Custom Droid

[Learn more about custom droids ‚Üí](/cli/configuration/custom-droids)

<Steps>
  <Step title="Choose Scope">
    Decide if the droid should be **project-level** (specific repository) or **personal** (available across all projects)
  </Step>
  
  <Step title="Generation Method">
    Choose to create manually or generate with droid's help:
    
    ```
    I want a code review droid that checks for security issues and coding standards
    ```
    
    Droid will generate an appropriate description and configuration
  </Step>
  
  <Step title="Configure Model">
    - **Inherit**: Use the same model as the parent session
    - **Specific Model**: Choose a dedicated model for this droid (e.g., use a reasoning model for complex analysis)
  </Step>
  
  <Step title="Enable Tools">
    Select which tools and capabilities the droid should have access to
  </Step>
  
  <Step title="Save & Edit">
    Confirm the configuration and optionally edit the details
  </Step>
</Steps>

### Example Use Cases

- **Code Review Droid** - Automated code reviews for pull requests
- **Documentation Droid** - Generates and maintains documentation
- **Test Generation Droid** - Creates comprehensive test suites
- **Security Audit Droid** - Scans for vulnerabilities and security issues

## MCP Integrations

Model Context Protocol (MCP) allows droid to integrate with external tools and data sources.

### Adding MCPs via CLI

Use the `/mcp add` command:

```bash
/mcp add
```

Then provide the MCP details:
- **Name**: Identifier for the MCP
- **Command**: Executable command (e.g., `npx`, `python`)
- **Args**: Command arguments
- **Environment Variables**: API keys and configuration

### Listing Configured MCPs

```bash
/mcp list
```

This shows all configured MCPs and their enabled/disabled status.

<Note>
  After adding or modifying MCPs, you may need to restart the CLI for changes to take effect.
</Note>

### Adding MCPs via Configuration File

You can also directly edit `~/.factory/mcp.json`:

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/directory"]
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "your-token-here"
      }
    }
  }
}
```

### Popular MCP Integrations

- **Brave Search** - Web search capabilities
- **Playwright** - Browser automation
- **GitHub** - Repository and issue management
- **Filesystem** - Extended file system access
- **Postgres** - Database queries
- **Slack** - Team communication

[Browse all MCP servers ‚Üí](/cli/configuration/mcp)

## Example Workflow: Spec Mode to Implementation

Here's a complete workflow demonstrating droid's capabilities:

<Steps>
  <Step title="Start in Spec Mode">
    Press `Shift + Tab` until you're in Spec mode
    
    ```
    Create an authentication system with GitHub and Google OAuth
    ```
  </Step>
  
  <Step title="Review the Plan">
    Droid generates a detailed specification:
    - Architecture decisions
    - Files to create/modify
    - Dependencies needed
    - Implementation steps
  </Step>
  
  <Step title="Iterate on the Spec">
    Refine the plan before implementation:
    
    ```
    Change the plan to only include Github auth and not Google auth
    ```
    
    Droid updates the specification accordingly
  </Step>
  
  <Step title="Approve and Proceed">
    Once satisfied with the plan, proceed with High mode to implement
  </Step>
  
  <Step title="Review Changes">
    Droid shows exactly what will change and waits for your approval
  </Step>
</Steps>

<Tip>
  Spec mode is especially powerful for complex features. It allows you to validate the approach before any code is written.
</Tip>

[Read the full Specification Mode guide ‚Üí](/cli/user-guides/specification-mode)

[Learn about implementing large features ‚Üí](/cli/user-guides/implementing-large-features)

## Summary

You've learned how to:

- Install and authenticate with the Droid CLI
- Navigate the interface and use keyboard shortcuts
- Understand and switch between autonomy modes
- Configure settings and preferences
- Add custom models with BYOK
- Create and manage custom droids (sub-agents)
- Integrate external tools via MCP
- Use spec mode for planning before implementation

## Next Steps

<CardGroup cols={2}>
  <Card
    title="How to Talk to a Droid"
    icon="comments"
    href="/cli/getting-started/how-to-talk-to-a-droid"
  >
    Learn best practices for communicating with droid
  </Card>
  
  <Card
    title="Common Use Cases"
    icon="lightbulb"
    href="/cli/getting-started/common-use-cases"
  >
    Explore real-world workflows and scenarios
  </Card>
  
  <Card
    title="Become a Power User"
    icon="bolt"
    href="/cli/user-guides/become-a-power-user"
  >
    Advanced techniques and productivity tips
  </Card>
  
  <Card
    title="AGENTS.md Guide"
    icon="file-lines"
    href="/cli/configuration/agents-md"
  >
    Document project-specific conventions
  </Card>
</CardGroup>
</file>

<file path="docs/cli/user-guides/auto-run.mdx">
---
title: Auto-Run Mode
description: Choose low, medium, or high autonomy so droid can execute work that matches your risk tolerance without repeated confirmations.
---

Auto-Run Mode lets you decide how much autonomy droid has after you approve a plan. Instead of confirming every tool call, pick the level of risk you are comfortable with and droid will keep moving while still surfacing everything it does.

<CardGroup cols={2}>
  <Card title="Configurable Autonomy" icon="slider">
    Switch between Low, Medium, and High depending on the type of work in front of you.
  </Card>
  <Card title="Risk-Aware Execution" icon="shield-check">
    Commands run automatically only when their risk rating is at or below your chosen level.
  </Card>
  <Card title="No Surprises" icon="eye">
    Dangerous commands and command substitutions always require an explicit approval.
  </Card>
  <Card title="Persistent Preference" icon="floppy">
    Your autonomy level is saved in settings and restored for the next session.
  </Card>
</CardGroup>

## Autonomy levels at a glance

| Level | What runs automatically | Typical examples |
| --- | --- | --- |
| **Auto (Low)** | File edits, file creation, and read-only commands from the built-in allowlist | `Edit`, `Create`, `ls`, `git status`, `rg` |
| **Auto (Medium)** | Everything from Low plus reversible commands that change your workspace | `npm install`, `pip install`, `git commit`, `mv`, `cp`, build tooling |
| **Auto (High)** | All commands that are not explicitly blocked for safety | `docker compose up`, `git push` (if allowed), migrations, custom scripts |

Auto-Run always shows streamed output and highlights every file change, regardless of the autonomy level.

## Risk classification

Every command sent through the CLI includes a risk rating (`low`, `medium`, or `high`) along with a short justification. Auto-Run compares that rating to your selected autonomy level:

- **Low risk** ‚Äì read-only operations and changes that cannot create irreversible damage (listing files, showing logs, git diff).
- **Medium risk** ‚Äì actions that alter your workspace but are straightforward to undo (package installs, moving files, local git operations, builds).
- **High risk** ‚Äì commands that could be destructive, hard to roll back, or security sensitive (sudo, wiping directories, deploying, piping remote scripts).

Commands run automatically only when their risk level is less than or equal to your current setting. If a tool labels a command above your threshold, the CLI pauses and asks for confirmation.

## How Auto-Run decides what to execute

- **File tools** (`Create`, `Edit`, `MultiEdit`, `ApplyPatch`) are treated as low risk and run instantly whenever Auto-Run is active.
- **Execute commands** follow the risk threshold. Low autonomy auto-accepts only read-only allowlisted commands. Medium adds reversible commands. High accepts any command with a declared risk level, except for those blocked below.
- **Safety interlocks** always trigger confirmation, even in Auto (High): dangerous patterns (`rm -rf /`, `dd of=/dev/*`, etc.), command substitution (`$(...)`, backticks), or anything explicitly flagged by the CLI security checks.
- **Allowlist expansion** ‚Äì when you approve a command, you can add it to the session allowlist so future occurrences run without another prompt.

## Enabling and switching modes

- **Cycle from the keyboard** ‚Äì press **Shift+Tab** (or `Ctrl+T` on Windows) to move through Normal ‚Üí Spec ‚Üí Auto (Low) ‚Üí Auto (Medium) ‚Üí Auto (High) ‚Üí back to Normal. The active mode is shown in the status banner and Help popup.
- **Set a default in Settings** ‚Äì open the CLI settings menu, choose your preferred autonomy level, and the CLI persists it for future sessions.
- **Choose it after a spec** ‚Äì when approving a Specification Mode plan, pick ‚ÄúProceed‚Äù (manual), or enable Auto-Run at Low, Medium, or High for the implementation phase.
- **Return to manual control** at any time by cycling back to Normal; droid will resume asking for each file change and command.

## Workflow examples

**Auto (Low)** ‚Äì quick file updates and reconnaissance
```
- Update docs/README.md with new instructions
- Run ls, git status, and rg searches as needed
```
All edits and read-only checks happen without prompts, while anything that modifies dependencies still asks first.

**Auto (Medium)** ‚Äì feature work that needs tooling
```
- Add a new React component (multiple file edits)
- npm install @acme/widget
- npm run lint
```
File changes, dependency installs, and build scripts execute automatically so long as they are reversible.

**Auto (High)** ‚Äì migrations or integration tests
```
- Run database migration script
- docker compose up test-environment
- git push origin feature/autonomy-docs
```
Droid executes the entire sequence without pauses while still blocking obviously dangerous commands.

## When you will still get prompted

- A command is rated above your current autonomy level.
- The CLI detects command substitution or a dangerous pattern.
- A tool requests something outside the session allowlist and you are in Auto (Low).
- Droid needs clarity (e.g., missing context, ambiguous edits) and asks for input.
- You manually interrupt with **Esc** (single tap interrupts operations; double tap clears current input).

## Best practices

- Start new or high-stakes work in Normal or Auto (Low) until you trust the plan.
- Use Auto (Medium) for day-to-day feature development and refactors that rely on package managers or build steps.
- Reserve Auto (High) for well-understood pipelines where you expect droid to run end-to-end scripts.
- If you spot a suspect command, interrupt, provide guidance, and resume at the autonomy level that fits the remaining risk.

Ready to try it? Cycle into the level you need with **Shift+Tab**, or pick the desired option when you approve your next spec.
</file>

<file path="docs/cli/user-guides/become-a-power-user.mdx">
---
title: Become a Power User
description: Maximize Droid performance with IDE integration, smart planning, and project optimization.
---

Want Droid to work faster, smarter, and with fewer iterations? These four power features transform good results into exceptional ones. Each technique saves tokens, reduces tool calls, and ships better code.

<CardGroup cols={2}>
  <Card title="Fewer Tool Calls" icon="plug">
    IDE plugin provides real-time context so Droid sees what you see
  </Card>
  <Card title="Better First Attempts" icon="bullseye">
    Spec Mode explores before coding, preventing false starts
  </Card>
  <Card title="Consistent Quality" icon="sparkles">
    AGENTS.md captures your standards once, applies them always
  </Card>
  <Card title="Self-Correcting Code" icon="circle-check">
    Linters and tests let Droid fix issues before you even see them
  </Card>
</CardGroup>

## Factory IDE Plugin ‚Äî Real-time context awareness

Make sure to install Factory IDE plugin for Droid. The Factory IDE plugin acts as an MCP server that gives Droid immediate awareness of your development environment. No more explaining what file you're looking at or copying error messages‚ÄîDroid sees exactly what you see.

**What Droid gets automatically:**
- Open files and selected lines
- VSCode error highlighting and diagnostics
- Project structure and active terminal output
- Your cursor position and recent edits

**Without the plugin:**
```
"Fix 'Property user does not exist on type AuthContext' error in auth.ts"
```

**With the plugin:**
```
"Fix error"
```

The plugin eliminates entire categories of back-and-forth. Droid knows the context, sees the errors that you see, and understands your intent from minimal input.

<Tip>
  **Quick setup:** Install the Factory extension from VSCode marketplace.
</Tip>

## Spec Mode ‚Äî Explore and plan first, code second

Complex features need exploration before implementation. Spec Mode prevents costly false starts by letting Droid investigate your codebase thoroughly before writing a single line of code.

<Steps>
  <Step title="Activate Spec Mode">
    Press **Shift+Tab** when starting complex work
  </Step>
  <Step title="Describe your goal">
    Write 1-2 sentences about what you want or provide fully-featured existing technical specs.
  </Step>
  <Step title="Droid explores">
    Searches relevant files, understands patterns, identifies dependencies
  </Step>
  <Step title="Review the plan">
    Get a detailed specification with implementation steps before any changes
  </Step>
  <Step title="Approve and execute">
    Only after you approve does Droid start making changes
  </Step>
</Steps>

**Perfect for:**
- Features touching 2+ files
- Architectural changes
- Unfamiliar codebases
- Security-sensitive work

Without Spec Mode, Droid might jump into implementation too early and not do the work in the exact way you would like. With it, you get a detailed specification and a chance to correct the path before too many tokens are wasted.

<Note>
  Spec Mode isn't just for features‚Äîuse it for complex debugging, refactoring, or any task where understanding comes before doing.
</Note>

## AGENTS.md ‚Äî Your preferences, remembered

AGENTS.md captures your coding standards, project conventions, and personal preferences in one place. Droid reads it automatically for every task.

**What to document:**

| Category | Examples |
| --- | --- |
| **Code style** | "Use arrow functions, not function declarations" <br/> "Prefer early returns over nested conditionals" |
| **Testing** | "Every new endpoint needs integration tests" <br/> "Use factories, not fixtures for test data" |
| **Architecture** | "Services go in src/services with matching interfaces" <br/> "All database queries use the repository pattern" |
| **Tooling** | "Run `npm run verify` before marking any task complete" <br/> "Deploy with `scripts/deploy.sh`, never manual commands" |
| **Mistakes to avoid** | "Never commit .env files" <br/> "Don't use any! type annotations" |

**Start simple, evolve over time:**

Create `AGENTS.md` in your project root:
```markdown
# Project Guidelines

## Testing
- Run `npm test` before completing any feature
- New features need unit tests
- API changes need integration tests

## Code Style  
- Use TypeScript strict mode
- Prefer composition over inheritance
- Keep functions under 20 lines

## Common Commands
- Lint: `npm run lint:fix`
- Test: `npm test`
- Build: `npm run build`
```

Every time Droid repeats a mistake or you explain something twice, add it to AGENTS.md. Within weeks, you'll have a personalized assistant that knows exactly how you work.

<Tip>
  **Pro tip:** Include examples of good code from your project. "Follow the pattern in src/services/UserService.ts" gives Droid a concrete template.
</Tip>

## Agent Readiness ‚Äî Let your tools do the teaching

Make your project self-correcting. When Droid can run the same verification tools as your CI/CD pipeline, it fixes problems immediately instead of waiting for you to point them out.

<CardGroup cols={2}>
  <Card title="Linters" icon="magnifying-glass">
    ESLint, Pylint catch style issues instantly
  </Card>
  <Card title="Type Checkers" icon="shield">
    TypeScript, mypy prevent type errors before runtime
  </Card>
  <Card title="Fast Tests" icon="gauge">
    Unit tests that run in seconds provide immediate feedback
  </Card>
  <Card title="Pre-commit Hooks" icon="hook">
    Husky, pre-commit ensure consistency before commits
  </Card>
</CardGroup>

<Warning>
  **Critical:** Keep verification fast. Slow tests will make the end-to-end work slower.
</Warning>

## Combining all four for maximum impact

These features compound. IDE plugin provides context ‚Üí Spec Mode uses that context for better planning ‚Üí AGENTS.md ensures consistent implementation ‚Üí Agent readiness catches issues immediately.

<Note>
  **Getting started?** Install the IDE plugin first‚Äîit's the fastest path to better results. Then add AGENTS.md with just your test commands. Build from there.
</Note>
</file>

<file path="docs/cli/user-guides/choosing-your-model.mdx">
---
title: Choosing Your Model
description: Balance accuracy, speed, and cost by picking the right model and reasoning level for each CLI task.
---

Model quality evolves quickly, and we tune the CLI defaults as the ecosystem shifts. Use this guide as a snapshot of how the major options compare today, and expect to revisit it as we publish updates. This guide was last updated on Wednesday, October 23rd 2025.

---

## 1 ¬∑ Current stack rank (October 2025)

| Rank | Model                    | Why we reach for it                                                                                                                              |
| ---- | ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | **Claude Sonnet 4.5**    | Recommended daily driver. Excellent balance of quality, speed, and cost for most development tasks. Current CLI default.                        |
| 2    | **GPT-5 Codex**          | Fast iteration loops with strong coding performance. Great for implementation-heavy work at lower cost than Sonnet.                             |
| 3    | **Claude Haiku 4.5**     | Fast and cost-effective for routine tasks, quick iterations, and high-volume automation. Best for speed-sensitive workflows.                    |
| 4    | **Droid Core (GLM-4.6)** | Open-source model with 0.25√ó token multiplier. Lightning-fast and budget-friendly for automation, bulk edits, and air-gapped environments.     |
| 5    | **GPT-5**                | Strong generalist from OpenAI. Choose when you prefer OpenAI ergonomics or need specific GPT features.                                          |
| 6    | **Claude Opus 4.1**      | Highest capability for extremely complex work. Use when you need maximum reasoning power for critical architecture decisions or tough problems. |

<Note>
  We ship model updates regularly. When a new release overtakes the list above,
  we update this page and the CLI defaults.
</Note>

---

## 2 ¬∑ Match the model to the job

| Scenario                                                         | Recommended model                                                                                                                          |
| ---------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| **Deep planning, architecture reviews, ambiguous product specs** | Start with **Sonnet 4.5** for strong reasoning at practical cost. Use **GPT-5 Codex** for faster iteration or **Haiku 4.5** for lighter tasks. |
| **Full-feature development, large refactors**                    | **Sonnet 4.5** is the recommended daily driver. Try **GPT-5 Codex** when you want faster loops or **Droid Core** for high-volume work.   |
| **Repeatable edits, summarization, boilerplate generation**      | **Haiku 4.5** or **Droid Core** for speed and cost savings. **GPT-5** or **Sonnet 4.5** when you need higher quality.                     |
| **CI/CD or automation loops**                                    | Favor **Haiku 4.5** or **Droid Core** for predictable throughput at low cost. Use **Sonnet 4.5** or **Codex** for complex automation.    |
| **High-volume automation, frequent quick turns**                 | **Haiku 4.5** for speedy feedback loops. **Droid Core** when cost is critical or you need air-gapped deployment.                          |

<Tip>
  **Claude Opus 4.1** remains available for extremely complex architecture decisions or critical work where you need maximum reasoning capability. Most tasks don't require Opus-level power‚Äîstart with Sonnet 4.5 and escalate only if needed.
</Tip>

Tip: you can swap models mid-session with `/model` or by toggling in the settings panel (`Shift+Tab` ‚Üí **Settings**).

---

## 3 ¬∑ Switching models mid-session

- Use `/model` (or **Shift+Tab ‚Üí Settings ‚Üí Model**) to swap without losing your chat history.
- If you change providers (e.g. Anthropc to OpenAI), the CLI converts the session transcript between Anthropic and OpenAI formats. The translation is lossy‚Äîprovider-specific metadata is dropped‚Äîbut we have not seen accuracy regressions in practice.
- For the best context continuity, switch models at natural milestones: after a commit, once a PR lands, or when you abandon a failed approach and reset the plan.
- If you flip back and forth rapidly, expect the assistant to spend a turn re-grounding itself; consider summarizing recent progress when you switch.

---

## 4 ¬∑ Reasoning effort settings

- Anthropic models (Opus/Sonnet/Haiku) show modest gains between Low and High.
- GPT models respond much more to higher reasoning effort‚Äîbumping **GPT-5** or **GPT-5 Codex** to **High** can materially improve planning and debugging.
- Reasoning effort increases latency and cost, so start Low for simple work and escalate when you need more depth.

<Tip>
  Change reasoning effort from `/model` ‚Üí **Reasoning effort**, or via the
  settings menu.
</Tip>

---

## 5 ¬∑ Bring Your Own Keys (BYOK)

Factory ships with managed Anthropic and OpenAI access. If you prefer to run against your own accounts, BYOK is opt-in‚Äîsee [Bring Your Own Keys](/cli/configuration/byok) for setup steps, supported providers, and billing notes.

### Open-source models

**Droid Core (GLM-4.6)** is an open-source alternative available in the CLI. It's useful for:

- **Air-gapped environments** where external API calls aren't allowed
- **Cost-sensitive projects** needing unlimited local inference
- **Privacy requirements** where code cannot leave your infrastructure
- **Experimentation** with open-source model capabilities

**Note:** GLM-4.6 does not support image attachments. For image-based workflows, use Claude or GPT models.

To use open-source models, you'll need to configure them via BYOK with a local inference server (like Ollama) or a hosted provider. See [BYOK documentation](/cli/configuration/byok) for setup instructions.

---

## 6 ¬∑ Keep notes on what works

- Track high-impact workflows (e.g., spec generation vs. quick edits) and which combinations of model + reasoning effort feel best.
- Ping the community or your Factory contact when you notice a model regression so we can benchmark and update this guidance quickly.
</file>

<file path="docs/cli/user-guides/implementing-large-features.mdx">
---
title: Implementing Large Features
description: A systematic approach to tackling complex, multi-phase development projects using specification planning and iterative implementation.
---

Large-scale features require careful planning and systematic execution to avoid overwhelming complexity. This guide outlines a proven workflow for breaking down massive projects into manageable phases, using specification mode for planning and iterative implementation with frequent validation.

<CardGroup cols={2}>
  <Card title="Systematic Planning" icon="map">
    Break complex features into discrete, manageable phases with clear
    boundaries
  </Card>
  <Card title="Incremental Progress" icon="stairs">
    Implement one phase at a time with validation and testing at each step
  </Card>
  <Card title="Version Control Strategy" icon="code-branch">
    Use git commits and PRs to track progress and enable safe rollbacks
  </Card>
  <Card title="Continuous Validation" icon="check-circle">
    Test functionality incrementally rather than waiting until the end
  </Card>
</CardGroup>

## When to use this workflow

This approach is ideal for:

**Massive refactors** - Touching 100+ files across your entire codebase

```
"Migrate from REST API to GraphQL across all frontend components"
```

**Major component migrations** - Replacing core system dependencies

```
"Switch from Stripe to a new billing provider across the entire payment system"
```

**Large feature implementations** - New functionality spanning 30+ files

```
"Add comprehensive user roles and permissions system to the existing application"
```

## The workflow

<Steps>
  <Step title="Create the master plan">
    Use Specification Mode to create comprehensive documentation breaking the
    project into major phases.
  </Step>
  <Step title="Phase-by-phase implementation">
    Start new sessions for each phase, referencing the master plan document.
  </Step>
  <Step title="Frequent commits and PRs">
    Create git commits and pull requests corresponding to each completed phase.
  </Step>
  <Step title="Incremental validation">
    Test and validate functionality after each phase rather than at the end.
  </Step>
  <Step title="Update the plan">
    Mark completed phases and adjust remaining work based on learnings.
  </Step>
</Steps>

## Phase 1: Master planning with Specification Mode

Start by using **Shift+Tab** to enter Specification Mode and create a comprehensive breakdown:

**Example prompt:**

```
Create a detailed implementation plan for migrating our entire authentication system
from Firebase Auth to Auth0. This affects user login, registration, session management,
role-based access control, and integrations across 50+ components.

Break this into major phases that can be implemented independently with clear
testing and validation points. Each phase should be completable in 1-2 days
and have minimal dependencies on other phases.
```

**Specification Mode will generate:**

- **Phase breakdown** - 4-6 major implementation phases
- **Dependencies mapping** - Which phases must be completed before others
- **Testing strategy** - How to validate each phase works correctly
- **Risk assessment** - Potential issues and mitigation strategies
- **Rollback plan** - How to safely revert if needed

**Save the plan** - Approve the specification and save it as `IMPLEMENTATION_PLAN.md` in your project root.

## Phase 2: Iterative implementation

For each phase in your plan:

### Start a fresh session

Begin each phase with a new droid session to maintain focus and clean context.

### Reference the master plan

**Example prompt for Phase 1:**

```
I'm implementing Phase 1 of the authentication migration plan documented in
IMPLEMENTATION_PLAN.md.

Phase 1 focuses on setting up Auth0 configuration and creating the basic
authentication service without affecting existing Firebase integration.

Please read the plan document and implement this phase, then update the
document to mark Phase 1 as complete.
```

### Use Specification Mode for complex phases

For phases involving significant changes, use **Shift+Tab** to get detailed planning:

```
Following IMPLEMENTATION_PLAN.md, implement Phase 3: Update all login components
to use the new Auth0 service while maintaining backward compatibility with
the existing Firebase auth as fallback.
```

### Commit frequently

After each phase completion, ask Droid to commit your changes:

```
Commit all changes for Phase 1 of the auth migration with a detailed message.
```

```
Create a commit for the Auth0 service setup work with bullet points for each major change.
```

Droid will stage all changes and create the commit with proper co-authorship attribution.

### Create phase-specific PRs

Ask Droid to create pull requests for each completed phase:

```
Create a PR for the auth migration Phase 1 work on a new branch called auth-migration-phase-1.
```

```
Open a pull request with a comprehensive description of what was completed and testing done.
```

Droid will create the branch, push the changes, and generate a detailed PR description based on the commits and changes made.

## Phase 3: Validation and testing strategy

### Test each phase independently

Don't wait until the end - validate functionality after each phase:

**Phase 1 completion:**

```
Run the authentication tests and verify the Auth0 service works in isolation.
Test user registration, login, and logout with the new service.
```

**Phase 2 completion:**

```
Test the migration script with a subset of test users. Verify data integrity
and that users can log in with both old and new systems.
```

### Use feature flags for gradual rollout

```
Add a feature flag for auth0-migration with 10% rollout that can be controlled by environment variable.
```

```
Implement progressive rollout logic using feature flags to gradually migrate users from Firebase to Auth0.
```

### Automated testing at phase boundaries

```
Run the full test suite after each phase including unit, integration, and e2e tests.
```

```
Set up automated testing that validates auth migration functionality at each phase boundary.
```

## Best practices

**Start with read-only changes** - Begin phases with analysis and preparation before making modifications.

**Maintain backward compatibility** - Keep old systems working while new ones are being built.

**Use feature toggles** - Allow gradual rollout and quick rollback if needed.

**Document learnings** - Update your plan based on discoveries during implementation.

**Test boundary conditions** - Focus testing on the interfaces between old and new systems.

**Plan for rollback** - Each phase should be reversible if critical issues are discovered.

**Communicate progress** - Keep stakeholders updated with regular progress reports.

## Recovery strategies

If a phase encounters major issues:

1. **Immediate rollback** - Use git to revert to the last stable state
2. **Issue analysis** - Document what went wrong and why
3. **Plan adjustment** - Update remaining phases based on learnings
4. **Stakeholder communication** - Update timelines and expectations

The systematic approach ensures large features are delivered reliably while maintaining code quality and system stability throughout the process.

Ready to tackle your next large-scale feature? Start with **Shift+Tab** to create your master implementation plan!
</file>

<file path="docs/cli/user-guides/specification-mode.mdx">
---
title: Specification Mode
description: Turn plain-English specifications into production-ready code with automatic planning and review.
---

Specification Mode transforms simple feature descriptions into working code with automatic planning and safety checks. You provide a brief description of what you want, and droid creates a detailed specification and implementation plan before making any changes.

<CardGroup cols={2}>
  <Card title="Simple Input" icon="message">
    Just 4-6 sentences describing what you want built
  </Card>
  <Card title="Automatic Planning" icon="list-check">
    Droid creates detailed specs and implementation plans
  </Card>
  <Card title="Safe Execution" icon="shield-check">
    No code changes until you approve the complete plan
  </Card>
  <Card title="Enterprise Ready" icon="building">
    Built-in security, compliance, and team standards
  </Card>
</CardGroup>

## How it works

<Steps>
  <Step title="Describe your feature">
    Provide a simple description in 4-6 sentences. No need to write formal
    specifications.
  </Step>
  <Step title="Droid creates the spec">
    Droid analyzes your request and generates a complete specification with
    acceptance criteria, implementation plan, and technical details. You can optionally use [mixed models](/cli/configuration/mixed-models) to configure a different model for planning.
  </Step>
  <Step title="Review and approve">
    You review the generated specification and implementation plan. Request
    changes or approve as-is.
  </Step>
  <Step title="Implementation">
    Only after approval does droid begin making actual code changes, showing
    each modification for review.
  </Step>
</Steps>

## Example workflow

**Your input:**

```
Add a feature for users to export their personal data.
It should create a ZIP file with their profile, posts, and uploaded files.
Send them an email when it's ready. Make sure it follows GDPR requirements.
The export should work for accounts up to 2GB of data.
```

**Droid generates:**

- Complete specification with detailed acceptance criteria
- Technical implementation plan covering backend, frontend, and email
- File-by-file breakdown of changes needed
- Testing strategy and verification steps
- Security and compliance considerations

**You approve, then droid implements** the complete solution while showing each change for review.

<Note>
  Specification Mode must be manually activated using **Shift+Tab** in the CLI.
  It does not automatically activate.
</Note>

## How to activate Specification Mode

To enter Specification Mode, press **Shift+Tab** while in the CLI. This will enable the specification planning workflow for your next request.

## What happens during planning

**Analysis phase (read-only):**

- Examines your existing codebase and patterns
- Reviews related files and dependencies
- Studies your AGENTS.md conventions
- Gathers context from external sources

**Planning phase:**

- Develops comprehensive implementation strategy
- Identifies all files that need changes
- Plans sequence of modifications
- Considers testing and verification steps

**Safety guarantees:**

- Cannot edit files during analysis
- Cannot run commands that modify anything
- Cannot create, delete, or move files
- All exploration is read-only until you approve

## Writing effective requests

**Focus on outcomes:** Describe what the software should accomplish, not how to build it.

```
Users need to be able to reset their passwords using email verification.
The reset link should expire after 24 hours for security.
Include rate limiting to prevent abuse.
```

**Include important constraints:**

```
Add user data export functionality that works for accounts up to 5GB.
Must comply with GDPR and include audit logging.
Should complete within 10 minutes and not impact application performance.
```

**Reference existing patterns:**

```
Add a notification system similar to how we handle email confirmations.
Use the same background job pattern as our existing report generation.
Follow the authentication patterns we use for other sensitive operations.
```

**Be specific about verification:** Tell droid how to confirm the implementation works correctly.

**Consider the full user journey:** Describe the complete experience, not just technical requirements.

**Include error scenarios:** Specify how failures should be handled and communicated to users.

**Think about scale:** Mention performance requirements and expected usage patterns.

## Enterprise integration

Reference external requirements by pasting links:

```
Implement the user management features described in this Jira ticket:
https://company.atlassian.net/browse/PROJ-123

Follow our security standards and include comprehensive error handling.
```

If you've integrated platforms through Factory's dashboard, droid can read context from tickets, documents, and specs during analysis.

## Benefits

<CardGroup cols={2}>
  <Card title="Safety First" icon="shield-check">
    No accidental changes during exploration. See the complete plan before any
    modifications.
  </Card>
  <Card title="Thorough Planning" icon="brain">
    Comprehensive analysis leads to better architecture decisions and fewer
    surprises.
  </Card>
  <Card title="Full Control" icon="eye">
    Complete visibility into what will be done before any code changes happen.
  </Card>
  <Card title="Better Outcomes" icon="trophy">
    Well-planned implementations are more likely to be correct, complete, and
    maintainable.
  </Card>
</CardGroup>

## AGENTS.md integration

Document your project conventions to enhance Specification Mode's planning. See [AGENTS.md](/cli/configuration/agents-md) for more information.

Specification Mode automatically incorporates these conventions, ensuring consistency with your team's standards.

## Breaking down large features

For complex features spanning multiple components, break them into focused phases:

**Phase 1:**

```
Implement user data export backend API and job processing.
Focus only on the server-side functionality, not the UI yet.
```

**Phase 2:**

```
Add the frontend UI for data export using the API from Phase 1.
Include progress indicators and download management.
```

This approach allows you to validate each phase before proceeding to the next.

## Specification approval options

After droid presents the specification, choose how to continue:

1. **Proceed with implementation** ‚Äì Approve the plan and keep normal (manual) execution controls.
2. **Proceed, and allow file edits and read-only commands (Low)** ‚Äì Enable low autonomy auto-run so droid can edit files and run safe read-only commands automatically.
3. **Proceed, and allow reversible commands (Medium)** ‚Äì Enable medium autonomy auto-run so droid can also run reversible commands without additional prompts.
4. **Proceed, and allow all commands (High)** ‚Äì Enable high autonomy auto-run for fully automated execution, including commands that are not easily reversible.
5. **No, keep iterating on spec** ‚Äì Stay in Specification Mode to refine the plan before implementation.

Selecting any auto-run option sets the corresponding autonomy level for the rest of the session. Choosing to keep iterating leaves Specification Mode active so you can continue shaping the plan.

## Saving your specifications as Markdown

Specification Mode can automatically write the approved plan to disk. Open the CLI settings and enable **Save spec as Markdown** to turn this on.

- By default, plans are saved to `.factory/docs` inside the nearest project-level `.factory` directory. If none exists, the CLI falls back to `~/.factory/docs` in your home directory.
- Use the **Spec save directory** setting to pick between the project directory, your home directory, or a custom path. Custom values support absolute paths, `~` expansion, `.factory/...` shortcuts, and relative paths from the current workspace.
- The CLI creates the target directory if it does not exist and writes the Markdown exactly as shown in the approval dialog.
- Files are named `YYYY-MM-DD-slug.md`, where the slug comes from the spec title or first heading, and a counter is appended if a file with the same name already exists.

## What happens after approval

Once you approve a specification plan, droid systematically implements the changes while showing each modification for review. You maintain full control through the approval workflow, ensuring quality and alignment with requirements.

For simpler changes that don't need comprehensive planning, droid can proceed directly while still showing all modifications for approval.

Ready to try Specification Mode? Start with a simple description of what you want to build, and let droid handle the specification and planning complexity.
</file>

<file path="docs/enterprise/compliance-audit-and-monitoring.mdx">
---
title: Compliance, Audit & Monitoring
description: How Droids support SOC2, ISO 27001/42001, regulatory reviews, and continuous monitoring using OpenTelemetry and audit logs.
---

Security and compliance teams need clear answers to **who did what, when, where, and with which data**. This page explains how Droids fit into your compliance posture and how to integrate them with your existing monitoring and audit infrastructure.

---

## Certifications and Trust Center

Factory maintains an enterprise‚Äëgrade security and compliance program, including:

- **SOC 2**
- **ISO 27001**
- **ISO 42001**

Our **Trust Center** provides up‚Äëto‚Äëdate reports, security architecture documentation, and sub‚Äëprocessor lists. Use it as the primary reference for security and compliance reviews.

---

## Audit trails and events

There are two complementary sources of audit information:

1. **Factory‚Äëside audit logs** (for cloud‚Äëmanaged features).
2. **Customer‚Äëside OTEL telemetry** emitted by Droid.

### Factory‚Äëside audit logs (cloud‚Äëmanaged)

When you use Factory‚Äôs hosted services, the control plane records key events such as:

- Authentication events and SSO/SCIM changes.
- Org and project configuration updates.
- Policy changes (model allow/deny lists, autonomy limits, Droid Shield settings, hooks configuration).
- Administrative actions in the web UI.

These logs can be exported via the Trust Center or integrations agreed upon in your enterprise engagement.

### Customer‚Äëside OTEL telemetry

Droid emits OTEL metrics, traces, and logs that can serve as **fine‚Äëgrained audit data** inside your own systems, including:

- Session start and end events, tagged with user, team, environment, and project information.
- Tool usage events (which tools were invoked, how long they ran, and whether they succeeded).
- Command execution metadata, including risk classification and outcome.
- Code modification events (which files and repositories were changed).

You control how long these signals are retained and how they are correlated with other systems such as CI/CD pipelines, SIEMs, and case management tools.

---

## OpenTelemetry schema and collectors

Factory‚Äôs OTEL support is designed to integrate with existing observability tooling.

At a high level, telemetry includes:

- **Resource attributes** ‚Äì describing the environment, service, org, team, and user.
- **Metrics** ‚Äì counters and histograms for sessions, LLM usage, tools, and errors.
- **Traces and spans** ‚Äì describing the lifecycle of sessions and automated runs.
- **Logs** ‚Äì structured events for key actions and errors.

You can deploy OTEL collectors that:

- Receive OTLP data from Droid.
- Enrich or redact attributes based on your own policies.
- Forward telemetry to multiple destinations (for example, Prometheus + Loki, Datadog, Splunk, or S3).

This architecture keeps **ownership of telemetry firmly in your hands**, even when using Factory‚Äôs cloud‚Äëmanaged features.

For more details on the metrics and traces useful for cost and productivity analysis, see [Usage, Cost & Productivity Analytics](/enterprise/usage-cost-and-analytics).

---

## Regulatory and industry use cases

Factory is designed to support organizations operating under strict regulatory regimes. While implementation details differ, common patterns include:

<AccordionGroup>
  <Accordion title="Financial services">
    - Use hybrid or airgapped deployments for systems subject to strict data residency and record‚Äëkeeping requirements.
    - Route all LLM traffic through gateways that implement your bank‚Äôs data policies.
    - Use OTEL telemetry and hooks to ensure Droid activity is visible in your SIEM and aligned with your control framework.
  </Accordion>

  <Accordion title="Healthcare and PHI">
    - Deploy Droid in environments that never expose protected health information to external LLMs.
    - Use model allowlists that include only providers and gateways that meet your PHI handling requirements.
    - Use Droid Shield and DLP hooks to prevent PHI from being included in prompts or logs.
  </Accordion>

  <Accordion title="National security and defense">
    - Rely on fully airgapped deployments with on‚Äëprem models and collectors.
    - Treat Droid as an internal tool whose artifacts and logs never leave your network.
    - Use OTEL and hooks to integrate with mission‚Äëspecific monitoring and incident response tooling.
  </Accordion>
</AccordionGroup>

---

## Deployment and configuration for compliance teams

To integrate Droid into your compliance and monitoring stack:

1. **Decide on deployment pattern** ‚Äì cloud‚Äëmanaged, hybrid, or fully airgapped.
2. **Define model and gateway policies** ‚Äì which providers and gateways are allowed, and where.
3. **Configure OTEL collectors and destinations** ‚Äì ensure all Droid telemetry flows into your SIEM and observability tools.
4. **Set up hooks and Droid Shield** ‚Äì enforce DLP, approval workflows, and environment‚Äëspecific controls.
5. **Document policies and mappings** ‚Äì connect Droid controls to your internal control framework and regulatory obligations.

Most of this configuration is expressed via the hierarchical settings system described in [Hierarchical Settings & Org Control](/enterprise/hierarchical-settings-and-org-control).
</file>

<file path="docs/enterprise/hierarchical-settings-and-org-control.mdx">
---
title: Hierarchical Settings & Org Control
description: How org, project, folder, and user settings combine to control models, tools, safety policies, and telemetry for Droid.
---

Factory‚Äôs enterprise story is built on a **single, predictable settings hierarchy**. Instead of ad‚Äëhoc per‚Äëmachine configuration, orgs express policy once and have it apply consistently across laptops, CI, VMs, and airgapped environments.

This page explains how the hierarchy works and how to use it to govern models, tools, safety policies, and telemetry.

---

## The four levels

Settings are defined in `.factory/` folders with a consistent structure at four levels:

```text
Org         ‚Üí Central `.factory/` bundle (or config endpoint)
Project     ‚Üí <git-root>/.factory/
Folder      ‚Üí <git-root>/.../subfolder/.factory/
User        ‚Üí ~/.factory/
```

Each `.factory/` folder can contain:

- `settings.json` ‚Äì general settings (models, safety, preferences, telemetry).
- `mcp.json` ‚Äì MCP server configurations.
- `droids/` ‚Äì droid definitions.
- `commands/` ‚Äì custom commands.
- `hooks/` ‚Äì hook definitions.

The **same schema** applies at every level. What changes is **precedence**.

---

## Extension‚Äëonly semantics

Factory uses **extension‚Äëonly** semantics instead of traditional ‚Äúoverride‚Äù behavior.

- Higher levels (org, project) **cannot be overridden** by lower levels.
- Lower levels (folder, user) can only **add** to what higher levels define when those fields are unset.
- This ensures org policies remain intact even as projects and users customize their experience.

There are three merge modes depending on the data type.

### 1. Simple values ‚Äì first wins

For simple scalar values (strings, numbers, booleans):

- The first level that sets a value ‚Äúwins.‚Äù
- Lower levels cannot change or remove that value.

Examples:

- `sessionDefaults.model`
- `sessionDefaults.autonomyLevel`
- `maxAutonomyLevel`

This guarantees that org decisions (such as which models or autonomy levels are allowed) remain authoritative.

### 2. Arrays ‚Äì union, cannot remove

Array fields accumulate across levels:

- Org entries are always present and **cannot be removed**.
- Project and folder levels can add more entries.
- User level can add more entries but cannot remove or weaken higher‚Äëlevel entries.

Examples:

- Command **allow lists** and **deny lists**.
- Lists of enabled hooks or features.

This pattern is ideal for policies like ‚Äúthese commands are always denied‚Äù or ‚Äúthese hooks are always enabled,‚Äù while still allowing teams to extend the list.

### 3. Objects ‚Äì keys are locked per level

For object fields:

- Keys defined at a higher level are **locked**; their contents cannot be changed by lower levels.
- Lower levels can add new keys but not modify or delete existing ones.

Examples:

- `customModels` ‚Äì org defines `claude-enterprise`; projects can add `payments-gpt`, users can add `personal-experimental`, but none can change or remove `claude-enterprise`.
- MCP server definitions ‚Äì org defines which servers exist and how they connect; projects decide which to use.

This keeps critical configuration (like model endpoints and MCP servers) under centralized control.

---

## Org configuration

Large organizations typically manage an **org‚Äëlevel `.factory` bundle** or config endpoint that:

- Specifies allowed models, gateways, and BYOK policies.
- Defines global command allow/deny lists.
- Sets defaults for autonomy, reasoning effort, and safety features like Droid Shield.
- Configures OTEL defaults (endpoints, sampling, and attributes).
- Publishes org‚Äëstandard droids, commands, and hooks.

This bundle is distributed to all environments where Droid runs‚Äîdeveloper machines, CI, VMs, and airgapped clusters.

Org policy is the foundation; projects and users build on top of it.

---

## Project and folder configuration

Projects and folders use `.factory/` directories checked into version control to specialize org policy for particular codebases and teams.

Common responsibilities include:

- Adding project‚Äëspecific models and gateways within the allowed set.
- Defining project‚Äëspecific droids (for example, `/migrate-service`, `/refactor-module`).
- Configuring hooks that know about the project‚Äôs tests, linters, and deployment processes.
- Tightening safety controls for high‚Äërisk repositories.

Folder‚Äëlevel `.factory/` directories are useful in monorepos where different subsystems have different policies.

---

## User configuration

Developers can configure `~/.factory/` for **personal preferences only** where higher levels are silent.

Examples:

- Choosing a preferred model from the allowed set.
- Setting default behavior for display options and minor UX preferences.
- Enabling additional hooks or tools that do not conflict with org policy.

Because of extension‚Äëonly semantics, users cannot:

- Re‚Äëenable models or tools that org or project settings have disallowed.
- Loosen command allow/deny lists.
- Reduce autonomy or safety requirements set by org or project.

---

## Example: enforcing a model policy

Suppose your org wants to:

- Allow only approved enterprise models.
- Disallow user‚Äësupplied API keys.
- Force all prompts through a particular LLM gateway.

You would:

1. Define the allowed models and gateway endpoints in the org `.factory/settings.json`.
2. Set a policy flag to disable user BYOK entirely.
3. Configure hooks to verify that any model selection or endpoint use matches the org‚Äëapproved set.

Projects and users can still choose **which of the approved models** to use for different tasks, but cannot break these guarantees.

---

## Example: environment‚Äëspecific autonomy

Consider an org that wants to:

- Allow high autonomy in CI and sandboxed containers.
- Limit autonomy on developer laptops.

You could:

1. At org level, set `maxAutonomyLevel` to `high`.
2. In project settings, define environment‚Äëaware hooks that:
   - Inspect environment tags (for example, `environment.type=local|ci|sandbox`).
   - Downgrade or block autonomy levels above `medium` when running on laptops.
3. Optionally, define stricter folder‚Äëlevel policies for particularly sensitive repos.

Again, users cannot override these rules; they can only choose safer personal defaults within the allowed space.

---

## Putting it all together

The hierarchical settings system underpins everything described in the other enterprise pages:

- [Identity & Access Management](/enterprise/identity-and-access) ‚Äì who can change which level of settings.
- [Privacy, Data Flows & Governance](/enterprise/privacy-and-data-flows) ‚Äì where data and telemetry are allowed to go.
- [Network & Deployment Configuration](/enterprise/network-and-deployment) ‚Äì which environments Droid can run in and how it connects.
- [LLM Safety & Agent Controls](/enterprise/llm-safety-and-agent-controls) ‚Äì policies for commands, tools, and Droid Shield.
- [Models, LLM Gateways & Integrations](/enterprise/models-llm-gateways-and-integrations) ‚Äì control over models, gateways, MCP servers, droids, and commands.
- [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring) ‚Äì guarantees and telemetry used to prove compliance.

By expressing policy once at the right level, you can run Droid across cloud, hybrid, and airgapped environments **without per‚Äëmachine drift or one‚Äëoff configuration**.
</file>

<file path="docs/enterprise/identity-and-access.mdx">
---
title: Identity & Access Management
description: How Droids use org, project, and user identity to control who can run agents, where, and with which permissions.
---

Identity and access management controls **who can run Droid**, in which environments, and under what policies.

This page provides an overview of the identity model, roles, and environments; detailed SSO and SCIM setup instructions live in [SSO, IdP & SCIM Provisioning](/enterprise/identity-sso-and-scim).

---

## Identity model

Every Droid run is associated with three dimensions of identity:

<CardGroup cols={2}>
  <Card title="User or machine identity" icon="user">
    Human developers authenticate via SSO (SAML/OIDC), inheriting their directory groups and roles.
    Automation (CI/CD, scheduled jobs) runs under **machine identities** with long‚Äëlived tokens or workload identities.
  </Card>
  <Card title="Org / project / folder" icon="folders">
    The active repo and `.factory/` folders determine the **org, project, and folder context**.
    Policies at these levels decide which models, tools, and integrations Droid may use.
  </Card>
  <Card title="Runtime environment" icon="server">
    Whether Droid is running on a laptop, in a CI runner, or in a sandboxed VM/devcontainer is captured as environment attributes.
    Policies can treat these differently (for example, higher autonomy only in CI or sandboxes).
  </Card>
  <Card title="Session metadata" icon="activity">
    Each Droid session records metadata such as session ID, CLI version, and git branch, which is available for audit and OTEL telemetry.
  </Card>
</CardGroup>

---

## Org identity and SSO (overview)

Most enterprises integrate Factory with an identity provider (IdP) such as **Okta, Azure AD, or Google Workspace**.

At a high level:

- **Org membership** is derived from IdP groups mapped to Factory organizations and teams.
- **SSO sign‚Äëin** gives developers access to both the web platform and Droid using corporate credentials.
- **Role information** (for example, `Owner`, `Admin`, `Member`) flows from IdP groups into Factory roles.

For step‚Äëby‚Äëstep SSO and SCIM configuration‚Äîincluding setting up the IdP application, mapping attributes, and enabling provisioning‚Äîsee [SSO, IdP & SCIM Provisioning](/enterprise/identity-sso-and-scim).

---

## Role‚Äëbased access control (RBAC)

Factory distinguishes between three broad classes of actors:

- **Org administrators**
  - Define org‚Äëlevel `.factory` configuration, including model policies, global command allow/deny lists, and default telemetry targets.
  - Decide which deployment patterns (cloud, hybrid, airgapped) are supported and where Droid binaries may run.
  - Configure security features such as maximum autonomy level and whether user‚Äësupplied BYOK keys are allowed.

- **Project owners / maintainers**
  - Own project‚Äëlevel `.factory/` folders that live in version control.
  - Provide team‚Äëspecific models, droids, commands, and hooks that extend org policy without weakening it.
  - Configure project‚Äëspecific policies, for example limiting Droid to certain repositories or directories.

- **Developers**
  - Customize personal preferences in `~/.factory/` (for example, default model choice within the allowed set).
  - Run Droid locally, in IDEs, or via team‚Äëprovided scripts and CI jobs.
  - Cannot override any setting defined at org or project level.

Role assignment flows from your IdP into Factory; the **hierarchical settings engine** enforces what each role can effectively change. See [Hierarchical Settings & Org Control](/enterprise/hierarchical-settings-and-org-control) for the exact precedence rules.

---

## Devices, environments, and workspace trust

Because Droid is a CLI, it can run in many environments:

- Developer laptops (macOS, Linux, Windows)
- Remote dev servers or workspaces
- CI runners and build agents
- Hardened VMs and devcontainers

Enterprise customers typically combine Droid with **endpoint management** and **workspace trust** controls:

<AccordionGroup>
  <Accordion title="Endpoint & MDM controls">
    Use tools like **Jamf, Intune, or other MDM solutions** to control where Droid binaries can be installed, which users can run them, and which configuration files they can read.

    Common patterns include:

    - Only allowing Droid to run under managed user accounts.
    - Restricting configuration directories to corporate‚Äëmanaged volumes.
    - Enforcing OS‚Äëlevel disk encryption and screen lock policies.
  </Accordion>

  <Accordion title="Workspace trust">
    Treat Droid as trusted only in **known repositories and environments**:

    - Pin Droid to specific paths or repos on developer machines.
    - Require elevated approval or sandboxed environments for untrusted code.
    - Use project‚Äëlevel `.factory/` folders to mark which repos are "Droid‚Äëready" and what policies should apply.
  </Accordion>

  <Accordion title="Environment‚Äëaware policies">
    The same developer may run Droid in multiple contexts: on their laptop, in CI, or in an isolated container.

    Policies can take these differences into account:

    - Allow higher autonomy or more powerful tools **only** inside devcontainers or CI runners.
    - Restrict network access or command execution when running on laptops.
    - Tag OTEL telemetry with environment attributes to support environment‚Äëspecific alerting.
  </Accordion>
</AccordionGroup>

---

## How identity flows into policy and telemetry

Identity and environment information are used in two main ways:

1. **Policy evaluation** ‚Äì hierarchical settings (org ‚Üí project ‚Üí folder ‚Üí user) use identity to determine which configuration bundle applies to a given run.
2. **Telemetry and audit** ‚Äì Droid emits OTEL metrics, traces, and logs with attributes like `user.id`, `team.id`, `session.id`, and environment tags so you can build per‚Äëorg and per‚Äëteam dashboards.

For details on how these identities are encoded in telemetry, see [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring).
</file>

<file path="docs/enterprise/identity-sso-and-scim.mdx">
---
title: SSO, IdP & SCIM Provisioning
description: How to integrate Factory with your Identity Provider using SAML/OIDC SSO and SCIM to manage access to Droids at scale.
---

This page describes how to connect Factory to your **Identity Provider (IdP)** and keep access to Droids synchronized using **SSO and SCIM**.

It is IdP‚Äëagnostic and applies to Okta, Azure AD, Google Workspace, and other enterprise identity platforms.

---

## Overview

Factory supports two main identity integrations:

- **SAML 2.0 / OIDC SSO** ‚Äì developers sign in with corporate credentials; no separate Factory password.
- **SCIM 2.0 provisioning** ‚Äì users and groups are created, updated, and removed automatically from your IdP.

Together, these give you:

- Centralized control over who can access Factory and Droids.
- Automatic deprovisioning when people leave or change roles.
- Consistent role and group mappings across web, CLI, and automation.

The high‚Äëlevel flow is:

1. Configure an SSO application for Factory in your IdP.
2. Map IdP attributes (email, name, groups) into Factory.
3. Enable SCIM for automatic user and group provisioning (optional but recommended).
4. Map directory groups to Factory orgs, teams, and roles.

---

## Prerequisites

Before setting up SSO and SCIM:

- You are on a plan that includes **enterprise SSO support**.
- You have **admin access** to your IdP (or a partner in IT who does).
- You have a **Factory admin** who can coordinate configuration on the Factory side.

We generally recommend treating SSO + SCIM as a joint effort between your **security/IT** and **platform/dev‚Äëprod** teams.

---

## SSO configuration (IdP‚Äëagnostic)

Factory supports both **SAML 2.0** and **OIDC**. The exact UI varies by IdP, but the concepts are the same.

### 1. Create a Factory application in your IdP

In your IdP admin console:

1. Create a new application for **Factory**.
2. Choose **SAML** or **OIDC** as the protocol (Factory supports both; your account team can recommend one based on your environment).
3. Assign the application to a small test group of users first (for example, `factory-pilot-users`).

Your Factory contact will provide or confirm:

- The **redirect / callback URL** for SSO.
- The **entity ID / client ID** and any other required metadata.

### 2. Configure SAML/OIDC metadata

In the IdP application you just created:

- For **SAML**:
  - Set the **Assertion Consumer Service (ACS) URL** / Single Sign‚ÄëOn URL to the value provided by Factory.
  - Set the **Entity ID** / Audience URI as provided by Factory.
  - Configure the NameID format and attributes as recommended (typically email address as the primary identifier).

- For **OIDC**:
  - Use the Factory‚Äëprovided **client ID** and **redirect URI**.
  - Configure the **scopes** to include at least `openid`, `profile`, and `email`.

Factory will consume the IdP metadata (SAML XML or OIDC discovery configuration) and establish the trust relationship.

### 3. Map attributes and groups

Next, configure which attributes your IdP sends to Factory in the SAML assertion or OIDC ID token.

We recommend at least:

- **Email** ‚Äì primary unique identifier (for example, `user.userprincipalname`, `user.mail`).
- **Display name** ‚Äì used in UI (for example, `user.displayname`).
- **Groups or roles** ‚Äì used to map users into Factory orgs and roles.

Common patterns include groups such as:

- `factory-org-owners`
- `factory-org-admins`
- `factory-users`
- `factory-ci-bots`

These groups can be mapped on the Factory side to **Owner**, **Admin**, and **Member** roles, and to specific orgs or teams.

### 4. Test the connection

Once metadata and attributes are configured:

1. Use a test user in your IdP who is assigned to the Factory application.
2. Initiate login from the Factory sign‚Äëin page using ‚ÄúSign in with SSO‚Äù / your IdP button.
3. Verify that:
   - The user is redirected to the IdP, authenticates, and returns to Factory.
   - The user lands in the correct org/team with the expected role.

If anything fails, check the IdP‚Äôs logs and Factory‚Äôs error message; most issues are due to mismatched URLs, certificates, or attribute mappings.

---

## SCIM provisioning

SSO controls **how users authenticate**; SCIM controls **which users and groups exist** in Factory.

With SCIM enabled:

- New employees in relevant IdP groups get access to Factory automatically.
- Users removed from those groups lose access automatically.
- Group membership changes propagate into Factory without manual updates.

### 1. Enable SCIM in Factory

Your Factory admin (or account team) will:

- Enable SCIM for your organization.
- Provide a **SCIM base URL** and **SCIM bearer token** for your IdP.

Treat the SCIM token as a secret; store it only in your IdP‚Äôs application configuration.

### 2. Configure SCIM in your IdP

In your IdP‚Äôs SCIM settings for the Factory application:

1. Enable **automatic provisioning**.
2. Paste the **SCIM base URL** and **SCIM token** from Factory.
3. Choose which users and groups to sync (for example, only `factory-*` groups).
4. Configure attribute mappings if required (for example, `userName` ‚Üí email, `displayName` ‚Üí name).

Once enabled, your IdP will start pushing users and groups to Factory and keep them synchronized.

### 3. Map directory groups to Factory roles

With SCIM in place, group management should happen **only in your IdP**.

Use group naming and mapping rules such as:

- `factory-org-owners` ‚Üí Factory org Owners.
- `factory-org-admins` ‚Üí Factory org Admins.
- `factory-users` ‚Üí Factory Members.
- `factory-ci-bots` ‚Üí machine/service accounts with restricted permissions.

This keeps RBAC definitions in one place (your IdP) and lets you audit them alongside other enterprise apps.

---

## Service accounts and CI access

Most organizations also need **non‚Äëhuman identities** for CI/CD and automation.

Recommended pattern:

- Create **dedicated CI groups** (for example, `factory-ci-bots`).
- Provision CI accounts via SCIM into Factory using those groups.
- Issue tokens for CI workflows scoped to the relevant orgs/teams.

This keeps human and machine access clearly separated while still benefiting from centralized provisioning and deprovisioning.

---

## Troubleshooting & best practices

Common issues and recommendations:

- **Login loops or failures**
  - Verify ACS / redirect URLs exactly match what Factory provided.
  - Confirm certificates or signing keys have not expired or been rotated without updating Factory.

- **User lands in wrong org or role**
  - Check group memberships and mapping rules.
  - Ensure the intended groups are included in SAML assertions or ID tokens.

- **Provisioning not working**
  - Confirm SCIM is enabled in both Factory and your IdP.
  - Check SCIM logs in your IdP for errors (invalid token, URL, or schema).

Best practices:

- Keep a **small pilot group** for initial rollout and future changes.
- Use **clear, prefix‚Äëbased group names** (for example, `factory-*`) to keep IdP configuration maintainable.
- Manage all role changes and access reviews in your IdP to leverage existing governance processes.

Once SSO and SCIM are in place, the **Identity & Access Management** overview explains how these identities are enforced at runtime for Droids.
</file>

<file path="docs/enterprise/index.mdx">
---
title: Enterprise with Droids
description: How to deploy, secure, and operate Droids in the world‚Äôs highest‚Äësecurity environments.
---

Factory‚Äôs enterprise platform is designed for the **highest‚Äësecurity customers**‚Äîsystemically important banks, governments, healthcare, national security, and other regulated organizations.

Instead of forcing you into a single cloud IDE, Droid is a **CLI and agent runtime that runs anywhere**:

- On developer laptops, in any terminal or IDE
- In CI/CD pipelines (GitHub, GitLab, internal runners)
- In VMs, Kubernetes clusters, and hardened devcontainers
- In **fully airgapped environments** with no outbound internet access

This section explains how to deploy Droid safely, govern which models and tools it can use, and observe its behavior at enterprise scale.

---

## What this section covers

Use these pages together as your enterprise playbook for Droids:

<CardGroup cols={2}>
  <Card title="Identity & Access" icon="user-shield">
    How orgs, projects, folders, and users are identified; how SSO/SCIM and RBAC determine who can run Droid and with which permissions.
    See [Identity & Access Management](/enterprise/identity-and-access).
  </Card>
  <Card title="Privacy & Data Flows" icon="shield-check">
    Exact data flows for code, prompts, and telemetry across cloud, hybrid, and fully airgapped deployments.
    See [Privacy, Data Flows & Governance](/enterprise/privacy-and-data-flows).
  </Card>
  <Card title="Network & Deployment" icon="server">
    Reference architectures for cloud‚Äëmanaged, hybrid, and fully airgapped deployments, plus proxy and mTLS configuration.
    See [Network & Deployment Configuration](/enterprise/network-and-deployment).
  </Card>
  <Card title="LLM Safety & Controls" icon="shield-alert">
    How Droid classifies command risk, enforces allow/deny lists, uses Droid Shield for secret scanning, and integrates hooks and sandboxes.
    See [LLM Safety & Agent Controls](/enterprise/llm-safety-and-agent-controls).
  </Card>
  <Card title="Models & Integrations" icon="boxes">
    Hierarchical model allow/deny, LLM gateways, BYOK, MCP servers, droids, commands, and how Droid plugs into your existing AI stack.
    See [Models, LLM Gateways & Integrations](/enterprise/models-llm-gateways-and-integrations).
  </Card>
  <Card title="Analytics & Compliance" icon="file-badge">
    OTEL‚Äënative telemetry, analytics, audit logging, and how Factory supports SOC2, ISO 27001, ISO 42001 and internal regulatory reviews.
    See [Usage, Cost & Productivity Analytics](/enterprise/usage-cost-and-analytics) and [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring).
  </Card>
</CardGroup>

---

## Enterprise foundations

### Multi‚Äëdeployment by design

Factory supports three deployment patterns for Droid, all built on the same core binary and configuration model:

1. **Cloud‚Äëmanaged** ‚Äì Droid runs on developer machines and CI but uses Factory‚Äôs cloud for coordination and optional analytics. Models are either Factory‚Äëbrokered or brought by you.
2. **Hybrid enterprise** ‚Äì Droid runs entirely in your infrastructure (VMs, CI runners, containers), optionally connecting to Factory cloud for UX while all LLMs and telemetry terminate inside your network.
3. **Fully airgapped** ‚Äì Droid runs in a network with **no outbound internet access**. Models and OTEL collectors are hosted entirely inside this environment; Factory never receives traffic.

You can start in cloud‚Äëmanaged mode, then migrate critical workloads to hybrid or airgapped environments without changing how developers talk to Droid.

### Hierarchical control, not per‚Äëdevice drift

Enterprise policy is expressed through a **hierarchical settings model**:

- **Org** ‚Üí global defaults and hard security policies
- **Project** ‚Üí repo‚Äëlevel settings committed to `.factory/`
- **Folder** ‚Üí narrower team or subsystem overrides inside a repo
- **User** ‚Üí personal preferences only where higher levels are silent

Higher levels **cannot be overridden** by lower ones. Org and project settings extend downward; users can opt into stricter controls but never weaken them. This hierarchy governs models, tools, MCP servers, droids, commands, autonomy levels, and telemetry destinations.

Learn more in [Hierarchical Settings & Org Control](/enterprise/hierarchical-settings-and-org-control).

### Defense‚Äëin‚Äëdepth agent safety

LLMs are probabilistic; Factory treats them as powerful but untrusted components. Droid‚Äôs safety story combines:

- **Deterministic controls** ‚Äì command risk classification, allow/deny lists, file and repo protections, and sandbox boundaries
- **Droid Shield** ‚Äì secret scanning and DLP‚Äëstyle checks across prompts, files, and commands
- **Hooks** ‚Äì programmable enforcement points (pre‚Äëprompt, pre‚Äëtool, pre‚Äëcommand, pre‚Äëgit, post‚Äëedit) to integrate with your own security systems
- **Sandboxed runtimes** ‚Äì running Droid inside devcontainers and hardened VMs for high‚Äërisk work

These layers are independent of which LLM or IDE a developer prefers.

### OTEL‚Äënative observability

All serious enterprise deployments need to answer: *‚ÄúWhat are agents doing, where, and at what cost?‚Äù*

Droid emits **OpenTelemetry metrics, traces, and logs** so you can:

- Send telemetry directly to existing collectors (Prometheus, Datadog, Splunk, Jaeger, etc.)
- Track sessions, LLM usage, code edits, tool invocations, and errors per org/team/user
- Correlate Droid activity with SDLC metrics you already use

Factory‚Äôs own cloud analytics are **optional**; high‚Äësecurity customers can route all telemetry exclusively to their own infrastructure.

See [Usage, Cost & Productivity Analytics](/enterprise/usage-cost-and-analytics) and [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring).

---

## Trust & compliance

Factory maintains a security and compliance posture suitable for the most demanding organizations:

- **SOC 2**
- **ISO 27001**
- **ISO 42001**

You can find the latest reports, sub‚Äëprocessor lists, and security architecture details in our **Trust Center**.

For a deeper dive into how Droid fits your regulatory and audit requirements, start with [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring).
</file>

<file path="docs/enterprise/llm-safety-and-agent-controls.mdx">
---
title: LLM Safety & Agent Controls
description: How Droids classify risk, enforce allow/deny policies, use Droid Shield, and integrate hooks and sandboxes to keep agents safe.
---

Factory treats LLMs as powerful but untrusted components. Droid‚Äôs safety model combines **deterministic controls, programmable hooks, and sandboxed runtimes** so that even frontier models can operate safely in high‚Äësecurity environments.

---

## Two layers of safety

We differentiate between:

1. **Deterministic controls** ‚Äì hard boundaries that do not depend on model behavior.
2. **LLM steering** ‚Äì prompts and context that guide models toward better behavior without providing guarantees.

Enterprise security should be built primarily on deterministic controls; steering is a quality‚Äëof‚Äëlife improvement.

<CardGroup cols={2}>
  <Card title="Deterministic controls" icon="shield-check">
    - Command risk classification
    - Global and project‚Äëlevel allow/deny lists
    - File and repo protection
    - Droid Shield secret scanning
    - Hooks for enforcement and logging
    - Sandboxed VMs and containers
  </Card>
  <Card title="LLM steering" icon="sparkles">
    - Project and org‚Äëlevel rules and instructions
    - Standardized commands and workflows
    - Context selection and enrichment via MCP
    - Model choice and reasoning effort defaults
  </Card>
</CardGroup>

---

## Command risk classification

Every shell command Droid proposes is classified into a **risk level** based on patterns and context (for example, file deletion, network access, package installation, database access).

Typical levels include:

- **Low risk** ‚Äì read‚Äëonly commands and local diagnostics (for example, `ls`, `cat`, `git status`).
- **Medium risk** ‚Äì commands that modify code or install dependencies (for example, `npm install`, `go test ./...`).
- **High risk** ‚Äì commands that delete data, change system configuration, or interact with sensitive resources (for example, `rm -rf`, `kubectl delete`, `psql` against production).

Org and project policies can map risk levels to behavior, such as:

- Always allow low‚Äërisk commands.
- Require user approval for medium‚Äërisk commands.
- Block high‚Äërisk commands entirely or only allow them in specific environments (for example, isolated devcontainers).

Risk information is also emitted via OTEL so security teams can monitor how often high‚Äërisk commands are proposed or attempted.

---

## Command allowlists and denylists

Admins can define **global and project‚Äëspecific allow/deny lists** in hierarchical settings:

- **Deny lists** ‚Äì patterns for commands that are never permitted (for example, `rm -rf`, `sudo *`, `curl *://sensitive-endpoint`).
- **Allow lists** ‚Äì specific commands or patterns that can run without additional approval in certain environments.

Because settings are extension‚Äëonly:

- Org‚Äëlevel denies and allows **cannot be removed** by projects or users.
- Projects can add additional allows or denies within their repos.
- Users cannot weaken the policy; they can only choose stricter personal defaults.

This keeps command policy consistent across thousands of machines while still allowing local specialization.

---

## Droid Shield: secret scanning and DLP

**Droid Shield** adds a dedicated layer of protection for secrets and sensitive content.

When enabled, Droid Shield can:

- Scan **files** before they are read or edited.
- Scan **prompts** before they are sent to models.
- Scan **commands** before they are executed.

It detects patterns such as:

- API tokens and access keys.
- Passwords and database connection strings.
- Private keys and certificates.
- Organization‚Äëspecific identifiers (configurable patterns).

Based on policy, Droid Shield can:

- Block the operation entirely.
- Redact the sensitive portions before continuing.
- Emit OTEL events and logs for security review.
- Call out to a **customer DLP service** via hooks for deeper analysis.

Org admins configure Droid Shield at the org and project levels; users cannot disable it where it is enforced.

---

## Hooks for enforcement and logging

Hooks are Droid‚Äôs **programmable safety and observability interface**. They allow you to run your own code at key points in the agent loop.

Common hook points include:

- **Before prompt submission** ‚Äì inspect prompts for secrets, PII, or policy violations.
- **Before file reads or writes** ‚Äì block or redact access to sensitive files.
- **Before command execution** ‚Äì enforce approval workflows or block dangerous commands.
- **Before git operations** ‚Äì prevent unauthorized `git push` or interactions with restricted branches.
- **After code generation or edits** ‚Äì run linters, security scanners, or internal compliance checks.

Typical enterprise use cases:

<AccordionGroup>
  <Accordion title="Block direct git pushes">
    Require all code changes to flow through your existing tooling by blocking `git push` in Droid sessions and instructing developers to use internal CL/PR tooling instead.
  </Accordion>
  <Accordion title="Integrate with DLP and CASB systems">
    Forward prompts and file snippets to your DLP or CASB APIs before they reach LLMs; deny or redact operations that violate policy.
  </Accordion>
  <Accordion title="Enforce environment‚Äëspecific policies">
    Allow certain tools and commands only in CI or sandboxed environments, based on environment tags emitted by Droid.
  </Accordion>
</AccordionGroup>

See [Hooks Guide](/cli/configuration/hooks-guide) and [Hooks Reference](/reference/hooks-reference) for implementation details and examples.

---

## Sandboxing with containers and VMs

Running Droid in **sandboxed devcontainers and VMs** lets you safely grant more autonomy where it is useful, without exposing production systems.

Recommended patterns:

- Use Docker/Podman devcontainers with restricted filesystem mounts and network egress.
- Run Droid with higher autonomy only inside containers or VMs that **do not have direct access to production databases or secrets**.
- Use separate credentials and environment variables for sandboxed versus production‚Äëadjacent environments.

In OTEL telemetry, you can tag sessions by environment (for example, `environment.type=local|ci|sandbox`) to build environment‚Äëspecific dashboards and alerts.

---

## Steering models toward safe behavior

While deterministic controls are the foundation, **LLM steering** improves quality and reduces how often dangerous actions are even proposed.

Org and project settings can define:

- **Rules and instructions** ‚Äì security guidelines, coding standards, and organization‚Äëspecific instructions that apply to every request.
- **Standardized commands and workflows** ‚Äì shared commands (for example, `/security-review`, `/migrate-service`) that bake in safe patterns.
- **Context enrichment** ‚Äì MCP servers that expose documentation, runbooks, and internal APIs so models have accurate information instead of guessing.

Because these are instructions, not enforcement, they complement rather than replace the hard boundaries described above.
</file>

<file path="docs/enterprise/models-llm-gateways-and-integrations.mdx">
---
title: Models, LLM Gateways & Integrations
description: How Droids connect to your models, LLM gateways, MCP servers, droids, commands, and existing engineering tools.
---

Factory is designed to plug into the **AI and developer tooling you already use**. This page explains how to control which models Droid can use, how to route traffic through LLM gateways, and how to manage MCP servers, droids, commands, and platform integrations.

---

## Model management and hierarchy

Model access is governed by the same hierarchical settings system used throughout Factory:

- **Org level**
  - Defines the **authoritative list of allowed models** and categories.
  - Can explicitly ban models (for example, non‚Äëenterprise APIs) so they cannot be re‚Äëenabled by projects or users.
  - Decides whether user‚Äësupplied BYOK keys are allowed at all.

- **Project level**
  - Can **add additional models** on top of the org‚Äëapproved set (for example, project‚Äëspecific fine‚Äëtunes) but cannot re‚Äëenable banned ones.
  - Can set project defaults‚Äîfor example, ‚Äúuse a small model for tests, a large model for refactors.‚Äù

- **User level**
  - Can choose personal defaults **within the allowed set**.
  - Cannot see or select models that higher levels have disallowed.

Because the hierarchy is extension‚Äëonly, upgrades and policy changes at the org level flow consistently across all environments.

---

## LLM gateways

Many enterprises centralize model access behind an **LLM gateway** that handles authentication, routing, and policy enforcement.

Factory works with gateways in two ways:

1. **Directly configured gateway endpoints**
   - `.factory/settings.json` can specify gateway base URLs for specific providers.
   - Environment variables can route calls (for example, `ANTHROPIC_BASE_URL`, `OPENAI_BASE_URL`).
   - Custom models configured via [BYOK](/cli/configuration/byok) can point to gateway endpoints using `base_url` and provider‚Äëspecific settings, so the same gateway policy applies whether models are built‚Äëin or custom.

2. **Org‚Äëlevel gateway policy**
   - Org admins can require that all model traffic go through specific gateways.
   - BYOK can be restricted so that only centrally managed keys and identities are used.

When you use a gateway, **data handling and retention policies are those of the gateway and underlying providers**; Droid simply uses the endpoints and credentials you configure.

For concrete examples of configuring custom models (including gateway‚Äëbacked models), see [Custom models & BYOK](/cli/configuration/byok), which covers the `custom_models` array in `~/.factory/config.json` and how those models appear in the `/model` selector.

---

## Cloud providers and BYOK

Factory supports multiple model deployment patterns:

- **Direct cloud providers** ‚Äì calling OpenAI, Anthropic, Google, and others using your enterprise credentials.
- **Cloud AI platforms** ‚Äì AWS Bedrock, GCP Vertex, Azure OpenAI, using IAM‚Äëbacked authentication.
- **On‚Äëprem / self‚Äëhosted models** ‚Äì models running inside your network, exposed via approved gateways.

Bring‚Äëyour‚Äëown‚Äëkey (BYOK) is controlled by policy:

- Org admins can allow or block **user‚Äësupplied API keys**.
- Even when BYOK is allowed, orgs can restrict which providers and endpoints keys may target.
- Project configs can define shared keys or credentials for team‚Äëwide models in secure stores.

In high‚Äësecurity environments, orgs often:

- Disable user BYOK entirely.
- Route all traffic through gateways that enforce data residency and audit logging.

---

## MCP servers

The **Model Context Protocol (MCP)** lets Droid access external systems‚Äîticket queues, documentation, databases, and more‚Äîthrough well‚Äëdefined tools.

MCP servers can be very powerful; they may read from internal systems or perform side‚Äëeffecting actions. Factory gives you several levers to control them:

- **Org allowlist/blocklist**
  - Org admins define which MCP servers are allowed at all.
  - Servers not on the allowlist are ignored, even if a project tries to configure them.

- **Project‚Äëlevel configuration**
  - Projects can enable subsets of the allowed servers and configure environment variables and connection details.

- **User‚Äëlevel opt‚Äëin**
  - Users can enable or disable MCP servers from the allowed set for their own sessions.

These controls let you safely expose internal systems to Droid while ensuring each server has passed security and compliance review.

---

## Droids, commands, and tools

Factory‚Äôs ecosystem of **droids, commands, and hooks** is also governed hierarchically.

### Org‚Äëlevel droids and commands

- Org admins can publish **blessed droids** and **shared commands** into an org‚Äëlevel `.factory` bundle.
- These often encode security‚Äëreviewed workflows such as:
  - `/security-review`
  - `/migrate-service`
  - `/refactor-module`
- Projects and users can use these resources but cannot modify them.

### Project‚Äëlevel extensions

- Projects add **specialized droids and commands** in their own `.factory/droids/` and `.factory/commands/` directories.
- These extend org resources with project‚Äëspecific logic‚Äîsuch as knowledge of particular services, schemas, or runbooks.

### User‚Äëlevel customization

- Users can add personal droids and commands in `~/.factory/droids/` and `~/.factory/commands/`.
- These are useful for individual workflows but must still respect org and project policies (for example, cannot call disallowed tools or models).

Hooks tie everything together by providing enforcement and logging at the edges of these tools. See [LLM Safety & Agent Controls](/enterprise/llm-safety-and-agent-controls) for more.

---

## Integration environments

Because Droid is CLI‚Äëfirst, it integrates with many environments without forcing developers into a particular IDE.

Common patterns include:

- **Terminals and shells**
  - Direct use of Droid in `bash`, `zsh`, `fish`, or Windows shells.
  - Shell aliases and scripts to standardize workflows across teams.

- **IDE and editor integrations**
  - Integrations with IDEs such as VS Code, JetBrains tools, and others that treat Droid as a backend agent.
  - Policies and telemetry still flow through the same hierarchical settings and OTEL pipelines.

- **CI/CD pipelines**
  - Running Droid in GitHub Actions, GitLab CI, or internal pipelines for tasks like code review, refactoring, and migration.
  - Use separate identities and credentials for CI compared to developers.

- **Remote workspaces and VMs**
  - Connecting the web platform to remote machines via secure bridges.
  - Running Droid in locked‚Äëdown remote environments while providing a browser‚Äëbased UX.

Across all of these, the same enterprise controls apply: **models, tools, MCP servers, and telemetry are constrained by org and project policy, not by the IDE or environment**.
</file>

<file path="docs/enterprise/network-and-deployment.mdx">
---
title: Network & Deployment Configuration
description: Reference architectures and network requirements for cloud, hybrid, and fully airgapped Droid deployments.
---

Droids are designed to run anywhere: on laptops, in CI pipelines, on VMs and Kubernetes clusters, and in fully airgapped environments.

This page describes the **supported deployment patterns**, their **network requirements**, and how to combine Droid with proxies, custom CAs, mTLS, and sandboxed containers.

---

## Deployment patterns

Factory supports three canonical patterns. You can mix patterns across teams and environments.

### 1. Cloud‚Äëmanaged deployment

In this pattern, Droid runs on developer machines and build infrastructure, while **Factory cloud** provides orchestration and optional analytics.

<CardGroup cols={2}>
  <Card title="Where Droid runs" icon="terminal">
    - Developer laptops and workstations
    - CI/CD runners (GitHub, GitLab, internal)
    - Optional devcontainers or remote workspaces
  </Card>
  <Card title="What lives in Factory cloud" icon="cloud">
    - Control plane and org metadata
    - Optional usage analytics dashboards
    - Authentication and access control for the web UI
  </Card>
</CardGroup>

LLM traffic can still be routed through **your own gateways and providers**; Factory does not need to broker model access.

Cloud‚Äëmanaged deployments are ideal for organizations that allow well‚Äëscoped cloud usage but want strong governance over models, keys, and telemetry.

### 2. Hybrid enterprise deployment

In hybrid deployments, Droid runs entirely within your infrastructure, while you may still use Factory cloud selectively for user experience and coordination.

- Droid processes run on **your VMs, containers, CI runners, and remote dev environments**.
- LLM traffic goes through **your LLM gateways or cloud providers** under your accounts.
- OTEL telemetry is sent to **your collectors and observability stack**.
- Factory cloud may see limited metadata (for example, org and project identifiers) if you enable cloud features.

This pattern is common for large enterprises and critical infrastructure where **network segmentation** and **central governance** are mandatory.

### 3. Fully airgapped deployment

In fully airgapped deployments:

- Droid runs in an isolated network with **no outbound internet connectivity**.
- Models are served from **on‚Äëprem or in‚Äënetwork endpoints**.
- OTEL collectors and observability tooling are hosted entirely inside the airgap.
- Factory cloud is not reachable at runtime; any artifacts (binaries, configuration) are imported via offline processes.

This is the default pattern for national security, defense, and other highly classified workloads.

---

## Network requirements

Network requirements vary per pattern.

### Cloud‚Äëmanaged

In addition to your model providers and OTEL collector endpoints, Droid typically needs:

- Access to Factory cloud endpoints (for example, `*.factory.ai` and related domains).
- Outbound access to any configured LLM providers or LLM gateways.
- Outbound access to OTEL collectors if they are hosted outside the local network.

Your security team can tighten access by:

- Restricting outbound hosts to the minimum set of domains.
- Using HTTPS proxies and custom CAs as described below.
- Routing all LLM traffic through a central gateway and monitoring.

### Hybrid

In hybrid mode, Droid generally needs only:

- Access to your **internal LLM gateways and model endpoints**.
- Access to your **internal OTEL collectors and SIEM/observability stack**.
- Optional, tightly scoped access to Factory cloud endpoints for specific features.

You can run Droid within private subnets, VPNs, and Kubernetes clusters, inheriting all existing firewall and network controls.

### Fully airgapped

In fully airgapped environments:

- Droid traffic is entirely **contained inside your network**.
- No external domains are required at runtime.
- Updates to Droid and configuration bundles are handled through your own artifact repositories or offline processes.

---

## Proxies, custom CAs, and mTLS

Enterprise networks frequently require HTTP(S) proxies, organization‚Äëspecific certificate authorities, and mutual TLS.

### HTTP(S) proxy support

Droid respects standard proxy environment variables:

```bash
export HTTPS_PROXY="https://proxy.example.com:8080"
export HTTP_PROXY="http://proxy.example.com:8080"

# Bypass proxy for specific hosts
export NO_PROXY="localhost,127.0.0.1,internal.example.com,.corp.example.com"
```

Use these to route traffic from Droid to LLM gateways and any Factory cloud endpoints through your corporate proxy.

### Custom certificate authorities

If your organization uses custom CAs for HTTPS inspection or internal endpoints, configure the runtime environment so Droid trusts those CAs (for example, via `NODE_EXTRA_CA_CERTS` or OS‚Äëlevel trust stores).

### Mutual TLS (mTLS)

For environments that require client certificates when calling gateways or internal APIs, configure your containers, VMs, or runners with the appropriate certificate, key, and passphrase. These settings are usually handled at the HTTP client or proxy layer that Droid uses.

---

## Running in secure containers and VMs

Running Droid inside hardened containers and VMs is one of the most effective ways to **bound the blast radius** of any agent mistakes or misconfigurations.

Recommended patterns include:

- **Devcontainers for untrusted code**
  - Use locked‚Äëdown devcontainers with restricted filesystem mounts and outbound network rules.
  - Run Droid with higher autonomy only inside these containers, never directly on the host.

- **Isolated VMs for sensitive operations**
  - Create dedicated VMs for production‚Äëadjacent work (for example, migration tooling).
  - Use OS policies to restrict which repos, secrets, and networks those VMs can access.

- **CI/CD pipelines**
  - Run Droid in ephemeral CI jobs with short‚Äëlived credentials and minimal privileges.
  - Combine with hooks and Droid Shield to prevent leaks and enforce approval workflows.

See [LLM Safety & Agent Controls](/enterprise/llm-safety-and-agent-controls) for how autonomy, allow/deny lists, and Droid Shield interact with these environments.

---

## Configuration surfaces

Network and deployment configuration is expressed through:

- **Environment variables** ‚Äì proxies, gateways, OTEL endpoints, custom certificates.
- **Org and project `.factory/settings.json`** ‚Äì hierarchical policies about where Droid may run, which models and gateways are allowed, and default telemetry destinations.
- **Org config endpoints** ‚Äì for large organizations, a central configuration service can distribute a standard `.factory` bundle to all environments.

For details on the hierarchy and merge behavior, see [Hierarchical Settings & Org Control](/enterprise/hierarchical-settings-and-org-control).
</file>

<file path="docs/enterprise/privacy-and-data-flows.mdx">
---
title: Privacy, Data Flows & Governance
description: How code, prompts, and telemetry move in cloud, hybrid, and fully airgapped Droid deployments, and how to control those flows.
---

High‚Äësecurity organizations need precise answers to **what data goes where, when, and under whose control**.

Factory‚Äôs answer is simple: **data boundaries are determined by the models, gateways, and deployment pattern you choose**, and Droid is configurable to respect those boundaries.

---

## Overview: three main data flows

When you run Droid, there are three primary ways data can move:

1. **Code and files** ‚Äì local reads and writes on your filesystem and git repositories.
2. **LLM traffic** ‚Äì prompts and context sent to model providers or LLM gateways.
3. **Telemetry** ‚Äì metrics, traces, and logs emitted via OpenTelemetry.

How far each flow travels depends on whether you are in a **cloud‚Äëmanaged**, **hybrid**, or **fully airgapped** deployment.

<CardGroup cols={3}>
  <Card title="Cloud‚Äëmanaged" icon="cloud">
    Droid runs on laptops and CI, talking to Factory‚Äôs cloud for orchestration
    and (optionally) analytics. LLM requests go to your chosen model providers
    or LLM gateways.
  </Card>
  <Card title="Hybrid" icon="cloud-off">
    Droid runs entirely inside your infra. LLM and OTEL traffic terminate in
    your network; Factory cloud may only see minimal metadata if you enable it.
  </Card>
  <Card title="Fully airgapped" icon="shield">
    Droid, models, and collectors all live inside an isolated network. No
    runtime dependency on Factory cloud; **no traffic leaves the environment**.
  </Card>
</CardGroup>

---

## Code and file access

Droid is a filesystem‚Äënative agent:

- It reads your code, configuration, and test files **directly from the local filesystem** at the moment they‚Äôre needed.
- It uses LLMs to analyze existing code and generate new code, then applies patches on disk, with git as the source of truth where available.
- It does **not** upload or index your codebase into a remote datastore; there is no static or ‚Äúcold‚Äù copy of your repository stored in Factory cloud.

In all deployment patterns:

- The **agent loop and runtime execute entirely on the machine** where Droid runs (developer workstation, CI runner, VM, or container).
- File contents can be included in LLM requests as context, so the data path for code always follows the same LLM request pipeline described below.
- **File reads and writes remain local** to that environment; only the portions you choose to include in prompts leave the machine, and only to the model endpoints you configure.
- Hooks and Droid Shield run locally inside that agent loop. By default they behave like local SAST / policy checks; they only send data off the machine if you explicitly configure a hook to call an external service.

You control which files and directories Droid can see through standard OS permissions and your repository layout. See [LLM Safety & Agent Controls](/enterprise/llm-safety-and-agent-controls) for additional file‚Äëlevel protections.

---

## LLM requests and model‚Äëspecific guarantees

When Droid needs model output, it sends prompts and context to **your configured models and LLM gateways**.

By default, Droid can target **enterprise‚Äëgrade endpoints** for providers like Azure OpenAI, AWS Bedrock, Google Vertex AI, OpenAI, Anthropic, and Gemini, using contracts that support zero data retention and enterprise privacy controls. In these configurations, Factory routes traffic **directly** to the provider‚Äôs official APIs; we do not proxy this traffic through third‚Äëparty services or store prompts and responses in Factory cloud.

If you instead configure your own endpoints‚ÄîLLM gateways, self‚Äëhosted models, or generic HTTP APIs‚Äîthe privacy guarantees are entirely determined by those systems and your agreements with them; Factory does not add additional protections on top.

### Model and gateway options

- **Cloud model providers** ‚Äì OpenAI, Anthropic, Google, and others via their enterprise offerings.
- **Cloud AI platforms** ‚Äì AWS Bedrock, GCP Vertex, Azure OpenAI, using your cloud accounts.
- **On‚Äëprem / self‚Äëhosted models** ‚Äì models served inside your network or airgapped environment via HTTP/gRPC gateways.
- **LLM gateways** ‚Äì central gateways that normalize traffic, add authentication, enforce rate limits, and log usage.

### How Droid interacts with models

- Org and project policies decide **which models and gateways are allowed**, and whether users can bring their own keys.
- In high‚Äësecurity settings, orgs commonly:
  - Prefer direct enterprise endpoints (for example, Azure OpenAI, AWS Bedrock, Google Vertex AI, OpenAI Enterprise, Anthropic/Claude Enterprise, Gemini Enterprise) to get first‚Äëparty zero‚Äëretention guarantees.
  - Disable ad‚Äëhoc user‚Äësupplied keys and generic internet endpoints.
  - Treat any LLM gateways or self‚Äëhosted models as in‚Äëscope security systems, subject to the same reviews and monitoring as other critical services.

See [Models, LLM Gateways & Integrations](/enterprise/models-llm-gateways-and-integrations) for configuration details.

---

## Telemetry and analytics

Telemetry is how you understand _what_ Droid is doing and _where_. Factory treats OpenTelemetry as the primary interface for this.

### OTEL as the source of truth

- Droid emits **OTLP signals** (metrics, traces, logs) to the endpoints you configure via environment variables or `.factory` settings.
- Typical destinations include OTEL collectors feeding **Prometheus, Datadog, New Relic, Splunk, Loki, Jaeger, Tempo**, and similar systems.
- High‚Äësecurity customers commonly deploy OTEL collectors **inside their own networks** and never send telemetry to Factory.

### Optional Factory cloud analytics

In cloud‚Äëmanaged deployments, you can opt into Factory‚Äôs own analytics dashboards, which may:

- Aggregate anonymized usage metrics to show adoption, model usage, and cost trends.
- Surface per‚Äëorg and per‚Äëteam insights for platform and leadership teams.

These analytics are optional; org administrators decide whether to enable them.

For more on signals and schema, see [Usage, Cost & Productivity Analytics](/enterprise/usage-cost-and-analytics) and [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring).

---

## Data retention and residency

### Factory‚Äëhosted components

In cloud‚Äëmanaged mode, Factory may store limited operational logs and metrics for:

- Authentication and administrative actions (for example, org configuration changes).
- Service health and debugging.

Retention and residency for these logs are documented in the Trust Center and can be tuned per customer engagement.

### Customer‚Äëhosted components

For hybrid and airgapped deployments:

- **LLM traffic** is handled entirely by your providers and gateways; Factory does not see it.
- **Telemetry** is stored in your observability stack; retention is governed by your own policies.
- **Code, configuration, and secrets** never leave your environment unless you explicitly send them to external services via hooks or gateways.

In fully airgapped environments, Factory never receives any runtime data; you are responsible for all retention and residency decisions.

---

## Governance controls in practice

To make these guarantees enforceable rather than aspirational, Factory exposes **governance levers** at the org and project levels:

- Model and gateway allow/deny lists.
- Policies for whether user‚Äësupplied BYOK keys are allowed.
- Global and project‚Äëspecific hooks for DLP, redaction, and approval workflows.
- OTEL endpoint configuration (including requiring on‚Äëprem collectors).
- Maximum autonomy level and other safety controls, especially in less‚Äëtrusted environments.

These levers are implemented through the **hierarchical settings** system described in [Hierarchical Settings & Org Control](/enterprise/hierarchical-settings-and-org-control).
</file>

<file path="docs/enterprise/usage-cost-and-analytics.mdx">
---
title: Usage, Cost & Productivity Analytics
description: How to measure Droid adoption, control LLM spend, and understand impact using OpenTelemetry and optional Factory dashboards.
---

Enterprise adoption requires more than a good developer experience‚Äîyou need to understand **who is using Droid, on what, and at what cost**.

Factory is built around **OpenTelemetry (OTEL)** so you can plug Droid directly into your existing observability stack, with optional cloud analytics for organizations that want a hosted view.

---

## OTEL‚Äënative metrics and traces

Droid emits OTEL signals that capture how it is used across your org.

### Key metric families

Examples of metric categories include:

- **Session metrics**
  - Counts of interactive and headless sessions.
  - Session duration and active engagement time.

- **LLM usage metrics**
  - Tokens in/out per model and provider.
  - Request counts and latencies.
  - Error rates and retry behavior.

- **Tool usage metrics**
  - Tool invocations and execution time.
  - Success/failure rates.
  - Command risk levels proposed and executed.

- **Code modification metrics**
  - Files and lines modified, created, or deleted.
  - Distribution across repositories and teams.

### Traces and spans

Traces can show the lifecycle of a session or automation run:

- Session start ‚Üí prompt construction ‚Üí LLM call ‚Üí tool execution ‚Üí code edits ‚Üí validation.
- Spans capture timing and metadata for each step, including model choice, tools invoked, and error conditions.

These signals allow you to build dashboards in systems like **Prometheus, Grafana, Datadog, New Relic, or Splunk** without depending on a proprietary analytics service.

For a deeper look at the telemetry schema and how it supports compliance and audits, see [Compliance, Audit & Monitoring](/enterprise/compliance-audit-and-monitoring).

---

## Factory cloud analytics (optional)

In cloud‚Äëmanaged deployments, Factory can provide a **hosted analytics view** for platform and leadership teams.

Typical views include:

- Adoption metrics by org, team, and repository.
- Model usage and performance trends.
- High‚Äëlevel cost estimates for LLM usage.
- Top workflows and droids by frequency.

These dashboards are built on top of the same signals Droid emits via OTEL; enabling them does not change the underlying telemetry model.

Hybrid and fully airgapped deployments commonly rely solely on **customer‚Äëowned OTEL pipelines** and disable hosted analytics entirely.

---

## Cost management strategies

LLM cost control is a combination of **model policy**, **usage patterns**, and **observability**.

Recommended practices:

<AccordionGroup>
  <Accordion title="Constrain the model catalog">
    Use org‚Äëlevel policies to limit which models are available.

    - Prefer smaller models for everyday tasks; reserve large models for complicated refactors or design work.
    - Disable experimental or high‚Äëcost models by default.
    - Enforce model choices per environment (for example, cheaper models in CI).
  </Accordion>

  <Accordion title="Tune autonomy and context usage">
    Higher autonomy and larger context windows consume more tokens.

    - Set reasonable defaults for autonomy level and reasoning effort.
    - Use hooks to cap context size or block unnecessary large prompts.
    - Encourage teams to iterate with tighter scopes (for example, specific directories instead of entire monorepos).
  </Accordion>

  <Accordion title="Use OTEL for cost monitoring">
    Feed token and request metrics into your observability stack.

    - Build per‚Äëteam and per‚Äëmodel dashboards.
    - Alert on unusual spikes in usage.
    - Compare cost curves before and after policy changes.
  </Accordion>
</AccordionGroup>

---

## Measuring productivity impact

Cost only matters in the context of outcomes. With OTEL, you can correlate Droid usage with **software delivery and quality metrics** you already track.

Common approaches:

- Link OTEL traces for Droid sessions with CI builds, test runs, and deployment pipelines.
- Measure how often Droid is involved in changes that reduce incidents, resolve alerts, or improve test coverage.
- Use code modification metrics to estimate automation impact (for example, lines of code refactored or migrated).

These analyses are done entirely in your existing observability and analytics stack; Factory‚Äôs role is to provide clean, structured signals from Droid.
</file>

<file path="docs/guides/building/droid-exec-tutorial.mdx">
---
title: "Building Interactive Apps with Droid Exec"
description: "Learn how to build a chat with X feature using Droid Exec"
---

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://youtube.com/embed/pd8fWTwJylw"
  title="Building Interactive Apps with Droid Exec"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## What this doc covers

- How to build a "chat with repo" feature using Factory's Droid Exec in headless mode
- Setting up streaming responses with Server-Sent Events for real-time agent feedback
- Understanding the actual implementation from Factory's official example

<Note>
  For a complete reference on Droid Exec capabilities, see the [Droid Exec Overview](/cli/droid-exec/overview)
</Note>

---

## 1. Pre-requisites and Installation

### Requirements
- Bun (the example uses Bun, but Node.js works too)
- Factory CLI installed (`droid` on your PATH)
- A local repository to chat with

### Installation

```bash
# Install Bun
curl -fsSL https://bun.sh/install | bash

# Install Factory CLI
curl -fsSL https://app.factory.ai/cli | sh

# Sign in to Factory (one-time browser auth)
droid
```

After the browser login, `droid exec` works from your app without needing API keys in code.

### Try the Official Example

```bash
git clone https://github.com/Factory-AI/examples.git
cd examples/droid-chat
bun i
bun dev
```

Open [http://localhost:4000](http://localhost:4000) - you'll see a chat window overlaid on the repo's README.

---

## 2. Why Use Droid Exec?

Building AI features that understand codebases requires orchestrating multiple operations: searching files, reading code, analyzing structure, and synthesizing answers. Without `droid exec`, a question like *"How do we charge for MCP servers?"* would require dozens of API calls and custom logic to search, read, and understand the relevant code.

`droid exec` is Factory's headless CLI mode that handles this autonomously in a single command. It searches codebases, reads files, reasons about code structure, and returns structured JSON output‚Äîwith built-in safety controls and configurable autonomy levels. Perfect for building chat interfaces, CI/CD automation, or any application that needs codebase intelligence.

---

## 3. How It Works: The Core Pattern

The Factory example uses a simple pattern: spawn `droid exec` with `--output-format debug` and stream the results via Server-Sent Events (SSE).

### Running Droid Exec

```typescript
// Simplified from src/server/chat.ts
function runDroidExec(prompt: string, repoPath: string) {
  const args = ["exec", "--output-format", "debug"];
  
  // Optional: configure model (defaults to glm-4.6)
  const model = process.env.DROID_MODEL_ID ?? "glm-4.6";
  args.push("-m", model);
  
  // Optional: reasoning level (off|low|medium|high)
  const reasoning = process.env.DROID_REASONING;
  if (reasoning) {
    args.push("-r", reasoning);
  }
  
  args.push(prompt);
  
  return Bun.spawn(["droid", ...args], {
    cwd: repoPath,
    stdio: ["ignore", "pipe", "pipe"]
  });
}
```

### Key Flags Explained

**`--output-format debug`**: Streams structured events as the agent works
- Each tool call (file read, search, etc.) emits an event
- Lets you show real-time progress to users
- Alternative: `--output-format json` for final output only

**`-m` (model)**: Choose your AI model
- `glm-4.6` - Fast, cheap (default)
- `gpt-5-codex` - Most powerful for complex code
- `claude-sonnet-4-5` - Best balance of speed and capability

**`-r` (reasoning)**: Control thinking depth
- `off` - No reasoning, fastest
- `low` - Light reasoning (default)
- `medium|high` - Deeper analysis, slower

**No `--auto` flag?**: Defaults to read-only (safest)
- Can't modify files, only read/search/analyze
- Perfect for chat applications

<Note>
  See [CLI Reference](/reference/cli-reference) for all flag explanations
</Note>

---

## 4. Building the Chat Feature: Streaming with SSE

The Factory example streams agent activity in real-time using Server-Sent Events. This gives users immediate feedback as the agent searches, reads files, and thinks.

### Server: Streaming SSE Endpoint

```typescript
// Simplified from src/server/chat.ts
export async function handleChatRequest(req: Request): Promise<Response> {
  const { message, history } = await req.json();
  
  // Get repo info (finds ./repos/<folder>)
  const repoInfo = await getLocalRepoInfo();
  
  // Build prompt with history
  const prompt = buildPrompt(message, history);
  
  // Spawn droid exec
  const proc = runDroidExec(prompt, repoInfo.workdir);
  
  // Create SSE stream
  const stream = new ReadableStream({
    start(controller) {
      const encoder = new TextEncoder();
      
      // Helper to send events
      const send = (event: string, data: any) => {
        controller.enqueue(encoder.encode(`event: ${event}\n`));
        controller.enqueue(encoder.encode(`data: ${JSON.stringify(data)}\n\n`));
      };
      
      // Read stdout and parse debug events
      const reader = proc.stdout.getReader();
      let buffer = "";
      
      (async () => {
        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          
          buffer += new TextDecoder().decode(value);
          buffer = parseAndFlush(buffer, (event, data) => {
            send(event, data);
          });
        }
      })();
      
      // When process exits, close stream
      proc.exited.then((code) => {
        send("exit", { code });
        controller.close();
      });
    }
  });
  
  return new Response(stream, {
    headers: {
      "Content-Type": "text/event-stream",
      "Cache-Control": "no-cache",
      "Connection": "keep-alive"
    }
  });
}
```

### Event Types You'll Receive

When `--output-format debug` is used, droid emits events like:

```
event: tool_call
data: {"tool":"grep","args":{"pattern":"MCP"}}

event: assistant_chunk
data: {"text":"I found references to MCP servers in..."}

event: tool_result
data: {"files_found":["src/billing.ts","config/pricing.yml"]}

event: exit
data: {"code":0}
```

### Client: React Hook for SSE

```typescript
// Simplified from src/hooks/useChat.ts
export function useChat() {
  const [messages, setMessages] = useState<Message[]>([]);
  
  const sendMessage = async (text: string, history: Message[]) => {
    // Add user message
    setMessages(prev => [...prev, { role: "user", content: text }]);
    
    // Start SSE connection
    const response = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text, history })
    });
    
    const reader = response.body!.getReader();
    const decoder = new TextDecoder();
    let buffer = "";
    let assistantMessage = { role: "assistant", content: "" };
    
    while (true) {
      const { value, done } = await reader.read();
      if (done) break;
      
      buffer += decoder.decode(value, { stream: true });
      
      // Parse SSE events
      const lines = buffer.split("\n");
      buffer = lines.pop() || "";
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        
        if (line.startsWith("event:")) {
          const event = line.slice(7);
          const dataLine = lines[++i];
          const data = JSON.parse(dataLine.slice(6));
          
          if (event === "assistant_chunk") {
            // Append to assistant message
            assistantMessage.content += data.text;
            setMessages(prev => {
              const newMessages = [...prev];
              if (newMessages[newMessages.length - 1]?.role !== "assistant") {
                newMessages.push({ ...assistantMessage });
              } else {
                newMessages[newMessages.length - 1] = { ...assistantMessage };
              }
              return newMessages;
            });
          }
          
          if (event === "exit") {
            // Done
            break;
          }
        }
      }
    }
  };
  
  return { messages, sendMessage };
}
```

### Real-World Example: The Video

In the demo video, the user asked: *"Can you search for how we charge for MCP servers?"*

Behind the scenes, `droid exec` automatically:
1. **Searched** the codebase with ripgrep for "MCP", "charge", "payment"
2. **Read** relevant files (billing config, pricing logic, env vars)
3. **Analyzed** the code structure to understand the charging flow
4. **Synthesized** a complete answer with file locations, variable names, and implementation details

All streamed in real-time through SSE - no manual orchestration needed.

### Project Structure (from the Example)

```
examples/droid-chat/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts       # Bun HTTP server + static files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.ts        # SSE endpoint, runs droid exec
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repo.ts        # Finds local repo in ./repos/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompt.ts      # System prompt + history formatting
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stream.ts      # Parses debug output, strips paths
‚îÇ   ‚îú‚îÄ‚îÄ components/chat/   # React chat UI
‚îÇ   ‚îî‚îÄ‚îÄ hooks/useChat.ts   # Client-side SSE parsing
‚îú‚îÄ‚îÄ repos/                 # Your repositories to chat with
‚îÇ   ‚îî‚îÄ‚îÄ your-repo/
‚îî‚îÄ‚îÄ public/                # Static assets
```

### Configuration Options

The example supports environment variables:

```bash
# .env
DROID_MODEL_ID=gpt-5-codex  # Default: glm-4.6
DROID_REASONING=low         # Default: low (off|low|medium|high)
PORT=4000                   # Default: 4000
HOST=localhost              # Default: localhost
```

### Best Practices

‚úÖ **Do:**
- Use read-only mode (no `--auto` flag) for user-facing features
- Validate user input before passing to `droid exec`
- Set timeouts (example uses 240 seconds)
- Parse SSE events incrementally for responsive UI
- Strip local file paths from debug output before sending to client

‚ö†Ô∏è **Avoid:**
- Using `--auto medium/high` in production without sandboxing
- Passing unsanitized user input directly to the CLI
- Blocking the main thread while waiting for results

---

## 5. Customization & Extensions

### Swap the Data Source

The example ships with a local repo, but you can easily adapt it:

**PDFs & Documents:**
```typescript
// Extract text from PDFs, write to temp dir, point droid at it
import { pdfToText } from 'pdf-to-text';

const text = await pdfToText('document.pdf');
fs.writeFileSync('/tmp/docs/content.txt', text);
runDroidExec("Summarize this document", '/tmp/docs');
```

**Databases:**
```typescript
// Add database context to prompt
const prompt = `You have access to a PostgreSQL database with these tables:
${JSON.stringify(schema)}

User question: ${message}`;

runDroidExec(prompt, repoPath); // Can read SQL files in repo
```

**Websites:**
```typescript
// Crawl site, save markdown, chat with it
import TurndownService from 'turndown';

const markdown = new TurndownService().turndown(html);
fs.writeFileSync('./repos/site-content/page.md', markdown);
```

### Change Models on the Fly

```typescript
// Let users pick models
function runWithModel(prompt: string, model: string) {
  return Bun.spawn([
    "droid", "exec",
    "-m", model,  // glm-4.6, gpt-5-codex, etc.
    "--output-format", "debug",
    prompt
  ], { cwd: repoPath });
}
```

### Add Tool Call Visibility

The example's `stream.ts` parses debug events. You can surface them in the UI:

```typescript
if (event === "tool_call") {
  // Show: "üîç Searching for 'MCP charge'"
  // Show: "üìÑ Reading src/billing.ts"
}
```

This creates a transparent, trust-building experience where users see exactly what the agent is doing.

---

## Additional Resources

**Official Example:**
- [GitHub: droid-chat example](https://github.com/Factory-AI/examples/tree/main/droid-chat) - Full working code

**Documentation:**
- [Droid Exec Overview](/cli/droid-exec/overview) - Complete CLI reference
- [Autonomy Levels Guide](/cli/user-guides/auto-run) - Understanding `--auto` flags
- [CI/CD Cookbook](/cli/droid-exec/cookbook/code-review) - Production patterns
- [Model Configuration](/reference/cli-reference) - Available models and settings

**Community:**
- [Factory Discord](https://discord.gg/zuudFXxg69) - Get help from the team
- [GitHub Discussions](https://github.com/factory-ai/factory/discussions) - Share your builds

---

## Next Steps

1. Clone the example: `git clone https://github.com/Factory-AI/examples.git`
2. Run it locally: `cd examples/droid-chat && bun dev`
3. Explore the code in `src/server/chat.ts` to see how SSE streaming works
4. Customize `src/server/prompt.ts` to change the agent's behavior
5. Swap `./repos/` content to chat with your own repositories

The example is intentionally minimal (~500 lines total) so you can understand it fully and adapt it to your needs.
</file>

<file path="docs/guides/building/droid-vps-setup.mdx">
---
title: "Deploy Droid on a VPS Server"
description: "Learn how to set up droid on a VPS for remote access and headless automation"
---

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://youtube.com/embed/a3tqhTdSugg"
  title="Deploy Droid on a VPS Server"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## What this doc covers

- Set up Factory's CLI, Droid, on a Virtual Private Server (VPS) for remote access from anywhere
- Configure SSH authentication with key pairs for secure, passwordless server connections
- Use `droid exec` for headless automation tasks and system administration on your server

---

## 1. Prerequisites and installation

Before starting, you'll need:

- **Factory CLI installed locally** - Follow the [installation guide](/cli/getting-started/quickstart)
- **Factory account** - Sign up at [factory.ai](https://factory.ai)
- **VPS provider account** - This tutorial uses [Hetzner](https://www.hetzner.com/), but works with any VPS provider (DigitalOcean, Linode, AWS EC2, etc.)
- **Basic terminal familiarity** - You'll be running commands in your local terminal and on the server

**Cost estimate**: A basic VPS suitable for running droid costs around $5-10/month.

---

## 2. Why use droid on a VPS?

Running AI agents locally limits you to when you're at your computer. Production debugging, scheduled automation, and mobile access all require a server that's always available. Without a VPS, you can't monitor servers from your phone, run headless automation 24/7, or access droid while traveling.

By deploying droid on a VPS, you get an always-available AI assistant accessible from any device. Perfect for system administration, production debugging, and building custom automation workflows with `droid exec`.

---

## 3. Setup and basic usage

Let's walk through the complete setup process, from creating SSH keys to connecting to your VPS.

### Step 1: Generate SSH keys with droid

We'll use droid locally to create an SSH key pair. This is more secure than password authentication and enables seamless connections.

```bash
# Start droid in your local terminal
droid

# Ask droid to create the key pair
> Create a new SSH key pair called example
```

Droid will generate two files:
- `~/.ssh/example` - Private key (keep this secret, never share)
- `~/.ssh/example.pub` - Public key (safe to share, will be added to your VPS)

### Step 2: Copy the public key

```bash
# Ask droid to copy the public key to your clipboard
> Copy the public key to the clipboard
```

### Step 3: Create your VPS and add the SSH key

In your VPS provider dashboard (Hetzner example):

1. **Create a new server**:
   - Choose your server type (e.g., CPX22 - $4.99/month)
   - Select a location (e.g., Ashburn, Virginia)
   - Keep default options

2. **Add your SSH key**:
   - In the "SSH Keys" section, click "Add SSH Key"
   - Paste the public key you copied
   - Name it "example" (or any descriptive name)
   - Add the key to the server

3. **Name and create**:
   - Optionally name your server (e.g., "example-vps")
   - Click "Create" and wait for the server to spin up

### Step 4: Configure SSH for easy access

Once your server is ready, copy its IP address (e.g., `123.45.67.89`) and ask droid to configure your SSH settings:

```bash
# In droid
> Add 123.45.67.89 to my SSH config file with an alias called example so I can connect easily
```

Droid will update your `~/.ssh/config` file to include something like:

```ssh-config
Host example
    HostName 123.45.67.89
    User root
    IdentityFile ~/.ssh/example
```

**What this enables**: Instead of typing `ssh root@123.45.67.89 -i ~/.ssh/example` every time, you can simply run `ssh example`.

### Step 5: Connect and install Droid on the VPS

```bash
# In a new terminal window, connect to your VPS
ssh example

# Install Factory CLI on the VPS
curl -fsSL https://cli.factory.ai/install.sh | sh

# Activate the installation
source ~/.bashrc  # or source ~/.zshrc if using zsh

# Verify installation
droid --version
```

### Step 6: Authenticate Droid on the VPS

```bash
# Run droid for the first time
droid
```

On first run, droid will prompt you to log in:
1. It displays a URL and an authentication code
2. Copy the code
3. Click the URL (or paste it in your browser)
4. Paste the code to authenticate
5. You're now logged in and can use droid on your VPS

**Success check**: You should now see the droid prompt on your VPS, ready to accept commands.

---

## 4. Advanced example: System administration with droid

Now that droid is running on your VPS, let's use it for practical server administration. This example shows how droid can handle complex setup tasks like configuring a web server.

### Setting up Nginx with Docker

```bash
# In your VPS, with droid running
> Set up Nginx with Docker and serve a hello world page
```

Droid will:
1. Install Docker if not already present
2. Create a basic Nginx configuration
3. Create an HTML file with "Hello World"
4. Set up and run the Docker container
5. Configure networking and ports

**Verification**: Open a browser and navigate to your VPS IP address (e.g., `http://123.45.67.89`). You should see "Hello World" displayed.

**What makes this powerful**: Tasks that normally require multiple commands, configuration files, and troubleshooting are handled by droid with a single natural language instruction. Droid understands best practices and handles edge cases automatically.

---

## 5. Droid exec: Headless automation and custom agents

The real power of running droid on a VPS is `droid exec` - a headless mode that enables programmatic access for building automation workflows and custom agents.

### What is droid exec?

`droid exec` runs droid commands without an interactive session, making it perfect for:
- Scheduled automation tasks
- Building custom agent frameworks
- Integrating droid into scripts and applications
- Running quick queries from CI/CD pipelines

<Note>See the full droid exec docs [here](/cli/droid-exec/overview).</Note>

### Basic droid exec usage

```bash
# Simple query with a fast model (GLM 4.6)
droid exec --model glm-4.6 "Tell me a joke"
```

### Advanced: System exploration

```bash
# Ask droid to explore your system and find specific information
droid exec --model glm-4.6 "Explore my system and tell me where the file is that I'm serving with Nginx"
```

Droid will:
1. Search for Nginx configuration files
2. Identify the document root
3. Locate the HTML/content files being served
4. Report back with file paths and relevant configuration

**Output example**:
```
Configuration file: /etc/nginx/nginx.conf
Content file: /var/www/html/index.html
Docker setup: /home/user/docker-compose.yml
Server running on: port 80
```

---

## 6. Remote access from anywhere

One of the biggest advantages of having droid on a VPS is accessing it from any device, including mobile.

### Using Termius for mobile SSH access

<iframe
  className="w-full aspect-video rounded-xl"
  src="https://youtube.com/embed/6aghwvyZsDo"
  title="Using Termius for mobile SSH access"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

[Termius](https://termius.com/) is a modern SSH client available for:
- macOS, Windows, Linux (desktop)
- iOS and Android (mobile)

**Setup steps**:

1. **Install Termius** on your device
2. **Add your SSH key**:
   - In Termius, go to Keychain
   - Add a new key
   - Import your private key (`~/.ssh/example`)
3. **Add your VPS host**:
   - Create a new host
   - Hostname: Your VPS IP address
   - Username: `root` (or your configured user)
   - Key: Select the key you imported
4. **Connect**: Tap the host to connect

**Mobile workflow**:
```bash
# On your phone via Termius
ssh example

# Run droid
droid

# Or use droid exec for quick queries
droid exec --model glm-4-flash "Check system resources and uptime"
```

### Real-world scenarios

- **Travel troubleshooting**: Server goes down while you're away? SSH in from your phone and let droid help diagnose and fix the issue
- **On-call debugging**: Respond to alerts from anywhere with AI-assisted investigation
- **Quick queries**: Check system status, review logs, or make configuration changes without needing your laptop

## Next steps

Now that you have droid running on your VPS:

1. **Explore automation**: Start with simple `droid exec` commands and build up to custom scripts
2. **Set up monitoring**: Use droid to help configure system monitoring and alerting
3. **Create scheduled tasks**: Combine droid exec with cron jobs for recurring automation
4. **Join the community**: Share your use cases and learn from others in the [Factory Discord](https://discord.gg/zuudFXxg69)

For more information:
- [Factory CLI Documentation](/cli/getting-started/overview)
- [Droid Exec Reference](/cli/droid-exec/overview)
- [Custom Droids Guide](/cli/configuration/custom-droids)
</file>

<file path="docs/guides/product/coming-soon.mdx">
---
title: "Product Guides"
description: "Product guides coming soon"
---

# Product Guides

Product guides are coming soon. Stay tuned for guides on building product features with Factory.
</file>

<file path="docs/images/logos/linear.svg">
<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.03509 12.9431C3.24245 14.9227 4.10472 16.8468 5.62188 18.364C7.13904 19.8811 9.0631 20.7434 11.0428 20.9508L3.03509 12.9431Z" fill="#000000"/>
<path d="M3 11.4938L12.4921 20.9858C13.2976 20.9407 14.0981 20.7879 14.8704 20.5273L3.4585 9.11548C3.19793 9.88771 3.0451 10.6883 3 11.4938Z" fill="#000000"/>
<path d="M3.86722 8.10999L15.8758 20.1186C16.4988 19.8201 17.0946 19.4458 17.6493 18.9956L4.99021 6.33659C4.54006 6.89125 4.16573 7.487 3.86722 8.10999Z" fill="#000000"/>
<path d="M5.66301 5.59517C9.18091 2.12137 14.8488 2.135 18.3498 5.63604C21.8508 9.13708 21.8645 14.8049 18.3907 18.3228L5.66301 5.59517Z" fill="#000000"/>
</svg>
</file>

<file path="docs/images/hero-dark.svg">
<svg width="700" height="320" viewBox="0 0 700 320" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_2862_30)">
<rect width="700" height="320" rx="16" fill="url(#paint0_linear_2862_30)"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="white"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="url(#paint1_radial_2862_30)"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="black" fill-opacity="0.5" style="mix-blend-mode:hard-light"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="url(#paint2_linear_2862_30)" fill-opacity="0.5" style="mix-blend-mode:hard-light"/>
<path d="M311.72 247.034C283.108 246.887 258.409 231.208 246.538 201.531C234.656 171.825 238.271 134.702 253.583 101.377C282.195 101.524 306.894 117.203 318.765 146.88C330.647 176.586 327.031 213.709 311.72 247.034Z" stroke="url(#paint3_linear_2862_30)" stroke-opacity="0.05" stroke-width="0.530516"/>
<path d="M305.839 247.174C343.92 237.419 377.154 210.619 393.585 171.64C410.017 132.661 405.98 90.1988 386.347 56.1934C348.266 65.9477 315.032 92.7486 298.601 131.728C282.169 170.706 286.206 213.168 305.839 247.174Z" fill="white"/>
<path d="M305.839 247.174C343.92 237.419 377.154 210.619 393.585 171.64C410.017 132.661 405.98 90.1988 386.347 56.1934C348.266 65.9477 315.032 92.7486 298.601 131.728C282.169 170.706 286.206 213.168 305.839 247.174Z" fill="url(#paint4_radial_2862_30)"/>
<path d="M393.341 171.537C376.971 210.369 343.89 237.091 305.969 246.867C286.462 212.959 282.476 170.663 298.845 131.831C315.215 92.9978 348.295 66.2765 386.217 56.5004C405.724 90.4077 409.71 132.704 393.341 171.537Z" stroke="url(#paint5_linear_2862_30)" stroke-opacity="0.05" stroke-width="0.530516"/>
<path d="M305.686 246.995C329.749 266.114 361.965 272.832 393.67 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.045 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="white"/>
<path d="M305.686 246.995C329.749 266.114 361.965 272.832 393.67 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.045 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="url(#paint6_radial_2862_30)"/>
<path d="M305.686 246.995C329.749 266.114 361.965 272.832 393.67 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.045 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="black" fill-opacity="0.2" style="mix-blend-mode:hard-light"/>
<path d="M305.686 246.995C329.749 266.114 361.965 272.832 393.67 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.045 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="url(#paint7_linear_2862_30)" fill-opacity="0.5" style="mix-blend-mode:hard-light"/>
<path d="M393.586 261.878C362.034 272.529 329.98 265.88 306.002 246.907C317.534 215.919 341.57 190.327 373.13 179.673C404.681 169.023 436.735 175.671 460.714 194.644C449.181 225.632 425.145 251.224 393.586 261.878Z" stroke="url(#paint8_linear_2862_30)" stroke-opacity="0.05" stroke-width="0.530516"/>
<g opacity="0.8" filter="url(#filter0_f_2862_30)">
<circle cx="660" cy="-60" r="160" fill="#18E244" fill-opacity="0.4"/>
</g>
<g opacity="0.8" filter="url(#filter1_f_2862_30)">
<circle cx="20" cy="213" r="160" fill="#18CAE2" fill-opacity="0.33"/>
</g>
<g opacity="0.8" filter="url(#filter2_f_2862_30)">
<circle cx="660" cy="480" r="160" fill="#18E2B2" fill-opacity="0.52"/>
</g>
<g opacity="0.8" filter="url(#filter3_f_2862_30)">
<circle cx="20" cy="413" r="160" fill="#4018E2" fill-opacity="0.22"/>
</g>
<path opacity="0.2" d="M0 50H700" stroke="url(#paint9_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.1" d="M0 82H700" stroke="url(#paint10_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.2" d="M239 0L239 320" stroke="url(#paint11_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.1" d="M271 0L271 320" stroke="url(#paint12_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.2" d="M461 0L461 320" stroke="url(#paint13_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.1" d="M429 0L429 320" stroke="url(#paint14_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.2" d="M0 271H700" stroke="url(#paint15_radial_2862_30)" stroke-dasharray="4 4"/>
<path opacity="0.1" d="M0 239H700" stroke="url(#paint16_radial_2862_30)" stroke-dasharray="4 4"/>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M0 160H700" stroke="url(#paint17_linear_2862_30)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.2">
<path d="M511 -1L189 321" stroke="url(#paint18_linear_2862_30)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.2">
<path d="M511 321L189 -1" stroke="url(#paint19_linear_2862_30)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<circle cx="350" cy="160" r="111" stroke="white"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<circle cx="350" cy="160" r="79" stroke="white"/>
</g>
</g>
<defs>
<filter id="filter0_f_2862_30" x="260" y="-460" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_30"/>
</filter>
<filter id="filter1_f_2862_30" x="-380" y="-187" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_30"/>
</filter>
<filter id="filter2_f_2862_30" x="260" y="80" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_30"/>
</filter>
<filter id="filter3_f_2862_30" x="-380" y="13" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_30"/>
</filter>
<linearGradient id="paint0_linear_2862_30" x1="1.04308e-05" y1="320" x2="710.784" y2="26.0793" gradientUnits="userSpaceOnUse">
<stop stop-color="#18E299" stop-opacity="0.09"/>
<stop offset="0.729167" stop-color="#0D9373" stop-opacity="0.08"/>
</linearGradient>
<radialGradient id="paint1_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(208.697 189.703) rotate(-10.029) scale(169.097 167.466)">
<stop stop-color="#00B0BB"/>
<stop offset="1" stop-color="#00DB65"/>
</radialGradient>
<linearGradient id="paint2_linear_2862_30" x1="306.587" y1="93.5598" x2="252.341" y2="224.228" gradientUnits="userSpaceOnUse">
<stop stop-color="#18E299"/>
<stop offset="1"/>
</linearGradient>
<linearGradient id="paint3_linear_2862_30" x1="311.84" y1="123.717" x2="253.579" y2="224.761" gradientUnits="userSpaceOnUse">
<stop/>
<stop offset="1" stop-opacity="0"/>
</linearGradient>
<radialGradient id="paint4_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(313.407 243.64) rotate(-75.7542) scale(203.632 223.902)">
<stop stop-color="#00BBBB"/>
<stop offset="0.712616" stop-color="#00DB65"/>
</radialGradient>
<linearGradient id="paint5_linear_2862_30" x1="308.586" y1="102.284" x2="383.487" y2="201.169" gradientUnits="userSpaceOnUse">
<stop/>
<stop offset="1" stop-opacity="0"/>
</linearGradient>
<radialGradient id="paint6_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(311.446 249.925) rotate(-20.3524) scale(174.776 163.096)">
<stop stop-color="#00B0BB"/>
<stop offset="1" stop-color="#00DB65"/>
</radialGradient>
<linearGradient id="paint7_linear_2862_30" x1="395.842" y1="169.781" x2="332.121" y2="263.82" gradientUnits="userSpaceOnUse">
<stop stop-color="#00B1BC"/>
<stop offset="1"/>
</linearGradient>
<linearGradient id="paint8_linear_2862_30" x1="395.842" y1="169.781" x2="370.99" y2="271.799" gradientUnits="userSpaceOnUse">
<stop/>
<stop offset="1" stop-opacity="0"/>
</linearGradient>
<radialGradient id="paint9_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(350 50) scale(398.125 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint10_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(350 82) scale(398.125 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint11_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(239 160) rotate(90) scale(182 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint12_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(271 160) rotate(90) scale(182 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint13_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(461 160) rotate(90) scale(182 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint14_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(429 160) rotate(90) scale(182 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint15_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(350 271) scale(398.125 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<radialGradient id="paint16_radial_2862_30" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(350 239) scale(398.125 182)">
<stop offset="0.348958" stop-color="#84FFD3"/>
<stop offset="0.880208" stop-color="#18E299" stop-opacity="0"/>
</radialGradient>
<linearGradient id="paint17_linear_2862_30" x1="0" y1="160" x2="700" y2="160" gradientUnits="userSpaceOnUse">
<stop stop-color="white" stop-opacity="0.1"/>
<stop offset="0.5" stop-color="white"/>
<stop offset="1" stop-color="white" stop-opacity="0.1"/>
</linearGradient>
<linearGradient id="paint18_linear_2862_30" x1="511" y1="-1" x2="189" y2="321" gradientUnits="userSpaceOnUse">
<stop stop-color="white" stop-opacity="0.1"/>
<stop offset="0.5" stop-color="white"/>
<stop offset="1" stop-color="white" stop-opacity="0.1"/>
</linearGradient>
<linearGradient id="paint19_linear_2862_30" x1="511" y1="321" x2="189" y2="-0.999997" gradientUnits="userSpaceOnUse">
<stop stop-color="white" stop-opacity="0.1"/>
<stop offset="0.5" stop-color="white"/>
<stop offset="1" stop-color="white" stop-opacity="0.1"/>
</linearGradient>
<clipPath id="clip0_2862_30">
<rect width="700" height="320" rx="16" fill="white"/>
</clipPath>
</defs>
</svg>
</file>

<file path="docs/images/hero-light.svg">
<svg width="700" height="320" viewBox="0 0 700 320" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_2862_278)">
<rect width="700" height="320" rx="16" fill="url(#paint0_linear_2862_278)"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="white"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="url(#paint1_radial_2862_278)"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="black" fill-opacity="0.5" style="mix-blend-mode:hard-light"/>
<path d="M311.889 247.3C283.097 247.215 258.226 231.466 246.292 201.629C234.357 171.793 238.02 134.523 253.414 101.112C282.206 101.197 307.077 116.945 319.011 146.782C330.946 176.619 327.283 213.888 311.889 247.3Z" fill="url(#paint2_linear_2862_278)" fill-opacity="0.5" style="mix-blend-mode:hard-light"/>
<path d="M311.72 247.034C283.108 246.887 258.409 231.208 246.538 201.531C234.656 171.825 238.271 134.702 253.583 101.377C282.195 101.524 306.894 117.203 318.765 146.88C330.647 176.586 327.031 213.709 311.72 247.034Z" stroke="url(#paint3_linear_2862_278)" stroke-opacity="0.05" stroke-width="0.530516"/>
<path d="M305.839 247.174C343.92 237.419 377.154 210.619 393.585 171.64C410.017 132.661 405.98 90.1988 386.347 56.1934C348.266 65.9477 315.032 92.7486 298.601 131.728C282.169 170.706 286.206 213.168 305.839 247.174Z" fill="white"/>
<path d="M305.839 247.174C343.92 237.419 377.154 210.619 393.585 171.64C410.017 132.661 405.98 90.1988 386.347 56.1934C348.266 65.9477 315.032 92.7486 298.601 131.728C282.169 170.706 286.206 213.168 305.839 247.174Z" fill="url(#paint4_radial_2862_278)"/>
<path d="M393.341 171.537C376.971 210.369 343.89 237.091 305.969 246.867C286.462 212.959 282.476 170.663 298.845 131.831C315.215 92.9978 348.295 66.2765 386.217 56.5004C405.724 90.4077 409.71 132.704 393.341 171.537Z" stroke="url(#paint5_linear_2862_278)" stroke-opacity="0.05" stroke-width="0.530516"/>
<path d="M305.686 246.995C329.75 266.114 361.965 272.832 393.671 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.046 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="white"/>
<path d="M305.686 246.995C329.75 266.114 361.965 272.832 393.671 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.046 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="url(#paint6_radial_2862_278)"/>
<path d="M305.686 246.995C329.75 266.114 361.965 272.832 393.671 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.046 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="black" fill-opacity="0.2" style="mix-blend-mode:hard-light"/>
<path d="M305.686 246.995C329.75 266.114 361.965 272.832 393.671 262.129C425.376 251.426 449.499 225.691 461.03 194.556C436.967 175.437 404.751 168.719 373.046 179.422C341.34 190.125 317.217 215.86 305.686 246.995Z" fill="url(#paint7_linear_2862_278)" fill-opacity="0.5" style="mix-blend-mode:hard-light"/>
<path d="M393.586 261.878C362.035 272.529 329.981 265.88 306.002 246.907C317.535 215.919 341.571 190.327 373.13 179.673C404.682 169.023 436.736 175.671 460.715 194.644C449.182 225.632 425.146 251.224 393.586 261.878Z" stroke="url(#paint8_linear_2862_278)" stroke-opacity="0.05" stroke-width="0.530516"/>
<g opacity="0.8" filter="url(#filter0_f_2862_278)">
<circle cx="660" cy="-60" r="160" fill="#18E299" fill-opacity="0.4"/>
</g>
<g opacity="0.8" filter="url(#filter1_f_2862_278)">
<circle cx="20" cy="213" r="160" fill="#18E299" fill-opacity="0.33"/>
</g>
<g opacity="0.8" filter="url(#filter2_f_2862_278)">
<circle cx="660" cy="480" r="160" fill="#18E299" fill-opacity="0.52"/>
</g>
<g opacity="0.8" filter="url(#filter3_f_2862_278)">
<circle cx="20" cy="413" r="160" fill="#18E299" fill-opacity="0.22"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M0 50H700" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M0 82H700" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M239 0L239 320" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M271 0L271 320" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M461 0L461 320" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M350 0L350 320" stroke="url(#paint9_linear_2862_278)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M429 0L429 320" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M0 271H700" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M0 239H700" stroke="black" stroke-dasharray="4 4"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M0 160H700" stroke="url(#paint10_linear_2862_278)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M511 -1L189 321" stroke="url(#paint11_linear_2862_278)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.1">
<path d="M511 321L189 -1" stroke="url(#paint12_linear_2862_278)"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.05">
<circle cx="350" cy="160" r="111" stroke="black"/>
</g>
<g style="mix-blend-mode:overlay" opacity="0.05">
<circle cx="350" cy="160" r="79" stroke="black"/>
</g>
</g>
<defs>
<filter id="filter0_f_2862_278" x="260" y="-460" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_278"/>
</filter>
<filter id="filter1_f_2862_278" x="-380" y="-187" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_278"/>
</filter>
<filter id="filter2_f_2862_278" x="260" y="80" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_278"/>
</filter>
<filter id="filter3_f_2862_278" x="-380" y="13" width="800" height="800" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="120" result="effect1_foregroundBlur_2862_278"/>
</filter>
<linearGradient id="paint0_linear_2862_278" x1="1.04308e-05" y1="320" x2="710.784" y2="26.0793" gradientUnits="userSpaceOnUse">
<stop stop-color="#18E299" stop-opacity="0.09"/>
<stop offset="0.729167" stop-color="#0D9373" stop-opacity="0.08"/>
</linearGradient>
<radialGradient id="paint1_radial_2862_278" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(208.697 189.703) rotate(-10.029) scale(169.097 167.466)">
<stop stop-color="#00B0BB"/>
<stop offset="1" stop-color="#00DB65"/>
</radialGradient>
<linearGradient id="paint2_linear_2862_278" x1="306.587" y1="93.5598" x2="252.341" y2="224.228" gradientUnits="userSpaceOnUse">
<stop stop-color="#18E299"/>
<stop offset="1"/>
</linearGradient>
<linearGradient id="paint3_linear_2862_278" x1="311.84" y1="123.717" x2="253.579" y2="224.761" gradientUnits="userSpaceOnUse">
<stop/>
<stop offset="1" stop-opacity="0"/>
</linearGradient>
<radialGradient id="paint4_radial_2862_278" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(313.407 243.64) rotate(-75.7542) scale(203.632 223.902)">
<stop stop-color="#00BBBB"/>
<stop offset="0.712616" stop-color="#00DB65"/>
</radialGradient>
<linearGradient id="paint5_linear_2862_278" x1="308.586" y1="102.284" x2="383.487" y2="201.169" gradientUnits="userSpaceOnUse">
<stop/>
<stop offset="1" stop-opacity="0"/>
</linearGradient>
<radialGradient id="paint6_radial_2862_278" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(311.447 249.925) rotate(-20.3524) scale(174.776 163.096)">
<stop stop-color="#00B0BB"/>
<stop offset="1" stop-color="#00DB65"/>
</radialGradient>
<linearGradient id="paint7_linear_2862_278" x1="395.843" y1="169.781" x2="332.121" y2="263.82" gradientUnits="userSpaceOnUse">
<stop stop-color="#00B1BC"/>
<stop offset="1"/>
</linearGradient>
<linearGradient id="paint8_linear_2862_278" x1="395.843" y1="169.781" x2="370.991" y2="271.799" gradientUnits="userSpaceOnUse">
<stop/>
<stop offset="1" stop-opacity="0"/>
</linearGradient>
<linearGradient id="paint9_linear_2862_278" x1="350" y1="0" x2="350" y2="320" gradientUnits="userSpaceOnUse">
<stop stop-opacity="0"/>
<stop offset="0.0001" stop-opacity="0.3"/>
<stop offset="0.333333"/>
<stop offset="0.666667"/>
<stop offset="1" stop-opacity="0.3"/>
</linearGradient>
<linearGradient id="paint10_linear_2862_278" x1="0" y1="160" x2="700" y2="160" gradientUnits="userSpaceOnUse">
<stop stop-opacity="0.1"/>
<stop offset="0.5"/>
<stop offset="1" stop-opacity="0.1"/>
</linearGradient>
<linearGradient id="paint11_linear_2862_278" x1="511" y1="-1" x2="189" y2="321" gradientUnits="userSpaceOnUse">
<stop stop-opacity="0.1"/>
<stop offset="0.5"/>
<stop offset="1" stop-opacity="0.1"/>
</linearGradient>
<linearGradient id="paint12_linear_2862_278" x1="511" y1="321" x2="189" y2="-0.999997" gradientUnits="userSpaceOnUse">
<stop stop-opacity="0.1"/>
<stop offset="0.5"/>
<stop offset="1" stop-opacity="0.1"/>
</linearGradient>
<clipPath id="clip0_2862_278">
<rect width="700" height="320" rx="16" fill="white"/>
</clipPath>
</defs>
</svg>
</file>

<file path="docs/logo/dark.svg">
<svg width="3402" height="957" viewBox="0 0 3402 957" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M850.34 642.2V314.85H1089.34V373.3H913.5V450H1070.63V506.58H913.5V642.2H850.34Z" fill="white"/>
<path d="M1130.47 642.2L1228.55 360.8C1233.23 347.375 1241.97 335.739 1253.57 327.506C1265.16 319.273 1279.02 314.849 1293.24 314.85C1307.55 314.848 1321.5 319.327 1333.13 327.658C1344.76 335.989 1353.49 347.753 1358.1 361.3L1453.61 642.2H1388.61L1365.69 573.92H1219.79L1195.94 642.2H1130.47ZM1238.47 516.87H1346.97L1307.75 398.87C1303.07 384.77 1283.15 384.72 1278.4 398.79L1238.47 516.87Z" fill="white"/>
<path d="M1502.72 478.52C1502.72 386.4 1577.07 311.1 1669.2 311.1C1737.01 311.1 1792.2 352.26 1818.38 410.71L1758.52 428.02C1741.69 394.81 1710.82 370.96 1669.2 370.96C1609.34 370.96 1565.38 418.66 1565.38 478.52C1565.38 538.38 1609.38 585.61 1669.2 585.61C1710.82 585.61 1740.75 564.1 1757.12 530.43L1817.91 546.8C1792.19 604.8 1737.48 645.47 1669.2 645.47C1577.07 645.47 1502.72 570.68 1502.72 478.52Z" fill="white"/>
<path d="M1984.87 642.2V373.3H1881.98V314.85H2146.67V373.3H2047.53V642.2H1984.87Z" fill="white"/>
<path d="M2210.76 476.329C2212.19 384.479 2286.38 311.029 2378.23 311.569C2469.89 312.119 2543.71 386.73 2544.17 478.99C2544.63 571.25 2469.35 645.99 2377.22 645.99C2284.21 645.94 2209.31 569.679 2210.76 476.329ZM2481.04 478.99C2481.04 419.13 2437.04 369.99 2377.22 369.99C2317.83 369.99 2273.4 419.09 2273.4 478.99C2273.4 538.38 2317.4 586.99 2377.22 586.99C2437.04 586.99 2481.04 538.85 2481.04 478.99Z" fill="white"/>
<path d="M2629.76 642.2V314.85H2777.07C2841.61 314.85 2890.24 366.29 2890.24 425.68C2890.19 446.932 2883.61 467.656 2871.4 485.051C2859.19 502.447 2841.94 515.675 2821.97 522.95L2894.92 642.2H2823.37L2755.56 530.9H2692.93V642.2H2629.76ZM2692.9 476.2H2776.14C2806.07 476.2 2829.45 454.2 2829.45 423.83C2829.45 394.37 2807.45 371.45 2777.07 371.45H2692.93L2692.9 476.2Z" fill="white"/>
<path d="M3053.93 539.78L2940.29 314.85H3007.17L3084.8 468.7L3162.43 314.85H3229.3L3117.06 537.91V642.2H3053.93V539.78Z" fill="white"/>
<path d="M500.76 329.29C499.9 329.077 499.097 328.68 498.404 328.128C497.712 327.575 497.146 326.88 496.748 326.089C496.349 325.298 496.126 324.43 496.093 323.545C496.061 322.659 496.22 321.778 496.56 320.96C508.3 292.39 513.48 269.53 505.12 259.96C482.98 234.57 394.19 285.059 365.88 302.159C365.122 302.615 364.274 302.902 363.395 303C362.516 303.098 361.626 303.005 360.786 302.728C359.946 302.451 359.175 301.996 358.527 301.394C357.879 300.792 357.369 300.057 357.03 299.24C345.13 270.73 332.62 250.9 319.94 250.04C286.33 247.74 259.24 346.229 251.31 378.329C251.098 379.189 250.703 379.993 250.152 380.685C249.6 381.378 248.905 381.943 248.115 382.342C247.325 382.741 246.458 382.964 245.573 382.996C244.689 383.029 243.808 382.87 242.99 382.53C214.42 370.79 191.55 365.61 181.99 373.97C156.6 396.11 207.08 484.9 224.18 513.21C224.637 513.967 224.925 514.815 225.024 515.695C225.123 516.574 225.031 517.465 224.754 518.305C224.477 519.146 224.021 519.917 223.418 520.565C222.815 521.213 222.079 521.722 221.26 522.059C192.76 533.959 172.93 546.469 172.06 559.149C169.77 592.759 268.25 619.85 300.36 627.78C301.218 627.994 302.019 628.391 302.71 628.943C303.4 629.495 303.964 630.19 304.361 630.98C304.759 631.769 304.982 632.635 305.014 633.519C305.047 634.402 304.889 635.283 304.55 636.099C292.81 664.669 287.63 687.539 295.99 697.099C318.13 722.489 406.93 672.009 435.24 654.909C435.998 654.452 436.846 654.164 437.726 654.065C438.605 653.966 439.496 654.058 440.336 654.336C441.177 654.613 441.947 655.069 442.595 655.672C443.243 656.275 443.753 657.011 444.09 657.829C455.99 686.329 468.49 706.16 481.18 707.03C514.79 709.32 541.88 610.84 549.8 578.73C550.014 577.871 550.411 577.068 550.964 576.377C551.517 575.685 552.213 575.121 553.004 574.723C553.795 574.326 554.662 574.103 555.547 574.072C556.432 574.04 557.313 574.199 558.13 574.54C586.7 586.28 609.56 591.449 619.13 583.099C644.52 560.959 594.03 472.159 576.93 443.849C576.476 443.091 576.191 442.243 576.094 441.365C575.996 440.486 576.09 439.596 576.367 438.757C576.644 437.917 577.098 437.147 577.699 436.499C578.3 435.851 579.034 435.339 579.85 435C608.36 423.1 628.19 410.589 629.05 397.909C631.35 364.299 532.86 337.21 500.76 329.29ZM462.2 297.069C468.66 308.649 435.37 385.81 410.61 439.78C410.196 440.682 409.516 441.436 408.66 441.94C407.805 442.444 406.815 442.674 405.825 442.599C404.835 442.524 403.891 442.147 403.122 441.52C402.352 440.892 401.793 440.044 401.52 439.089C391.52 403.999 380.09 362.77 367.86 327.77C367.38 326.396 367.404 324.896 367.928 323.539C368.452 322.181 369.442 321.054 370.72 320.359C401.26 303.679 453.52 281.529 462.2 297.069ZM315.84 306.619C328.59 310.239 359.61 388.34 380.26 444.01C380.605 444.94 380.656 445.953 380.408 446.914C380.159 447.874 379.623 448.735 378.871 449.382C378.118 450.029 377.186 450.43 376.199 450.531C375.212 450.633 374.218 450.43 373.35 449.95C341.44 432.24 304.23 411.14 270.83 395.04C269.522 394.405 268.482 393.328 267.894 391.998C267.306 390.669 267.209 389.174 267.62 387.78C277.45 354.42 298.71 301.769 315.84 306.619ZM219.1 416.869C230.67 410.409 307.84 443.7 361.8 468.46C362.703 468.874 363.457 469.554 363.961 470.41C364.465 471.265 364.695 472.255 364.62 473.245C364.544 474.235 364.168 475.178 363.54 475.948C362.913 476.717 362.065 477.277 361.11 477.55C326.03 487.55 284.79 498.98 249.79 511.21C248.418 511.687 246.92 511.662 245.565 511.138C244.21 510.614 243.084 509.626 242.39 508.349C225.74 477.809 203.55 425.549 219.1 416.869ZM228.65 563.23C232.26 550.48 310.37 519.459 366.04 498.809C366.97 498.465 367.984 498.414 368.944 498.662C369.905 498.911 370.766 499.447 371.413 500.199C372.059 500.951 372.461 501.884 372.562 502.87C372.663 503.857 372.46 504.851 371.98 505.72C354.26 537.63 333.16 574.84 317.06 608.23C316.431 609.542 315.354 610.587 314.023 611.177C312.693 611.767 311.196 611.864 309.8 611.45C276.44 601.68 223.79 580.36 228.65 563.23ZM338.9 659.97C332.43 648.4 365.73 571.23 390.49 517.27C390.904 516.367 391.585 515.613 392.44 515.109C393.296 514.605 394.285 514.375 395.275 514.45C396.266 514.525 397.209 514.902 397.978 515.529C398.748 516.157 399.307 517.005 399.58 517.96C409.58 553.04 421.01 594.28 433.24 629.28C433.717 630.653 433.69 632.151 433.165 633.507C432.639 634.862 431.648 635.987 430.37 636.68C399.84 653.33 347.57 675.52 338.93 659.97H338.9ZM485.26 650.419C472.5 646.809 441.48 568.7 420.83 513.03C420.484 512.098 420.431 511.082 420.68 510.12C420.928 509.158 421.466 508.295 422.22 507.648C422.974 507 423.909 506.6 424.897 506.5C425.886 506.4 426.882 506.606 427.75 507.089C459.65 524.799 496.87 545.91 530.26 562.01C531.571 562.641 532.613 563.718 533.202 565.048C533.79 566.379 533.885 567.875 533.47 569.27C523.65 602.68 502.39 655.279 485.26 650.419ZM582 540.169C570.42 546.639 493.26 513.339 439.29 488.579C438.387 488.165 437.633 487.485 437.129 486.629C436.625 485.774 436.396 484.784 436.471 483.794C436.546 482.804 436.922 481.861 437.55 481.091C438.177 480.321 439.025 479.763 439.98 479.49C475.07 469.49 516.3 458.059 551.3 445.829C552.675 445.352 554.175 445.378 555.532 445.904C556.889 446.43 558.015 447.421 558.71 448.7C575.35 479.23 597.54 531.499 582 540.169ZM572.45 393.809C568.83 406.569 490.73 437.59 435.06 458.24C434.128 458.586 433.113 458.638 432.151 458.39C431.189 458.141 430.326 457.604 429.678 456.85C429.031 456.096 428.631 455.161 428.531 454.172C428.431 453.184 428.636 452.188 429.12 451.319C446.83 419.419 467.93 382.199 484.03 348.809C484.663 347.5 485.74 346.459 487.07 345.871C488.4 345.283 489.896 345.186 491.29 345.599C524.65 355.419 577.3 376.679 572.45 393.809Z" fill="white"/>
</svg>
</file>

<file path="docs/logo/light.svg">
<svg width="3402" height="957" viewBox="0 0 3402 957" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="3402" height="957" fill="white"/>
<path d="M850.34 642.2V314.85H1089.34V373.3H913.5V450H1070.63V506.58H913.5V642.2H850.34Z" fill="black"/>
<path d="M1130.47 642.2L1228.55 360.8C1233.23 347.375 1241.97 335.739 1253.57 327.506C1265.16 319.273 1279.02 314.849 1293.24 314.85C1307.55 314.848 1321.5 319.327 1333.13 327.658C1344.76 335.989 1353.49 347.753 1358.1 361.3L1453.61 642.2H1388.61L1365.69 573.92H1219.79L1195.94 642.2H1130.47ZM1238.47 516.87H1346.97L1307.75 398.87C1303.07 384.77 1283.15 384.72 1278.4 398.79L1238.47 516.87Z" fill="black"/>
<path d="M1502.72 478.52C1502.72 386.4 1577.07 311.1 1669.2 311.1C1737.01 311.1 1792.2 352.26 1818.38 410.71L1758.52 428.02C1741.69 394.81 1710.82 370.96 1669.2 370.96C1609.34 370.96 1565.38 418.66 1565.38 478.52C1565.38 538.38 1609.38 585.61 1669.2 585.61C1710.82 585.61 1740.75 564.1 1757.12 530.43L1817.91 546.8C1792.19 604.8 1737.48 645.47 1669.2 645.47C1577.07 645.47 1502.72 570.68 1502.72 478.52Z" fill="black"/>
<path d="M1984.87 642.2V373.3H1881.98V314.85H2146.67V373.3H2047.53V642.2H1984.87Z" fill="black"/>
<path d="M2210.76 476.329C2212.19 384.479 2286.38 311.029 2378.23 311.569C2469.89 312.119 2543.71 386.73 2544.17 478.99C2544.63 571.25 2469.35 645.99 2377.22 645.99C2284.21 645.94 2209.31 569.679 2210.76 476.329ZM2481.04 478.99C2481.04 419.13 2437.04 369.99 2377.22 369.99C2317.83 369.99 2273.4 419.09 2273.4 478.99C2273.4 538.38 2317.4 586.99 2377.22 586.99C2437.04 586.99 2481.04 538.85 2481.04 478.99Z" fill="black"/>
<path d="M2629.76 642.2V314.85H2777.07C2841.61 314.85 2890.24 366.29 2890.24 425.68C2890.19 446.932 2883.61 467.656 2871.4 485.051C2859.19 502.447 2841.94 515.675 2821.97 522.95L2894.92 642.2H2823.37L2755.56 530.9H2692.93V642.2H2629.76ZM2692.9 476.2H2776.14C2806.07 476.2 2829.45 454.2 2829.45 423.83C2829.45 394.37 2807.45 371.45 2777.07 371.45H2692.93L2692.9 476.2Z" fill="black"/>
<path d="M3053.93 539.78L2940.29 314.85H3007.17L3084.8 468.7L3162.43 314.85H3229.3L3117.06 537.91V642.2H3053.93V539.78Z" fill="black"/>
<path d="M500.76 329.29C499.9 329.077 499.097 328.68 498.404 328.128C497.712 327.575 497.146 326.88 496.748 326.089C496.349 325.298 496.126 324.43 496.093 323.545C496.061 322.659 496.22 321.778 496.56 320.96C508.3 292.39 513.48 269.53 505.12 259.96C482.98 234.57 394.19 285.059 365.88 302.159C365.122 302.615 364.274 302.902 363.395 303C362.516 303.098 361.626 303.005 360.786 302.728C359.946 302.451 359.175 301.996 358.527 301.394C357.879 300.792 357.369 300.057 357.03 299.24C345.13 270.73 332.62 250.9 319.94 250.04C286.33 247.74 259.24 346.229 251.31 378.329C251.098 379.189 250.703 379.993 250.152 380.685C249.6 381.378 248.905 381.943 248.115 382.342C247.325 382.741 246.458 382.964 245.573 382.996C244.689 383.029 243.808 382.87 242.99 382.53C214.42 370.79 191.55 365.61 181.99 373.97C156.6 396.11 207.08 484.9 224.18 513.21C224.637 513.967 224.925 514.815 225.024 515.695C225.123 516.574 225.031 517.465 224.754 518.305C224.477 519.146 224.021 519.917 223.418 520.565C222.815 521.213 222.079 521.722 221.26 522.059C192.76 533.959 172.93 546.469 172.06 559.149C169.77 592.759 268.25 619.85 300.36 627.78C301.218 627.994 302.019 628.391 302.71 628.943C303.4 629.495 303.964 630.19 304.361 630.98C304.759 631.769 304.982 632.635 305.014 633.519C305.047 634.402 304.889 635.283 304.55 636.099C292.81 664.669 287.63 687.539 295.99 697.099C318.13 722.489 406.93 672.009 435.24 654.909C435.998 654.452 436.846 654.164 437.726 654.065C438.605 653.966 439.496 654.058 440.336 654.336C441.177 654.613 441.947 655.069 442.595 655.672C443.243 656.275 443.753 657.011 444.09 657.829C455.99 686.329 468.49 706.16 481.18 707.03C514.79 709.32 541.88 610.84 549.8 578.73C550.014 577.871 550.411 577.068 550.964 576.377C551.517 575.685 552.213 575.121 553.004 574.723C553.795 574.326 554.662 574.103 555.547 574.072C556.432 574.04 557.313 574.199 558.13 574.54C586.7 586.28 609.56 591.449 619.13 583.099C644.52 560.959 594.03 472.159 576.93 443.849C576.476 443.091 576.191 442.243 576.094 441.365C575.996 440.486 576.09 439.596 576.367 438.757C576.644 437.917 577.098 437.147 577.699 436.499C578.3 435.851 579.034 435.339 579.85 435C608.36 423.1 628.19 410.589 629.05 397.909C631.35 364.299 532.86 337.21 500.76 329.29ZM462.2 297.069C468.66 308.649 435.37 385.81 410.61 439.78C410.196 440.682 409.516 441.436 408.66 441.94C407.805 442.444 406.815 442.674 405.825 442.599C404.835 442.524 403.891 442.147 403.122 441.52C402.352 440.892 401.793 440.044 401.52 439.089C391.52 403.999 380.09 362.77 367.86 327.77C367.38 326.396 367.404 324.896 367.928 323.539C368.452 322.181 369.442 321.054 370.72 320.359C401.26 303.679 453.52 281.529 462.2 297.069ZM315.84 306.619C328.59 310.239 359.61 388.34 380.26 444.01C380.605 444.94 380.656 445.953 380.408 446.914C380.159 447.874 379.623 448.735 378.871 449.382C378.118 450.029 377.186 450.43 376.199 450.531C375.212 450.633 374.218 450.43 373.35 449.95C341.44 432.24 304.23 411.14 270.83 395.04C269.522 394.405 268.482 393.328 267.894 391.998C267.306 390.669 267.209 389.174 267.62 387.78C277.45 354.42 298.71 301.769 315.84 306.619ZM219.1 416.869C230.67 410.409 307.84 443.7 361.8 468.46C362.703 468.874 363.457 469.554 363.961 470.41C364.465 471.265 364.695 472.255 364.62 473.245C364.544 474.235 364.168 475.178 363.54 475.948C362.913 476.717 362.065 477.277 361.11 477.55C326.03 487.55 284.79 498.98 249.79 511.21C248.418 511.687 246.92 511.662 245.565 511.138C244.21 510.614 243.084 509.626 242.39 508.349C225.74 477.809 203.55 425.549 219.1 416.869ZM228.65 563.23C232.26 550.48 310.37 519.459 366.04 498.809C366.97 498.465 367.984 498.414 368.944 498.662C369.905 498.911 370.766 499.447 371.413 500.199C372.059 500.951 372.461 501.884 372.562 502.87C372.663 503.857 372.46 504.851 371.98 505.72C354.26 537.63 333.16 574.84 317.06 608.23C316.431 609.542 315.354 610.587 314.023 611.177C312.693 611.767 311.196 611.864 309.8 611.45C276.44 601.68 223.79 580.36 228.65 563.23ZM338.9 659.97C332.43 648.4 365.73 571.23 390.49 517.27C390.904 516.367 391.585 515.613 392.44 515.109C393.296 514.605 394.285 514.375 395.275 514.45C396.266 514.525 397.209 514.902 397.978 515.529C398.748 516.157 399.307 517.005 399.58 517.96C409.58 553.04 421.01 594.28 433.24 629.28C433.717 630.653 433.69 632.151 433.165 633.507C432.639 634.862 431.648 635.987 430.37 636.68C399.84 653.33 347.57 675.52 338.93 659.97H338.9ZM485.26 650.419C472.5 646.809 441.48 568.7 420.83 513.03C420.484 512.098 420.431 511.082 420.68 510.12C420.928 509.158 421.466 508.295 422.22 507.648C422.974 507 423.909 506.6 424.897 506.5C425.886 506.4 426.882 506.606 427.75 507.089C459.65 524.799 496.87 545.91 530.26 562.01C531.571 562.641 532.613 563.718 533.202 565.048C533.79 566.379 533.885 567.875 533.47 569.27C523.65 602.68 502.39 655.279 485.26 650.419ZM582 540.169C570.42 546.639 493.26 513.339 439.29 488.579C438.387 488.165 437.633 487.485 437.129 486.629C436.625 485.774 436.396 484.784 436.471 483.794C436.546 482.804 436.922 481.861 437.55 481.091C438.177 480.321 439.025 479.763 439.98 479.49C475.07 469.49 516.3 458.059 551.3 445.829C552.675 445.352 554.175 445.378 555.532 445.904C556.889 446.43 558.015 447.421 558.71 448.7C575.35 479.23 597.54 531.499 582 540.169ZM572.45 393.809C568.83 406.569 490.73 437.59 435.06 458.24C434.128 458.586 433.113 458.638 432.151 458.39C431.189 458.141 430.326 457.604 429.678 456.85C429.031 456.096 428.631 455.161 428.531 454.172C428.431 453.184 428.636 452.188 429.12 451.319C446.83 419.419 467.93 382.199 484.03 348.809C484.663 347.5 485.74 346.459 487.07 345.871C488.4 345.283 489.896 345.186 491.29 345.599C524.65 355.419 577.3 376.679 572.45 393.809Z" fill="black"/>
</svg>
</file>

<file path="docs/onboarding/configuring-your-factory/droid-yaml-configuration.mdx">
---
title: Configuring Your Droid YAML
description: Learn how to customize Droid behavior using the .droid.yaml file
---

The `.droid.yaml` file at the root of your project allows you to customize Droid behavior through a simple YAML configuration. This powerful tool enables you to tailor Factory's AI-driven assistance to your specific needs.

<Note>
  We are constantly adding new options to configure Droid through the .droid.yaml. Your feedback helps us prioritize which options we make available first.
</Note>

## Basic Structure

Here's an overview of the `.droid.yaml` structure:

```yaml
review:
  guidelines:
    # Review guidelines
  auto_review:
    # Auto-review settings
  # Other review settings
```

Let's dive into each section in detail.

## Review Settings

The `review` section configures how Droid performs code reviews.

### Guidelines

```yaml
review:
  guidelines:
    - path: "**/example"
      guideline: "example guideline"
```

- `path`: An fnmatch pattern specifying which files the guideline applies to.
- `guideline`: The specific instruction for Droid to follow during reviews.

### Auto-Review Settings

```yaml
review:
  auto_review:
    enabled: true
    draft: false
    bot: false
    ignore_title_keywords:
      - "WIP"
      - "DO NOT MERGE"
    ignore_labels:
      - "droid-skip"
    excluded_base_branches:
      - "example_branch"
```

- `enabled`: Enable automatic code review on pull request open (default: false).
- `draft`: Enable automatic code review on draft pull requests (default: false).
- `bot`: Enable automatic code review on pull requests authored by bots (default: false).
- `ignore_title_keywords`: Skip review for pull requests with these keywords in the title.
- `ignore_labels`: Skip review for pull requests with these labels.
- `excluded_base_branches`: Skip review for pull requests on these base branches.

### Other Review Settings

```yaml
review:
  pr_summary: true
  file_summaries: true
  tips: true
  github_action_repair: true
  path_filters:
    - "!**/*.log"
  enable_skip_reason_comments: true
```

- `pr_summary`: Generate a summary of the pull request (default: true).
- `file_summaries`: Generate summaries of modified files (default: true).
- `tips`: Include Droid Tips in the review (default: true).
- `github_action_repair`: Suggest solutions to GitHub Action failures (default: true).
- `path_filters`: Patterns to include/exclude for review. Use cautiously.
- `enable_skip_reason_comments`: Add comments explaining why Droid skipped a review.

## Validation

If you have access to Review Droid, it will automatically verify your `.droid.yaml` when modified in a pull request. Otherwise, use a YAML validation tool to ensure valid YAML syntax.

<Card title="Review Droid Guidelines" icon="book" href="/onboarding/configuring-your-review-droid/review-droid-guidelines">
  Learn how to set up effective guidelines for Review Droid
</Card>
</file>

<file path="docs/onboarding/configuring-your-review-droid/droid-yaml-configuration.mdx">
---
title: Configuring Your Droid YAML
description: Learn how to customize Droid behavior using the .droid.yaml file
---

The `.droid.yaml` file at the root of your project allows you to customize Droid behavior through a simple YAML configuration. This powerful tool enables you to tailor Factory's AI-driven assistance to your specific needs.

<Note>
  We are constantly adding new options to configure Droid through the .droid.yaml. Your feedback helps us prioritize which options we make available first.
</Note>

## Basic Structure

Here's an overview of the `.droid.yaml` structure:

```yaml
review:
  guidelines:
    # Review guidelines
  auto_review:
    # Auto-review settings
  # Other review settings
```

Let's dive into each section in detail.

## Review Settings

The `review` section configures how Droid performs code reviews.

### Guidelines

```yaml
review:
  guidelines:
    - path: "**/example"
      guideline: "example guideline"
```

- `path`: An fnmatch pattern specifying which files the guideline applies to.
- `guideline`: The specific instruction for Droid to follow during reviews.

### Auto-Review Settings

```yaml
review:
  auto_review:
    enabled: true
    draft: false
    bot: false
    ignore_title_keywords:
      - "WIP"
      - "DO NOT MERGE"
    ignore_labels:
      - "droid-skip"
    excluded_base_branches:
      - "example_branch"
```

- `enabled`: Enable automatic code review on pull request open (default: false).
- `draft`: Enable automatic code review on draft pull requests (default: false).
- `bot`: Enable automatic code review on pull requests authored by bots (default: false).
- `ignore_title_keywords`: Skip review for pull requests with these keywords in the title.
- `ignore_labels`: Skip review for pull requests with these labels.
- `excluded_base_branches`: Skip review for pull requests on these base branches.

### Other Review Settings

```yaml
review:
  pr_summary: true
  file_summaries: true
  tips: true
  github_action_repair: true
  path_filters:
    - "!**/*.log"
  enable_skip_reason_comments: true
```

- `pr_summary`: Generate a summary of the pull request (default: true).
- `file_summaries`: Generate summaries of modified files (default: true).
- `tips`: Include Droid Tips in the review (default: true).
- `github_action_repair`: Suggest solutions to GitHub Action failures (default: true).
- `path_filters`: Patterns to include/exclude for review. Use cautiously.
- `enable_skip_reason_comments`: Add comments explaining why Droid skipped a review.

## Validation

If you have access to Review Droid, it will automatically verify your `.droid.yaml` when modified in a pull request. Otherwise, use a YAML validation tool to ensure valid YAML syntax.

<Card title="Review Droid Guidelines" icon="book" href="/onboarding/configuring-your-review-droid/review-droid-guidelines">
  Learn how to set up effective guidelines for Review Droid
</Card>
</file>

<file path="docs/onboarding/configuring-your-review-droid/review-droid-guidelines.mdx">
---
title: "Review Droid Guidelines"
description: "Learn how to set up effective guidelines for Review Droid to enhance your code review process"
---

Review Droid Guidelines are targeted instructions that Review Droid follows when reviewing your code. These guidelines ensure that Droid-provided code review comments are desirable, consistent, and specific to your codebase. They are particularly useful for maintaining code quality and enforcing best practices across a project.

## Configuring Guidelines

Guidelines are configured in your `.droid.yaml` file under the `guidelines` field within the `review` section. This configuration allows you to define different instructions based on file paths, ensuring that the guidelines are contextually relevant.

### Basic Structure

Here's an example of how guidelines are structured in the `.droid.yaml` file:

<CodeGroup>

```yaml
review:
  guidelines:
    - path: "src/*.py"
      guideline: "Do not use multi-line nested list comprehensions."
    - path: "src/*"
      guideline: "Do not leave in commented out code. Delete it."
    - path: "*"
      guideline: "Correct grammar and spelling mistakes. Do not comment on writing style. Allow for flexible capitalization and abbreviation for variable names."
    - path: "*.ts"
      guideline: "Follow our TypeScript style guide."
      context_document_path: "docs/CONTRIBUTING.md"
    - path: "*"
      guideline: "Follow all of our engineering best practices."
      context_document_path: "https://factory-ai.atlassian.net/wiki/spaces/factory/pages/9338882/Best+Practices"
```

</CodeGroup>

### Components of a Guideline

- `path`: An fnmatch pattern specifying which file paths this guideline applies to.
- `guideline`: The specific issue you want Droid to comment on, preferably including a suggestion for how to fix it.
- `context_document_path` (optional): Specifies a document that provides additional context to Review Droid when enforcing the guideline. This can be either:
  - A path to a document from the repository root
  - A URL to a Confluence page

## Best Practices for Writing Guidelines

To make the most of Review Droid Guidelines, follow these best practices:

1. **Be Specific and Actionable**: Ensure your guidelines are clear and lead to actionable changes. Vague guidelines can result in inconsistent reviews and misunderstandings.
2. **Complement Existing Tools**: Guidelines should complement other tools like linters and type checkers, not replace them. Use guidelines for aspects that are not easily automated, such as code structure and logic.
3. **Maintain Contextual Relevance**: Tailor your guidelines to the specific context of the code. Different parts of the codebase may require different focus areas during review.
4. **Use Examples**: When possible, provide examples of both good and bad practices in your guidelines to make them more clear and effective.
5. **Keep Guidelines Up-to-Date**: Regularly review and update your guidelines as your project evolves and coding standards change.

## Guideline Examples

Here are some examples of effective guidelines for different aspects of code review:

### Bugs & Errors

<CodeGroup>

```yaml
- path: "src/*"
  guideline: "Catch obvious bugs"
```

</CodeGroup>

### Readability

<CodeGroup>

```yaml
- path: "src/*.py"
  guideline: "Don't use multi-line nested list comprehensions. Break them down into multiple statements for better readability."
```

</CodeGroup>

### Error Handling

<CodeGroup>

```yaml
- path: "src/*.py"
  guideline: "Ensure all file operations are wrapped in try/except blocks to handle I/O errors gracefully."
```

</CodeGroup>

### Security

<CodeGroup>

```yaml
- path: "src/*.py"
  guideline: "Validate all user inputs to prevent SQL injection and XSS attacks. Use parameterized queries and escape HTML output."
```

</CodeGroup>

### Documentation

<CodeGroup>

```yaml
- path: "src/*.py"
  guideline: "Ensure all public functions have docstrings that describe their purpose, parameters, and return values."
```

</CodeGroup>

## Feedback Mechanism

Review Droid incorporates a feedback mechanism to continuously improve the effectiveness of the guidelines. During the review process, reviewers can provide feedback on each guideline using thumbs up or thumbs down reactions.

- **Thumbs Up**: Indicates that the guideline was helpful and should continue to be used in future reviews.
- **Thumbs Down**: Indicates that the guideline was not helpful or needs improvement.

This feedback loop ensures that the guidelines evolve over time based on real-world usage and reviewer experiences, leading to more accurate and valuable review comments.

## Conclusion

By setting up effective Review Droid Guidelines, you can significantly enhance the quality and consistency of your code reviews. Remember to start with a few key guidelines and gradually expand as you learn what works best for your team and project.

<Card title="Next: Cloud Development Environments" icon="cloud" href="/web/machine-connection/remote-workspaces/installation-and-usage">
  Learn how to set up Cloud Development Environments for optimal Droid performance
</Card>
</file>

<file path="docs/onboarding/creating-your-factory/basic-integrations.mdx">
---
title: "Overview of Factory Integrations"
description: "Understand and plan your Factory integrations for optimal workflow"
---

Integrating Factory with your existing tools is crucial for maximizing its benefits. This guide provides an overview of the necessary integrations and helps you plan your setup.

## Essential Integrations

### 1. Source Code Management (Required)

You must integrate at least one source code management system with Factory. Choose the option that matches your current setup:

<CardGroup cols="2">
  <Card title="GitHub Cloud" icon="github" href="/onboarding/integrating-with-your-engineering-system/github-cloud">
    Set up integration with GitHub's cloud-based service
  </Card>
  <Card title="GitLab Cloud" icon="gitlab" href="/onboarding/integrating-with-your-engineering-system/gitlab-cloud">
    Integrate with GitLab's cloud offering
  </Card>
  <Card title="GitHub Enterprise Server" icon="server" href="/onboarding/integrating-with-your-engineering-system/github-enterprise-server">
    Connect Factory to your self-hosted GitHub instance
  </Card>
  <Card title="GitLab Self-Hosted" icon="server" href="/onboarding/integrating-with-your-engineering-system/gitlab-self-hosted">
    Set up Factory with your self-managed GitLab instance
  </Card>
</CardGroup>

### 2. Project Management (Recommended)

Integrating a project management tool enhances Factory's ability to understand and assist with your workflow. Choose one:

<CardGroup cols="2">
  <Card title="Jira" icon="jira" href="/onboarding/integrating-with-your-engineering-system/jira">
    Connect Factory with Atlassian's Jira
  </Card>
  <Card title="Linear" icon={<svg width="40" height="40" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"/><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/><g id="SVGRepo_iconCarrier"> <path d="M3.03509 12.9431C3.24245 14.9227 4.10472 16.8468 5.62188 18.364C7.13904 19.8811 9.0631 20.7434 11.0428 20.9508L3.03509 12.9431Z" fill="currentColor"/> <path d="M3 11.4938L12.4921 20.9858C13.2976 20.9407 14.0981 20.7879 14.8704 20.5273L3.4585 9.11548C3.19793 9.88771 3.0451 10.6883 3 11.4938Z" fill="currentColor"/> <path d="M3.86722 8.10999L15.8758 20.1186C16.4988 19.8201 17.0946 19.4458 17.6493 18.9956L4.99021 6.33659C4.54006 6.89125 4.16573 7.487 3.86722 8.10999Z" fill="currentColor"/> <path d="M5.66301 5.59517C9.18091 2.12137 14.8488 2.135 18.3498 5.63604C21.8508 9.13708 21.8645 14.8049 18.3907 18.3228L5.66301 5.59517Z" fill="currentColor"/> </g></svg>} href="/onboarding/integrating-with-your-engineering-system/linear">
    Integrate Factory with Linear for streamlined project management
  </Card>
</CardGroup>

### 3. Knowledge Management (Recommended)

<CardGroup cols="2">
  <Card title="Google Drive" icon="google-drive" href="/onboarding/integrating-with-your-engineering-system/googledrive">
    Connect Factory with Google Drive to leverage your Google Docs in Factory Development
  </Card>
  <Card title="Notion" icon={<svg width="40" height="40" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M3.25781 3.11684C3.67771 3.45796 3.83523 3.43193 4.62369 3.37933L12.0571 2.93299C12.2147 2.93299 12.0836 2.77571 12.0311 2.74957L10.7965 1.85711C10.56 1.67347 10.2448 1.46315 9.64083 1.51576L2.44308 2.04074C2.18059 2.06677 2.12815 2.19801 2.2327 2.30322L3.25781 3.11684ZM3.7041 4.84917V12.6704C3.7041 13.0907 3.91415 13.248 4.38693 13.222L12.5562 12.7493C13.0292 12.7233 13.0819 12.4341 13.0819 12.0927V4.32397C13.0819 3.98306 12.9508 3.79921 12.6612 3.82545L4.12422 4.32397C3.80918 4.35044 3.7041 4.50803 3.7041 4.84917ZM11.7688 5.26872C11.8212 5.50518 11.7688 5.74142 11.5319 5.76799L11.1383 5.84641V11.6205C10.7965 11.8042 10.4814 11.9092 10.2188 11.9092C9.79835 11.9092 9.69305 11.7779 9.37812 11.3844L6.80345 7.34249V11.2532L7.61816 11.437C7.61816 11.437 7.61816 11.9092 6.96086 11.9092L5.14879 12.0143C5.09615 11.9092 5.14879 11.647 5.33259 11.5944L5.80546 11.4634V6.29276L5.1489 6.24015C5.09625 6.00369 5.22739 5.66278 5.5954 5.63631L7.53935 5.50528L10.2188 9.5998V5.97765L9.53564 5.89924C9.4832 5.61018 9.69305 5.40028 9.95576 5.37425L11.7688 5.26872ZM1.83874 1.33212L9.32557 0.780787C10.245 0.701932 10.4815 0.754753 11.0594 1.17452L13.4492 2.85424C13.8436 3.14309 13.975 3.22173 13.975 3.53661V12.7493C13.975 13.3266 13.7647 13.6681 13.0293 13.7203L4.33492 14.2454C3.78291 14.2717 3.52019 14.193 3.23111 13.8253L1.47116 11.5419C1.1558 11.1216 1.02466 10.8071 1.02466 10.4392V2.25041C1.02466 1.77825 1.23504 1.38441 1.83874 1.33212Z" fill="currentColor"></path> </g></svg>} href="/onboarding/integrating-with-your-engineering-system/notion">
    Integrate Factory with Notion to leverage your Notion docs in Factory Development
  </Card>
</CardGroup>

### 4. Incident Management (Recommended)

<CardGroup cols={2}>
  <Card title="Sentry" icon={<svg class="css-15xgryy e10nushx5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 66" width="40" height="40" xmlns:xlink="http://www.w3.org/1999/xlink">  <path d="M29,2.26a4.67,4.67,0,0,0-8,0L14.42,13.53A32.21,32.21,0,0,1,32.17,40.19H27.55A27.68,27.68,0,0,0,12.09,17.47L6,28a15.92,15.92,0,0,1,9.23,12.17H4.62A.76.76,0,0,1,4,39.06l2.94-5a10.74,10.74,0,0,0-3.36-1.9l-2.91,5a4.54,4.54,0,0,0,1.69,6.24A4.66,4.66,0,0,0,4.62,44H19.15a19.4,19.4,0,0,0-8-17.31l2.31-4A23.87,23.87,0,0,1,23.76,44H36.07a35.88,35.88,0,0,0-16.41-31.8l4.67-8a.77.77,0,0,1,1.05-.27c.53.29,20.29,34.77,20.66,35.17a.76.76,0,0,1-.68,1.13H40.6q.09,1.91,0,3.81h4.78A4.59,4.59,0,0,0,50,39.43a4.49,4.49,0,0,0-.62-2.28Z" fill="currentColor" transform="translate(11, 11)">  </path> </svg>} href="/onboarding/integrating-with-your-engineering-system/sentry">
    Connect Factory with Sentry to execute RCA in the Factory platform
  </Card>
  <Card title="PagerDuty" icon={<svg width="40" height="25" viewBox="0 0 256 372" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid">  <title>PagerDuty</title>  <g>      <path d="M54.5538972,272.557214 L54.5538972,371.475954 L0,371.475954 L0,272.557214 L54.5538972,272.557214 Z M109.046548,0.000774792703 C155.791517,0.0522613599 176.052007,2.70434494 204.842454,18.2553897 C236.470978,35.2371476 256,68.9883914 256,111.018242 C256,150.076285 240.079602,183.827529 209.512438,203.993367 C181.492537,222.6733 149.651741,225.220564 107.197347,225.220564 L107.197347,225.220564 L0,225.220564 L0,0 Z M117.785558,47.7544491 L116.112769,47.761194 L54.5538972,48.185738 L54.5538972,178.096186 L119.721393,178.096186 C165.359867,178.096186 200.172471,159.840796 200.172471,111.655058 C200.172471,66.8656716 172.15257,47.3366501 116.112769,47.761194 Z" fill="currentColor"></path>  </g></svg>} href="/onboarding/integrating-with-your-engineering-system/pagerduty">
    Integrate Factory with PagerDuty to leverage PagerDuty incidents in the Factory platform
  </Card>
</CardGroup>

## Security and Permissions

We understand the importance of data security and privacy. Factory employs industry-leading security measures and adheres to strict compliance standards.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about our security measures, compliance certifications, and data handling practices
</Card>

## Next Steps

After setting up your integrations:

<Card title="Configuring Your Factory" icon="gear" href="/onboarding/configuring-your-factory/droid-yaml-configuration">
  Learn how to configure Factory for your specific needs using Droid YAML files and Review Droid guidelines
</Card>

By carefully planning and implementing these integrations, you'll create a seamless workflow between Factory and your existing tools, maximizing productivity and efficiency in your development process.
</file>

<file path="docs/onboarding/creating-your-factory/signup.mdx">
---
title: Sign Up for Factory
description: Create your Factory account and start accelerating your engineering velocity
---

Now that you've set up Single Sign-On (SSO) for your organization, it's time to create your Factory account. This process is straightforward and will get you ready to start using Factory's powerful tools.

## Signup Process

<Steps>
  <Step title="Receive Invitation">
    Your Factory point of contact will send you an email invitation to join Factory.
  </Step>
  <Step title="Click Invitation Link">
    Open the invitation email and click on the provided link to start the signup process.
  </Step>
  <Step title="Choose SSO">
    On the signup page, select the option to sign in with your company's SSO.
  </Step>
  <Step title="Authenticate">
    You will be redirected to your company's IdP login page. Enter your credentials to authenticate.
  </Step>
  <Step title="Complete Profile">
    Once authenticated, you may be asked to complete your Factory profile. Fill in any required information.
  </Step>
  <Step title="Accept Terms">
    Review and accept Factory's terms of service and privacy policy.
  </Step>
  <Step title="Access Dashboard">
    Upon completion, you'll be directed to your Factory dashboard.
  </Step>
</Steps>

## Important Notes

- Ensure that the email address you use to sign up is registered in your company's IdP.
- If you encounter any issues during the signup process, please contact your IT department or Factory support.

<Accordion title="Troubleshooting Common Issues">
  - **SSO Option Not Visible**: Ensure that SSO has been properly set up for your organization. Contact your Factory team member if the issue persists.
  - **Authentication Failure**: Double-check that you're using the correct credentials for your company's SSO. If problems continue, consult your IT department.
  - **Invitation Link Expired**: Request a new invitation from your Factory point of contact.
</Accordion>

<Card title="Next Step: Basic Integrations" icon="puzzle-piece" href="/onboarding/creating-your-factory/basic-integrations">
  Proceed to set up basic integrations for your Factory account
</Card>
</file>

<file path="docs/onboarding/creating-your-factory/sso-setup.mdx">
---
title: Setting Up Single Sign-On (SSO)
description: Configure SSO for seamless access to Factory
---

Enterprise users have the option to authenticate with their personal Identity Provider (IdP). Factory offers integration with any IdP (Google Workspace, Okta, Azure AD, etc.) through both SAML and OIDC protocols.

## Prerequisites

Before setting up SSO, ensure you have:

- Admin access to your company's IdP
- The email address of your IdP system manager

## Setup Process

<Steps>
  <Step title="Notify Factory">
    Contact your Factory representative to initiate the SSO setup process.
  </Step>
  <Step title="Receive Setup Email">
    The IdP system manager will receive an email with setup instructions.
  </Step>
  <Step title="Choose IdP Provider">
    Select your IdP provider from the options provided in the setup email.
  </Step>
  <Step title="Follow Integration Steps">
    Complete the integration steps as outlined for your specific IdP. This process typically takes 5-10 minutes.
  </Step>
  <Step title="Test the Connection">
    Once integration is complete, test the IdP to Factory connection using the provided tools.
  </Step>
</Steps>

## Troubleshooting

If you encounter any errors during the testing phase:

1. Double-check that all entered fields strictly match the on-screen instructions.
2. Follow any fix recommendations provided in the error message.
3. If issues persist, note the error information and contact Factory support.

<Card title="Next Step: Sign Up" icon="user-plus" href="/onboarding/creating-your-factory/signup">
  Proceed to create your Factory account
</Card>
</file>

<file path="docs/onboarding/creating-your-factory/user-permissions.mdx">
---
title: User Permissions
description: Understand the permissions assigned to each user type
---

Now that your Factory account is set up, you can add users from your organization and assign them the appropriate permission levels as outlined below.

## Outline of Permissions

**Owners:**

* Access Factory

* Configure integrations

* Update roles

* Remove users

**Managers:**

* Access Factory

* Configure integrations

* Update roles

**Users:**

* Access Factory
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/github-cloud.mdx">
---
title: "GitHub Cloud"
description: "Step-by-step guide to connect Factory with your GitHub Cloud repositories"
---

This guide will walk you through the process of integrating Factory with GitHub Cloud, enabling the Factory platform to access and work with your repositories.

## Prerequisites

- A Factory account with admin privileges
- Admin access to your GitHub organization

## Integration Steps

<Steps>
  <Step title="Access Factory Platform">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate GitHub Integration">
    Click on "Connect" next to Github to start the integration process. Select Manage Github Permissions.
  </Step>
  <Step title="Authorize Factory's GitHub App">
    You'll be redirected to GitHub. Click "Authorize" to allow Factory's secure OAuth2 GitHub Application access to your organization.
  </Step>
  <Step title="Configure Repository Access">
    Select the repositories you want Factory to access. You can choose specific repositories or grant access to all current and future repositories.
  </Step>
  <Step title="Set Up Permissions">
    Factory requires specific permissions to function optimally. Review and approve the following permissions:

    - **Actions and Metadata** (Read Access): Allows Factory to access GitHub Actions data for understanding CI processes and diagnosing test failures.
    - **Code** (Read and Write Access): Necessary for Factory to review code and create pull requests. Note that Factory cannot merge code autonomously.
    - **Commit Statuses** (Read and Write Access): Enables Factory to track and update commit statuses.
    - **Discussions** (Read and Write Access): Allows Factory to analyze and participate in repository discussions.
    - **Issues** (Read and Write Access): Enables Factory to interact with issues for automated ticket handling.
    - **Pull Requests** (Read and Write Access): Necessary for Factory to analyze and facilitate code reviews.
    - **Workflows** (Read and Write Access): Allows Factory to manage and potentially correct failed CI runs.
  </Step>
  <Step title="Confirm Integration">
    After granting permissions, you'll be redirected back to Factory. Confirm that the integration status shows as "Connected".
  </Step>
</Steps>

## Verification

To ensure the integration is working correctly:

1. Create a test repository or use an existing one with minimal sensitive data.
2. Initiate a simple workflow, such as creating a pull request.
3. Verify that Factory can access and interact with the repository as expected.

## Best Practices

- Regularly review and audit the permissions granted to Factory.
- Use repository-specific settings to fine-tune access levels for sensitive projects.
- Keep your GitHub organization's security settings up-to-date.

## Troubleshooting

If you encounter issues during integration:

- Ensure you have the necessary admin rights on both Factory and GitHub.
- Check GitHub's audit logs for any permission-related issues.
- Verify that your organization doesn't have conflicting third-party application restrictions.

For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/github-enterprise-server.mdx">
---
title: "GitHub Enterprise Server"
description: "Detailed guide for connecting Factory with your self-hosted GitHub Enterprise Server"
---

This guide provides a comprehensive walkthrough for integrating Factory with your GitHub Enterprise Server (GHES) instance. This integration enables the Factory platform to securely access and work with your on-premise repositories.

> Connecting to a GitHub Enterprise Server is only supported in the Enterprise plan.

## Prerequisites

- Admin access to your GitHub Enterprise Server instance
- Network access between your GHES instance and Factory's AWS VPC
- A Factory account with an Enterprise plan and admin privileges 

## Integration Process

<Steps>
  <Step title="Initial Setup & Information Gathering">
    <Steps>
      <Step title="Create GitHub App">
        1. Navigate to your GHES instance settings.
        2. Go to GitHub Apps and click "New GitHub App".
        3. Fill in the app details:
           - Name: "Factory Integration"
           - Homepage URL: https://factory.ai
           - Webhook URL: (Provided by Factory)
        4. Set permissions as outlined in the "Required Permissions" section below.
        5. Generate and securely store a private key for the app.
      </Step>
      <Step title="Collect Integration Information">
        Gather the following details:

        - GitHub App ID
        - Client ID
        - Client Secret
        - Webhook Secret
        - Private Key (generated in previous step)
        - Your GHES instance hostname
      </Step>
      <Step title="Submit Information to Factory">
        Securely send the collected information to your Factory representative.
      </Step>
    </Steps>
  </Step>
  <Step title="Network Security Configuration">
    <Steps>
      <Step title="Evaluate Network Policy">
        Review your current network security policies to identify potential connectivity barriers with Factory's AWS VPC.
      </Step>
      <Step title="Establish Connectivity">
        Choose one of the following methods:

        1. VPC Peering (if your GHES is on AWS):
           - Initiate a VPC peering request.
           - Exchange VPC IDs with Factory.
           - Configure route tables for direct network routes.
        2. VPN Connection:
           - Establish a VPN between your network and Factory's.
           - Ensure VPN settings (e.g., IPsec) are compatible on both ends.
      </Step>
      <Step title="Firewall Configuration">
        - Allow outbound connections to Factory's services (HTTPS and SSH traffic).
        - Ensure your GHES instance can communicate with the Factory-provided Lambda function URL.
      </Step>
    </Steps>
  </Step>
  <Step title="Webhook Setup">
    Configure the webhook in your GHES to send events to the Factory-provided cloud function URL.
  </Step>
  <Step title="Required Permissions">
    Ensure the GitHub App has the following permissions:

    - Actions and Metadata (Read)
    - Code (Read & Write)
    - Commit Statuses (Read & Write)
    - Discussions (Read & Write)
    - Issues (Read & Write)
    - Pull Requests (Read & Write)
    - Workflows (Read & Write)
  </Step>
  <Step title="Testing and Validation">
    <Steps>
      <Step title="Preliminary Testing">
        Work with Factory to conduct initial tests of webhook connectivity and data exchange.
      </Step>
      <Step title="Comprehensive Testing">
        Test all GitHub events that trigger Tools within Factory, including:

        - Creating pull requests
        - Pushing code
        - Opening issues
      </Step>
      <Step title="Validation">
        Verify that Factory Tools respond correctly to these events.
      </Step>
    </Steps>
  </Step>
  <Step title="Final Adjustments and Go-Live">
    <Steps>
      <Step title="Feedback and Adjustments">
        Provide feedback on any issues encountered during testing. Work with Factory to make necessary adjustments.
      </Step>
      <Step title="Go-Live">
        Agree on a go-live date with Factory.
      </Step>
      <Step title="Monitoring">
        Implement continuous monitoring for the initial days post-launch to quickly address any unforeseen issues.
      </Step>
    </Steps>
  </Step>
</Steps>

## Troubleshooting

- If webhook events aren't being received, check your network configuration and firewall rules.
- For permission-related issues, review the GitHub App settings in your GHES instance.
- If Factory isn't responding as expected, verify that all required events are being sent and that permissions are correctly set.

## Support

For any specific issues or detailed support needs, contact the Factory team through your designated support channel.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures for enterprise integrations
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/gitlab-cloud.mdx">
---
title: "GitLab Cloud Integration"
description: "Step-by-step guide to connect Factory with your GitLab Cloud repositories"
---

This guide will walk you through the process of integrating Factory with GitLab Cloud, enabling the Factory platform to seamlessly work with your GitLab repositories.

## Prerequisites

- A Factory account with admin privileges
- Admin access to your GitLab Cloud organization

## Integration Steps

<Steps>
  <Step title="Access Factory Platform">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate GitLab Integration">
    Click on "Connect" next to Gitlab to start the integration process. Select Manage Gitlab Permissions.
  </Step>
  <Step title="Authorize Factory's GitLab Application">
    You'll be redirected to GitLab. Review the requested permissions and click "Authorize" to allow Factory's secure OAuth2 GitLab Application access to your organization.
  </Step>
  <Step title="Review and Approve Permissions">
    Factory requires two main OAuth scopes to function optimally:

    - **api**: This comprehensive scope allows Factory to read from and write to your repositories, manage issues and merge requests, and comment on commits.
    - **read_user**: This scope enables Factory to access user information, providing better context for various operations.

    Ensure these scopes are selected before proceeding.
  </Step>
  <Step title="Configure Repository Access">
    Select the repositories you want Factory to access. You can choose specific repositories or grant access to all current and future repositories within the authorized groups or personal namespace.
  </Step>
  <Step title="Confirm Integration">
    After granting permissions, you'll be redirected back to Factory. Confirm that the integration status shows as "Connected".
  </Step>
</Steps>

## Verification

To ensure the integration is working correctly:

1. Create a test repository or use an existing one with minimal sensitive data.
2. Initiate a simple workflow, such as creating a merge request.
3. Verify that Factory can access and interact with the repository as expected.

## Best Practices

- Regularly review and audit the permissions granted to Factory.
- Use GitLab's group-level settings to manage access for multiple projects efficiently.
- Keep your GitLab organization's security settings up-to-date.
- Periodically review the list of authorized applications in your GitLab settings.

## Troubleshooting

If you encounter issues during integration:

- Ensure you have the necessary admin rights on both Factory and GitLab.
- Check GitLab's audit logs for any permission-related issues.
- Verify that the OAuth application is properly authorized in your GitLab settings.

For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/gitlab-self-hosted.mdx">
---
title: "GitLab Self-Hosted"
description: "Comprehensive guide for connecting Factory with your self-hosted GitLab instance"
---

This guide provides detailed instructions for integrating Factory with your self-hosted GitLab instance, allowing the Factory platform to securely access and work with your on-premise repositories.

> Connecting to a self-hosted GitLab instance is only supported in the Enterprise plan.

## Prerequisites

- Admin access to your self-hosted GitLab instance
- A Factory account with an Enterpise plan and admin privileges

## Integration Process

<Steps>
  <Step title="Create GitLab Application">
    1. In your GitLab instance, go to Admin Area \> Applications.
    2. Click "Add new application" and fill in the details:
        - Name: `Factory Integration`
        - Redirect URI: `https://app.factory.ai/api/integrations/redirect/gitlab-sh`
        - Trusted: yes
        - Scopes:
          - `api`
          - `read_api`
          - `read_user`
          - `read_repository`
          - `write_repository`
          - `read_observability`
          - `write_observability`
    3. Save the application and note the Application ID and Secret.
  </Step>
  <Step title="Create Factory Droid User Account">
    1. In your GitLab instance, go to Admin Area \> Users.
    2. Click "New User" and fill in the details:
        - Name: `Factory Droid`
        - Username: `factory-droid`
        - Email: [any]
    3. Once the user is created, log in as or Impersonate the user before moving on to the next step.
  </Step>
  <Step title="Configure Gitlab Self-Hosted in Factory">
    1. Navigate to https://app.factory.ai/settings/integrations, click on "Connect" next to GitLab, and toggle "Self-Hosted" in the bottom left.
    2. In the Self-Hosted Setup panel, enter your GitLab Self-Hosted Application details:
        - **Domain:** the url of your GitLab instance, such as https://gitlab.example.com. If you have separate internal and external domains, enter your external domain.
        - **Application ID:** from the application created in the previous part.
        - **Secret:** from the application created in the previous part.
    3. Save the configuration.
    4. Click "Manage Gitlab Self-Hosted Permissions" in the top right. This will open a pop-up window that will authorize the integration. IMPORTANT: you must be logged in as or impersonating the `factory-droid` user before performing this step.
    5. Your repositories should now appear in the Repository Selection panel. Navigate there and enable repositories for Factory.
  </Step>
</Steps>

## Support

For any specific issues or detailed support needs, contact the Factory team through your designated support channel.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures for enterprise integrations
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/googledrive.mdx">
---
title: "Google Drive"
description: "Step-by-step guide to connect Factory with your Google Drive docs"
---

This guide will walk you through the process of integrating Factory with Google Drive, enabling you to leverage Google Docs in your Factory development experience.

## Prerequisites

- A Factory account
- A Google account

## Integration Steps

<Steps>
  <Step title="Access Factory Platform">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate Google Drive Integration">
    Click on "Connect" next to Google Drive to start the integration process.
  </Step>
  <Step title="Login to your Google Account or select the appropriate account.">
    Provide Factory access to your Google Account.
  </Step>
  <Step title="Incorporate Google Docs into your workflows">
    Use the @ to tag relevant docs or simply copy and paste the google doc URL to add to context.
  </Step>
  <Step title="Export generated Fragments to Google Drive">
    Use the Export to Drive to export Factory generated docs to Google Drive.
  </Step>
</Steps>

## Verification

After configuration, verify that the integration status shows as "Connected" in your Factory dashboard.

- Simply tag a Google Doc using the @ sign or simply copy/paste a URL doc

## Troubleshooting

If you encounter issues during integration:

- Ensure you have provisioned full access for GDrive in Factory
- If provisioned but not resolved, please disconnect and reconnect GDrive from the Integrations panel in the Settings tab. 
  For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/jira.mdx">
---
title: "Jira"
description: "Step-by-step guide to connect Factory with your Jira workspace"
---

This guide will walk you through the process of integrating Factory with Jira, enabling the Factory platform to interact with your Jira boards and issues.

## Prerequisites

- Admin access to your Jira workspace
- A Factory account with admin privileges

## Integration Steps

<Steps>
  <Step title="Create a Jira Service Account">
    <Steps>
      <Step title="Create New User">
        1. In your Jira workspace, create a new user.
        2. Name the user "Droids".
        3. Narrow the scopes to only the projects you want Factory to access.
      </Step>
      <Step title="Set Permissions">
        Configure the service account's permissions to limit access to only the necessary Jira boards and projects.
      </Step>
    </Steps>
  </Step>
  <Step title="Initiate Jira Integration in Factory">
    <Steps>
      <Step title="Access Integrations">
        Log in to your Factory account and navigate to Integrations in your Settings.
      </Step>
      <Step title="Connect Jira">
        Click on "Connect Jira" to start the integration process.
      </Step>
    </Steps>
  </Step>
  <Step title="Authorize Factory's Jira Application">
    <Steps>
      <Step title="Switch to Service Account">
        Before authorizing, switch to an incognito browser window and log in with the "Droids" service account you created.
      </Step>
      <Step title="Authorize Application">
        Review the requested permissions and click "Authorize" to allow Factory access to your Jira workspace.
      </Step>
    </Steps>
  </Step>
  <Step title="Confirm Integration">
    After authorization, you'll be redirected back to the Factory platform. Verify that the integration status shows as "Connected".
  </Step>
  <Step title="Create a New Session">
    Create a New Session directly from Jira with this ticket in context by clicking the "üîó Factory - Open in Factory" link

    - Note that clicking this link will always create a **new session**.
  </Step>
</Steps>

## Verification

To ensure the integration is working correctly:

1. Create a test issue in one of the authorized Jira projects.
2. Use Factory to interact with this issue (e.g., comment on it or change its status).
3. Verify that the changes are reflected in Jira.

## Best Practices

- Regularly review and audit the permissions granted to the Droids service account.
- Use Jira's project-level settings to manage access efficiently.
- Periodically rotate the API token if you're using the token-based setup method.

## Troubleshooting

If you encounter issues during integration:

- Ensure you're logged in as the service account when authorizing the integration.
- Check Jira's audit logs for any permission-related issues.
- Verify that the service account has the necessary permissions for the intended projects.

For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/linear.mdx">
---
title: "Linear"
description: "Guide to connect Factory with your Linear workspace"
---

This guide will walk you through the process of integrating Factory with Linear, enabling seamless interaction between Factory and your Linear projects.

## Prerequisites

- Admin access to your Linear workspace
- A Factory account with admin privileges

## Integration Steps

<Steps>
  <Step title="Access Factory Integrations">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate Linear Integration">
    Locate and select the Linear integration option.
  </Step>
  <Step title="Authorize Factory's Linear Application">
    You'll be redirected to Linear. Review the requested permissions and click "Authorize" to allow Factory access to your Linear workspace.
  </Step>
  <Step title="Configure Team and Project Access">
    Select the teams and projects you want Factory to interact with. You can adjust these settings later if needed.
  </Step>
  <Step title="Set Up Permissions">
    Ensure that Factory has the necessary permissions to view and create issues, manage workflows, and access relevant project data.
  </Step>
  <Step title="Confirm Integration">
    After granting permissions, you'll be redirected back to Factory. Verify that the integration status shows as "Connected".
  </Step>
  <Step title="Create a New Session">
    Create a New Session directly from Linear with this ticket in context by clicking the "üîó Factory - Open in Factory" link

    - Note that clicking this link will always create a **new session**.
  </Step>
</Steps>

## Verification

To ensure the integration is working correctly:

1. Create a test issue in one of the authorized Linear projects.
2. Use Factory to interact with this issue (e.g., comment on it or change its status).
3. Verify that the changes are reflected in Linear.

## Best Practices

- Regularly review and audit the permissions granted to Factory.
- Use Linear's team-level settings to manage access efficiently.
- Keep your Linear workspace's security settings up-to-date.

## Troubleshooting

If you encounter issues during integration:

- Ensure you have the necessary admin rights on both Factory and Linear.
- Check Linear's audit logs for any permission-related issues.
- Verify that the integration has access to the intended teams and projects.

For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/notion.mdx">
---
title: "Notion"
description: "Step-by-step guide to connect Factory with your Notion docs, databases, and wikis."
---

This guide will walk you through the process of integrating Factory with Notion, enabling you to leverage Notion Docs in your Factory development experience.

## Prerequisites

- A Factory account
- A Notion account

## Integration Steps

<Steps>
  <Step title="Access Factory Platform">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate Notion Integration">
    Click on "Connect" next to Notion to start the integration process.
  </Step>
  <Step title="Login to your Notion Account or select the appropriate account.">
    Provide Factory access to your Notion Account.
  </Step>
  <Step title="Select the Notion Files and Folders you want exposed to Factory">
    Select the specific folders and files that you want integrated into Factory. Be sure to select any folders that might be at all relevant to workflows and tasks executed in Factory.
  </Step>
  <Step title="Incorporate Notion into your workflows">
    Use the @ to tag relevant docs or simply copy and paste the Notion doc URL to add to context.
  </Step>
  <Step title="Export generated Fragments to Notion">
    Use the Export to Notion to export Factory generated docs to Notion.
  </Step>
</Steps>

## Verification

After configuration, verify that the integration status shows as "Connected" in your Factory dashboard.

- Simply tag a Notion doc using the @ sign or simply copy/paste a URL doc

## Troubleshooting

If you encounter issues during integration:

- Ensure you have provisioned full access for Notion in Factory
- If provisioned but not resolved, please disconnect and reconnect Notion from the Integrations panel in the Settings tab. 
  For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/pagerduty.mdx">
---
title: "PagerDuty"
description: "Step-by-step guide to connect Factory with your PagerDuty incidents."
---

## PagerDuty + Factory Integration Benefits

- **Bring PagerDuty context into Factory's AI workflow.** Paste or mention any PagerDuty incident URL in chat and Factory automatically pulls in the full incident timeline, alerts, responders and notes.
- **Accelerate incident triage.** Engineers see enriched incident details side-by-side with code, logs and other context, reducing tool-switching needs.
- **Generate fixes faster.** Factory can analyze the imported PagerDuty data, identify likely root causes and propose remediation PRs.
- **Zero-maintenance integration.** OAuth-based‚Äîno service keys, Event Rules or manual configuration inside PagerDuty.

## How it Works

- A Factory user connects their PagerDuty account using OAuth with read-only scope.
- When a PagerDuty incident URL is pasted into Factory chat, Factory retrieves the incident's details, alerts and notes to help root cause the problem.
- Factory displays this parsed information in the Context Panel and incorporates it in its responses and suggestions.

## Requirements

- A PagerDuty user who can authorize OAuth applications.
- A Factory account with permission to manage personal integrations.

## Support

If you need help with this integration, please contact **support@factory.ai**.

## Integration Walkthrough

### In PagerDuty

No configuration is required in PagerDuty. This integration uses OAuth authentication with read-only scope, so there's no need to create services, integrations, or event rules in your PagerDuty account. All setup is completed within Factory.

### In Factory

1. Sign in to Factory and open **Settings**.
2. Locate **PagerDuty** and click **Connect**.
3. A popup redirects to PagerDuty's OAuth screen. Select the account you wish to authorize and click **Allow Access**.
4. When the popup closes, PagerDuty will display as **Connected** with a green dot. You're done‚Äîno further steps in PagerDuty are necessary.

#### Verifying the Integration

1. Copy a PagerDuty incident URL, e.g. `https://acme.pagerduty.com/incidents/PRD1234`.
2. Paste it into any Factory chat.
3. The incident details should appear in the Context Panel within a few seconds.

## How to Uninstall

1. In PagerDuty, navigate to **User Settings ‚Üí Authorized Applications**.
2. Locate **Factory** and click **Revoke Access**.

This immediately invalidates the OAuth token; Factory will stop retrieving data.
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/sentry.mdx">
---
title: "Sentry"
description: "Step-by-step guide to connect Factory with your Sentry error tracking system"
---

This guide will walk you through the process of integrating Factory with Sentry, enabling the Factory platform to access and work with your error tracking data.

## Prerequisites

- A Factory account with admin privileges
- Admin access to your Sentry organization
- Sentry projects set up for your applications

## Integration Steps

<Steps>
  <Step title="Access Factory Platform">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate Sentry Integration">
    Click on "Connect" next to Sentry to start the integration process.
  </Step>
  <Step title="Install Factory's Sentry Integration">
    You'll be redirected to Sentry. Review and approve the installation of Factory's Sentry integration in your organization.
  </Step>
  <Step title="Configure Access Permissions">
    Factory requires specific permissions to function optimally:

    - **Issue & Event Access** (Read Access): Allows Factory to retrieve issue details, stack traces, and related events
    - **Organization Access** (Read Access): Enables Factory to access organization-wide settings and metadata
    - **Project Access** (Read Access): Permits Factory to access project-specific information and settings
  </Step>
  <Step title="Confirm Integration">
    After granting permissions, you'll be redirected back to Factory. Verify that the integration status shows as "Connected".
  </Step>
</Steps>

## Usage

Once integrated, Factory can:

1. **Access Issue Details**: View comprehensive information about errors, including stack traces, breadcrumbs, and context data
2. **Search Issues**: Find specific issues across your Sentry projects
3. **Analyze Error Patterns**: Understand error trends and common failure points
4. **Context Integration**: Use Sentry data as context when discussing code changes or debugging

### Issue Context

When you share a Sentry issue URL in a Factory chat, the assistant will automatically:

1. Retrieve the issue details
2. Extract relevant stack traces
3. Include error context and breadcrumbs
4. Provide insights based on the error information

Example Sentry issue URL format:

```
https://sentry.io/organizations/your-org/issues/12345/
```

## Best Practices

- Regularly review and audit the permissions granted to Factory
- Use Sentry's project-level settings to fine-tune access control
- Keep your Sentry organization's security settings up-to-date
- Periodically review the integration's usage and effectiveness

## Troubleshooting

If you encounter issues during integration:

- Ensure you have the necessary admin rights in both Factory and Sentry
- Check Sentry's audit logs for any permission-related issues
- Verify that your organization doesn't have conflicting third-party application restrictions

For persistent problems, contact Factory support with specific error messages or screenshots.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/integrating-with-your-engineering-system/slack.mdx">
---
title: "Slack"
description: "Step-by-step guide to connect Factory with your Slack workspace"
---

This guide will walk you through the process of integrating Factory with Slack, enabling seamless interaction between Factory and your Slack conversations.

## Prerequisites 

- A Factory account with admin privileges
- Admin access to your Slack workspace
- Ability to install apps in your Slack workspace

## Integration Steps

<Steps>
  <Step title="Access Factory Integrations">
    Log in to your Factory account and navigate to the Integrations section in your Settings.
  </Step>
  <Step title="Initiate Slack Integration">
    Click on "Connect" next to Slack to start the integration process.
  </Step>
  <Step title="Authorize Factory's Slack Application">
    You'll be redirected to Slack. Review the requested permissions and click "Allow" to authorize Factory access to your Slack workspace.
  </Step>
  <Step title="Select Workspace">
    If you belong to multiple workspaces, select the workspace you want to connect to Factory.
  </Step>
  <Step title="Confirm Integration">
    After authorization, you'll be redirected back to Factory. Verify that the integration status shows as "Connected".
  </Step>
  <Step title="Add to Channels">
    In your Slack workspace, add the Factory app to relevant channels by typing `/invite @Factory` in each channel.
  </Step>
</Steps>

## Verification

To ensure the integration is working correctly:

1. Mention `@Factory` in a thread within a channel where the app has been added.
2. Verify that Factory responds with a link to open the conversation in Factory.
3. Click the link and confirm that the Slack thread content appears in your new Factory session.


## Slack Tools

<Warning>
Before using the tools below, make sure that the Factory app is invited
to the channels you'd like to interact with by sending <code>/invite&nbsp;@Factory</code> in those channels.
</Warning>

Factory provides four native tools to interact with Slack:

| Tool | What it does |
| ---- | ------------ |
| **Get Slack Channels** | Lists all channels the bot can access |
| **Post Slack Message** | Sends a message to a channel or replies to an existing thread |
| **Read Thread Messages** | Reads the messages from a Slack thread |
| **Get Channel History** | Retrieves recent messages from a channel |

## Additional Features

Besides the tools above, the Slack integration also allows you to: 

- Mention `@Factory` in any Slack thread to receive a link to continue the conversation in Factory
- Import Slack thread context into Factory by clicking the provided link
- Reference Slack threads in Factory by pasting a thread URL into a Factory chat

When a Slack thread is imported, Factory has access to the entire conversation history, allowing it to provide context-aware assistance.

## Best Practices

- Add the Factory app only to channels where development discussions occur.
- Use threads rather than channel messages when mentioning Factory.
- Provide sufficient context in the Slack thread before mentioning Factory.
- Regularly review the permissions granted to the Factory app in your Slack settings.

## Troubleshooting

If you encounter issues during integration:

- Ensure you have admin rights in both Factory and your Slack workspace.
- Verify that the Factory app has been added to the channel where you're mentioning it.
- If you see a "not_in_channel" error toast when trying to paste a Slack thread URL, it means the Factory bot needs to be invited to that channel. Use `/invite @Factory` in the channel to resolve this issue.
- Check that your organization's firewall isn't blocking webhook communications.
- For persistent issues, contact Factory support with specific error messages.

<Card title="Security and Compliance" icon="shield-check" href="#">
  Learn about Factory's security measures and how we protect your data
</Card>
</file>

<file path="docs/onboarding/index.mdx">
---
title: Welcome to Factory Onboarding - Enterprise
sidebarTitle: Onboarding
description: Get started with Factory and accelerate your engineering velocity
---

Welcome to Factory! This onboarding guide will walk you through the process of setting up and configuring your Factory environment, integrating it with your existing engineering systems.

## Onboarding Process Overview

Our onboarding process is divided into four main sections:

1. [Creating Your Factory](/onboarding/creating-your-factory/sso-setup)
2. [Configuring Your Factory](/onboarding/configuring-your-factory/droid-yaml-configuration)
3. [Integrating With Your Engineering System](/onboarding/integrating-with-your-engineering-system/github-cloud)

Each section is designed to guide you through a specific aspect of the setup process, ensuring a smooth and comprehensive onboarding experience.

<Card title="Start Onboarding" icon="rocket" href="/onboarding/creating-your-factory/sso-setup">
  Begin your Factory journey by setting up SSO and creating your account
</Card>

## Need Help?

If you encounter any issues during the onboarding process, please don't hesitate to reach out to our support team. We're here to ensure your Factory experience is smooth and productive from day one.

<Card title="Contact Support" icon="headset" href="mailto:support@factory.ai">
  Get in touch with our support team for assistance
</Card>
</file>

<file path="docs/reference/cli-reference.mdx">
---
title: CLI Reference
description: Complete reference for droid command-line interface, including commands and flags
---

## Installation

<CodeGroup>

```bash macOS/Linux
curl -fsSL https://app.factory.ai/cli | sh
```

```powershell Windows
irm https://app.factory.ai/cli/windows | iex
```

</CodeGroup>

The CLI operates in two modes:

- **Interactive (`droid`)** - Chat-first REPL with slash commands
- **Non-interactive (`droid exec`)** - Single-shot execution for automation and scripting

## CLI commands

| Command                          | Description                                 | Example                                         |
| :------------------------------- | :------------------------------------------ | :---------------------------------------------- |
| `droid`                          | Start interactive REPL                      | `droid`                                         |
| `droid "query"`                  | Start REPL with initial prompt              | `droid "explain this project"`                  |
| `droid exec "query"`             | Execute task without interactive mode       | `droid exec "summarize src/auth"`               |
| `droid exec -f prompt.md`        | Load prompt from file                       | `droid exec -f .factory/prompts/review.md`      |
| `cat file \| droid exec`         | Process piped content                       | `git diff \| droid exec "draft release notes"` |
| `droid exec -s <id> "query"`     | Resume existing session in exec mode        | `droid exec -s session-123 "continue"`          |
| `droid exec --list-tools`        | List available tools, then exit             | `droid exec --list-tools`                       |

## CLI flags

Customize droid's behavior with command-line flags:

| Flag                             | Description                                                                                                  | Example                                                  |
| :------------------------------- | :----------------------------------------------------------------------------------------------------------- | :------------------------------------------------------- |
| `-f, --file <path>`              | Read prompt from a file                                                                                      | `droid exec -f plan.md`                                  |
| `-m, --model <id>`               | Select a specific model (see [model IDs](#available-models))                                                 | `droid exec -m claude-opus-4-1-20250805`                 |
| `-s, --session-id <id>`          | Continue an existing session                                                                                 | `droid exec -s session-abc123`                           |
| `--auto <level>`                 | Set [autonomy level](#autonomy-levels) (`low`, `medium`, `high`)                                             | `droid exec --auto medium "run tests"`                   |
| `--enabled-tools <ids>`          | Force-enable specific tools (comma or space separated)                                                       | `droid exec --enabled-tools ApplyPatch,Bash`             |
| `--disabled-tools <ids>`         | Disable specific tools for this run                                                                          | `droid exec --disabled-tools execute-cli`                |
| `--list-tools`                   | Print available tools and exit                                                                               | `droid exec --list-tools`                                |
| `-o, --output-format <format>`   | Output format (`text`, `json`, `stream-json`)                                                                | `droid exec -o json "document API"`                      |
| `--input-format <format>`        | Input format (`stream-json` for multi-turn)                                                                  | `droid exec --input-format stream-json -o stream-json`   |
| `-r, --reasoning-effort <level>` | Override reasoning effort (`off`, `none`, `low`, `medium`, `high`)                                           | `droid exec -r high "debug flaky test"`                  |
| `--spec-model <id>`              | Use a different model for specification planning                                                             | `droid exec --spec-model claude-sonnet-4-5-20250929`     |
| `--use-spec`                     | Start in specification mode (plan before executing)                                                          | `droid exec --use-spec "add user profiles"`              |
| `--skip-permissions-unsafe`      | Skip all permission prompts (‚ö†Ô∏è use with extreme caution)                                                    | `droid exec --skip-permissions-unsafe`                   |
| `--cwd <path>`                   | Execute from a specific working directory                                                                    | `droid exec --cwd ../service "run tests"`                |
| `--delegation-url <url>`         | Override delegation service endpoint                                                                         | `droid exec --delegation-url https://custom.factory.ai`  |
| `-v, --version`                  | Display CLI version                                                                                          | `droid -v`                                               |
| `-h, --help`                     | Show help information                                                                                        | `droid --help`                                           |

<Tip>
  Use `--output-format json` for scripting and automation, allowing you to parse droid's responses programmatically.
</Tip>

## Autonomy levels

`droid exec` uses tiered autonomy to control what operations the agent can perform. Only raise access when the environment is safe.

| Level                         | Intended for             | Notable allowances                                                                 |
| :---------------------------- | :----------------------- | :--------------------------------------------------------------------------------- |
| *(default)*                   | Read-only reconnaissance | File reads, git diffs, environment inspection                                      |
| `--auto low`                  | Safe edits               | Create/edit files, run formatters, non-destructive commands                        |
| `--auto medium`               | Local development        | Install dependencies, build/test, local git commits                                |
| `--auto high`                 | CI/CD & orchestration    | Git push, deploy scripts, long-running operations                                  |
| `--skip-permissions-unsafe`   | Isolated sandboxes only  | Removes all guardrails (‚ö†Ô∏è use only in disposable containers)                      |

**Examples:**

```bash
# Default (read-only)
droid exec "Analyze the auth system and create a plan"

# Low autonomy - safe edits
droid exec --auto low "Add JSDoc comments to all functions"

# Medium autonomy - development work
droid exec --auto medium "Install deps, run tests, fix issues"

# High autonomy - deployment
droid exec --auto high "Run tests, commit, and push changes"
```

<Warning>
  `--skip-permissions-unsafe` removes all safety checks. Use **only** in isolated environments like Docker containers.
</Warning>

## Available models

| Model ID                      | Name                    | Reasoning support | Default reasoning |
| :---------------------------- | :---------------------- | :---------------- | :---------------- |
| `claude-sonnet-4-5-20250929`  | Claude Sonnet 4.5       | Yes               | off               |
| `gpt-5-codex`                 | GPT-5 Codex (Auto)      | No                | none              |
| `gpt-5-2025-08-07`            | GPT-5                   | Yes               | medium            |
| `claude-opus-4-1-20250805`    | Claude Opus 4.1         | Yes               | off               |
| `claude-haiku-4-5-20251001`   | Claude Haiku 4.5        | Yes               | off               |
| `glm-4.6`                     | Droid Core (GLM-4.6)    | No                | none              |

Custom models configured via [BYOK](/cli/configuration/byok) use the format: `custom:<alias>`

See [Choosing Your Model](/cli/user-guides/choosing-your-model) for detailed guidance on which model to use for different tasks.

## Interactive mode features

### Bash mode

Press `!` when the input is empty to toggle bash mode. In bash mode, commands execute directly in your shell without AI interpretation‚Äîuseful for quick operations like checking `git status` or running `npm test`.

- **Toggle on:** Press `!` (when input is empty)
- **Execute commands:** Type any shell command and press Enter
- **Toggle off:** Press `Esc` to return to normal AI chat mode

The prompt changes from `>` to `$` when bash mode is active.

### Slash commands

Available when running `droid` in interactive mode. Type the command at the prompt:

| Command                  | Description                                           |
| :----------------------- | :---------------------------------------------------- |
| `/account`               | Open Factory account settings in browser              |
| `/billing`               | View and manage billing settings                      |
| `/bug [title]`           | Create a bug report with session data and logs        |
| `/clear`                 | Start a new session (alias for `/new`)                |
| `/compress [prompt]`     | Compress session and move to new one with summary     |
| `/cost`                  | Show token usage statistics                           |
| `/help`                  | Show available slash commands                         |
| `/mcp`                   | Manage Model Context Protocol servers                 |
| `/model`                 | Switch AI model mid-session                           |
| `/new`                   | Start a new session                                   |
| `/sessions`              | List and select previous sessions                     |
| `/settings`              | Configure application settings                        |
| `/status`                | Show current droid status and configuration           |
| `/terminal-setup`        | Configure terminal keybindings for Shift+Enter        |

For detailed information on slash commands, see the [interactive mode documentation](/cli/getting-started/quickstart#useful-slash-commands).

### MCP command reference

The `/mcp` command manages Model Context Protocol servers:

```bash
/mcp list                    # List all configured servers
/mcp add <name> <command>    # Add stdio-based server
/mcp add --type http <url>   # Add HTTP-based server
/mcp remove <name>           # Remove a server
/mcp get <name>              # Show server details
/mcp enable <name>           # Enable a disabled server
/mcp disable <name>          # Temporarily disable a server
```

See [MCP Configuration](/cli/configuration/mcp) for complete documentation.

## Authentication

1. Generate an API key at [app.factory.ai/settings/api-keys](https://app.factory.ai/settings/api-keys)
2. Set the environment variable:

<CodeGroup>

```bash macOS/Linux
export FACTORY_API_KEY=fk-...
```

```powershell Windows (PowerShell)
$env:FACTORY_API_KEY="fk-..."
```

```cmd Windows (CMD)
set FACTORY_API_KEY=fk-...
```

</CodeGroup>

**Persist the variable** in your shell profile (`~/.bashrc`, `~/.zshrc`, or PowerShell `$PROFILE`) for long-term use.

<Warning>
  Never commit API keys to source control. Use environment variables or secure secret management.
</Warning>

## Exit codes

| Code | Meaning                        |
| :--- | :----------------------------- |
| `0`  | Success                        |
| `1`  | General runtime error          |
| `2`  | Invalid CLI arguments/options  |

## Common workflows

### Code review

```bash
# Analysis only
droid exec "Review this PR for security issues"

# With modifications
droid exec --auto low "Review code and add missing type hints"
```

### Testing and debugging

```bash
# Investigation
droid exec "Analyze failing tests and explain root cause"

# Fix and verify
droid exec --auto medium "Fix failing tests and run test suite"
```

### Refactoring

```bash
# Planning
droid exec "Create refactoring plan for auth module"

# Execution
droid exec --auto low --use-spec "Refactor auth module"
```

### CI/CD integration

```yaml
# GitHub Actions example
- name: Run Droid Analysis
  env:
    FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
  run: |
    droid exec --auto medium -f .github/prompts/deploy.md
```

## See also

- [Quickstart guide](/cli/getting-started/quickstart) - Getting started with Factory CLI
- [Interactive mode](/cli/getting-started/quickstart) - Shortcuts, input modes, and features
- [Choosing your model](/cli/user-guides/choosing-your-model) - Model selection guidance
- [Settings](/cli/configuration/settings) - Configuration options
- [Custom commands](/cli/configuration/custom-slash-commands) - Create your own shortcuts
- [Custom droids](/cli/configuration/custom-droids) - Build specialized agents
- [Droid Exec overview](/cli/droid-exec/overview) - Detailed automation guide
- [MCP configuration](/cli/configuration/mcp) - External tool integration
</file>

<file path="docs/reference/hooks-reference.mdx">
---
title: "Hooks reference"
description: "Reference documentation for implementing hooks in Droid"
---

<Tip>
  For a quickstart guide with examples, see [Get started with hooks](/cli/configuration/hooks-guide).
</Tip>

## Configuration

Droid hooks are configured in your [settings files](/cli/configuration/settings):

* `~/.factory/settings.json` - User settings
* `.factory/settings.json` - Project settings
* `.factory/settings.local.json` - Local project settings (not committed)
* Enterprise managed policy settings

### Structure

Hooks are organized by matchers, where each matcher can have multiple hooks:

```json
{
  "hooks": {
    "EventName": [
      {
        "matcher": "ToolPattern",
        "hooks": [
          {
            "type": "command",
            "command": "your-command-here"
          }
        ]
      }
    ]
  }
}
```

* **matcher**: Pattern to match tool names, case-sensitive (only applicable for
  `PreToolUse` and `PostToolUse`)
  * Simple strings match exactly: `Write` matches only the Write tool
  * Supports regex: `Edit|Write` or `Notebook.*`
  * Use `*` to match all tools. You can also use empty string (`""`) or leave
    `matcher` blank.
* **hooks**: Array of commands to execute when the pattern matches
  * `type`: Currently only `"command"` is supported
  * `command`: The bash command to execute (can use `$FACTORY_PROJECT_DIR`
    environment variable)
  * `timeout`: (Optional) How long a command should run, in seconds, before
    canceling that specific command.

<Warning>
  **Always use absolute paths** for hook commands and scripts, not relative paths. 
  Hooks execute from Droid's current working directory, which may change during execution. 
  Use `"$FACTORY_PROJECT_DIR"/path/to/script.sh` for project-relative scripts or full paths like 
  `/usr/local/bin/script.sh` or `~/.factory/hooks/script.sh` for global scripts.
</Warning>

For events like `UserPromptSubmit`, `Notification`, `Stop`, and `SubagentStop`
that don't use matchers, you can omit the matcher field:

```json
{
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "/path/to/prompt-validator.py"
          }
        ]
      }
    ]
  }
}
```

### Project-Specific Hook Scripts

You can use the environment variable `FACTORY_PROJECT_DIR` (only available when
Droid spawns the hook command) to reference scripts stored in your project,
ensuring they work regardless of Droid's current directory:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$FACTORY_PROJECT_DIR\"/.factory/hooks/check-style.sh"
          }
        ]
      }
    ]
  }
}
```

### Plugin hooks

Plugins can provide hooks that integrate seamlessly with your user and project hooks. Plugin hooks are automatically merged with your configuration when plugins are enabled.

**How plugin hooks work**:

* Plugin hooks are defined in the plugin's `hooks/hooks.json` file or in a file given by a custom path to the `hooks` field.
* When a plugin is enabled, its hooks are merged with user and project hooks
* Multiple hooks from different sources can respond to the same event
* Plugin hooks use the `${DROID_PLUGIN_ROOT}` environment variable to reference plugin files

**Example plugin hook configuration**:

```json
{
  "description": "Automatic code formatting",
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "${DROID_PLUGIN_ROOT}/scripts/format.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

<Note>
  Plugin hooks use the same format as regular hooks with an optional `description` field to explain the hook's purpose.
</Note>

<Note>
  Plugin hooks run alongside your custom hooks. If multiple hooks match an event, they all execute in parallel.
</Note>

**Environment variables for plugins**:

* `${DROID_PLUGIN_ROOT}`: Absolute path to the plugin directory
* `${FACTORY_PROJECT_DIR}`: Project root directory (same as for project hooks)
* All standard environment variables are available

See the plugin components reference for details on creating plugin hooks.

## Hook Events

### PreToolUse

Runs after Droid creates tool parameters and before processing the tool call.

**Common matchers:**

* `Task` - Sub-droid tasks (see [subagents documentation](/cli/user-guides/specification-mode))
* `Bash` - Shell commands
* `Glob` - File pattern matching
* `Grep` - Content search
* `Read` - File reading
* `Edit` - File editing
* `Write` - File writing
* `WebFetch`, `WebSearch` - Web operations

### PostToolUse

Runs immediately after a tool completes successfully.

Recognizes the same matcher values as PreToolUse.

### Notification

Runs when Droid sends notifications. Notifications are sent when:

1. Droid needs your permission to use a tool. Example: "Droid needs your
   permission to use Bash"
2. The prompt input has been idle for at least 60 seconds. "Droid is waiting
   for your input"

### UserPromptSubmit

Runs when the user submits a prompt, before Droid processes it. This allows you
to add additional context based on the prompt/conversation, validate prompts, or
block certain types of prompts.

### Stop

Runs when Droid has finished responding. Does not run if
the stoppage occurred due to a user interrupt.

### SubagentStop

Runs when a sub-droid (Task tool call) has finished responding.

### PreCompact

Runs before Droid is about to run a compact operation.

**Matchers:**

* `manual` - Invoked from `/compact`
* `auto` - Invoked from auto-compact (due to full context window)

### SessionStart

Runs when Droid starts a new session or resumes an existing session (which
currently does start a new session under the hood). Useful for loading in
development context like existing issues or recent changes to your codebase, installing dependencies, or setting up environment variables.

**Matchers:**

* `startup` - Invoked from startup
* `resume` - Invoked from `--resume`, `--continue`, or `/resume`
* `clear` - Invoked from `/clear`
* `compact` - Invoked from auto or manual compact.



### SessionEnd

Runs when a Droid session ends. Useful for cleanup tasks, logging session
statistics, or saving session state.

The `reason` field in the hook input will be one of:

* `clear` - Session cleared with /clear command
* `logout` - User logged out
* `prompt_input_exit` - User exited while prompt input was visible
* `other` - Other exit reasons

## Hook Input

Hooks receive JSON data via stdin containing session information and
event-specific data:

```typescript
{
  // Common fields
  session_id: string
  transcript_path: string  // Path to conversation JSON
  cwd: string              // The current working directory when the hook is invoked
  permission_mode: string  // Current permission mode: "default", "plan", "acceptEdits", or "bypassPermissions"

  // Event-specific fields
  hook_event_name: string
  ...
}
```

### PreToolUse Input

The exact schema for `tool_input` depends on the tool.

```json
{
  "session_id": "abc123",
  "transcript_path": "/Users/.../.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "PreToolUse",
  "tool_name": "Write",
  "tool_input": {
    "file_path": "/path/to/file.txt",
    "content": "file content"
  }
}
```

### PostToolUse Input

The exact schema for `tool_input` and `tool_response` depends on the tool.

```json
{
  "session_id": "abc123",
  "transcript_path": "/Users/.../.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "PostToolUse",
  "tool_name": "Write",
  "tool_input": {
    "file_path": "/path/to/file.txt",
    "content": "file content"
  },
  "tool_response": {
    "filePath": "/path/to/file.txt",
    "success": true
  }
}
```

### Notification Input

```json
{
  "session_id": "abc123",
  "transcript_path": "/Users/.../.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "Notification",
  "message": "Task completed successfully"
}
```

### UserPromptSubmit Input

```json
{
  "session_id": "abc123",
  "transcript_path": "/Users/.../.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "UserPromptSubmit",
  "prompt": "Write a function to calculate the factorial of a number"
}
```

### Stop and SubagentStop Input

`stop_hook_active` is true when Droid is already continuing as a result of
a stop hook. Check this value or process the transcript to prevent Droid
from running indefinitely.

```json
{
  "session_id": "abc123",
  "transcript_path": "~/.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "Stop",
  "stop_hook_active": true
}
```

### PreCompact Input

For `manual`, `custom_instructions` comes from what the user passes into
`/compact`. For `auto`, `custom_instructions` is empty.

```json
{
  "session_id": "abc123",
  "transcript_path": "~/.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "PreCompact",
  "trigger": "manual",
  "custom_instructions": ""
}
```

### SessionStart Input

```json
{
  "session_id": "abc123",
  "transcript_path": "~/.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "SessionStart",
  "source": "startup"
}
```

### SessionEnd Input

```json
{
  "session_id": "abc123",
  "transcript_path": "~/.factory/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",
  "cwd": "/Users/...",
  "permission_mode": "default",
  "hook_event_name": "SessionEnd",
  "reason": "exit"
}
```

## Hook Output

There are two ways for hooks to return output back to Droid. The output
communicates whether to block and any feedback that should be shown to Droid
and the user.

### Simple: Exit Code

Hooks communicate status through exit codes, stdout, and stderr:

* **Exit code 0**: Success. `stdout` is shown to the user in transcript mode
  (CTRL-R), except for `UserPromptSubmit` and `SessionStart`, where stdout is
  added to the context.
* **Exit code 2**: Blocking error. `stderr` is fed back to Droid to process
  automatically. See per-hook-event behavior below.
* **Other exit codes**: Non-blocking error. `stderr` is shown to the user and
  execution continues.

<Warning>
  Reminder: Droid does not see stdout if the exit code is 0, except for
  the `UserPromptSubmit` hook where stdout is injected as context.
</Warning>

#### Exit Code 2 Behavior

| Hook Event         | Behavior                                                           |
| ------------------ | ------------------------------------------------------------------ |
| `PreToolUse`       | Blocks the tool call, shows stderr to Droid                       |
| `PostToolUse`      | Shows stderr to Droid (tool already ran)                          |
| `Notification`     | N/A, shows stderr to user only                                     |
| `UserPromptSubmit` | Blocks prompt processing, erases prompt, shows stderr to user only |
| `Stop`             | Blocks stoppage, shows stderr to Droid                            |
| `SubagentStop`     | Blocks stoppage, shows stderr to sub-droid                   |
| `PreCompact`       | N/A, shows stderr to user only                                     |
| `SessionStart`     | N/A, shows stderr to user only                                     |
| `SessionEnd`       | N/A, shows stderr to user only                                     |

### Advanced: JSON Output

Hooks can return structured JSON in `stdout` for more sophisticated control:

#### Common JSON Fields

All hook types can include these optional fields:

```json
{
  "continue": true, // Whether Droid should continue after hook execution (default: true)
  "stopReason": "string", // Message shown when continue is false

  "suppressOutput": true, // Hide stdout from transcript mode (default: false)
  "systemMessage": "string" // Optional warning message shown to the user
}
```

If `continue` is false, Droid stops processing after the hooks run.

* For `PreToolUse`, this is different from `"permissionDecision": "deny"`, which
  only blocks a specific tool call and provides automatic feedback to Droid.
* For `PostToolUse`, this is different from `"decision": "block"`, which
  provides automated feedback to Droid.
* For `UserPromptSubmit`, this prevents the prompt from being processed.
* For `Stop` and `SubagentStop`, this takes precedence over any
  `"decision": "block"` output.
* In all cases, `"continue" = false` takes precedence over any
  `"decision": "block"` output.

`stopReason` accompanies `continue` with a reason shown to the user, not shown
to Droid.

#### `PreToolUse` Decision Control

`PreToolUse` hooks can control whether a tool call proceeds.

* `"allow"` bypasses the permission system. `permissionDecisionReason` is shown
  to the user but not to Droid.
* `"deny"` prevents the tool call from executing. `permissionDecisionReason` is
  shown to Droid.
* `"ask"` asks the user to confirm the tool call in the UI.
  `permissionDecisionReason` is shown to the user but not to Droid.

Additionally, hooks can modify tool inputs before execution using `updatedInput`:

* `updatedInput` allows you to modify the tool's input parameters before the tool executes. This is a `Record<string, unknown>` object containing the fields you want to change or add.
* This is most useful with `"permissionDecision": "allow"` to modify and approve tool calls.

```json
{
  "hookSpecificOutput": {
    "hookEventName": "PreToolUse",
    "permissionDecision": "allow",
    "permissionDecisionReason": "My reason here",
    "updatedInput": {
      "field_to_modify": "new value"
    }
  }
}
```

<Note>
  The `decision` and `reason` fields are deprecated for PreToolUse hooks.
  Use `hookSpecificOutput.permissionDecision` and
  `hookSpecificOutput.permissionDecisionReason` instead. The deprecated fields
  `"approve"` and `"block"` map to `"allow"` and `"deny"` respectively.
</Note>

#### `PostToolUse` Decision Control

`PostToolUse` hooks can provide feedback to Droid after tool execution.

* `"block"` automatically prompts Droid with `reason`.
* `undefined` does nothing. `reason` is ignored.
* `"hookSpecificOutput.additionalContext"` adds context for Droid to consider.

```json
{
  "decision": "block" | undefined,
  "reason": "Explanation for decision",
  "hookSpecificOutput": {
    "hookEventName": "PostToolUse",
    "additionalContext": "Additional information for Droid"
  }
}
```

#### `UserPromptSubmit` Decision Control

`UserPromptSubmit` hooks can control whether a user prompt is processed.

* `"block"` prevents the prompt from being processed. The submitted prompt is
  erased from context. `"reason"` is shown to the user but not added to context.
* `undefined` allows the prompt to proceed normally. `"reason"` is ignored.
* `"hookSpecificOutput.additionalContext"` adds the string to the context if not
  blocked.

```json
{
  "decision": "block" | undefined,
  "reason": "Explanation for decision",
  "hookSpecificOutput": {
    "hookEventName": "UserPromptSubmit",
    "additionalContext": "My additional context here"
  }
}
```

#### `Stop`/`SubagentStop` Decision Control

`Stop` and `SubagentStop` hooks can control whether Droid must continue.

* `"block"` prevents Droid from stopping. You must populate `reason` for Droid
  to know how to proceed.
* `undefined` allows Droid to stop. `reason` is ignored.

```json
{
  "decision": "block" | undefined,
  "reason": "Must be provided when Droid is blocked from stopping"
}
```

#### `SessionStart` Decision Control

`SessionStart` hooks allow you to load in context at the start of a session.

* `"hookSpecificOutput.additionalContext"` adds the string to the context.
* Multiple hooks' `additionalContext` values are concatenated.

```json
{
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": "My additional context here"
  }
}
```

#### `SessionEnd` Decision Control

`SessionEnd` hooks run when a session ends. They cannot block session termination
but can perform cleanup tasks.

#### Exit Code Example: Bash Command Validation

```python
#!/usr/bin/env python3
import json
import re
import sys

# Define validation rules as a list of (regex pattern, message) tuples
VALIDATION_RULES = [
    (
        r"\bgrep\b(?!.*\|)",
        "Use 'rg' (ripgrep) instead of 'grep' for better performance and features",
    ),
    (
        r"\bfind\s+\S+\s+-name\b",
        "Use 'rg --files | rg pattern' or 'rg --files -g pattern' instead of 'find -name' for better performance",
    ),
]


def validate_command(command: str) -> list[str]:
    issues = []
    for pattern, message in VALIDATION_RULES:
        if re.search(pattern, command):
            issues.append(message)
    return issues


try:
    input_data = json.load(sys.stdin)
except json.JSONDecodeError as e:
    print(f"Error: Invalid JSON input: {e}", file=sys.stderr)
    sys.exit(1)

tool_name = input_data.get("tool_name", "")
tool_input = input_data.get("tool_input", {})
command = tool_input.get("command", "")

if tool_name != "Bash" or not command:
    sys.exit(1)

# Validate the command
issues = validate_command(command)

if issues:
    for message in issues:
        print(f"‚Ä¢ {message}", file=sys.stderr)
    # Exit code 2 blocks tool call and shows stderr to Droid
    sys.exit(2)
```

#### JSON Output Example: UserPromptSubmit to Add Context and Validation

<Note>
  For `UserPromptSubmit` hooks, you can inject context using either method:

  * Exit code 0 with stdout: Droid sees the context (special case for `UserPromptSubmit`)
  * JSON output: Provides more control over the behavior
</Note>

```python
#!/usr/bin/env python3
import json
import sys
import re
import datetime

# Load input from stdin
try:
    input_data = json.load(sys.stdin)
except json.JSONDecodeError as e:
    print(f"Error: Invalid JSON input: {e}", file=sys.stderr)
    sys.exit(1)

prompt = input_data.get("prompt", "")

# Check for sensitive patterns
sensitive_patterns = [
    (r"(?i)\b(password|secret|key|token)\s*[:=]", "Prompt contains potential secrets"),
]

for pattern, message in sensitive_patterns:
    if re.search(pattern, prompt):
        # Use JSON output to block with a specific reason
        output = {
            "decision": "block",
            "reason": f"Security policy violation: {message}. Please rephrase your request without sensitive information."
        }
        print(json.dumps(output))
        sys.exit(0)

# Add current time to context
context = f"Current time: {datetime.datetime.now()}"
print(context)

"""
The following is also equivalent:
print(json.dumps({
  "hookSpecificOutput": {
    "hookEventName": "UserPromptSubmit",
    "additionalContext": context,
  },
}))
"""

# Allow the prompt to proceed with the additional context
sys.exit(0)
```

#### JSON Output Example: PreToolUse with Approval

```python
#!/usr/bin/env python3
import json
import sys

# Load input from stdin
try:
    input_data = json.load(sys.stdin)
except json.JSONDecodeError as e:
    print(f"Error: Invalid JSON input: {e}", file=sys.stderr)
    sys.exit(1)

tool_name = input_data.get("tool_name", "")
tool_input = input_data.get("tool_input", {})

# Example: Auto-approve file reads for documentation files
if tool_name == "Read":
    file_path = tool_input.get("file_path", "")
    if file_path.endswith((".md", ".mdx", ".txt", ".json")):
        # Use JSON output to auto-approve the tool call
        output = {
            "decision": "approve",
            "reason": "Documentation file auto-approved",
            "suppressOutput": True  # Don't show in transcript mode
        }
        print(json.dumps(output))
        sys.exit(0)

# For other cases, let the normal permission flow proceed
sys.exit(0)
```

## Working with MCP Tools

Droid hooks work seamlessly with
[Model Context Protocol (MCP) tools](/cli/configuration/mcp). When MCP servers
provide tools, they appear with a special naming pattern that you can match in
your hooks.

### MCP Tool Naming

MCP tools follow the pattern `mcp__<server>__<tool>`, for example:

* `mcp__memory__create_entities` - Memory server's create entities tool
* `mcp__filesystem__read_file` - Filesystem server's read file tool
* `mcp__github__search_repositories` - GitHub server's search tool

### Configuring Hooks for MCP Tools

You can target specific MCP tools or entire MCP servers:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "mcp__memory__.*",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'Memory operation initiated' >> ~/mcp-operations.log"
          }
        ]
      },
      {
        "matcher": "mcp__.*__write.*",
        "hooks": [
          {
            "type": "command",
            "command": "/home/user/scripts/validate-mcp-write.py"
          }
        ]
      }
    ]
  }
}
```

## Examples

<Tip>
  For practical examples including code formatting, notifications, and file protection, see [More Examples](/cli/configuration/hooks-guide#more-examples) in the get started guide.
</Tip>

## Security Considerations

### Disclaimer

**USE AT YOUR OWN RISK**: Droid hooks execute arbitrary shell commands on
your system automatically. By using hooks, you acknowledge that:

* You are solely responsible for the commands you configure
* Hooks can modify, delete, or access any files your user account can access
* Malicious or poorly written hooks can cause data loss or system damage
* Factory AI provides no warranty and assumes no liability for any damages
  resulting from hook usage
* You should thoroughly test hooks in a safe environment before production use

Always review and understand any hook commands before adding them to your
configuration.

### Security Best Practices

Here are some key practices for writing more secure hooks:

1. **Validate and sanitize inputs** - Never trust input data blindly
2. **Always quote shell variables** - Use `"$VAR"` not `$VAR`
3. **Block path traversal** - Check for `..` in file paths
4. **Use absolute paths** - Always specify full paths for scripts. Never use relative paths like `./script.sh` or `hooks/script.sh` as they may resolve incorrectly depending on Droid's current directory. Use `"$FACTORY_PROJECT_DIR"/path/to/script.sh` for project scripts or full paths like `/usr/local/bin/script.sh` or `~/.factory/hooks/script.sh` for global scripts.
5. **Skip sensitive files** - Avoid `.env`, `.git/`, keys, etc.

### Configuration Safety

Direct edits to hooks in settings files don't take effect immediately. Droid:

1. Captures a snapshot of hooks at startup
2. Uses this snapshot throughout the session
3. Warns if hooks are modified externally
4. Requires review in `/hooks` menu for changes to apply

This prevents malicious hook modifications from affecting your current session.

## Hook Execution Details

* **Timeout**: 60-second execution limit by default, configurable per command.
  * A timeout for an individual command does not affect the other commands.
* **Parallelization**: All matching hooks run in parallel
* **Deduplication**: Multiple identical hook commands are deduplicated automatically
* **Environment**: Runs in current directory with Droid's environment
  * The `FACTORY_PROJECT_DIR` environment variable is available and contains the
    absolute path to the project root directory (where Droid was started)
* **Input**: JSON via stdin
* **Output**:
  * PreToolUse/PostToolUse/Stop/SubagentStop: Progress shown in transcript (Ctrl-R)
  * Notification/SessionEnd: Logged to debug only (`--debug`)
  * UserPromptSubmit/SessionStart: stdout added as context for Droid

## Debugging

### Basic Troubleshooting

If your hooks aren't working:

1. **Check configuration** - Run `/hooks` to see if your hook is registered
2. **Verify syntax** - Ensure your JSON settings are valid
3. **Test commands** - Run hook commands manually first
4. **Check permissions** - Make sure scripts are executable
5. **Review logs** - Use `droid --debug` to see hook execution details

Common issues:

* **Quotes not escaped** - Use `\"` inside JSON strings
* **Wrong matcher** - Check tool names match exactly (case-sensitive)
* **Command not found** - Use full paths for scripts

### Advanced Debugging

For complex hook issues:

1. **Inspect hook execution** - Use `droid --debug` to see detailed hook
   execution
2. **Validate JSON schemas** - Test hook input/output with external tools
3. **Check environment variables** - Verify Droid's environment is correct
4. **Test edge cases** - Try hooks with unusual file paths or inputs
5. **Monitor system resources** - Check for resource exhaustion during hook
   execution
6. **Use structured logging** - Implement logging in your hook scripts

### Debug Output Example

Use `droid --debug` to see hook execution details:

```
[DEBUG] Executing hooks for PostToolUse:Write
[DEBUG] Getting matching hook commands for PostToolUse with query: Write
[DEBUG] Found 1 hook matchers in settings
[DEBUG] Matched 1 hooks for query "Write"
[DEBUG] Found 1 hook commands to execute
[DEBUG] Executing hook command: <Your command> with timeout 60000ms
[DEBUG] Hook command completed with status 0: <Your stdout>
```

Progress messages appear in transcript mode (Ctrl-R) showing:

* Which hook is running
* Command being executed
* Success/failure status
* Output or error messages
</file>

<file path="docs/web/getting-started/overview.mdx">
---
title: Overview
sidebarTitle: Overview
description: A brief introduction to Factory on the web
---

## Why Factory?

The biggest friction points in software development aren't in writing code ‚Äì they're in everything that happens around it. Factory addresses these challenges with:

<CardGroup cols={3}>
  <Card title="Context Management" img="/images/overview/context.jpg">
    Factory integrates with your entire codebase and engineering tools to provide instant, relevant context for any task.
  </Card>

  <Card title="Specialized Droids" img="/images/overview/workflows.jpg">
    Accelerate common development tasks with Factory's specialized AI assistants, each optimized for specific use cases.
  </Card>

  <Card title="Adaptive Interface" img="/images/overview/fragments.jpg">
    Work in an environment that adapts to your work with an AI-managed dynamic interface.
  </Card>
</CardGroup>

## Getting Started

<Steps>
  <Step title="Connect Your Machine">
    Connect to a remote repository or your local machine.
  </Step>

  <Step title="Connect Your Tools">
    Integrate your existing engineering and project management tools such as Slack, Linear, or PagerDuty to unlock Factory's full potential.
  </Step>

  <Step title="Choose Your Droids">
    Select from our specialized Droids, each designed to excel at specific development tasks.
  </Step>

  <Step title="Start Building">
    Experience a new way of software development with unified context and AI assistance.
  </Step>
</Steps>

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Quickstart"
    icon="rocket"
    href="/web/getting-started/quickstart"
  >
    Get up and running with the Factory web platform in 5 minutes
  </Card>
</CardGroup>
</file>

<file path="docs/web/getting-started/quickstart.mdx">
---
title: "Quickstart"
description: "Connect to your machine and execute on tasks in just 5 minutes"
---

In this Quickstart Guide, you'll learn how to launch Factory, connect to your codebase, and start making code changes with AI assistance.

<Note>
  Make sure you have access to Factory before getting started.
</Note>

## Step 1: Launch Factory

<Steps>
  <Step title="Open Factory">
    Open the Factory application in your browser.

    <Frame>
      ![factoryhomepage.png](/images/web/factoryhomepage.png)
    </Frame>

    <Note>
      By default, your session is configured with settings from your most recent session. First-time users will see default settings: Code Droid, remote connection, and an empty workspace.
    </Note>
  </Step>
</Steps>

## Step 2: Configure Your Session

<Steps>
  <Step title="Select Your Droid">
    Click the Droid Selection button to choose the appropriate droid based on your project needs.

    <Frame>
      ![droid-selection.gif](/images/web/droid-selection.gif)
    </Frame>
  </Step>
  
  <Step title="Select Your Machine Connection">
    <Frame>
      ![machine-connection-start.gif](/images/web/machine-connection-start.gif)
    </Frame>

    Choose between Local (via Bridge) or Remote connection.

    ### Local Connection (Bridge)
    1. Download Factory Bridge and open the application
    2. Enter the pairing code displayed in the Machine Connection menu
    3. Set your root directory to your working directory
    4. Bridge automatically scans for repositories from the root directory
    5. Select repositories relevant to this session

    <Frame>
      ![bridge-connection.gif](/images/web/bridge-connection.gif)
    </Frame>

    ### Remote Connection
    Connect to a remote workspace (requires GitHub or GitLab integration).

    <Note>
      See our [Integrations guide](/onboarding/integrating-with-your-engineering-system/github-cloud) to connect GitHub or GitLab for remote workspaces.
    </Note>
  </Step>

  <Step title="Select Model and Tools">
    Choose your desired model and activate the necessary tools for your task.

    <Frame>
      ![model-tool-selection.gif](/images/web/model-tool-selection.gif)
    </Frame>

    <Note>
      Tools extend Factory's capabilities through external integrations to connect with Jira, Notion, Slack, and other platforms.
    </Note>
  </Step>
</Steps>

## Step 3: Explore Your Codebase

<Steps>
  <Step title="Analyze Your Architecture">
    Start with a comprehensive overview of your project:

    ```
    > Analyze this codebase and explain the overall architecture
    ```

    Droid reads your files contextually and leverages organizational knowledge to provide comprehensive insights about your project structure and conventions.

    <Note>
      Use the context panel to explore all context leveraged by Droid.
    </Note>
  </Step>
</Steps>

## Step 4: Make Your First Code Change

<Steps>
  <Step title="Request a Simple Modification">
    Try a simple modification to see Droid in action:

    ```
    > Add comprehensive logging to the main application startup
    ```

    Droid will:
    1. Analyze your current logging setup
    2. Propose specific changes with a clear plan
    3. Show you exactly what will be modified

    <Note>
      This transparent review process ensures you maintain full control over all code modifications.
    </Note>
  </Step>
</Steps>

## Step 5: Experience Enterprise Workflows

<Steps>
  <Step title="Complex Tasks with External Context">
    Try more complex tasks that showcase Factory's enterprise capabilities:

    ### Security Audit
    ```
    > Audit this codebase for security vulnerabilities and create a remediation plan
    ```

    ### Integration with Team Tools
    Provide context from your team's tools using '@' mentions or direct links.


    <Note>
      If you've integrated these platforms through Factory's dashboard, Droid can automatically read context from Jira, Notion, Slack, and other sources.
    </Note>
  </Step>
</Steps>

## Best Practices

### Be Specific with Context
**Instead of:** "Fix the bug"  
**Try:** "Fix the authentication timeout issue where users get logged out after 5 minutes instead of the configured 30 minutes"

### Leverage Organizational Knowledge
"Following our team's coding standards, implement the user preferences feature described in ticket PROJ-123"

### Use the Review Workflow
Always review Droid's proposed changes before approval. The transparent diff view helps you understand exactly what will be modified.

## Congratulations! üéâ

You've successfully connected Factory to your codebase and made your first AI-assisted code changes.

### Next Steps

Continue exploring Factory's web platform to maximize your productivity with AI-assisted development.
</file>

<file path="docs/web/machine-connection/factory-bridge/best-practices.mdx">
---
title: Factory Bridge Best Practices
description: Recommendations and strategies for effectively integrating Factory Bridge into your development workflow
---

Factory Bridge creates powerful opportunities to seamlessly integrate your local environment with Factory. This guide provides best practices to help you maximize the benefits while maintaining security and efficiency.

## Workflow Integration

### Development Environment Setup

<Steps>
  <Step title="Standardize Project Structures">
    Create consistent project structures across your repositories to make it easier to automate common tasks with Factory Bridge.

    ```
    project-root/
    ‚îú‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ scripts/
    ‚îî‚îÄ‚îÄ package.json
    ```

  </Step>

  <Step title="Create Utility Scripts">
    Develop standardized utility scripts for common tasks to simplify command execution through Factory:

    ```bash
    # build.sh
    #!/bin/bash
    echo "Building project..."
    npm run build
    ```

    This allows you to run `./scripts/build.sh` instead of remembering complex build commands.

  </Step>

  <Step title="Set Up Path References">
    Store frequently used paths in your Factory sessions to make command execution more consistent:

    ```
    Project path: /Users/username/projects/my-app
    Build script: ./scripts/build.sh
    Test script: ./scripts/test.sh
    ```

  </Step>
</Steps>

### Task Automation

<AccordionGroup>
  <Accordion title="Common Development Tasks">
    Create command sequences for regular development tasks:

    ```
    # Start development environment
    cd /path/to/project
    npm install
    npm start
    ```

    Factory can execute these commands in sequence, monitoring output at each stage.

  </Accordion>

  <Accordion title="Testing Workflows">
    Establish consistent testing workflows:

    ```
    # Run tests for a specific feature
    cd /path/to/project
    npm test -- --filter=feature-name
    ```

    Factory can execute tests and help analyze the results in the same session.

  </Accordion>

  <Accordion title="Deployment Preparation">
    Prepare for deployment with confidence:

    ```
    # Prepare for deployment
    cd /path/to/project
    npm run lint
    npm test
    npm run build
    ```

    Factory can execute these commands sequentially, only proceeding if each step succeeds.

  </Accordion>
</AccordionGroup>

## Performance Optimization

### Resource Management

<CardGroup cols={2}>
  <Card title="Limit Long-Running Processes" icon="gauge-high">
    Remember that each process started through Factory Bridge consumes resources on your local machine. Terminate processes when they're no longer needed to free up resources.
  </Card>

  <Card title="Monitor Resource Usage" icon="chart-line">
    Periodically check system resource usage when running multiple processes through Factory Bridge to ensure optimal performance.
  </Card>
</CardGroup>

### Command Execution Strategies

<Steps>
  <Step title="Choose the Right Working Directory">
    Always specify the most specific working directory for commands to avoid unexpected behavior and improve performance.

    ```
    # Good practice
    cd /path/to/specific/module
    npm test

    # Instead of
    cd /path/to/large/project
    cd module
    npm test
    ```

  </Step>

  <Step title="Batch Similar Commands">
    Group similar commands to reduce overhead:

    ```
    # Good practice
    cd /path/to/project && npm install && npm test

    # Instead of separate commands
    cd /path/to/project
    npm install
    npm test
    ```

  </Step>

  <Step title="Use Background Processes When Appropriate">
    For long-running processes that you don't need to monitor continuously, consider running them in the background:

    ```
    nohup npm start > app.log 2>&1 &
    ```

    This allows you to continue working with Factory while the process runs.

  </Step>
</Steps>

## Security Best Practices

### Access Control

<CardGroup cols={2}>
  <Card title="Manage Pairing Codes Carefully" icon="key">
    Treat your Factory Bridge pairing code like a password. Don't share it with others, and regenerate it if you suspect it's been compromised.
  </Card>

  <Card title="Use Separate Environments" icon="shield-halved">
    Consider setting up different environments (e.g., development, testing, production) with appropriate access controls for each stage of development.
  </Card>
</CardGroup>

### Command Execution Safety

<Steps>
  <Step title="Review Commands Before Execution">
    Always review commands suggested by Factory before allowing them to execute, especially commands that modify your system or access sensitive data.
  </Step>

  <Step title="Avoid Hardcoded Credentials">
    Never include credentials directly in commands. Instead, use environment variables or secure credential storage solutions.

    ```
    # Avoid
    mysql -u root -p"password"

    # Better
    mysql -u root -p
    # Then use Pipe Process Input to enter the password
    ```

  </Step>

  <Step title="Limit Command Scope">
    Restrict commands to the minimum permissions needed for the task:

    ```
    # Instead of
    sudo npm install -g package

    # Use
    npm install --save-dev package
    ```

  </Step>
</Steps>

### Data Protection

<AccordionGroup>
  <Accordion title="Handling Sensitive Data">
    When working with sensitive data:

    1. Minimize exposure of sensitive data in command outputs
    2. Avoid commands that might display credentials or keys
    3. Be cautious when running diagnostic commands that might reveal system information
    4. Clear sensitive data from logs and terminal outputs

  </Accordion>

  <Accordion title="Secure File Operations">
    When working with files containing sensitive information:

    1. Ensure appropriate file permissions
    2. Be careful with wildcards in commands that could accidentally include sensitive files
    3. Verify target directories before executing file operations
    4. Use temporary directories for processing sensitive data when possible

  </Accordion>
</AccordionGroup>

## Advanced Integration Techniques

### Chaining Tools Together

Combine Factory Bridge tools for more complex workflows:

<Steps>
  <Step title="Interactive Script Execution">
    Execute a script that requires user input:

    ```
    # Execute a Python script
    python interactive_script.py

    # Use Pipe Process Input to provide responses to prompts
    # For each prompt: send input with appropriate termination
    ```

  </Step>

  <Step title="Process Management Lifecycle">
    Manage the complete lifecycle of a process:

    ```
    # Start a server
    npm start

    # Interact with the server through another process
    curl http://localhost:3000/api/test

    # Terminate the server when testing is complete
    # Use Kill Process tool with the server's PID
    ```

  </Step>
</Steps>

### Custom Automation Scripts

Create custom scripts specifically designed to work well with Factory Bridge:

<AccordionGroup>
  <Accordion title="Progress Reporting">
    Design scripts with clear progress indicators:

    ```bash
    #!/bin/bash
    echo "Step 1: Installing dependencies..."
    npm install
    echo "Step 2: Running tests..."
    npm test
    echo "Step 3: Building application..."
    npm run build
    echo "Complete!"
    ```

    This makes it easier to track progress in Factory.

  </Accordion>

  <Accordion title="Interactive Decision Points">
    Create scripts with clear interactive prompts:

    ```bash
    #!/bin/bash
    echo "Deploy to production? (y/n)"
    read response
    if [ "$response" = "y" ]; then
        echo "Deploying to production..."
        # deployment commands
    else
        echo "Deployment cancelled."
    fi
    ```

    Factory can use the Pipe Process Input tool to respond to these prompts.

  </Accordion>
</AccordionGroup>

## Troubleshooting Techniques

### Diagnostic Strategies

<Steps>
  <Step title="Isolate Issues">
    When troubleshooting, isolate components to identify the source of problems:

    ```
    # Test database connection
    mysql -u username -p -e "SELECT 1"

    # Test API endpoint
    curl http://localhost:3000/api/health

    # Check process status
    ps aux | grep server
    ```

  </Step>

  <Step title="Capture Detailed Logs">
    Capture comprehensive logs for troubleshooting:

    ```
    # Redirect both stdout and stderr to a log file
    npm start > app.log 2>&1

    # Use verbose mode when available
    npm install --verbose
    ```

  </Step>

  <Step title="Check Environment Variables">
    Verify environment variables affecting your applications:

    ```
    # Print environment variables
    env | grep NODE
    ```

  </Step>
</Steps>

### Common Resolution Patterns

<AccordionGroup>
  <Accordion title="Connection Issues">
    If Factory cannot connect to Bridge:

    1. Check Factory Bridge is running (look for the tray icon)
    2. Verify the pairing code is correct
    3. Restart Factory Bridge
    4. Check for network issues or firewalls blocking connections
    5. Try reconnecting from a new Factory session
    6. Verify you haven't exceeded the maximum number of connected sessions

  </Accordion>

  <Accordion title="Command Execution Failures">
    When commands fail to execute properly:

    1. Try running the same command directly in your terminal
    2. Check for environment differences between Factory Bridge and your terminal
    3. Verify paths and working directories
    4. Check for permission issues
    5. Look for locked files or resources

  </Accordion>
</AccordionGroup>

## Team Collaboration

<CardGroup cols={2}>
  <Card title="Shared Workflows" icon="users">
    Create and document standard Factory Bridge workflows for your team to ensure consistency and knowledge sharing.
  </Card>

  <Card title="Process Documentation" icon="file-lines">
    Document processes that use Factory Bridge in your team's knowledge base, including common commands, troubleshooting steps, and best practices.
  </Card>
</CardGroup>

## Real-world Examples

<AccordionGroup>
  <Accordion title="Full-stack Development Workflow">
    A typical full-stack development workflow using Factory Bridge:

    1. Start the backend server:
       ```
       cd /path/to/backend
       npm start
       ```

    2. In another Factory interaction, start the frontend:
       ```
       cd /path/to/frontend
       npm start
       ```

    3. Run tests while both services are running:
       ```
       cd /path/to/tests
       npm test
       ```

    4. Make code changes in Factory and see real-time updates

    5. When finished, terminate both processes using their PIDs

  </Accordion>

  <Accordion title="Database Migration Workflow">
    A database migration workflow:

    1. Create a backup:
       ```
       pg_dump -U username -d database > backup.sql
       ```

    2. Run migration scripts:
       ```
       cd /path/to/migrations
       ./migrate.sh
       ```

    3. Verify migration success:
       ```
       psql -U username -d database -c "SELECT * FROM schema_migrations"
       ```

    4. Run application tests against the migrated database:
       ```
       cd /path/to/tests
       npm run test:integration
       ```

  </Accordion>
</AccordionGroup>

<Card title="Factory Bridge CLI Tools Reference" icon="book" href="/web/machine-connection/factory-bridge/cli-tools-reference">
  For detailed information on all available CLI tools, refer to the Factory Bridge CLI Tools Reference
</Card>
</file>

<file path="docs/web/machine-connection/factory-bridge/cli-tools-reference.mdx">
---
title: Factory Bridge CLI Tools Reference
description: Comprehensive guide to the CLI tools available through Factory Bridge and how to use them effectively
---

Factory Bridge provides several powerful CLI tools that allow you to interact with your local environment directly from Factory. This reference guide covers each tool in detail, including usage examples and parameters.

## Available CLI Tools

When you connect Factory to your local machine via Factory Bridge, you'll have access to the following shell tools in Droid Mode:

<CardGroup cols={3}>
  <Card title="Execute Process" icon="play">
    Run commands and scripts on your local machine
  </Card>
  <Card title="Kill Process" icon="stop">
    Terminate running processes
  </Card>
  <Card title="Pipe Process Input" icon="arrow-right-to-bracket">
    Send input to running processes
  </Card>
</CardGroup>

## Overview

Factory Bridge connects securely to your local machine, giving you access to powerful command-line capabilities directly within Factory. These tools allow you to execute commands, manage processes, and interact with running applications‚Äîall while maintaining your familiar workflow.

## Available CLI Tools

When connected via Factory Bridge, you'll have access to these essential command-line tools:

<CardGroup cols={3}>
  <Card title="Execute Commands" icon="play">
    Run commands and scripts directly from Factory
  </Card>
  <Card title="Manage Processes" icon="stop">
    Control running processes with ease
  </Card>
  <Card title="Interactive Input" icon="arrow-right-to-bracket">
    Send input to running applications
  </Card>
</CardGroup>

## Running Commands

Execute any command you would normally run in your terminal directly from Factory.

### How It Works

1. Connect Factory Bridge to your local machine
2. Ask Factory to run a command
3. View the results directly in your conversation

### Examples

<AccordionGroup>
  <Accordion title="List Files">
    **Request**:
    ```
    Run 'ls -la' in my home directory
    ```

    Factory will execute this command and show you the output:
    ```
    total 112
    drwxr-xr-x   18 user  staff    576 Mar 12 15:46 .
    drwxr-xr-x    5 root  admin    160 Feb  1 09:34 ..
    drwxr-xr-x   14 user  staff    448 Mar 12 14:22 .git
    -rw-r--r--    1 user  staff    310 Mar  9 10:13 .gitignore
    -rw-r--r--    1 user  staff   1064 Mar  9 10:13 README.md
    drwxr-xr-x    8 user  staff    256 Mar 12 14:22 src
    ```

  </Accordion>

  <Accordion title="Building Projects">
    **Request**:
    ```
    Build my React app using 'npm run build' in my project directory
    ```

    Factory will execute the build command and display the progress in real-time.

  </Accordion>

  <Accordion title="Starting Development Servers">
    **Request**:
    ```
    Start a development server with 'npm start' in my project
    ```

    Factory will start the server and stream the output, allowing you to monitor the process.

  </Accordion>
</AccordionGroup>

## Managing Processes

Easily control processes that you've started through Factory.

### How It Works

1. Start a process using Factory
2. If needed, ask Factory to terminate the process
3. Factory will safely shut down the process for you

## Interactive Applications

Interact with command-line applications that require user input.

### How It Works

1. Start an interactive process through Factory
2. Send input as needed, including confirmation responses, text entries, and commands
3. Factory will relay your input to the application and display the results

### Examples

<AccordionGroup>
  <Accordion title="Database Operations">
    <Steps>
      <Step title="Connect to Database">
        Ask Factory to start your database client
      </Step>
      <Step title="Enter Credentials">
        Securely provide login information
      </Step>
      <Step title="Execute Queries">
        Run SQL commands as needed
      </Step>
      <Step title="Complete Session">
        Exit cleanly when finished
      </Step>
    </Steps>
  </Accordion>

  <Accordion title="Git Workflow">
    <Steps>
      <Step title="Check Status">
        View current repository status
      </Step>
      <Step title="Create Branches">
        Create and switch branches as needed
      </Step>
      <Step title="Stage Changes">
        Add modified files to staging
      </Step>
      <Step title="Commit Work">
        Commit with descriptive messages
      </Step>
      <Step title="Push Updates">
        Push changes to remote repositories
      </Step>
    </Steps>
  </Accordion>
</AccordionGroup>

## Best Practices

- Specify complete file paths when possible
- Use quotes for commands containing spaces or special characters
- Consider security implications before running sensitive commands
- Always verify process information before termination

## Troubleshooting

<AccordionGroup>
  <Accordion title="Command Not Found">
    - Verify the command is installed on your system
    - Check if the command is in your system PATH
    - Try using the full path to the executable
    - Ensure you're using the correct environment for specialized commands
  </Accordion>

  <Accordion title="Permission Issues">
    - Check file and directory permissions
    - Ensure you have appropriate access rights
    - For scripts, verify they have execution permissions
    - Use elevated privileges only when necessary and with caution
  </Accordion>

  <Accordion title="Process Communication">
    - Verify processes are still running before attempting interaction
    - Check output logs for error messages
    - Restart processes if connection is lost
  </Accordion>
</AccordionGroup>

## Security Considerations

When using CLI tools through Factory Bridge, keep these security considerations in mind:

- All commands execute with your user permissions on your local machine
- Avoid running commands that could expose sensitive information
- Be cautious with commands that make system changes
- Consider using dedicated environments for sensitive operations

<Card title="Learn More About Factory Bridge" icon="bridge" href="/web/machine-connection/factory-bridge/installation-and-usage">
  Return to the main Factory Bridge documentation for installation and general usage information
</Card>
</file>

<file path="docs/web/machine-connection/factory-bridge/installation-and-usage.mdx">
---
title: Factory Bridge
description: Learn how to install, configure, and use Factory Bridge to connect Factory with your local environment
---

Factory Bridge creates a secure connection between the Factory platform and your local machine, enabling powerful capabilities like running CLI commands, managing local processes, and accessing local resources directly from your Factory sessions.

### System Requirements

Factory Bridge is available for MacOS and supported on most browsers except Safari and Brave.

## Installation

<Steps>
  <Step title="Download Factory Bridge">
    Download the Factory Bridge from the "Connect to Machine" -> "Local Machine" menu in the top-right corner of a Factory session.

  </Step>

  <Step title="Install Factory Bridge">
    **macOS**
    - Open the downloaded `.zip` file
    - Drag Factory Bridge to your Applications folder
  </Step>
</Steps>

## Getting Started

<Steps>
  <Step title="Launch Factory Bridge">
    If Factory Bridge isn't already running, launch it from your applications menu or folder. Look for the Factory Bridge icon in your system tray or menu bar to confirm it's running.

    <Note>
      Factory Bridge runs in the background and manages its own window state. You can always access it by clicking on the tray icon.
    </Note>

  </Step>

  <Step title="Enter Pairing Code">
    When you first launch Factory Bridge, you'll be prompted to enter a pairing code:

    1. Open Factory in your browser
    2. Navigate to a session where you want to use local capabilities
    3. Click on the CPU button in the top right of the session view, click "Local Machine"
    3. Factory will display a pairing code
    4. Enter this code in the Factory Bridge application

    The pairing code ensures a secure connection between Factory and your local machine.

  </Step>

  <Step title="Confirm Connection">
    Once successfully paired:

    1. The Factory Bridge interface will display "Bridge Paired" with a green indicator
    2. Factory will show that Bridge is connected in the session
    3. You can now access local capabilities in your Factory session

  </Step>
</Steps>

## Use Cases

### Running Local CLI Commands

Factory Bridge allows you to execute local CLI commands directly from Factory sessions, making it easy to interact with your local development environment.

<CardGroup cols={2}>
  <Card title="Execute Commands" icon="terminal">
    Run commands on your local machine:

    ```
    npm install react
    python -m venv myenv
    git status
    ```

    Factory will display the command output in real-time.

  </Card>

  <Card title="Navigate Local Filesystem" icon="folder-tree">
    Navigate and interact with your local filesystem:

    ```
    ls -la
    cd my-project
    mkdir new-folder
    ```

    Commands execute in your specified working directory.

  </Card>
</CardGroup>

### Managing Local Processes

<Steps>
  <Step title="Start Processes">
    Launch local servers, build processes, or any long-running tasks:

    ```
    npm start
    python manage.py runserver
    docker-compose up
    ```

  </Step>

  <Step title="Monitor Output">
    View real-time stdout and stderr output from the running process directly in Factory.
  </Step>

  <Step title="Interact with Processes">
    Send input to running processes as needed, such as responding to prompts or entering commands.
  </Step>

  <Step title="Terminate Processes">
    Easily stop processes when you're done or need to restart them.
  </Step>
</Steps>

### Development Workflow Integration

<AccordionGroup>
  <Accordion title="Local Server Development">
    Run a local development server and interact with it directly through Factory:

    1. Start your development server via Factory Bridge
    2. Make code changes in Factory
    3. See real-time output from your server
    4. Test your changes without switching contexts

  </Accordion>

  <Accordion title="Build and Test Processes">
    Run build processes, test suites, and CI tasks locally:

    1. Execute build commands through Factory
    2. Review build output in real-time
    3. Run tests and analyze results
    4. Fix issues without leaving Factory

  </Accordion>

  <Accordion title="Environment Setup">
    Configure development environments directly from Factory:

    1. Create and activate virtual environments
    2. Install dependencies
    3. Set up configuration files
    4. Initialize projects

  </Accordion>
</AccordionGroup>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Connection Issues">
    If Factory can't connect to Bridge:

    1. Ensure Factory Bridge is running (check your system tray)
    2. Verify you've entered the correct pairing code
    3. Restart Factory Bridge and try again
    4. Check if you have too many sessions open (current limit is 6 concurrent connections)

  </Accordion>

  <Accordion title="Missing Tool Options">
    If CLI tools don't appear in Factory:

    1. Make sure the MCP Bridge feature flag is enabled
    2. Refresh your Factory session
    3. Check that you're using Droid Mode in the model selection dropdown

  </Accordion>

  <Accordion title="Process Management Issues">
    If you encounter issues with process execution:

    1. Ensure you have the necessary permissions to run the command
    2. Check that required dependencies are installed
    3. Verify the working directory exists and is accessible
    4. Use absolute paths instead of relative paths for greater reliability

  </Accordion>
</AccordionGroup>

## Security Considerations

Factory Bridge establishes a secure local connection between your machine and Factory. Here's what you should know:

- Bridge runs only on your local machine and doesn't expose your system to the internet
- All commands are executed with your user permissions only
- The pairing code ensures only authorized Factory sessions can connect
- You maintain full control over which processes are executed

<Card title="Learn More About Factory Security" icon="shield-check" href="/cli/account/security">
  Explore Factory's comprehensive security measures and compliance standards
</Card>
</file>

<file path="docs/web/machine-connection/factory-bridge/model-context-protocol.mdx">
---
title: Model Context Protocol (MCP)
description: Extend Factory's capabilities with custom tools and data sources using Model Context Protocol
---

## What is MCP?

The [Model Context Protocol (MCP)](https://modelcontextprotocol.io/introduction) is an open protocol that standardizes how applications provide context and tools to LLMs. With MCP, you can extend Factory's capabilities by connecting it to various data sources and tools through standardized interfaces.

## Configuring MCP Servers

Factory supports MCP through Factory Bridge, which runs MCP servers on your local machine and makes their tools available to Factory.

### Configuration Process

To set up MCP servers with Factory:

1. Install [Factory Bridge](/web/machine-connection/factory-bridge/installation-and-usage) if you haven't already
2. Configure your MCP servers in the configuration file (details below)
3. Factory Bridge will automatically detect and load your MCP servers
4. The tools provided by your MCP servers will become available in Factory

## Accessing the MCP Configuration File

The easiest way to access and edit your MCP configuration is through the Factory Bridge system tray icon:

1. Locate the Factory Bridge icon in the system tray (menu bar on macOS, notification area on Windows)
2. Click on the icon to open the context menu
3. Select **"Open MCP Config File"** from the menu options

![Bridge Menu](/images/tutorial/bridge-menu-mcp.png)

This will open the configuration file in your default text editor. If the file doesn't exist yet, Factory Bridge will automatically create it with an empty default configuration.

For reference, the configuration file is stored at:

- **macOS**: `~/Library/Application Support/Factory Bridge/mcp.json`
- **Windows**: `%APPDATA%\Factory Bridge\mcp.json`

## Server Types

Factory Bridge supports two types of MCP servers:

### Stdio Servers

Stdio servers run as local processes and communicate via standard input/output streams. These are ideal for:
- Local tools and utilities
- File system operations
- Development and testing environments
- Servers that need direct access to your machine

### Streamable HTTP Servers

Streamable HTTP servers are remote endpoints accessed via HTTP/HTTPS URLs. These are ideal for:
- Cloud-hosted MCP services
- Shared team resources (like documentation servers)
- External APIs and services
- Servers that don't require local installation

## Configuration Format

The MCP configuration file uses JSON format. The structure varies based on the server type.

### Stdio Server Configuration

```json
{
  "mcpServers": {
    "server-name": {
      "type": "stdio",
      "command": "executable",
      "args": ["arg1", "arg2"],
      "env": {
        "ENV_VAR1": "value1",
        "ENV_VAR2": "value2"
      },
      "disabled": false
    }
  }
}
```

### Streamable HTTP Server Configuration

```json
{
  "mcpServers": {
    "server-name": {
      "type": "http",
      "url": "https://api.example.com/mcp",
      "headers": {
        "Authorization": "Bearer token",
        "X-API-Key": "secret"
      },
      "disabled": false
    }
  }
}
```

### Configuration Fields

**Common fields:**
- `mcpServers`: An object containing named server configurations
- `type`: Server type - either `"stdio"` or `"http"` (required)
- `disabled`: Optional boolean to temporarily disable a server without removing it

**Stdio server fields:**
- `command`: The executable to run (required)
- `args`: Array of command-line arguments (required)
- `env`: Optional environment variables to pass to the server

**Streamable HTTP server fields:**
- `url`: The HTTP/HTTPS endpoint URL (required)
- `headers`: Optional HTTP headers for authentication or other purposes

### Example Configuration

Here's an example configuration with multiple MCP servers, showing both stdio and Streamable HTTP servers:

```json
{
  "mcpServers": {
    "factory-docs": {
      "type": "http",
      "url": "https://docs.factory.ai/mcp"
    },
    "google-maps": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-google-maps"],
      "env": {
        "GOOGLE_MAPS_API_KEY": "your-api-key-here"
      }
    },
    "firecrawl": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "firecrawl-mcp"],
      "env": {
        "FIRECRAWL_API_KEY": "fc-****************************"
      }
    },
    "slack": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-slack"],
      "env": {
        "SLACK_BOT_TOKEN": "xoxb-******************",
        "SLACK_TEAM_ID": "T********"
      },
      "disabled": true
    }
  }
}
```

In this example:
- The `factory-docs` server is a Streamable HTTP server that provides access to Factory documentation
- The `google-maps` server is a stdio server that provides tools for interacting with Google Maps
- The `firecrawl` server is a stdio server enabled and configured with an API key
- The `slack` server is a stdio server that is disabled (it won't be loaded) but its configuration is preserved for future use

## Automatic Configuration Updates

Factory Bridge automatically detects changes to the MCP configuration file in real-time. When you modify the `mcp.json` file:

1. Factory Bridge detects the changes immediately
2. It identifies which servers need to be stopped, started, or restarted
3. It applies the changes without requiring a restart of the application
4. New servers and tools are automatically made available in Factory

This allows you to add, modify, or remove MCP servers without restarting Factory Bridge. Simply edit the configuration file, save your changes, and the new tools will be available in Factory.

## Disabling Servers

The `disabled` field allows you to temporarily disable a server without removing its configuration. This is useful for:

- Troubleshooting issues by selectively enabling/disabling servers
- Maintaining configurations for servers you only use occasionally
- Testing different server configurations

When a server is disabled, Factory Bridge will skip loading it but keep its configuration in the file for future use.

To disable a server, simply add `"disabled": true` to its configuration:

```json
"slack": {
  "command": "npx",
  "args": ["-y", "@modelcontextprotocol/server-slack"],
  "env": {
    "SLACK_BOT_TOKEN": "xoxb-******************",
    "SLACK_TEAM_ID": "T********"
  },
  "disabled": true
}
```

To re-enable it, either remove the `disabled` field or set it to `false`.

## Using MCP Tools in Factory

Once your MCP servers are configured and running, Factory will automatically detect the available tools and make them available for use.

When using Factory, it will intelligently determine when to use MCP tools based on your requests. You can also explicitly ask Factory to use a specific tool by referring to it by name.

## Windows Troubleshooting ‚Äì `npx` Execution

Running MCP servers via `npx` works out-of-the-box on macOS / Linux, but Windows users may encounter issues when trying to execute `npx` commands.

**Why it happens:**  
On Windows, `npx` is a script (`npx.cmd` / `npx.ps1`), not an executable. MCP stdio servers launch without shell access, so Windows cannot run the script directly.

### Quick Fix ‚Äì wrap the call with `cmd /c`

```json
{
  "mcpServers": {
    "slack": {
      "command": "cmd",
      "args": [
        "/c",
        "npx",
        "<your_mcp_command_here>"
      ],
    }
  }
}
```

## What's New

‚úÖ **Streamable HTTP Transport Support**: You can now connect to remote MCP servers over HTTP/HTTPS! Use Streamable HTTP servers to access cloud-hosted MCP services, documentation servers, and shared team resources without local installation.

## Coming Soon

We're actively working on expanding MCP support with these upcoming features:

1. **Image Tool Support**: Support for tools that return image outputs.

2. **Configuration UI**: A dedicated UI for MCP configuration with error reporting and server status monitoring.

## Resources

For more information about MCP and available servers:

- [Model Context Protocol Documentation](https://modelcontextprotocol.io)
- [Awesome MCP servers repository](https://github.com/punkpeye/awesome-mcp-servers)
- [Awesome MCP servers org page](https://mcpservers.org/)
- [Building Custom MCP Servers](https://modelcontextprotocol.io/quickstart/server)
</file>

<file path="docs/web/machine-connection/factory-bridge/troubleshooting.mdx">
---
title: Factory Bridge Troubleshooting
description: Solutions to common issues and problems encountered when using Factory Bridge
---

This guide helps you troubleshoot common issues that may arise when using Factory Bridge. Follow these steps to identify and resolve problems quickly.

## Connection Issues

### Bridge Not Connecting to Factory

<Steps>
  <Step title="Verify Bridge is Running">
    First, check if Factory Bridge is running on your system:

    - Look for the Factory Bridge icon in your system tray or menu bar
    - If not visible, try launching Factory Bridge again from your applications folder

  </Step>

  <Step title="Check Pairing Code">
    Verify you've entered the correct pairing code:

    - The pairing code should be 6 digits
    - Make sure you're using the most recent code shown in Factory
    - Try generating a new pairing code in Factory

  </Step>

  <Step title="Restart Factory Bridge">
    If the connection still fails:

    - Right-click the Factory Bridge icon in your system tray
    - Select "Quit"
    - Launch Factory Bridge again
    - Enter the pairing code when prompted

  </Step>

  <Step title="Check Session Limit">
    Factory Bridge currently supports up to 6 concurrent connections:

    - Close some Factory tabs if you have many open
    - Try connecting from a new Factory session

  </Step>
</Steps>

<Note>
  If you've recently updated Factory Bridge, you may need to restart your computer for all changes to take effect.
</Note>

### Connection Drops Unexpectedly

<AccordionGroup>
  <Accordion title="Network Issues">
    Network connectivity problems can cause connection drops:

    1. Check your internet connection
    2. Ensure your firewall isn't blocking Factory Bridge
    3. If using a VPN, verify it's not interfering with the connection
    4. Try switching to a different network if possible

  </Accordion>

  <Accordion title="System Sleep/Hibernation">
    System sleep or hibernation can disconnect Factory Bridge:

    1. Check your system's power settings
    2. Adjust sleep settings to prevent disconnections during active use
    3. Reconnect Factory Bridge after waking your computer

  </Accordion>

  <Accordion title="Factory Bridge Crashed">
    If Factory Bridge has crashed:

    1. Check if the Factory Bridge icon is still in your system tray
    2. If not, relaunch Factory Bridge
    3. Check system logs for error messages
    4. If crashes persist, try reinstalling Factory Bridge

  </Accordion>
</AccordionGroup>

## Command Execution Problems

### Commands Not Executing

<Steps>
  <Step title="Verify CLI Tools Are Available">
    Make sure you can see the CLI tools in Factory:

    1. Ensure you're using Droid Mode (select from the model dropdown)
    2. Check if the MCP Bridge feature flag is enabled
    3. Refresh your Factory session

  </Step>

  <Step title="Check Command Format">
    Ensure your commands are formatted correctly:

    1. Verify the syntax of your commands
    2. Check that you're providing all required parameters
    3. Make sure paths don't contain special characters that need escaping

  </Step>

  <Step title="Check Working Directory">
    Ensure the specified working directory exists and is accessible:

    1. Try using an absolute path instead of a relative path
    2. Verify you have permission to access the directory
    3. Check for typos in the directory path

  </Step>
</Steps>

### Command Returns Error

<AccordionGroup>
  <Accordion title="Command Not Found">
    If you see "command not found" errors:

    1. Verify the command is installed on your system by trying it directly in a terminal
    2. Check if the command is in your system PATH
    3. Use the full path to the executable instead of just the command name
    4. For environment-specific commands, ensure you're running in the correct environment

  </Accordion>

  <Accordion title="Permission Denied">
    If you see "permission denied" errors:

    1. Check if you have permission to run the command
    2. For scripts, ensure they have executable permissions (`chmod +x script.sh`)
    3. Verify you have access to any files or directories the command is trying to access
    4. For operations requiring elevated privileges, you may need to use `sudo` (with caution)

  </Accordion>

  <Accordion title="Incorrect Working Directory">
    If the command is running in the wrong location:

    1. Specify an absolute path for the working directory
    2. Verify the directory exists before running the command
    3. Use `pwd` command to check the current working directory

  </Accordion>
</AccordionGroup>

## Process Management Issues

### Can't Find Process ID (PID)

<Steps>
  <Step title="Locate Process Information">
    When a process is started through Factory Bridge, the PID is returned in the response:

    ```json
    {
      "pid": 12345
    }
    ```

    Look for this information in Factory's response after starting a process.

  </Step>

  <Step title="Check If Process Is Still Running">
    Verify if the process is still running:

    ```
    ps -p 12345
    ```

    If the process has already terminated, you'll need to start a new one.

  </Step>
</Steps>

### Process Terminates Unexpectedly

<AccordionGroup>
  <Accordion title="Application Error">
    The application may have encountered an error:

    1. Check the output for error messages
    2. Run the command with verbose or debug flags if available
    3. Try running the command directly in a terminal to see if it behaves differently

  </Accordion>

  <Accordion title="Resource Limitations">
    The process might be terminating due to resource constraints:

    1. Check if your system has sufficient memory and CPU
    2. Look for "out of memory" errors in the output
    3. Consider closing other applications to free up resources

  </Accordion>

  <Accordion title="Dependency Issues">
    Missing or incompatible dependencies can cause processes to terminate:

    1. Verify all required dependencies are installed
    2. Check version compatibility
    3. Look for dependency-related errors in the output

  </Accordion>
</AccordionGroup>

## Installation Issues

### Installation Fails

<AccordionGroup>
  <Accordion title="Insufficient Permissions">

    You may not have sufficient permissions to install Factory Bridge. On macOS, make sure you have permission to install applications

  </Accordion>

  <Accordion title="System Incompatibility">

    Your system may not meet the requirements:

    1. Check that your operating system version is supported
    2. Verify your system meets the minimum requirements
    3. Look for specific error messages that might indicate compatibility issues

  </Accordion>
</AccordionGroup>

### Factory Bridge Won't Start

<Steps>
  <Step title="Check System Resources">
    Ensure your system has sufficient resources:

    1. Check available memory and disk space
    2. Close unnecessary applications
    3. Restart your computer to free up resources

  </Step>

  <Step title="Look for Error Messages">
    Check for error messages:

    1. Look for error dialogs when launching Factory Bridge
    2. Check system logs for error messages
    3. On macOS, check Console.app for related errors
    4. On Windows, check Event Viewer for application errors

  </Step>

  <Step title="Reinstall Factory Bridge">
    If all else fails, try reinstalling:

    1. Uninstall Factory Bridge completely
    2. Download a fresh copy of the installer
    3. Install Factory Bridge again
    4. Restart your computer after installation

  </Step>
</Steps>

## Feature Availability Issues

### Missing CLI Tools

<AccordionGroup>
  <Accordion title="Terminal toolkit is not enabled">
    Terminal tools are only available in Droid Mode:

    1. Open the "Toolkits" selector inside of the chatbox input
    2. Select the "Terminal" toolkit
    3. Retry an existing message or send a new one

  </Accordion>

  <Accordion title="Version Mismatch">
    Your Factory Bridge version may not be compatible with the Factory platform:

    1. Check for Factory Bridge updates
    2. Download and install the latest version
    3. Restart Factory Bridge after updating

  </Accordion>
</AccordionGroup>

### Session Limit Reached

<Steps>
  <Step title="Understand the Limit">
    Factory Bridge currently supports up to 6 concurrent connections due to network protocol limitations.
  </Step>

  <Step title="Close Unused Sessions">
    If you've reached the limit:

    1. Close unused Factory tabs or sessions
    2. Wait a few minutes for connections to fully close
    3. Try connecting again with a new session

  </Step>

  <Step title="Restart Factory Bridge">
    If closing sessions doesn't help:

    1. Restart Factory Bridge completely
    2. This will reset all connections
    3. Reconnect with your most important session first

  </Step>
</Steps>

## Advanced Troubleshooting

### Check Factory Bridge Logs

<AccordionGroup>
  <Accordion title="Locating Log Files">
    Factory Bridge logs can provide valuable troubleshooting information:

    - **macOS**: Look in `~/Library/Logs/Factory\ Bridge`

    Look for files named `bridge-YYYY-MM-DD.log` or similar.

  </Accordion>

  <Accordion title="Share Logs">
    If you run into an issue not described above, please share the contents of your log files with our support team.
  </Accordion>
</AccordionGroup>

### Reset Factory Bridge

If you're experiencing persistent issues, you can try resetting Factory Bridge:

<Steps>
  <Step title="Quit Factory Bridge">
    First, completely close Factory Bridge:

    1. Right-click the Factory Bridge icon in your system tray
    2. Select "Quit" or "Exit"
    3. Verify the application has fully closed

  </Step>

  <Step title="Clear Configuration">
    Clear Factory Bridge configuration files: Delete `~/Library/Application Support/Factory Bridge`

  </Step>

  <Step title="Restart Factory Bridge">
    Restart Factory Bridge:

    1. Launch Factory Bridge from your applications folder
    2. You'll be prompted to enter a new pairing code
    3. Enter the pairing code from Factory

  </Step>
</Steps>

## Getting Additional Help

If you're still experiencing issues after trying these troubleshooting steps, here are some ways to get additional help:

<CardGroup cols={2}>
  <Card title="Report an Issue" icon="bug">
    Report bugs or issues with Factory Bridge:

    1. Gather relevant error messages and logs
    2. Take screenshots of the issue if applicable
    3. Document the steps to reproduce the problem
    4. Contact Factory support with this information at support@factory.ai

  </Card>
</CardGroup>

<Card title="Factory Bridge CLI Tools Reference" icon="book" href="/web/machine-connection/factory-bridge/cli-tools-reference">
  For detailed information on all available CLI tools, refer to the Factory Bridge CLI Tools Reference
</Card>
</file>

<file path="docs/web/machine-connection/remote-workspaces/best-practices.mdx">
---
title: Remote Workspaces - Best Practices
description: Proven tips and workflows to get the most out of remote workspaces in Factory
---

Remote workspaces let you spin up consistent, production-ready development environments in seconds. Below are field-tested practices that keep workspaces fast, predictable, and team-friendly.

## 1. Smart Setup Script Practices

| Practice                           | Why it matters                                        | How to do it                                                                                          |
| ---------------------------------- | ----------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| **Order commands by dependency**   | Later commands may depend on earlier installs.        | Run package installation first: `npm ci && npm run build` or `pip install -r requirements.txt && pytest -q` |
| **Use exact package managers**     | Consistent lockfiles prevent version drift.           | Use `npm ci` (not `npm install`), `pnpm -w i`, or `pip install -r requirements.txt` for reproducible builds |
| **Add error handling**             | Stops build on first failure, saves debugging time.   | Start your script with `#!/usr/bin/env bash` and `set -euo pipefail` for proper error handling |
| **Make scripts executable early**  | Avoid permission errors mid-build.                    | Add `chmod +x ./scripts/setup.sh && bash ./scripts/setup.sh` or use `bash ./scripts/setup.sh` directly |
| **Keep scripts idempotent**        | Re-running setup shouldn't break things.              | Use flags like `pip install --no-deps` or check for existing files before creating them |
| **Minimize heavy operations**      | Long builds slow down workspace creation.             | Focus on essential setup; defer optional tools to manual installation later |

> **Tip:** Test your setup script locally first. The script runs with `bash` at the repo root, and you can add `set -euo pipefail` for strict error handling.


---

## 2. Workflow Patterns That Scale

<AccordionGroup>

  <Accordion title="Spin-Up-Per-Task">
    Treat remote sessions as disposable: create one per ticket or PR, then archive when merged.  
    **Benefits:** perfect isolation, zero ‚Äúworks on my machine‚Äù drift.
  </Accordion>

  <Accordion title="Parallel Environments">
    Need to test multiple branches? Launch two separate sessions; switch context without killing processes.
  </Accordion>

</AccordionGroup>

---

## 3. Team Collaboration Tips

| Tip                         | Details                                                                                                             |
| --------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| **Name workspaces clearly** | Name workspaces according to the tracked repository, e.g. `factory-mono` to work on the `factory-mono` GitHub repo. |
| **Document entry commands** | Add an `AGENTS.md` file with common tasks (`npm run dev`, `pytest`). Droid automatically reads this file.           |

## 5. Troubleshooting at a Glance

| Symptom                      | Resolution                                                                   |
| ---------------------------- | ---------------------------------------------------------------------------- |
| **Rebuild is slow**          | Verify `.dockerignore`, cache heavy installs in image, use lighter base.     |
| **Git asks for credentials** | Ensure repository integration is enabled in **Integrations ‚Üí Repositories**. |
| **Out-of-disk errors**       | Prune package caches (`npm cache clean --force`) or rebuild workspace.       |

Following these practices keeps your remote workspaces fast, secure, and collaborative‚Äîso you can focus on shipping code, not configuring machines.
</file>

<file path="docs/web/machine-connection/remote-workspaces/index.mdx">
---
title: Remote Workspaces
description: Spin-up instant, cloud-hosted workspaces that mirror your local dev setup. No install required
---

Remote workspaces let you code **anywhere** without the ‚Äúworks on my machine‚Äù dance. Each workspace is a pre-configured environment that lives in the cloud, boots in seconds and can be customized to run setup commands.
## Why use remote workspaces?

| Benefit           | What it means for you                                                                                   |
| ----------------- | ------------------------------------------------------------------------------------------------------- |
| **Zero setup**    | Open a session and start coding; no local installs or VM juggling.                                       |
| **Consistency**   | Every teammate (and CI job) runs the _exact_ same environment.                                          |
| **Speed**         | Heavy builds run on powerful cloud CPUs; your laptop fan stays silent.                                  |
| **Isolation**     | Experiments live in disposable workspaces, keeping your local machine clean.                            |
| **Collaboration** | Share a workspace link; reviewers jump into the _live_ environment with code and ports already running. |

## Get Started

<CardGroup cols={2}>

  <Card title="1 ¬∑ Create a Workspace" icon="rocket" href="/web/machine-connection/remote-workspaces/installation-and-usage">
    Use the **Settings ‚Üí Session** page to spin up a new remote workspace from your repository.
  </Card>


  <Card title="2 ¬∑ Add setup script" icon="toolbox" href="/web/machine-connection/remote-workspaces/setup-script">
    Configure a setup script to run during workspace creation.
  </Card>

  <Card title="3 ¬∑ Follow Best Practices" icon="lightbulb" href="/web/machine-connection/remote-workspaces/best-practices">
    Optimize performance, cost, and team workflows with proven tips.
  </Card>

  <Card title="4 ¬∑ Troubleshoot Like a Pro" icon="bug" href="/web/machine-connection/remote-workspaces/troubleshooting">
    Quickly resolve provisioning, connection issues.
  </Card>

</CardGroup>

---

### More to Explore

- [**Installation & Usage** ‚Äì step-by-step setup guide](/web/machine-connection/remote-workspaces/installation-and-usage)

- [**Best Practices** ‚Äì performance, cost, collaboration](/web/machine-connection/remote-workspaces/best-practices)

- [**Troubleshooting** ‚Äì common fixes & FAQs](/web/machine-connection/remote-workspaces/troubleshooting)

Ready? Head to **Settings ‚Üí Workspaces** and launch your first remote workspace. Happy coding!
</file>

<file path="docs/web/machine-connection/remote-workspaces/installation-and-usage.mdx">
---
title: Remote Workspaces ‚Äì Installation & Usage
description: Set up, connect to, and use Remote Workspaces inside Factory sessions
---

A **remote workspace** is a fully-configured, on-demand development environment that lives in the cloud. Remote workspaces give you the same tools and dependencies you'd expect locally, so you can build, test, and run code directly from Factory.

<Note>
  To get the most out of remote workspaces, configure environment variables and a setup script during workspace creation. The setup script installs dependencies and prepares your development environment automatically, ensuring every team member has an identical setup.
</Note>

## System Requirements

- A repository enabled in Factory
- Manager role or higher to create remote workspaces

<Steps>

  <Step title="Open Session Settings">
    1. In Factory, click the **Settings** icon from the left sidebar.  
    2. Select **Session**.
    3. Scroll down to **Remote Workspaces**.
  </Step>

  <Step title="Create a New Remote Workspace">
    1. Click **Create Workspace**.  
    2. Enter the repository you want to use.  
    3. Give your workspace a friendly name (e.g., ‚Äúfrontend-workspace‚Äù).  
    4. (Optional) Configure a setup script to run during workspace initialization.
    5. Click **Create**.
    <Note>
      Factory clones your repo and prepares the environment‚Äîthis can take a minute for large projects.
    </Note>
  </Step>

  <Step title="Verify Workspace Ready">
    The new workspace appears in the list with a status indicator. Once it shows **Ready**, you can use it from any session.
  </Step>

</Steps>

---

## Launching a Remote Workspace inside a Session

<Steps>

  <Step title="Open or Start a Session">
    Join any Factory session as usual.
  </Step>

  <Step title="Connect to Cloud Machine">
    1. On the session start page, click the Machine Connection button. 
    2. Choose **Remote** tab.  
    3. Select the workspace you created earlier.  
    4. Factory attaches the remote workspace to your session.

    <Frame>
    ![machine-connection-start.gif](/images/web/machine-connection-start.gif)
    </Frame> 
  </Step>

  <Step title="Confirm Connection">
    A green indicator and remote working directory appear on the top-right next to your profile dropdown menu. You‚Äôre now interacting with the cloud workspace.
  </Step>

</Steps>

---

## Everyday Usage

<CardGroup cols={2}>

  <Card title="Run CLI Commands" icon="terminal">
    Use the **Terminal** toolkit to execute commands like:
    <pre>npm run dev
pytest
git status</pre>
    Output streams live into chat and logs.
  </Card>

  <Card title="Edit & Save Files" icon="file-code">
    Open files from the repo, make changes, and save.  
    Files persist in the remote workspace and can be committed upstream when ready.
  </Card>

  <Card title="Auto-Save Controls" icon="save">
    Auto-save is disabled by default‚Äîenable it from the **Session Settings** panel whenever you want live file syncing.
  </Card>

</CardGroup>

---

## Troubleshooting & Help

<AccordionGroup>

  <Accordion title="Can't connect from session">
    Ensure you:  
    1. Selected **Remote Machine** (not Local).  
    2. Refresh the page, or try again in a different session
  </Accordion>

</AccordionGroup>

<Card title="Need More Help?" icon="life-ring" href="/web/machine-connection/remote-workspaces/troubleshooting">
  Visit the full Remote Workspace Troubleshooting Guide
</Card>
</file>

<file path="docs/web/machine-connection/remote-workspaces/setup-script.mdx">
---
title: Remote Workspaces ‚Äì Setup Script
description: Configure a setup script to run during workspace creation
---

The setup script is a shell script that Factory runs during workspace creation, after your repository is cloned and before the workspace is activated. Use this feature to set up your workspace and give droid tools to work with your codebase.

## 1. How to define a setup script

1. In the modal for workspace creation, in the "Setup Script (Optional)" section, add your initialization script. You can write a multi-line bash script with all the commands you need.
2. Submit. The script runs in the repo root with bash strict mode (consider using `set -euo pipefail` at the start of your script). Script failures will stop the build.
3. Keep your script non‚Äëinteractive and idempotent. Write commands that can be safely re-run.
4. Review build logs if anything fails to see detailed output from your script execution.

Examples:

**Node.js (Next.js):**
```bash
#!/usr/bin/env bash
set -euo pipefail

npm ci
npm run build
```

**PNPM monorepo:**
```bash
#!/usr/bin/env bash
set -euo pipefail

pnpm -w i
pnpm -w build
```

**Python:**
```bash
#!/usr/bin/env bash
set -euo pipefail

pip install -r requirements.txt
pytest -q
```

**Multi-language project:**
```bash
#!/usr/bin/env bash
set -euo pipefail

# Install Node.js dependencies
npm ci

# Install Python dependencies
pip install -r requirements.txt

# Run setup script
bash ./scripts/setup.sh
```

What happens under the hood:
- The script executes after repository cloning, inside the build container at the repo root.
- Environment variables specified in workspace settings are available during script execution.
- Errors are surfaced clearly (e.g., `Setup script failed: ...`) for quick fixes.

## 2. Troubleshooting Tips

| Issue | Fix |
|---|---|
| Setup fails with "Setup script failed: ‚Ä¶" | Check the build logs for specific error messages. Run the script locally to debug, add error handling, use non‚Äëinteractive flags (e.g., `-y`), then retry. |
| Command not found | Install required tools earlier in your script or ensure they're available in the base Ubuntu image. |
| Permission denied (scripts) | Make scripts executable (`chmod +x ./scripts/setup.sh`) or invoke via interpreter (`bash ./scripts/setup.sh`). |
| Env var not found | Add it in Environment Variables section and reference as `$VAR`. Avoid echoing secrets in your script. |
| Long builds | Keep your script minimal; prefer cached installs (`npm ci` over `npm install`); avoid heavy, non‚Äëessential work. |
| Path/file not found | Scripts run at the repo root. Verify relative paths and that files exist after clone. |
</file>

<file path="docs/web/machine-connection/remote-workspaces/troubleshooting.mdx">
---
title: Remote Workspaces ‚Äì Troubleshooting
description: Diagnose and resolve common problems when creating, connecting to, or working inside a remote workspace
---

Even the smoothest remote workspace can hit a snag. This guide walks you through the quickest fixes for the most common remote workspace issues.

## Quick Reference

| Category               | Typical Symptoms                                                              |
| ---------------------- | ----------------------------------------------------------------------------- |
| **Workspace Creation** | ‚ÄúProvisioning‚Äù forever, cloning errors, setup script fails             |
| **Connection**         | Can‚Äôt attach from session, pairing spinner never stops, ‚ÄúMachine unavailable‚Äù |
| **Performance**        | Slow rebuilds, high latency in terminal, laggy editor                         |
| **Devcontainer**       | Build errors, ‚Äúcommand not found‚Äù, ports not reachable                        |
| **General Usage**      | Git asks for credentials, disk full, permission denied                        |

---

## 1. Workspace Creation Issues

<AccordionGroup>

  <Accordion title="Repository clone failed">
    **Diagnose**  
    - Error toast shows *‚Äúclone failed‚Äù* with a Git exit code  
    - Private repo? Missing OAuth scopes?

    **Resolve**
    1. Verify the repo is enabled and displays **Connected** in Integrations
    2. Refresh your OAuth token if prompted

  </Accordion>

</AccordionGroup>

---

## 2. Connection Problems

<Steps>

  <Step title="Check Machine Selector">
    In your session, click the **CPU** icon ‚Üí ensure **Cloud Machine** is selected.  
    If it shows **Local Machine**, switch to **Cloud Machine** and pick the workspace.
  </Step>

  <Step title="Browser & Network">
    - Use **Chrome** or **Edge** (other browsers may block WebSocket upgrades).  
    - Disable VPN/proxy to rule out WebSocket filtering.  
    - Reload the session tab (‚åòR / Ctrl-R).
  </Step>

</Steps>

---

## 3. Performance & Speed

| Symptom                   | Fix                                                                                                                              |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| **Rebuild takes > 5 min** | Add `.dockerignore` for `node_modules`, `*.pyc`, build outputs‚Ä¢ Use a lighter base image (e.g., alpine)                        |
| **Terminal latency**      | Close unused browser tabs with heavy JS‚Ä¢ Check local bandwidth (>5 Mbps recommended)‚Ä¢ Pause real-time spell-checker extensions |
| **Editor lag**            | Disable file watchers in dev tools (`nodemon`, `webpack --watch`) unless needed‚Ä¢ Use auto-save only when collaborating         |

---

## 4. General Usage Troubles

| Issue                              | Resolution                                                                                                               |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| **Git prompts for credentials**    | Make sure the repo integration is connected; remote workspace injects HTTPS tokens automatically.                        |
| **Disk quota exceeded**            | Clear package caches (`npm cache clean --force`, `pip cache purge`), remove large build artifacts, or rebuild workspace. |
| **Permission denied on file save** | File is outside the repo workspace; save inside `/workspaces/&lt;repo&gt;/`.                                             |
| **Cannot install global packages** | Use `npm install -g` or `pip install --user`. If still blocked, add commands to `postCreateCommand`.                     |
| **History lost after rebuild**     | Anything outside `/workspaces` is cleared during rebuild. Commit important scripts or store them inside the repo.        |

---

## Need More Help?

- **Best Practices** ‚Äì Optimize performance with the [Remote Workspace Best Practices guide](/web/machine-connection/remote-workspaces/best-practices)
- **Support** ‚Äì Reach out in your Factory support channel with workspace ID and error message

> A quick rebuild fixes 80 % of issues‚Äîdon‚Äôt hesitate to click **Rebuild** when in doubt.
</file>

<file path="docs/welcome/index.mdx">
---
title: "Welcome to Factory"
description:
---

Factory is an AI-native software development platform that works everywhere you do. From IDE to CI/CD - delegate complete tasks like refactors, incident response, and migrations to Droids without changing your tools, models, or workflow.

<img
  src="/images/product-image.png"
  alt="Droid in IDE"
  style={{ width: '100%', height: 'auto' }}
  className="rounded-lg"
/>

## Why us?

* **Model-agnostic:** use OpenAI, Anthropic, Google, X AI, open-source or local models.
* **Context-confidence:** compresses incrementally with anchor points for near-perfect context.
* **Specification mode:** detailed implementation, technical details and mixed model support.
* **Enterprise-ready:** SSO + SAML, dedicated compute, compliance & security and more.

## Get started in 5 minutes

<CardGroup cols={2}>
      <Card title="CLI" icon="square-terminal" href="/cli/getting-started/quickstart">
          Get started with our CLI.
      </Card>
      <Card title="Web" icon="browser" href="/web/getting-started/overview">
          Explore our web interface.
      </Card>
</CardGroup>

## Quick links

<CardGroup cols={2}>
    <Card title="IDE Extension" icon="code" href="/cli/configuration/ide-integrations">
      Use Factory in your favorite IDE.
    </Card>
    <Card title="Changelog" icon="newspaper" href="/changelog/cli-updates">
      Stay up to date with the latest features, improvements, and updates.
    </Card>
    <Card title="Guides" icon="book-open" href="/guides/building/droid-exec-tutorial">
      Learn how to build and automate with Factory.
    </Card>
    <Card title="Discord Community" icon="discord" href="https://discord.gg/zuudFXxg69">
      Join us to get help, share feedback, and connect with other developers.
    </Card>
</CardGroup>
<CardGroup cols={1}>
    <Card title="Support" icon="book" href="mailto:support@factory.ai">
        Need help? Get in touch with our support team.
    </Card>
</CardGroup>
</file>

<file path="docs/convert_md_to_mdx.sh">
#!/bin/bash

# Script to convert all .md files to .mdx (excluding README.md)
# Usage: ./convert_md_to_mdx.sh

# Find all .md files, excluding README.md
md_files=$(find . -name "*.md" | grep -v "README.md")

# Count the files
total_files=$(echo "$md_files" | wc -l)
echo "Found $total_files .md files to convert to .mdx"

# Convert each file
count=0
for file in $md_files; do
    # Create the new filename with .mdx extension
    new_file="${file%.md}.mdx"
    
    # Rename the file
    mv "$file" "$new_file"
    
    # Increment counter
    count=$((count + 1))
    
    # Display progress
    echo "[$count/$total_files] Converted: $file ‚Üí $new_file"
done

echo "Conversion complete! All $count files have been converted from .md to .mdx"
</file>

<file path="docs/docs.json">
{
  "$schema": "https://mintlify.com/docs.json",
  "theme": "willow",
  "name": "Factory Documentation",
  "colors": {
    "primary": "#020202",
    "light": "#f8f8f8",
    "dark": "#020202"
  },
  "styling": {
    "fonts": {
      "body": {
        "family": "Inter"
      },
      "heading": {
        "family": "Inter"
      },
      "mono": {
        "family": "Geist Mono"
      }
    }
  },
  "favicon": "/favicon.svg",
  "navigation": {
    "global": {
      "anchors": [
        {
          "anchor": "GitHub",
          "icon": "github",
          "href": "https://github.com/factory-ai/factory"
        },
        {
          "anchor": "Discord",
          "icon": "discord",
          "href": "https://discord.gg/zuudFXxg69"
        }
      ]
    },
    "tabs": [
      {
        "tab": "Docs",
        "groups": [
          {
            "group": "Welcome",
            "pages": ["welcome/index", "pricing"]
          },
          {
            "group": "CLI",
            "pages": [
                  "cli/getting-started/overview",
                  "cli/getting-started/quickstart",
                  {
                    "group": "Resources",
                    "pages": [
                      "cli/getting-started/video-walkthrough",
                      "cli/getting-started/how-to-talk-to-a-droid",
                      "cli/getting-started/common-use-cases"
                    ]
                  },
                  {
                    "group": "User Guides",
                    "pages": [
                      "cli/user-guides/become-a-power-user",
                      "cli/user-guides/specification-mode",
                      "cli/user-guides/auto-run",
                      "cli/user-guides/choosing-your-model",
                      "cli/user-guides/implementing-large-features"
                    ]
                  },
                  {
                    "group": "Configuration",
                    "pages": [
                      "cli/configuration/custom-slash-commands",
                      "cli/configuration/ide-integrations",
                      "cli/configuration/custom-droids",
                      {
                        "group": "Skills",
                        "pages": [
                          "cli/configuration/skills",
                          {
                            "group": "Cookbook",
                            "pages": [
                              "cli/configuration/skills/frontend-ui-integration",
                              "cli/configuration/skills/service-integration",
                              "cli/configuration/skills/data-querying",
                              "cli/configuration/skills/internal-tools"
                            ]
                          }
                        ]
                      },
                      "cli/configuration/agents-md",
                      "cli/configuration/settings",
                      "cli/configuration/mixed-models",
                      "cli/configuration/mcp",
                      {
                        "group": "Hooks",
                        "pages": [
                          "cli/configuration/hooks-guide",
                          {
                            "group": "Cookbook",
                            "pages": [
                              "cli/configuration/hooks/auto-formatting",
                              "cli/configuration/hooks/code-validation",
                              "cli/configuration/hooks/documentation-sync",
                              "cli/configuration/hooks/git-workflows",
                              "cli/configuration/hooks/logging-analytics",
                              "cli/configuration/hooks/notifications",
                              "cli/configuration/hooks/session-automation",
                              "cli/configuration/hooks/testing-automation"
                            ]
                          }
                        ]
                      },
                      {
                        "group": "Bring Your Own Key",
                        "pages": [
                          "cli/byok/overview",
                          "cli/byok/baseten",
                          "cli/byok/deepinfra",
                          "cli/byok/fireworks",
                          "cli/byok/google-gemini",
                          "cli/byok/groq",
                          "cli/byok/huggingface",
                          "cli/byok/ollama",
                          "cli/byok/openai-anthropic",
                          "cli/byok/openrouter"
                        ]
                      }
                    ]
                  },
                  {
                    "group": "Droid Exec (Headless)",
                    "pages": [
                      "cli/droid-exec/overview",
                      {
                        "group": "Cookbook",
                        "pages": [
                          "cli/droid-exec/cookbook/code-review",
                          "cli/droid-exec/cookbook/refactor-imports",
                          "cli/droid-exec/cookbook/refactor-error-messages",
                          "cli/droid-exec/cookbook/refactor-fix-lint"
                        ]
                      }
                    ]
                  },
                  {
                    "group": "Account",
                    "pages": [
                      "cli/account/security",
                      "cli/account/droid-shield"
                    ]
                  }
                ]
          },
          {
            "group": "Reference",
            "pages": [
              "reference/cli-reference",
              "reference/hooks-reference"
            ]
          },
          {
            "group": "Web Platform",
            "pages": [
              "web/getting-started/overview",
              "web/getting-started/quickstart",
              {
                "group": "Machine Connection",
                "pages": [
                  {
                    "group": "Factory Bridge",
                    "pages": [
                      "web/machine-connection/factory-bridge/installation-and-usage",
                      "web/machine-connection/factory-bridge/cli-tools-reference",
                      "web/machine-connection/factory-bridge/model-context-protocol",
                      "web/machine-connection/factory-bridge/best-practices",
                      "web/machine-connection/factory-bridge/troubleshooting"
                    ]
                  },
                  {
                    "group": "Remote Workspaces",
                    "pages": [
                      "web/machine-connection/remote-workspaces/index",
                      "web/machine-connection/remote-workspaces/installation-and-usage",
                      "web/machine-connection/remote-workspaces/setup-script",
                      "web/machine-connection/remote-workspaces/best-practices",
                      "web/machine-connection/remote-workspaces/troubleshooting"
                    ]
                  }
                ]
              }
            ]
          },
          {
            "group": "Enterprise",
            "pages": [
              "enterprise/index",
              {
                "group": "Architecture & Deployment",
                "pages": [
                  "enterprise/network-and-deployment",
                  "enterprise/models-llm-gateways-and-integrations"
                ]
              },
              {
                "group": "Security & Governance",
                "pages": [
                  "enterprise/identity-and-access",
                  "enterprise/identity-sso-and-scim",
                  "enterprise/privacy-and-data-flows",
                  "enterprise/llm-safety-and-agent-controls",
                  "enterprise/hierarchical-settings-and-org-control",
                  "enterprise/compliance-audit-and-monitoring"
                ]
              },
              {
                "group": "Analytics & Operations",
                "pages": [
                  "enterprise/usage-cost-and-analytics"
                ]
              }
            ]
          }
        ]
      },
      {
        "tab": "Guides",
        "groups": [
          {
            "group": "Building",
            "pages": [
              "guides/building/droid-exec-tutorial",
              "guides/building/droid-vps-setup"
            ]
          }
        ]
      },
      {
        "tab": "Changelog",
        "groups": [
          {
            "group": "Changelog",
            "pages": ["changelog/1-10", "changelog/1-9", "changelog/1-8", "changelog/cli-updates"]
          }
        ]
      }
    ]
  },
  "_hiddenTabs": {},
  "logo": {
    "light": "/logo/light.png",
    "dark": "/logo/dark.svg"
  },
  "topbarLinks": [
    {
      "name": "Guides",
      "url": "/guides/building/droid-exec-tutorial"
    },
    {
      "name": "Changelog",
      "url": "/changelog/1-9"
    }
  ],
  "navbar": {
    "links": []
  },
  "footer": {
    "socials": {
      "github": "https://github.com/factory-ai/factory",
      "discord": "https://discord.gg/zuudFXxg69",
      "twitter": "https://twitter.com/factoryAI",
      "linkedin": "https://www.linkedin.com/company/factory-hq/"
    }
  },
  "contextual": {
    "options": ["copy", "view", "chatgpt", "claude"]
  },
  "integrations": {
    "mixpanel": {
      "projectToken": "f2846cc5dfc8931eb2d1e98383a748e5"
    }
  },
  "redirects": [
    {
      "source": "/release-notes/jun-11-factory-1-1",
      "destination": "/changelog/1-1"
    },
    {
      "source": "/release-notes/jun-24-factory-1-2",
      "destination": "/changelog/1-2"
    },
    {
      "source": "/droids/review_droid/guidelines",
      "destination": "/onboarding/configuring-your-review-droid/review-droid-guidelines"
    },
    {
      "source": "/factory-cli/getting-started/overview",
      "destination": "/cli/getting-started/overview"
    },
    {
      "source": "/factory-cli/getting-started/quickstart",
      "destination": "/cli/getting-started/quickstart"
    },
    {
      "source": "/factory-cli/getting-started/how-to-talk-to-a-droid",
      "destination": "/cli/getting-started/how-to-talk-to-a-droid"
    },
    {
      "source": "/factory-cli/getting-started/common-use-cases",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/factory-cli/user-guides/specification-mode",
      "destination": "/cli/user-guides/specification-mode"
    },
    {
      "source": "/factory-cli/user-guides/auto-run",
      "destination": "/cli/user-guides/auto-run"
    },
    {
      "source": "/factory-cli/user-guides/implementing-large-features",
      "destination": "/cli/user-guides/implementing-large-features"
    },
    {
      "source": "/factory-cli/configuration/ide-integrations",
      "destination": "/cli/configuration/ide-integrations"
    },
    {
      "source": "/factory-cli/configuration/agents-md",
      "destination": "/cli/configuration/agents-md"
    },
    {
      "source": "/factory-cli/configuration/settings",
      "destination": "/cli/configuration/settings"
    },
    {
      "source": "/factory-cli/configuration/byok",
      "destination": "/cli/byok/overview"
    },
    {
      "source": "/cli/configuration/byok",
      "destination": "/cli/byok/overview"
    },
    {
      "source": "/factory-cli/configuration/mcp",
      "destination": "/cli/configuration/mcp"
    },
    {
      "source": "/factory-cli/account/security",
      "destination": "/cli/account/security"
    },
    {
      "source": "/cli/configuration/spec-mode-model",
      "destination": "/cli/configuration/mixed-models"
    },
    {
      "source": "/cli/configuration/cli-reference",
      "destination": "/reference/cli-reference"
    },
    {
      "source": "/cli/configuration/hooks-reference",
      "destination": "/reference/hooks-reference"
    },
    {
      "source": "/cli/reference/cli-reference",
      "destination": "/reference/cli-reference"
    },
    {
      "source": "/cli/reference/hooks-reference",
      "destination": "/reference/hooks-reference"
    },
    {
      "source": "/user-guides/build-with-factory/engineer-system-integrations",
      "destination": "/onboarding/creating-your-factory/basic-integrations"
    },
    {
      "source": "/user-guides/build-with-factory/security-compliance",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/build-with-factory/using-images",
      "destination": "/web/getting-started/overview"
    },
    {
      "source": "/user-guides/droids/creating-custom-droids",
      "destination": "/cli/configuration/custom-droids"
    },
    {
      "source": "/user-guides/droids/understanding-droids",
      "destination": "/cli/getting-started/how-to-talk-to-a-droid"
    },
    {
      "source": "/user-guides/factory-bridge/best-practices",
      "destination": "/web/machine-connection/factory-bridge/best-practices"
    },
    {
      "source": "/user-guides/factory-bridge/cli-tools-reference",
      "destination": "/web/machine-connection/factory-bridge/cli-tools-reference"
    },
    {
      "source": "/user-guides/factory-bridge/installation-and-usage",
      "destination": "/web/machine-connection/factory-bridge/installation-and-usage"
    },
    {
      "source": "/user-guides/factory-bridge/model-context-protocol",
      "destination": "/web/machine-connection/factory-bridge/model-context-protocol"
    },
    {
      "source": "/user-guides/factory-bridge/troubleshooting",
      "destination": "/web/machine-connection/factory-bridge/troubleshooting"
    },
    {
      "source": "/user-guides/get-started/core-concepts",
      "destination": "/cli/getting-started/how-to-talk-to-a-droid"
    },
    {
      "source": "/user-guides/get-started/overview",
      "destination": "/cli/getting-started/video-walkthrough"
    },
    {
      "source": "/user-guides/get-started/quickstart",
      "destination": "/cli/getting-started/quickstart"
    },
    {
      "source": "/user-guides/managing-context/context-retrieval",
      "destination": "/cli/user-guides/become-a-power-user"
    },
    {
      "source": "/user-guides/managing-context/context-types",
      "destination": "/cli/user-guides/become-a-power-user"
    },
    {
      "source": "/user-guides/managing-context/understanding-context",
      "destination": "/cli/user-guides/become-a-power-user"
    },
    {
      "source": "/user-guides/memory/understanding-memory",
      "destination": "/cli/user-guides/become-a-power-user"
    },
    {
      "source": "/user-guides/remote-workspaces",
      "destination": "/web/machine-connection/remote-workspaces"
    },
    {
      "source": "/user-guides/remote-workspaces/best-practices",
      "destination": "/web/machine-connection/remote-workspaces/best-practices"
    },
    {
      "source": "/user-guides/remote-workspaces/custom-commands",
      "destination": "/web/machine-connection/remote-workspaces/setup-script"
    },
    {
      "source": "/user-guides/remote-workspaces/installation-and-usage",
      "destination": "/web/machine-connection/remote-workspaces/installation-and-usage"
    },
    {
      "source": "/user-guides/remote-workspaces/troubleshooting",
      "destination": "/web/machine-connection/remote-workspaces/troubleshooting"
    },
    {
      "source": "/user-guides/sessions-in-factory/chat-interface",
      "destination": "/cli/getting-started/overview"
    },
    {
      "source": "/user-guides/sessions-in-factory/how-to-use-fragments",
      "destination": "/cli/user-guides/specification-mode"
    },
    {
      "source": "/user-guides/sessions-in-factory/sessions",
      "destination": "/cli/getting-started/overview"
    },
    {
      "source": "/user-guides/sessions-in-factory/use-cases",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/threads/Working%20with%20Threads",
      "destination": "/welcome"
    },
    {
      "source": "/user-guides/troubleshooting/repository-issues",
      "destination": "/web/machine-connection/factory-bridge/troubleshooting"
    },
    {
      "source": "/user-guides/usage-and-pricing/understanding-usage",
      "destination": "/enterprise/usage-cost-and-analytics"
    },
    {
      "source": "/user-guides/use-cases/building-internal-tools",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/code-diagrams",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/core-development",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/creating-prds",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/data-science",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/design-to-component",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/documentation",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/migrations",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/user-guides/use-cases/unit-testing",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/core-concepts/context/dynamic-retrieval",
      "destination": "/cli/getting-started/how-to-talk-to-a-droid"
    },
    {
      "source": "/web/core-concepts/context/external-integrations",
      "destination": "/web/machine-connection/factory-bridge/installation-and-usage"
    },
    {
      "source": "/web/core-concepts/context/memory-as-context",
      "destination": "/web/machine-connection/factory-bridge/model-context-protocol"
    },
    {
      "source": "/web/core-concepts/context/understanding-context",
      "destination": "/web/machine-connection/factory-bridge/model-context-protocol"
    },
    {
      "source": "/web/core-concepts/droids/understanding-droids",
      "destination": "/cli/getting-started/how-to-talk-to-a-droid"
    },
    {
      "source": "/web/core-concepts/droids/using-specialized-droids",
      "destination": "/cli/getting-started/how-to-talk-to-a-droid"
    },
    {
      "source": "/web/use-cases/building-internal-tools",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/code-diagrams",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/core-development",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/data-science",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/design-to-component",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/documentation",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/migrations",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/overview",
      "destination": "/cli/getting-started/common-use-cases"
    },
    {
      "source": "/web/use-cases/unit-testing",
      "destination": "/cli/getting-started/common-use-cases"
    }
  ]
}
</file>

<file path="docs/factory-docs-map.mdx">
---
title: "Factory Documentation Map"
description: "A comprehensive map of all Factory documentation pages with their headings for easy LLM navigation"
---

# Factory Documentation Map

This is a comprehensive map of all Factory documentation pages with their headings, designed for easy navigation by LLMs and developers.

> **Note:** This file is auto-generated by GitHub Actions. Do not edit manually.
> Last updated: 2025-11-08 01:58:21 UTC

## Document Structure

This map uses a hierarchical structure:

- **##** marks documentation groups (e.g., 'CLI', 'Web', 'User Guides')
- **###** marks individual documentation pages
- **Nested bullets** show the heading structure within each page
- Each page title links to the full documentation

## Cli

### [Droid Shield](https://docs.factory.ai/cli/account/droid-shield)

- What is Droid Shield?
- How Droid Shield Works
- What Droid Shield Detects
  - Detection Algorithm
- When Droid Shield Activates
- Managing Droid Shield Settings
  - In the CLI
- What to Do if Secrets are Detected
  - Recommended Actions
  - If You Get a False Positive
- Best Practices
- Limitations
- Related Resources
- Need Help?

### [Security](https://docs.factory.ai/cli/account/security)

- Security-First Design
- Key Security Features
- Security Best Practices
  - Essential Security Guidelines
- Built-in Protections
- Enterprise Security
- Need Help?

### [Baseten](https://docs.factory.ai/cli/byok/baseten)

- Configuration
- Getting Started
- Notes

### [DeepInfra](https://docs.factory.ai/cli/byok/deepinfra)

- Configuration
- Getting Started
- Notes

### [Fireworks AI](https://docs.factory.ai/cli/byok/fireworks)

- Configuration
- Getting Started
- Notes

### [Google Gemini](https://docs.factory.ai/cli/byok/google-gemini)

- Configuration
- Getting Started
- Notes

### [Hugging Face](https://docs.factory.ai/cli/byok/huggingface)

- Configuration
- Getting Started
- Notes

### [Ollama](https://docs.factory.ai/cli/byok/ollama)

- Local Ollama
  - Configuration
  - Setup
  - Approximate Hardware Requirements
- Ollama Cloud
  - Recommended Cloud Model
  - Configuration
  - Getting Started with Cloud Models
- Troubleshooting
  - Local server not connecting
  - Model not found
- Notes

### [OpenAI & Anthropic](https://docs.factory.ai/cli/byok/openai-anthropic)

- Configuration
- Getting API Keys
  - Anthropic
  - OpenAI
- Notes

### [OpenRouter](https://docs.factory.ai/cli/byok/openrouter)

- Configuration
- Getting Started
- Notes

### [Overview](https://docs.factory.ai/cli/byok/overview)

- Configuration Reference
  - Supported Fields
- Understanding Providers
- Prompt Caching
  - Verifying Prompt Caching
- Quick Start
- Using Custom Models
- Troubleshooting
  - Model not appearing in selector
  - "Invalid provider" error
  - Authentication errors
  - Local model won't connect
  - Rate limiting or quota errors
- Billing

### [AGENTS.md](https://docs.factory.ai/cli/configuration/agents-md)

- 1 ¬∑ What is **AGENTS.md**?
  - Why AGENTS.md?
  - What it contains:
- 2 ¬∑ One AGENTS.md works across many agents
- 3 ¬∑ File locations & discovery hierarchy
- 4 ¬∑ File structure & syntax
- 5 ¬∑ Common sections
- 6 ¬∑ Templates & examples
  - Factory-style comprehensive example
- Core Commands
- Project Layout
- Development Patterns & Constraints
- Git Workflow Essentials
- Evidence Required for Every PR
  - Node + React monorepo
  - Python microservice
- 7 ¬∑ Best practices
- 8 ¬∑ How agents use AGENTS.md
- 9 ¬∑ When things go wrong
  - Warning signs of agent drift:
  - Recovery playbook:
- 10 ¬∑ Getting started
  - Summary

### [Bring Your Own Key](https://docs.factory.ai/cli/configuration/byok)

- Configuration Reference
  - Supported Fields
- Understanding Providers
- Prompt Caching
  - Verifying Prompt Caching
- Quick Start Examples
  - Bring Your Own OpenAI/Anthropic Keys
  - Access via OpenRouter
  - Fireworks AI
  - Baseten
  - DeepInfra
  - Hugging Face Inference API
  - Ollama (Local and Cloud)
    - Local Ollama
    - Ollama Cloud
  - Connect to Google Gemini
- Using Custom Models
- Troubleshooting
  - Model not appearing in selector
  - "Invalid provider" error
  - Authentication errors
  - Local model won't connect
  - Rate limiting or quota errors
- Billing

### [CLI Reference](https://docs.factory.ai/reference/cli-reference)

- Installation
- CLI commands
- CLI flags
- Autonomy levels
- Available models
- Interactive mode features
  - Bash mode
  - Slash commands
  - MCP command reference
- Authentication
- Exit codes
- Common workflows
  - Code review
  - Testing and debugging
  - Refactoring
  - CI/CD integration
- See also

### [Custom Droids (Subagents)](https://docs.factory.ai/cli/configuration/custom-droids)

- 1 ¬∑ What are custom droids?
- 2 ¬∑ Why use them?
- 3 ¬∑ Quick start
- 4 ¬∑ Configuration
  - Tool categories ‚Üí concrete tools
- 5 ¬∑ Managing droids in the UI
- 5.5 ¬∑ Importing Claude Code subagents
  - How to import
  - What happens during import
  - Example import flow
  - Handling tool validation errors
- 6 ¬∑ Using custom droids effectively
- 7 ¬∑ Examples
  - Code reviewer (project scope)
  - Security sweeper (personal scope)
  - Task coordinator (with live progress)

### [Custom Slash Commands](https://docs.factory.ai/cli/configuration/custom-slash-commands)

- 1 ¬∑ Discovery & naming
- 2 ¬∑ Markdown commands
- 3 ¬∑ Executable commands
- 4 ¬∑ Managing commands
- 5 ¬∑ Usage patterns
- 6 ¬∑ Examples
  - Code review rubric (Markdown)
  - Daily standup helper (Markdown)
  - Regression smoke test (Executable)

### [IDE Integrations](https://docs.factory.ai/cli/configuration/ide-integrations)

- Features
- Installation
  - VS Code
  - JetBrains
- Usage
  - From your IDE
- Troubleshooting
  - VS Code extension not installing
  - JetBrains terminal issues
  - ESC key configuration
  - Common issues
- Next steps

### [Model Context Protocol (MCP)](https://docs.factory.ai/cli/configuration/mcp)

- Adding Servers
  - Adding HTTP Servers
  - Popular HTTP MCP Servers
    - Development & Testing
    - Project Management & Documentation
    - Payments & Commerce
    - Design & Media
    - Infrastructure & DevOps
  - Adding Stdio Servers
  - Popular Stdio MCP Servers
- Removing Servers
- Managing Servers
- Configuration

### [Mixed Models](https://docs.factory.ai/cli/configuration/mixed-models)

- What are mixed models?
- Why use mixed models?
- How to configure mixed models
  - Accessing the Configuration
  - Configuration Options
  - Selecting a Model
- Model Compatibility
  - Compatibility Rules
- Reasoning Effort Configuration
- Common Configurations
  - Anthropic Models
  - OpenAI Models
- How It Works
- Checking Your Configuration
- Clearing your mixed models configuration
- Best Practices
- Troubleshooting
- Related Resources

### [Settings](https://docs.factory.ai/cli/configuration/settings)

- Accessing settings
- Where settings live
- Available settings
  - Model
  - Reasoning effort
  - Autonomy level
  - Diff mode
  - Cloud session sync
  - Sound notifications
- Command allowlist & denylist
  - Example allow/deny configuration
- Example configuration
  - Need more?

### [Automated Code Review](https://docs.factory.ai/cli/droid-exec/cookbook/code-review)

- How it works
- Prerequisites
- Configure authentication
- Build the GitHub Actions workflow
  - Set up the workflow trigger
  - Configure workflow permissions
  - Checkout the repository
  - Install Droid CLI
  - Configure git identity
  - Run the automated review
  - Save artifacts on failure
- Test your reviewer

### [GitHub Actions](https://docs.factory.ai/cli/droid-exec/cookbook/github-actions)

- Example 1: Automated PR Review and Fix
- Example 2: Daily Documentation and Test Updates
- Example 3: Security and Dependency Scanner

### [Improve Error Messages](https://docs.factory.ai/cli/droid-exec/cookbook/refactor-error-messages)

- How it works
- Get the script
- Prerequisites
- Basic usage
  - Preview changes (dry run)
  - Apply refactoring
- Summary
- Real-world transformations
  - Example 1: Session Authentication
  - Example 2: Bearer Token Authorization
- Best practices

### [Automated Lint Fixes](https://docs.factory.ai/cli/droid-exec/cookbook/refactor-fix-lint)

- How it works
- Get the script
- Prerequisites
- Basic usage
  - Preview violations (dry run)
  - Apply fixes
- Real-world transformations
  - Example 1: Simple GET Handler
  - Example 2: Cron Job Handler
- Best practices

### [Organize Imports](https://docs.factory.ai/cli/droid-exec/cookbook/refactor-imports)

- How it works
- Get the script
- Prerequisites
- Basic usage
  - Preview changes (dry run)
  - Apply refactoring
- Summary
- Real-world transformations
  - Example 1: CommonJS to ES6 Conversion
  - Example 2: Consolidating Duplicate Imports
- Best practices

### [Overview](https://docs.factory.ai/cli/droid-exec/overview)

- Summary and goals
- Execution model
- Installation
- Quickstart
- Autonomy Levels
  - DEFAULT (no flags) - Read-only Mode
  - `--auto low` - Low-risk Operations
  - `--auto medium` - Development Operations
  - `--auto high` - Production Operations
  - `--skip-permissions-unsafe` - Bypass All Checks
  - Fail-fast Behavior
- Output formats and artifacts
  - text (default)
  - json
  - debug
- Working directory
- Models and reasoning effort
- Batch and parallel patterns
- Unique usage examples
- Exit behavior
- Best practices

### [Common Use Cases](https://docs.factory.ai/cli/getting-started/common-use-cases)

- Understanding a new codebase
- Fixing bugs and debugging
- Building features
- Working with tests
- Safe refactoring
- Documentation and communication
- Enterprise integration
- Getting the most value
- Next steps

### [How to Talk to a Droid](https://docs.factory.ai/cli/getting-started/how-to-talk-to-a-droid)

- Core principles
- Writing effective prompts
- Planning versus doing
- Managing context
- Common workflows
- Enterprise integration
- Session management
- Advanced techniques
- Examples of good prompts
- What doesn't work well
- Getting better results

### [Overview](https://docs.factory.ai/cli/getting-started/overview)

- Get started in 30 seconds
- What `droid` brings to your workflow
- Why teams choose Factory
- Next steps
- Additional resources

### [Quickstart](https://docs.factory.ai/cli/getting-started/quickstart)

- Before you begin
- Step 1: Install and start droid
- Step 2: Explore your codebase
- Step 3: Make your first code change
- Step 4: Experience enterprise workflows
- Step 5: Handle version control
- Essential controls
  - Useful slash commands
- Collaboration best practices
- Pro tips for enterprise teams
- What's next?

### [Video Walkthrough](https://docs.factory.ai/cli/getting-started/video-walkthrough)

- Installation & Setup
  - First-Time Authentication
- Interface & Shortcuts
  - Help Menu
  - Essential Keyboard Shortcuts
- Autonomy Modes
- Slash Commands
  - Switching Models
  - Sessions Management
- Settings & Configuration
  - Core Settings
  - Advanced Settings
  - IDE Integration
- Configuration Files
  - Directory Structure
  - config.json - Bring Your Own Key
  - settings.json - Allow & Deny Lists
  - mcp.json - MCP Integrations
- Custom Droids (Sub-Agents)
  - Managing Droids
  - Creating a Custom Droid
  - Example Use Cases
- MCP Integrations
  - Adding MCPs via CLI
  - Listing Configured MCPs
  - Adding MCPs via Configuration File
  - Popular MCP Integrations
- Example Workflow: Spec Mode to Implementation
- Summary
- Next Steps

### [Auto-Run Mode](https://docs.factory.ai/cli/user-guides/auto-run)

- Autonomy levels at a glance
- Risk classification
- How Auto-Run decides what to execute
- Enabling and switching modes
- Workflow examples
- When you will still get prompted
- Best practices

### [Become a Power User](https://docs.factory.ai/cli/user-guides/become-a-power-user)

- Factory IDE Plugin ‚Äî Real-time context awareness
- Spec Mode ‚Äî Explore and plan first, code second
- AGENTS.md ‚Äî Your preferences, remembered
- Testing
- Code Style
- Common Commands
- Agent Readiness ‚Äî Let your tools do the teaching
- Combining all four for maximum impact

### [Choosing Your Model](https://docs.factory.ai/cli/user-guides/choosing-your-model)

- 1 ¬∑ Current stack rank (October 2025)
- 2 ¬∑ Match the model to the job
- 3 ¬∑ Switching models mid-session
- 4 ¬∑ Reasoning effort settings
- 5 ¬∑ Bring Your Own Keys (BYOK)
  - Open-source models
- 6 ¬∑ Keep notes on what works

### [Implementing Large Features](https://docs.factory.ai/cli/user-guides/implementing-large-features)

- When to use this workflow
- The workflow
- Phase 1: Master planning with Specification Mode
- Phase 2: Iterative implementation
  - Start a fresh session
  - Reference the master plan
  - Use Specification Mode for complex phases
  - Commit frequently
  - Create phase-specific PRs
- Phase 3: Validation and testing strategy
  - Test each phase independently
  - Use feature flags for gradual rollout
  - Automated testing at phase boundaries
- Best practices
- Recovery strategies

### [Specification Mode](https://docs.factory.ai/cli/user-guides/specification-mode)

- How it works
- Example workflow
- How to activate Specification Mode
- What happens during planning
- Writing effective requests
- Enterprise integration
- Benefits
- AGENTS.md integration
- Breaking down large features
- Specification approval options
- Saving your specifications as Markdown
- What happens after approval

## Guides

### [Building Interactive Apps with Droid Exec](https://docs.factory.ai/guides/building/droid-exec-tutorial)

- What this doc covers
- 1. Pre-requisites and Installation
  - Requirements
  - Installation
  - Try the Official Example
- 2. Why Use Droid Exec?
- 3. How It Works: The Core Pattern
  - Running Droid Exec
  - Key Flags Explained
- 4. Building the Chat Feature: Streaming with SSE
  - Server: Streaming SSE Endpoint
  - Event Types You'll Receive
  - Client: React Hook for SSE
  - Real-World Example: The Video
  - Project Structure (from the Example)
  - Configuration Options
  - Best Practices
- 5. Customization & Extensions
  - Swap the Data Source
  - Change Models on the Fly
  - Add Tool Call Visibility
- Additional Resources
- Next Steps

### [Deploy Droid on a VPS Server](https://docs.factory.ai/guides/building/droid-vps-setup)

- What this doc covers
- 1. Prerequisites and installation
- 2. Why use droid on a VPS?
- 3. Setup and basic usage
  - Step 1: Generate SSH keys with droid
  - Step 2: Copy the public key
  - Step 3: Create your VPS and add the SSH key
  - Step 4: Configure SSH for easy access
  - Step 5: Connect and install Droid on the VPS
  - Step 6: Authenticate Droid on the VPS
- 4. Advanced example: System administration with droid
  - Setting up Nginx with Docker
- 5. Droid exec: Headless automation and custom agents
  - What is droid exec?
  - Basic droid exec usage
  - Advanced: System exploration
- 6. Remote access from anywhere
  - Using Termius for mobile SSH access
  - Real-world scenarios
- Next steps

### [Product Guides](https://docs.factory.ai/guides/product/coming-soon)


## Onboarding

### [Configuring Your Droid YAML](https://docs.factory.ai/onboarding/configuring-your-factory/droid-yaml-configuration)

- Basic Structure
- Review Settings
  - Guidelines
  - Auto-Review Settings
  - Other Review Settings
- Validation

### [Configuring Your Droid YAML](https://docs.factory.ai/onboarding/configuring-your-review-droid/droid-yaml-configuration)

- Basic Structure
- Review Settings
  - Guidelines
  - Auto-Review Settings
  - Other Review Settings
- Validation

### [Review Droid Guidelines](https://docs.factory.ai/onboarding/configuring-your-review-droid/review-droid-guidelines)

- Configuring Guidelines
  - Basic Structure
  - Components of a Guideline
- Best Practices for Writing Guidelines
- Guideline Examples
  - Bugs & Errors
  - Readability
  - Error Handling
  - Security
  - Documentation
- Feedback Mechanism
- Conclusion

### [Overview of Factory Integrations](https://docs.factory.ai/onboarding/creating-your-factory/basic-integrations)

- Essential Integrations
  - 1. Source Code Management (Required)
  - 2. Project Management (Recommended)
  - 3. Knowledge Management (Recommended)
  - 4. Incident Management (Recommended)
- Security and Permissions
- Next Steps

### [Sign Up for Factory](https://docs.factory.ai/onboarding/creating-your-factory/signup)

- Signup Process
- Important Notes

### [Setting Up Single Sign-On (SSO)](https://docs.factory.ai/onboarding/creating-your-factory/sso-setup)

- Prerequisites
- Setup Process
- Troubleshooting

### [User Permissions](https://docs.factory.ai/onboarding/creating-your-factory/user-permissions)

- Outline of Permissions

### [Welcome to Factory Onboarding - Enterprise](https://docs.factory.ai/onboarding)

- Onboarding Process Overview
- Need Help?

### [GitHub Cloud](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/github-cloud)

- Prerequisites
- Integration Steps
- Verification
- Best Practices
- Troubleshooting

### [GitHub Enterprise Server](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/github-enterprise-server)

- Prerequisites
- Integration Process
- Troubleshooting
- Support

### [GitLab Cloud Integration](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/gitlab-cloud)

- Prerequisites
- Integration Steps
- Verification
- Best Practices
- Troubleshooting

### [GitLab Self-Hosted](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/gitlab-self-hosted)

- Prerequisites
- Integration Process
- Support

### [Google Drive](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/googledrive)

- Prerequisites
- Integration Steps
- Verification
- Troubleshooting

### [Jira](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/jira)

- Prerequisites
- Integration Steps
- Verification
- Best Practices
- Troubleshooting

### [Linear](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/linear)

- Prerequisites
- Integration Steps
- Verification
- Best Practices
- Troubleshooting

### [Notion](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/notion)

- Prerequisites
- Integration Steps
- Verification
- Troubleshooting

### [PagerDuty](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/pagerduty)

- PagerDuty + Factory Integration Benefits
- How it Works
- Requirements
- Support
- Integration Walkthrough
  - In PagerDuty
  - In Factory
    - Verifying the Integration
- How to Uninstall

### [Sentry](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/sentry)

- Prerequisites
- Integration Steps
- Usage
  - Issue Context
- Best Practices
- Troubleshooting

### [Slack](https://docs.factory.ai/onboarding/integrating-with-your-engineering-system/slack)

- Prerequisites
- Integration Steps
- Verification
- Slack Tools
- Additional Features
- Best Practices
- Troubleshooting

## Root

### [Pricing](https://docs.factory.ai/pricing)

- Pricing Tiers
- Model Pricing
  - Pricing Table
- Thinking About Tokens

## Web

### [Overview](https://docs.factory.ai/web/getting-started/overview)

- Why Factory?
- Getting Started
- Next Steps

### [Quickstart](https://docs.factory.ai/web/getting-started/quickstart)

- Step 1: Launch Factory
- Step 2: Configure Your Session
  - Local Connection (Bridge)
  - Remote Connection
- Step 3: Explore Your Codebase
- Step 4: Make Your First Code Change
- Step 5: Experience Enterprise Workflows
  - Security Audit
  - Integration with Team Tools
- Best Practices
  - Be Specific with Context
  - Leverage Organizational Knowledge
  - Use the Review Workflow
- Congratulations! üéâ
  - Next Steps

### [Factory Bridge Best Practices](https://docs.factory.ai/web/machine-connection/factory-bridge/best-practices)

- Workflow Integration
  - Development Environment Setup
  - Task Automation
- Performance Optimization
  - Resource Management
  - Command Execution Strategies
- Security Best Practices
  - Access Control
  - Command Execution Safety
  - Data Protection
- Advanced Integration Techniques
  - Chaining Tools Together
  - Custom Automation Scripts
- Troubleshooting Techniques
  - Diagnostic Strategies
  - Common Resolution Patterns
- Team Collaboration
- Real-world Examples

### [Factory Bridge CLI Tools Reference](https://docs.factory.ai/web/machine-connection/factory-bridge/cli-tools-reference)

- Available CLI Tools
- Overview
- Available CLI Tools
- Running Commands
  - How It Works
  - Examples
- Managing Processes
  - How It Works
- Interactive Applications
  - How It Works
  - Examples
- Best Practices
- Troubleshooting
- Security Considerations

### [Factory Bridge](https://docs.factory.ai/web/machine-connection/factory-bridge/installation-and-usage)

  - System Requirements
- Installation
- Getting Started
- Use Cases
  - Running Local CLI Commands
  - Managing Local Processes
  - Development Workflow Integration
- Troubleshooting
- Security Considerations

### [Model Context Protocol (MCP)](https://docs.factory.ai/web/machine-connection/factory-bridge/model-context-protocol)

- What is MCP?
- Configuring MCP Servers
  - Configuration Process
- Accessing the MCP Configuration File
- Server Types
  - Stdio Servers
  - Streamable HTTP Servers
- Configuration Format
  - Stdio Server Configuration
  - Streamable HTTP Server Configuration
  - Configuration Fields
  - Example Configuration
- Automatic Configuration Updates
- Disabling Servers
- Using MCP Tools in Factory
- Windows Troubleshooting ‚Äì `npx` Execution
  - Quick Fix ‚Äì wrap the call with `cmd /c`
- What's New
- Coming Soon
- Resources

### [Factory Bridge Troubleshooting](https://docs.factory.ai/web/machine-connection/factory-bridge/troubleshooting)

- Connection Issues
  - Bridge Not Connecting to Factory
  - Connection Drops Unexpectedly
- Command Execution Problems
  - Commands Not Executing
  - Command Returns Error
- Process Management Issues
  - Can't Find Process ID (PID)
  - Process Terminates Unexpectedly
- Installation Issues
  - Installation Fails
  - Factory Bridge Won't Start
- Feature Availability Issues
  - Missing CLI Tools
  - Session Limit Reached
- Advanced Troubleshooting
  - Check Factory Bridge Logs
  - Reset Factory Bridge
- Getting Additional Help

### [Remote Workspaces - Best Practices](https://docs.factory.ai/web/machine-connection/remote-workspaces/best-practices)

- 1. Smart Setup Script Practices
- 2. Workflow Patterns That Scale
- 3. Team Collaboration Tips
- 5. Troubleshooting at a Glance

### [Remote Workspaces](https://docs.factory.ai/web/machine-connection/remote-workspaces)

- Why use remote workspaces?
- Get Started
  - More to Explore

### [Remote Workspaces ‚Äì Installation & Usage](https://docs.factory.ai/web/machine-connection/remote-workspaces/installation-and-usage)

- System Requirements
- Launching a Remote Workspace inside a Session
- Everyday Usage
- Troubleshooting & Help

### [Remote Workspaces ‚Äì Setup Script](https://docs.factory.ai/web/machine-connection/remote-workspaces/setup-script)

- 1. How to define a setup script
- 2. Troubleshooting Tips

### [Remote Workspaces ‚Äì Troubleshooting](https://docs.factory.ai/web/machine-connection/remote-workspaces/troubleshooting)

- Quick Reference
- 1. Workspace Creation Issues
- 2. Connection Problems
- 3. Performance & Speed
- 4. General Usage Troubles
- Need More Help?

## Welcome

### [Welcome to Factory](https://docs.factory.ai/welcome)

- Why us?
- Get started in 5 minutes
- Quick links
</file>

<file path="docs/favicon.svg">
<svg width="900" height="900" viewBox="0 0 900 900" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="900" height="900" fill="white"/>
<path d="M582.594 251.356C581.452 251.073 580.385 250.547 579.466 249.813C578.546 249.08 577.795 248.156 577.266 247.106C576.736 246.055 576.44 244.903 576.397 243.728C576.354 242.552 576.565 241.381 577.017 240.295C592.606 202.357 599.485 172.002 588.384 159.294C558.984 125.58 441.083 192.624 403.49 215.331C402.484 215.936 401.358 216.316 400.19 216.446C399.023 216.577 397.841 216.454 396.725 216.086C395.61 215.718 394.587 215.113 393.727 214.314C392.866 213.515 392.188 212.539 391.739 211.453C375.937 173.596 359.325 147.264 342.487 146.122C297.857 143.068 261.885 273.85 251.355 316.475C251.074 317.616 250.55 318.683 249.817 319.603C249.085 320.522 248.162 321.273 247.113 321.803C246.064 322.332 244.912 322.629 243.738 322.672C242.563 322.715 241.393 322.504 240.308 322.052C202.37 306.463 172.002 299.584 159.307 310.685C125.593 340.085 192.624 457.987 215.33 495.579C215.938 496.585 216.32 497.711 216.451 498.879C216.583 500.047 216.46 501.229 216.092 502.346C215.724 503.462 215.119 504.485 214.318 505.346C213.517 506.206 212.54 506.883 211.453 507.33C173.609 523.132 147.277 539.744 146.121 556.581C143.08 601.211 273.85 637.184 316.488 647.714C317.627 647.998 318.691 648.525 319.608 649.259C320.525 649.992 321.273 650.914 321.801 651.963C322.329 653.011 322.624 654.161 322.668 655.335C322.711 656.508 322.501 657.677 322.052 658.761C306.463 696.699 299.584 727.067 310.685 739.762C340.084 773.476 458 706.445 495.592 683.739C496.598 683.131 497.724 682.749 498.892 682.618C500.06 682.486 501.243 682.609 502.359 682.977C503.475 683.345 504.498 683.95 505.358 684.751C506.219 685.552 506.896 686.529 507.344 687.616C523.145 725.46 539.744 751.792 556.594 752.948C601.224 755.989 637.196 625.219 647.713 582.581C647.998 581.441 648.525 580.375 649.259 579.457C649.993 578.539 650.917 577.79 651.967 577.262C653.017 576.733 654.169 576.438 655.344 576.396C656.519 576.354 657.689 576.566 658.775 577.018C696.712 592.607 727.067 599.472 739.775 588.384C773.49 558.985 706.445 441.069 683.738 403.477C683.136 402.47 682.757 401.345 682.628 400.178C682.499 399.011 682.622 397.83 682.99 396.715C683.358 395.6 683.961 394.577 684.76 393.717C685.558 392.856 686.532 392.177 687.616 391.726C725.473 375.924 751.805 359.312 752.947 342.475C756.001 297.845 625.219 261.873 582.594 251.356ZM531.391 208.572C539.969 223.948 495.765 326.408 462.886 398.073C462.337 399.271 461.433 400.273 460.297 400.942C459.161 401.611 457.847 401.917 456.532 401.817C455.217 401.717 453.964 401.217 452.942 400.384C451.92 399.551 451.178 398.424 450.816 397.157C437.537 350.561 422.36 295.813 406.12 249.338C405.482 247.514 405.513 245.522 406.209 243.719C406.905 241.917 408.219 240.42 409.917 239.498C450.471 217.349 519.865 187.936 531.391 208.572ZM337.044 221.253C353.974 226.06 395.165 329.767 422.585 403.69C423.042 404.925 423.111 406.271 422.781 407.546C422.451 408.821 421.739 409.965 420.74 410.824C419.741 411.683 418.503 412.215 417.193 412.35C415.882 412.485 414.562 412.215 413.409 411.577C371.037 388.061 321.627 360.043 277.276 338.664C275.539 337.822 274.157 336.39 273.377 334.625C272.596 332.86 272.468 330.875 273.013 329.023C286.066 284.726 314.297 214.813 337.044 221.253ZM208.585 367.651C223.948 359.073 326.42 403.278 398.073 436.156C399.271 436.706 400.272 437.61 400.942 438.746C401.611 439.882 401.916 441.196 401.816 442.51C401.717 443.825 401.217 445.078 400.383 446.1C399.55 447.122 398.424 447.864 397.156 448.227C350.575 461.506 295.813 476.683 249.337 492.923C247.515 493.557 245.526 493.524 243.727 492.828C241.927 492.133 240.433 490.82 239.511 489.125C217.402 448.572 187.936 379.177 208.585 367.651ZM221.266 561.999C226.06 545.069 329.78 503.878 403.703 476.457C404.938 476 406.284 475.932 407.559 476.262C408.834 476.592 409.978 477.304 410.837 478.303C411.695 479.301 412.228 480.539 412.363 481.85C412.498 483.16 412.228 484.48 411.59 485.633C388.06 528.006 360.042 577.416 338.663 621.754C337.827 623.496 336.398 624.884 334.631 625.668C332.864 626.451 330.876 626.579 329.023 626.029C284.725 613.056 214.813 584.746 221.266 561.999ZM367.664 690.458C359.073 675.094 403.291 572.622 436.169 500.97C436.719 499.772 437.623 498.77 438.759 498.101C439.895 497.431 441.209 497.126 442.523 497.226C443.838 497.326 445.091 497.826 446.113 498.659C447.135 499.492 447.877 500.618 448.24 501.886C461.518 548.468 476.696 603.23 492.936 649.705C493.569 651.529 493.534 653.518 492.836 655.318C492.137 657.118 490.822 658.612 489.125 659.532C448.585 681.641 379.177 711.106 367.704 690.458H367.664ZM562.012 677.777C545.068 672.983 503.877 569.263 476.457 495.34C475.997 494.103 475.927 492.754 476.257 491.477C476.587 490.199 477.301 489.053 478.302 488.193C479.304 487.334 480.545 486.802 481.858 486.669C483.171 486.537 484.493 486.81 485.646 487.452C528.005 510.969 577.429 539 621.767 560.379C623.507 561.217 624.891 562.648 625.672 564.414C626.453 566.181 626.58 568.168 626.029 570.02C612.989 614.384 584.759 684.23 562.012 677.777ZM690.47 531.378C675.094 539.97 572.635 495.751 500.969 462.873C499.771 462.323 498.77 461.42 498.1 460.284C497.431 459.148 497.126 457.834 497.226 456.519C497.325 455.204 497.825 453.952 498.659 452.93C499.492 451.908 500.618 451.165 501.886 450.803C548.481 437.524 603.229 422.346 649.705 406.106C651.531 405.472 653.522 405.508 655.325 406.206C657.127 406.904 658.622 408.219 659.544 409.918C681.64 450.458 711.106 519.866 690.47 531.378ZM677.789 337.03C672.983 353.974 569.275 395.165 495.353 422.586C494.116 423.046 492.767 423.115 491.489 422.785C490.212 422.455 489.066 421.742 488.206 420.74C487.346 419.739 486.815 418.498 486.682 417.185C486.55 415.872 486.823 414.549 487.465 413.396C510.982 371.037 539 321.614 560.379 277.276C561.219 275.537 562.65 274.154 564.416 273.374C566.182 272.593 568.168 272.465 570.019 273.013C614.317 286.053 684.23 314.284 677.789 337.03Z" fill="black"/>
</svg>
</file>

<file path="docs/pricing.mdx">
---
title: "Pricing"
description: "Model pricing in Standard Tokens"
---

## Pricing Tiers

Factory measures usage through Standard Tokens. Cached tokens are billed at one-tenth of a Standard Token (10 cached tokens = 1 Standard Token). We offer two subscription plans:

| Plan     | Standard Tokens / Month                       | Price / Month |
| -------- | --------------------------------------------- | ------------- |
| **Free** | BYOK                                          | $0            | 
| **Pro**  | 10 million (+10 million bonus tokens)         | $20           |
| **Max**  | 100 million (+100 million bonus tokens)       | $200          |
| **Ultra**| 1 billion (+1 billion bonus tokens)           | $2,000        | 

Overage is billed at $2.70 per million Factory Standard Tokens.

## Model Pricing

Different models have different multipliers applied to calculate Standard Token usage.

### Pricing Table

| Model             | Multiplier |
| ----------------- | ---------- |
| Droid Core        | 0.25√ó      |
| Claude Haiku 4.5  | 0.4√ó       |
| GPT-5             | 0.5√ó       |
| GPT-5-Codex       | 0.5√ó       |
| GPT-5.1           | 0.5√ó       |
| GPT-5.1-Codex     | 0.5√ó       |
| Gemini 2.5 Pro    | 0.5√ó       |
| Claude Sonnet 4   | 1.2√ó       |
| Claude Sonnet 4.5 | 1.2√ó       |
| Claude Opus 4.1   | 6√ó         |

## Thinking About Tokens

As a reference point, using GPT-5-Codex at its 0.5√ó multiplier alongside our typical cache ratio of 4‚Äì8√ó means your effective Standard Token usage goes dramatically further than raw on-demand calls. Switching to very expensive models frequently‚Äîor rotating models often enough to invalidate the cache‚Äîwill lower that benefit, but most workloads see materially higher usage ceilings compared with buying capacity directly from individual model providers. Our aim is for you to run your workloads without worrying about token math; the plans are designed so common usage patterns outperform comparable direct offerings.
</file>

<file path="docs/README.md">
# Mintlify Starter Kit (test)

Click on `Use this template` to copy the Mintlify starter kit. The starter kit contains examples including

- Guide pages
- Navigation
- Customizations
- API Reference pages
- Use of popular components

### Development

Install the [Mintlify CLI](https://www.npmjs.com/package/mintlify) to preview the documentation changes locally. To install, use the following command

```
npm i -g mintlify
```

Run the following command at the root of your documentation (where mint.json is)

```
mintlify dev
```

### Publishing Changes

Install our Github App to auto propagate changes from your repo to your deployment. Changes will be deployed to production automatically after pushing to the default branch. Find the link to install on your dashboard.

#### Troubleshooting

- Mintlify dev isn't running - Run `mintlify install` it'll re-install dependencies.
- Page loads as a 404 - Make sure you are running in a folder with `mint.json`
</file>

<file path="docs/style.css">
/* Fix for welcome page paragraph FOUC */
.text-primary-light[style*="color: #ffffff"] {
    color: #ffffff !important;
    max-width: 42rem !important;
    margin-top: 1rem !important;
}

.hero {
    background-color: #FF0000;
    /* Red background */
    width: 100%;
    padding: 60px 0;
    color: white;
    text-align: center;
}

.hero-content {
    max-width: 800px;
    margin: 0 auto;
}

.hero h1 {
    font-size: 48px;
    margin-bottom: 20px;
}

.hero p {
    font-size: 24px;
    margin-bottom: 30px;
}

.hero-image {
    max-width: 100%;
    height: auto;
    margin-bottom: 30px;
}

.cta-button {
    display: inline-block;
    padding: 12px 24px;
    background-color: white;
    color: #FF0000;
    text-decoration: none;
    font-weight: bold;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.cta-button:hover {
    background-color: #FFCCCC;
}

/* Increase main content area width */
#content-area {
    max-width: 850px !important;
}

/* Use SF Mono for sidebar titles */
#sidebar-title {
    font-family: "SF Mono", monospace !important;
}

/* Unfocused sidebar navigation link color - soft gray */
a.text-gray-700:not(.text-primary),
button.text-gray-700.border-l:not(.text-primary) {
    color: #999999 !important;
}

a.text-gray-700:not(.text-primary):hover,
button.text-gray-700.border-l:not(.text-primary):hover,
a.text-gray-700.hover\:text-gray-900:not(.text-primary):hover,
button.text-gray-700.hover\:text-gray-900.border-l:not(.text-primary):hover {
    color: #333333 !important;
    border-left-color: #333333 !important;
}

.dark a.dark\:text-gray-400:not(.text-primary),
.dark button.dark\:text-gray-400.border-l:not(.text-primary),
a.text-gray-700.dark\:text-gray-400:not(.text-primary),
button.text-gray-700.dark\:text-gray-400.border-l:not(.text-primary) {
    color: #888888 !important;
}

.dark a.dark\:text-gray-400:not(.text-primary):hover,
.dark button.dark\:text-gray-400.border-l:not(.text-primary):hover,
.dark a.dark\:hover\:text-gray-300:not(.text-primary):hover,
.dark button.dark\:hover\:text-gray-300.border-l:not(.text-primary):hover {
    color: #CCCCCC !important;
    border-left-color: #CCCCCC !important;
}

/* Prose font size and color */
.prose {
    font-size: 15px !important;
    color: #5c5855 !important;
}

.dark .prose {
    color: #d1d1d1 !important;
}

/* Headers use Geist Mono */
h1, h2, h3, h4, h5, h6 {
    font-family: "Geist Mono", monospace !important;
}

/* Eyebrow section label in orange */
.eyebrow {
    color: #F27B2F !important;
}

/* All card icons in orange */
.card .bg-primary,
.card svg.bg-primary {
    background-color: #F27B2F !important;
}

.dark .card .bg-primary,
.dark .card .dark\:bg-primary-light,
.dark .card svg.dark\:bg-primary-light {
    background-color: #F27B2F !important;
}

/* Active sidebar navigation link color */
a.text-primary.border-primary {
    color: #F27B2F !important;
    border-left-color: #F27B2F !important;
    font-weight: 400 !important;
}

.dark a.text-primary.border-primary {
    color: #F27B2F !important;
    border-left-color: #F27B2F !important;
    font-weight: 400 !important;
}

/* Table of contents default softer color */
#table-of-contents-content a {
    color: #999999 !important;
}

#table-of-contents-content a:hover {
    color: #333333 !important;
}

.dark #table-of-contents-content a {
    color: #888888 !important;
}

.dark #table-of-contents-content a:hover {
    color: #f5f5f5 !important;
}

/* Maintain font-weight for TOC items across light/dark modes */
.toc-item a.font-medium {
    font-weight: 500 !important;
}

/* Active/focused table of contents link color */
#table-of-contents-content a.text-primary,
#table-of-contents-content a.border-primary {
    color: #F27B2F !important;
    border-color: #F27B2F !important;
}

.dark #table-of-contents-content a.text-primary,
.dark #table-of-contents-content a.border-primary {
    color: #F27B2F !important;
    border-color: #F27B2F !important;
}
</file>

<file path="examples/droid-code-review-workflow/.github/workflows/droid-code-review.yml">
name: Droid Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

concurrency:
  group: droid-review-${{ github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  pull-requests: write
  contents: read
  issues: write

jobs:
  code-review:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    if: github.event.pull_request.draft == false

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Install Droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          "$HOME/.local/bin/droid" --version

      - name: Configure git identity
        run: |
          git config user.name "Droid Agent"
          git config user.email "droidagent@factory.ai"

      - name: Prepare review context
        run: |
          set -euo pipefail

          git fetch origin ${{ github.event.pull_request.base.ref }}
          git diff origin/${{ github.event.pull_request.base.ref }}...${{ github.event.pull_request.head.sha }} > diff.txt

          curl --fail --silent --show-error \
               -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               -H "Accept: application/vnd.github.v3+json" \
               "https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.pull_request.number }}/comments" \
               -o existing_comments.json

          curl --fail --silent --show-error \
               -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               -H "Accept: application/vnd.github.v3+json" \
               "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/comments" \
               -o review_threads.json

          curl --fail --silent --show-error \
               -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               -H "Accept: application/vnd.github.v3+json" \
               "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files" \
               | jq '[.[] | {filename: .filename, patch: .patch}]' > files.json

          jq -r '.pull_request.body // ""' "$GITHUB_EVENT_PATH" > pr_description.txt

      - name: Perform automated code review
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          cat > prompt.txt << 'EOF'
          You are an automated code review system. Review the PR diff and identify clear issues that need to be fixed.

          Input files (already in current directory):
          - diff.txt: the code changes to review
          - files.json: file patches with line numbers for positioning comments
          - existing_comments.json: skip issues already mentioned here
          - review_threads.json: conversation threads and resolution state for inline reviews (includes comment ids for replying)
          - pr_description.txt: the pull request description for additional context

          Task: Create a file called comments.json with one entry per comment. Each entry must be either:
          1. A new inline comment with this shape:
             { "path": "path/to/file.js", "position": 42, "body": "Your comment here" }
          2. A reply to an existing inline comment with this shape:
             { "in_reply_to": 123456789, "body": "Follow-up text" }
             (the in_reply_to value must come from the `id` field in review_threads.json)

          Focus on these types of issues:
          - Dead/unreachable code (if (false), while (false), code after return/throw/break)
          - Broken control flow (missing break in switch, fallthrough bugs)
          - Async/await mistakes (missing await, .then without return, unhandled promise rejections)
          - Array/object mutations in React components or reducers
          - UseEffect dependency array problems (missing deps, incorrect deps)
          - Incorrect operator usage (== vs ===, && vs ||, = in conditions)
          - Off-by-one errors in loops or array indexing
          - Integer overflow/underflow in calculations
          - Regex catastrophic backtracking vulnerabilities
          - Missing base cases in recursive functions
          - Incorrect type coercion that changes behavior
          - Environment variable access without defaults or validation
          - Null/undefined dereferences
          - Resource leaks (unclosed files or connections)
          - SQL/XSS injection vulnerabilities
          - Concurrency/race conditions
          - Missing error handling for critical operations

          Comment format:
          - Clearly describe the issue: "This code block is unreachable due to the if (false) condition"
          - Provide a concrete fix: "Remove this entire if block as it will never execute"
          - When possible, suggest the exact code change:
            '''suggestion
            // Remove the unreachable code
            '''
          - Be specific about why it's a problem: "This will cause a TypeError if input is null"
          - No emojis, just clear technical language

          Skip commenting on:
          - Code style, formatting, or naming conventions
          - Minor performance optimizations
          - Architectural decisions or design patterns
          - Features or functionality (unless broken)
          - Test coverage (unless tests are clearly broken)

          You may open and read other repository files beyond those listed above when it helps you understand the change, but keep all review comments anchored to the modified lines in this PR.

          Use review_threads.json and existing_comments.json to:
          - Avoid repeating resolved issues unless the problem still exists.
          - Reference ongoing discussions when adding a follow-up or clarification.
          - Prefer replying to existing open threads instead of creating duplicates when addressing the same code (use the in_reply_to format above).
          - Ignore your own previous comments that have been resolved unless the underlying issue is still present.

          Position calculation:
          - Use the "position" field from files.json patches
          - This is the line number in the diff, not the file
          - Comments must align with exact changed lines only

          Output: 
          - Empty array [] if no issues found
          - Otherwise array of comment objects with path, position, body
          - Each comment should be actionable and clear about what needs to be fixed
          - Maximum 10 comments total; prioritize the most critical issues
          EOF

          echo "Running code review analysis..."
          droid exec --auto high --model claude-sonnet-4-5-20250929 -f prompt.txt

          if [ ! -f comments.json ]; then
            echo "‚ùå ERROR: droid exec did not create comments.json"
            echo "This usually indicates the review run failed (e.g. missing FACTORY_API_KEY or runtime error)."
            exit 1
          fi

          echo "=== Review Results ==="
          cat comments.json

      - name: Submit inline review comments
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const prNumber = context.payload.pull_request.number;

            if (!fs.existsSync('comments.json')) {
              core.info('comments.json missing; skipping review submission');
              return;
            }

            const rawComments = JSON.parse(fs.readFileSync('comments.json', 'utf8'));

            if (!Array.isArray(rawComments)) {
              core.warning('comments.json is not an array; skipping review submission');
              return;
            }

            const formattedComments = rawComments.flatMap((comment, index) => {
              if (!comment || typeof comment !== 'object') {
                core.warning(`Skipping comment at index ${index}: expected object`);
                return [];
              }

              if ('in_reply_to' in comment) {
                const replyId = comment.in_reply_to;
                if (typeof replyId !== 'number') {
                  core.warning(`Skipping reply at index ${index}: in_reply_to must be a number`);
                  return [];
                }
                if (typeof comment.body !== 'string' || comment.body.trim().length === 0) {
                  core.warning(`Skipping reply at index ${index}: body must be a non-empty string`);
                  return [];
                }
                return [{ type: 'reply', in_reply_to: replyId, body: comment.body }];
              }

              if (
                typeof comment.path === 'string' &&
                typeof comment.position === 'number' &&
                typeof comment.body === 'string' &&
                comment.body.trim().length > 0
              ) {
                return [
                  {
                    type: 'new',
                    path: comment.path,
                    position: comment.position,
                    body: comment.body,
                  },
                ];
              }

              core.warning(
                `Skipping comment at index ${index}: must provide either {path, position, body} for new comments or {in_reply_to, body} for replies`
              );
              return [];
            });

            const newComments = formattedComments.filter(c => c.type === 'new').map(({ type, ...rest }) => rest);
            const replyComments = formattedComments.filter(c => c.type === 'reply').map(({ type, ...rest }) => rest);

            if (newComments.length === 0 && replyComments.length === 0) {
              const existing = await github.paginate(github.rest.issues.listComments, {
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                per_page: 100
              });
              
              const hasNoIssuesComment = existing.some(c => 
                c.user.login.includes('[bot]') && 
                /no issues found|lgtm|‚úÖ/i.test(c.body || '')
              );
              
              if (!hasNoIssuesComment) {
                await github.rest.pulls.createReview({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  pull_number: prNumber,
                  event: 'COMMENT',
                  body: '‚úÖ No issues found in the current changes.'
                });
              }
              return;
            }

            if (newComments.length > 0) {
              const summary = `Found ${newComments.length} potential issue${newComments.length === 1 ? '' : 's'} that should be addressed.`;

              await github.rest.pulls.createReview({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: prNumber,
                event: 'COMMENT',
                body: summary,
                comments: newComments
              });

              core.info(`Submitted review with ${newComments.length} inline comments`);
            }

            for (const reply of replyComments) {
              await github.rest.pulls.createReplyForReviewComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: prNumber,
                comment_id: reply.in_reply_to,
                body: reply.body,
              });
            }

            if (replyComments.length > 0) {
              core.info(`Submitted ${replyComments.length} inline reply${replyComments.length === 1 ? '' : 'ies'}`);
            }

      - name: Upload debug artifacts on failure
        if: ${{ failure() }}
        uses: actions/upload-artifact@v4
        with:
          name: droid-review-debug-${{ github.run_id }}
          path: |
            diff.txt
            files.json
            existing_comments.json
            review_threads.json
            prompt.txt
            pr_description.txt
            comments.json
            ${{ runner.home }}/.factory/logs/droid-log-single.log
            ${{ runner.home }}/.factory/logs/console.log
          if-no-files-found: ignore
          retention-days: 7
</file>

<file path="examples/droid-code-review-workflow/README.md">
# Droid Code Review Workflow

This directory contains a sample GitHub Actions workflow that uses Droid to automatically review pull requests in your repository.

## How to use

1.  **Copy the workflow file**:

    Copy the `droid-code-review.yml` file from this directory into your own repository's `.github/workflows/` directory.

2.  **Configure Secrets**:

    This workflow requires one secret to be added to your repository:

    *   `FACTORY_API_KEY`: Your Factory AI API key.

    To get your API key, sign in to Factory, click your profile in the top right, go to **Settings** ‚Üí **API Keys**, and create a key there. Once created, you won‚Äôt be able to view the key again, but you can always generate new ones.

    To add it:

    *   Go to your repository's **Settings** tab.
    *   In the **Security** section of the sidebar, select **Secrets and variables** > **Actions**.
    *   Click **New repository secret**.
    *   Name the secret `FACTORY_API_KEY` and paste your API key into the **Value** field.

    **Note on `GH_TOKEN`**: This workflow uses the built-in `secrets.GITHUB_TOKEN` to interact with the GitHub API. GitHub prevents creating secrets with a `GITHUB_` prefix. For this reason, the workflow assigns `secrets.GITHUB_TOKEN` to an environment variable named `GH_TOKEN`, which the Droid agent then uses. You do not need to create this secret yourself.
    *   Your GitHub Token will need `contents: read`, `pull requests: read and write` and `issues: write` access

4.  **Create a pull request**:

    Once the workflow file and API key are in place, Droid will automatically review any new pull requests you create.
</file>

<file path="community-builds.md">
# Community builds

A curated list of community-built examples and projects using Factory. To add yours, open a PR to this file.

- [here-now](https://github.com/fredrivett/here-now) - Minimal webpage hit counter ‚Äî¬†show how many people are here/now by [fredrivett](https://github.com/fredrivett)
- [factory-mcp](https://github.com/iannuttall/factory-mcp) - Community-built Factory MCP integration to search our docs by [iannuttall](https://github.com/iannuttall)
- [Factory CLI with ChatGPT Codex / Claude subscription via CLIProxyAPI](https://gist.github.com/chandika/c4b64c5b8f5e29f6112021d46c159fdd) - Guide to run Factory CLI against Claude Code Max or ChatGPT Codex through CLIProxyAPI by [chandika](https://github.com/chandika)
- [Factory CLI with Claude subscription via CLIProxyAPI](https://gist.github.com/ben-vargas/9f1a14ac5f78d10eba56be437b7c76e5) - Setup instructions for using Factory CLI with Claude Code Max through CLIProxyAPI by [ben-vargas](https://github.com/ben-vargas)
- [GrayPane ‚Äì Flight Search & Alerts](https://github.com/punitarani/flights-tracker) - Check available flights, monitor price trends, plan upcoming trips, and create personalized alerts by [Punit Arani](https://github.com/punitarani)
</file>

<file path="README.md">
# Factory

The agent-native development platform. Works across CLI, Web, Slack/Teams, Linear/Jira and Mobile.

Our agent, Droid, is top performing in terminal benchmarks.

<p align="left">
  <img src="docs/images/droid_ascii.gif" alt="Droid logo" height="220" />
</p>

<p align="left"><strong>The agent-native development platform built for shipping software faster.</strong></p>

## Getting Started

- [CLI Quickstart](https://docs.factory.ai/cli/getting-started/quickstart)
- [VS Code Extension](https://marketplace.visualstudio.com/items?itemName=Factory.factory-vscode-extension)

## Quick Links

- [Factory Website](https://factory.ai)
- [Documentation](https://docs.factory.ai)
- [CLI Overview](https://docs.factory.ai/cli/getting-started/overview)
- [Community Builds](./community-builds.md)

## Community & Contributions

- Join the community on [GitHub Discussions](https://github.com/Factory-AI/factory/discussions)
- Share your workflows by opening a PR against [`community-builds.md`](./community-builds.md)
- Bug/issue/feature request? [Open an issue](https://github.com/Factory-AI/factory/issues) or send a pull request

## Community Builds

- [here-now](https://github.com/fredrivett/here-now) - Minimal webpage hit counter ‚Äî¬†show how many people are here/now by [fredrivett](https://github.com/fredrivett)
- [factory-mcp](https://github.com/iannuttall/factory-mcp) - Community-built Factory MCP integration to search our docs by [iannuttall](https://github.com/iannuttall)
- [Factory CLI with ChatGPT Codex / Claude subscription via CLIProxyAPI](https://gist.github.com/chandika/c4b64c5b8f5e29f6112021d46c159fdd) - Guide to run Factory CLI against Claude Code Max or ChatGPT Codex through CLIProxyAPI by [chandika](https://github.com/chandika)
- [Factory CLI with Claude subscription via CLIProxyAPI](https://gist.github.com/ben-vargas/9f1a14ac5f78d10eba56be437b7c76e5) - Setup instructions for using Factory CLI with Claude Code Max through CLIProxyAPI by [ben-vargas](https://github.com/ben-vargas)
- [GrayPane ‚Äì Flight Search & Alerts](https://github.com/punitarani/flights-tracker) - Check available flights, monitor price trends, plan upcoming trips, and create personalized alerts by [Punit Arani](https://github.com/punitarani)

## License

Copyright ¬© 2025 Factory AI. All rights reserved.
</file>

</files>
